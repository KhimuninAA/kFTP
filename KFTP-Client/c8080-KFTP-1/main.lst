# file opened: main.asm
   1  0000                  device zxspectrum48 ; There is no ZX Spectrum, it is needed for the sjasmplus assembler.
   2  0000              ordos_wnd equ 49110
   3  0000              ordos_sdma equ 49104
   4  0000              ordos_watf equ 49098
   5  0000              ordos_wfile equ 49143
   6  0000              ordos_stop equ 49122
   7  0000              ordos_dirm equ 49128
   8  0000              ordos_start equ 49149
   9  0000              ordos_mxdsk equ 49080
  10  0000              ordos_rmax equ 49089
  11  0000              ordos_wdisk equ 49119
  12  0000              ordos_rdisk equ 49116
  13  0000              fontaddress equ 62417
  14  0000              inverceaddress equ 62419
  15  0000              printhexa equ 63509
  16  0000              printchata equ 63503
  17  0000              printchatc equ 63497
  18  0000              writebyteinothermem equ 63545
  19  0000              setposcursor equ 63548
  20  0000              getposcursor equ 63518
  21  0000              printhlstr equ 63512
  22  0000              getkeyboardchara equ 63491
  23  0000              getkeyboardstatea equ 63506
  24  0000              getkeyboardcodea equ 63515
  25  0000              vv55_setup equ 62979
  26  0000              vv55_port_c equ 62978
  27  0000              ; 12 void ordos_wnd() __address(0xbfd6);
  28  0000              ; 13 ///запись н/адреса буфера имени файла
  29  0000              ; 14 void ordos_sdma() __address(0xbfd0);
  30  0000              ; 15 ///запись адресов (н/к) блока озу
  31  0000              ; 16 void ordos_watf() __address(0xbfca);
  32  0000              ; 17 ///пп.записи файла на диск
  33  0000              ; 18 void ordos_wfile() __address(0xbff7);
  34  0000              ; 19 ///запись стоп-слова в диск
  35  0000              ; 20 void ordos_stop() __address(0xbfe2);
  36  0000              ; 21 /// вывод каталога диска в буфер
  37  0000              ; 22 void ordos_dirm() __address(0xbfe8);
  38  0000              ; 23 /// вход в ос "ordos"
  39  0000              ; 24 void ordos_start() __address(0xbffd);
  40  0000              ; 25 /// конеч.адрес программ.на диске (FF адрес стоп байта) HL
  41  0000              ; 26 void ordos_mxdsk() __address(0xbfb8);
  42  0000              ; 27 /// чтение максимального адреса диска HL
  43  0000              ; 28 void ordos_rmax() __address(0xbfc1);
  44  0000              ; 29 /// запись байта в диск HL-addr A-byte
  45  0000              ; 30 void ordos_wdisk() __address(0xbfdf);
  46  0000              ; 31 /// чтение байта из диска HL-addr A-byte
  47  0000              ; 32 void ordos_rdisk() __address(0xbfdc);
  48  0000              ; 12 extern uint16_t fontAddress __address(0xF3D1);
  49  0000              ; 13 ///ячейка, хранящая признак прямого (00Н) вывода (светлые символы на темном фоне) или инверсного (0FFH) вывода (темные символы на светлом фоне)
  50  0000              ; 14 extern uint16_t inverceAddress __address(0xF3D3);
  51  0000              ; 15
  52  0000              ; 16 ///-----* Функции Монитора *-------
  53  0000              ; 17 ///Вывод на экран HEX из регистра A
  54  0000              ; 18 void printHexA() __address(0xF815);
  55  0000              ; 19 ///Вывод символа на экран из регистра A
  56  0000              ; 20 void printChatA() __address(0xF80F);
  57  0000              ; 21 ///Вывод символа на экран из регистра С
  58  0000              ; 22 void printChatC() __address(0xF809);
  59  0000              ; 23 ///ЗАПИСЬ БАЙТА В ДОП. СТРАНИЦУ HL — АДРЕСА — N СТРАНИЦЫ (0-3) C — ЗАПИСЫВАЕМЫЙ БАЙТ
  60  0000              ; 24 void writeByteInOtherMem() __address(0xF839);
  61  0000              ; 25 ///УСТАНОВКА КУРСОРА ВХ. Н — НОМЕР СТРОКИ — Y L — НОМЕР ПОЗИЦИИ — X
  62  0000              ; 26 void setPosCursor() __address(0xF83C);
  63  0000              ; 27 ///ЗАПРОС ПОЛОЖЕНИЯ КУРСОРА Н - НОМЕР СТРОКИ - Y , L - НОМЕР ПОЗИЦИИ - X
  64  0000              ; 28 void getPosCursor() __address(0xF81E);
  65  0000              ; 29 ///ВЫВОД НА ЭКРАН СООБЩЕНИЯ ВХ.: HL- - АДРЕС НАЧАЛА КОНЕЧНЫЙ БАЙТ - 00Н
  66  0000              ; 30 void printHLStr() __address(0xF818);
  67  0000              ; 31
  68  0000              ; 32 ///ВВОД C СИМВОЛА С КЛАВИАТУРЫ А - ВВЕДЕННЫЙ СИМВОЛ
  69  0000              ; 33 void getKeyboardCharA() __address(0xF803);
  70  0000              ; 34 ///ОПРОС СОСТОЯНИЯ КЛАВИАТУРЫ А = 00Н - НЕ НАЖАТА , А = 0FFH - НАЖАТА
  71  0000              ; 35 void getKeyboardStateA() __address(0xF812);
  72  0000              ; 36 ///ВВОД КОДА НАЖАТОЙ КЛАВИШИ А = 0FFH - НЕ НАЖАТА А = 0FEH - РУС/ЛАТ ИНАЧЕ - КОД КЛАВИШИ
  73  0000              ; 37 void getKeyboardCodeA() __address(0xF81B);
  74  0000              ; 11 extern uint16_t VV55_SETUP __address(0xF603);
  75  0000              ; 12 extern uint16_t VV55_PORT_C __address(0xF602);
  76  0000
  77  0000                  org 0x00F0
  78  00F0
  79  00F0              ; 21 uint8_t appName[] = {'K','F','T','P','$',' ',' ',' '};
  80  00F0              appname:
  81  00F0 4B           	db 75
  82  00F1 46           	db 70
  83  00F2 54           	db 84
  84  00F3 50           	db 80
  85  00F4 24           	db 36
  86  00F5 20           	db 32
  87  00F6 20           	db 32
  88  00F7 20           	db 32
  89  00F8
  90  00F8
  91  00F8 00 01            DB 0x00, 0x01
  92  00FA
  93  00FA 00 20            DB 0x00, 0x20
  94  00FC
  95  00FC 00 00 00 00      DB 0x00, 0x00, 0x00, 0x00
  96  0100
  97  0100              ; 32 void main(){
  98  0100              main:
  99  0100              ; 33     updateDiskList();
 100  0100 CD 8C 03     	call updatedisklist
 101  0103              ; 34     initI2C();
 102  0103 CD 12 12     	call initi2c
 103  0106              ; 35     ///
 104  0106              ; 36
 105  0106              ; 37     /// WiFI
 106  0106              ; 38     //delay5msI2C(); delay5msI2C();
 107  0106              ; 39     getSSIDValue();
 108  0106 CD F2 13     	call getssidvalue
 109  0109              ; 40     //delay5msI2C(); delay5msI2C();
 110  0109              ; 41     getSSIDPasswordValue();
 111  0109 CD 10 14     	call getssidpasswordvalue
 112  010C              ; 42
 113  010C              ; 43     /// FTP
 114  010C              ; 44     //delay5msI2C(); delay5msI2C();
 115  010C              ; 45     getFTPUrl();
 116  010C CD 4D 15     	call getftpurl
 117  010F              ; 46     //delay5msI2C(); delay5msI2C();
 118  010F              ; 47     getFTPUser();
 119  010F CD BD 15     	call getftpuser
 120  0112              ; 48     //delay5msI2C(); delay5msI2C();
 121  0112              ; 49     getFTPPassword();
 122  0112 CD 2D 16     	call getftppassword
 123  0115              ; 50     //delay5msI2C(); delay5msI2C();
 124  0115              ; 51     getFTPPort();
 125  0115 CD 9D 16     	call getftpport
 126  0118              ; 52     getFtpCurrentPath();
 127  0118 CD 92 18     	call getftpcurrentpath
 128  011B              ; 53
 129  011B              ; 54     ///
 130  011B              ; 55     updateRootUI();
 131  011B CD E2 01     	call updaterootui
 132  011E              ; 56
 133  011E              ; 57     updateRootDataUI();
 134  011E CD DF 01     	call updaterootdataui
 135  0121              ; 58
 136  0121              ; 59     //Бесконечный цикл. Что бы увидеть результат
 137  0121              ; 60     for (;;) {
 138  0121              l_1:
 139  0121              ; 61         getKeyboardStateA();
 140  0121 CD 12 F8     	call getkeyboardstatea
 141  0124              ; 62         if (a == 0xFF) {
 142  0124 FE FF        	cp 255
 143  0126 C2 2F 01     	jp nz, l_3
 144  0129              ; 63             // Если клавиша нажата - вызываем обработчик
 145  0129              ; 64             keyboardEvent();
 146  0129 CD 53 01     	call keyboardevent
 147  012C C3 50 01     	jp l_4
 148  012F              l_3:
 149  012F              ; 65         } else {
 150  012F              ; 66             a = rootTimerTike;
 151  012F 3A 5C 1F     	ld a, (roottimertike)
 152  0132              ; 67             if (a >= 240) {
 153  0132 FE F0        	cp 240
 154  0134 DA 4C 01     	jp c, l_5
 155  0137              ; 68                 a = 0;
 156  0137 3E 00        	ld a, 0
 157  0139              ; 69                 rootTimerTike = a;
 158  0139 32 5C 1F     	ld (roottimertike), a
 159  013C              ; 70                 if ((a = rootViewCurrentView) == rootViewCurrentDiskView) {
 160  013C 3A 93 0F     	ld a, (rootviewcurrentview)
 161  013F B7           	or a
 162  0140 C2 49 01     	jp nz, l_7
 163  0143              ; 71                     updateWiFiStatus();
 164  0143 CD D3 0A     	call updatewifistatus
 165  0146              ; 72                     updateFtpStatus();
 166  0146 CD 19 08     	call updateftpstatus
 167  0149              l_7:
 168  0149 C3 50 01     	jp l_6
 169  014C              l_5:
 170  014C              ; 73                 }
 171  014C              ; 74             } else {
 172  014C              ; 75                 a++;
 173  014C 3C           	inc a
 174  014D              ; 76                 rootTimerTike = a;
 175  014D 32 5C 1F     	ld (roottimertike), a
 176  0150              l_6:
 177  0150              l_4:
 178  0150 C3 21 01     	jp l_1
 179  0153              ; 77             }
 180  0153              ; 78         }
 181  0153              ; 79     }
 182  0153              ; 80 }
 183  0153              ; 81
 184  0153              ; 82 void keyboardEvent() {
 185  0153              keyboardevent:
 186  0153              ; 83     getKeyboardCodeA();
 187  0153 CD 1B F8     	call getkeyboardcodea
 188  0156              ; 84     l = a; //Save key
 189  0156 6F           	ld l, a
 190  0157              ; 85     if ((a = rootViewOldKey) != l) {
 191  0157 3A D4 0F     	ld a, (rootviewoldkey)
 192  015A BD           	cp l
 193  015B CA DE 01     	jp z, l_9
 194  015E              ; 86         a = l; //Load key
 195  015E 7D           	ld a, l
 196  015F              ; 87         rootViewOldKey = a;
 197  015F 32 D4 0F     	ld (rootviewoldkey), a
 198  0162              ; 88         push_pop(hl) {
 199  0162 E5           	push hl
 200  0163              ; 89             a = l; //Load key
 201  0163 7D           	ld a, l
 202  0164              ; 90             if (a != 0xFF) {
 203  0164 FE FF        	cp 255
 204  0166 CA DD 01     	jp z, l_11
 205  0169              ; 91                 /// Hot ley
 206  0169              ; 92                 if (a == 0x03) { //F4 quit ordos
 207  0169 FE 03        	cp 3
 208  016B C2 74 01     	jp nz, l_13
 209  016E              ; 93                     ordos_start();
 210  016E CD FD BF     	call ordos_start
 211  0171 C3 87 01     	jp l_14
 212  0174              l_13:
 213  0174              ; 94                 } else if (a == 0x02) { //F3 Open FTP settings
 214  0174 FE 02        	cp 2
 215  0176 C2 7F 01     	jp nz, l_15
 216  0179              ; 95                     needOpenFTPSettingsEditView();
 217  0179 CD 2F 05     	call needopenftpsettingseditview
 218  017C C3 87 01     	jp l_16
 219  017F              l_15:
 220  017F              ; 96                 } else if (a == 0x01) { //F2 Open WiFi settings
 221  017F FE 01        	cp 1
 222  0181 C2 87 01     	jp nz, l_17
 223  0184              ; 97                     needOpenWiFiSettingsEditView();
 224  0184 CD 50 08     	call needopenwifisettingseditview
 225  0187              l_17:
 226  0187              l_16:
 227  0187              l_14:
 228  0187              ; 98                 }
 229  0187              ; 99
 230  0187              ; 100                 /// View's
 231  0187              ; 101                 if ((a = rootViewCurrentView) == rootViewCurrentDiskView) { // Local disk
 232  0187 3A 93 0F     	ld a, (rootviewcurrentview)
 233  018A B7           	or a
 234  018B C2 98 01     	jp nz, l_19
 235  018E              ; 102                     a = l; //Load key
 236  018E 7D           	ld a, l
 237  018F              ; 103                     diskViewKeyA();
 238  018F CD 46 04     	call diskviewkeya
 239  0192              ; 104                     showDiskList(); //Refresh
 240  0192 CD 9C 03     	call showdisklist
 241  0195 C3 DD 01     	jp l_20
 242  0198              l_19:
 243  0198              ; 105                 } else if ((a = rootViewCurrentView) == rootViewCurrentFTPView) { // FTP Dir
 244  0198 3A 93 0F     	ld a, (rootviewcurrentview)
 245  019B FE 01        	cp 1
 246  019D C2 AA 01     	jp nz, l_21
 247  01A0              ; 106                     a = l; //Load key
 248  01A0 7D           	ld a, l
 249  01A1              ; 107                     ftpViewKeyA();
 250  01A1 CD 7F 19     	call ftpviewkeya
 251  01A4              ; 108                     ftpViewDataUpdate();
 252  01A4 CD 1A 19     	call ftpviewdataupdate
 253  01A7 C3 DD 01     	jp l_22
 254  01AA              l_21:
 255  01AA              ; 109                 } else if ((a = rootViewCurrentView) == rootViewCurrentFTPSettingsEditView) {
 256  01AA 3A 93 0F     	ld a, (rootviewcurrentview)
 257  01AD FE 02        	cp 2
 258  01AF C2 BC 01     	jp nz, l_23
 259  01B2              ; 110                     a = l; //Load key
 260  01B2 7D           	ld a, l
 261  01B3              ; 111                     ftpSettingsEditViewKeyA();
 262  01B3 CD AA 07     	call ftpsettingseditviewkeya
 263  01B6              ; 112                     ftpSettingsEditViewDataUpdate();
 264  01B6 CD C0 06     	call ftpsettingseditviewdataupdate
 265  01B9 C3 DD 01     	jp l_24
 266  01BC              l_23:
 267  01BC              ; 113                 } else if ((a = rootViewCurrentView) == rootViewCurrentWiFiSettingsEditView) {
 268  01BC 3A 93 0F     	ld a, (rootviewcurrentview)
 269  01BF FE 03        	cp 3
 270  01C1 C2 CE 01     	jp nz, l_25
 271  01C4              ; 114                     a = l; //Load key
 272  01C4 7D           	ld a, l
 273  01C5              ; 115                     wifiSettingsEditViewKeyA();
 274  01C5 CD 29 09     	call wifisettingseditviewkeya
 275  01C8              ; 116                     wifiSettingsEditViewDataUpdate();
 276  01C8 CD C1 08     	call wifisettingseditviewdataupdate
 277  01CB C3 DD 01     	jp l_26
 278  01CE              l_25:
 279  01CE              ; 117                 } else if ((a = rootViewCurrentView) == rootSSIDListView) {
 280  01CE 3A 93 0F     	ld a, (rootviewcurrentview)
 281  01D1 FE 04        	cp 4
 282  01D3 C2 DD 01     	jp nz, l_27
 283  01D6              ; 118                     a = l; //Load key
 284  01D6 7D           	ld a, l
 285  01D7              ; 119                     SSIDListViewKeyA();
 286  01D7 CD F5 0B     	call ssidlistviewkeya
 287  01DA              ; 120                     SSIDListViewDataUpdate();
 288  01DA CD A9 0B     	call ssidlistviewdataupdate
 289  01DD              l_27:
 290  01DD              l_26:
 291  01DD              l_24:
 292  01DD              l_22:
 293  01DD              l_20:
 294  01DD              l_11:
 295  01DD E1           	pop hl
 296  01DE              l_9:
 297  01DE C9           	ret
 298  01DF              ; 121                 }
 299  01DF              ; 122                 //printHexA();
 300  01DF              ; 123             }
 301  01DF              ; 124         }
 302  01DF              ; 125     }
 303  01DF              ; 126 }
 304  01DF              ; 127
 305  01DF              ; 128 void updateRootDataUI() {
 306  01DF              updaterootdataui:
 307  01DF              ; 129     showDiskList();
 308  01DF C3 9C 03     	jp showdisklist
 309  01E2              ; 130 }
 310  01E2              ; 131
 311  01E2              ; 132 void updateRootUI() {
 312  01E2              updaterootui:
 313  01E2              ; 133     a = 0x00;
 314  01E2 3E 00        	ld a, 0
 315  01E4              ; 134     inverceAddress = a;
 316  01E4 32 D3 F3     	ld (inverceaddress), a
 317  01E7              ; 135     clearScreen();
 318  01E7 CD E8 02     	call clearscreen
 319  01EA              ; 136
 320  01EA              ; 137     a = 0x00;
 321  01EA 3E 00        	ld a, 0
 322  01EC              ; 138     inverceAddress = a;
 323  01EC 32 D3 F3     	ld (inverceaddress), a
 324  01EF              ; 139     showWiFiView();
 325  01EF CD 5E 02     	call showwifiview
 326  01F2              ; 140     a = 0x00;
 327  01F2 3E 00        	ld a, 0
 328  01F4              ; 141     inverceAddress = a;
 329  01F4 32 D3 F3     	ld (inverceaddress), a
 330  01F7              ; 142     showFtpView();
 331  01F7 CD 0F 1B     	call showftpview
 332  01FA              ; 143     a = 0x00;
 333  01FA 3E 00        	ld a, 0
 334  01FC              ; 144     inverceAddress = a;
 335  01FC 32 D3 F3     	ld (inverceaddress), a
 336  01FF              ; 145     diskView();
 337  01FF CD 37 02     	call diskview
 338  0202              ; 146     a = 0x00;
 339  0202 3E 00        	ld a, 0
 340  0204              ; 147     inverceAddress = a;
 341  0204 32 D3 F3     	ld (inverceaddress), a
 342  0207              ; 148     ftpView();
 343  0207 CD 0D 02     	call ftpview
 344  020A              ; 149
 345  020A              ; 150     showHelpStr();
 346  020A C3 BD 04     	jp showhelpstr
 347  020D              ; 151 }
 348  020D              ; 152
 349  020D              ; 153 void ftpView() {
 350  020D              ftpview:
 351  020D              ; 154     drowRectX = (a = ftpViewX);
 352  020D 3A D6 0D     	ld a, (ftpviewx)
 353  0210 32 86 03     	ld (drowrectx), a
 354  0213              ; 155     drowRectY = (a = ftpViewY);
 355  0213 3A D7 0D     	ld a, (ftpviewy)
 356  0216 32 87 03     	ld (drowrecty), a
 357  0219              ; 156     drowRectEndX = (a = ftpViewEX);
 358  0219 3A D8 0D     	ld a, (ftpviewex)
 359  021C 32 88 03     	ld (drowrectendx), a
 360  021F              ; 157     drowRectEndY = (a = ftpViewEY);
 361  021F 3A D9 0D     	ld a, (ftpviewey)
 362  0222 32 89 03     	ld (drowrectendy), a
 363  0225              ; 158     drowRect();
 364  0225 CD F2 02     	call drowrect
 365  0228              ; 159
 366  0228              ; 160     hl = ftpLabelPos;
 367  0228 2A DA 0D     	ld hl, (ftplabelpos)
 368  022B              ; 161     setPosCursor();
 369  022B CD 3C F8     	call setposcursor
 370  022E              ; 162     hl = ftpLabel;
 371  022E 21 DC 0D     	ld hl, ftplabel
 372  0231              ; 163     printHLStr();
 373  0231 CD 18 F8     	call printhlstr
 374  0234              ; 164
 375  0234              ; 165     updateCurrentPath();
 376  0234 C3 E2 18     	jp updatecurrentpath
 377  0237              ; 166 }
 378  0237              ; 167
 379  0237              ; 168 void diskView() {
 380  0237              diskview:
 381  0237              ; 169     drowRectX = (a = diskViewX);
 382  0237 3A B0 0D     	ld a, (diskviewx)
 383  023A 32 86 03     	ld (drowrectx), a
 384  023D              ; 170     drowRectY = (a = diskViewY);
 385  023D 3A B1 0D     	ld a, (diskviewy)
 386  0240 32 87 03     	ld (drowrecty), a
 387  0243              ; 171     drowRectEndX = (a = diskViewEX);
 388  0243 3A B2 0D     	ld a, (diskviewex)
 389  0246 32 88 03     	ld (drowrectendx), a
 390  0249              ; 172     drowRectEndY = (a = diskViewEY);
 391  0249 3A B3 0D     	ld a, (diskviewey)
 392  024C 32 89 03     	ld (drowrectendy), a
 393  024F              ; 173     drowRect();
 394  024F CD F2 02     	call drowrect
 395  0252              ; 174
 396  0252              ; 175     hl = diskViewLabelPos;
 397  0252 2A B4 0D     	ld hl, (diskviewlabelpos)
 398  0255              ; 176     setPosCursor();
 399  0255 CD 3C F8     	call setposcursor
 400  0258              ; 177     hl = diskViewLabel;
 401  0258 21 B6 0D     	ld hl, diskviewlabel
 402  025B              ; 178     printHLStr();
 403  025B C3 18 F8     	jp printhlstr
 404  025E              ; 179 }
 405  025E              ; 180
 406  025E              ; 181 void showWiFiView() {
 407  025E              showwifiview:
 408  025E              ; 182     drowRectX = (a = wifiSettingsViewX);
 409  025E 3A AE 0C     	ld a, (wifisettingsviewx)
 410  0261 32 86 03     	ld (drowrectx), a
 411  0264              ; 183     drowRectY = (a = wifiSettingsViewY);
 412  0264 3A AF 0C     	ld a, (wifisettingsviewy)
 413  0267 32 87 03     	ld (drowrecty), a
 414  026A              ; 184     drowRectEndX = (a = wifiSettingsViewEX);
 415  026A 3A B0 0C     	ld a, (wifisettingsviewex)
 416  026D 32 88 03     	ld (drowrectendx), a
 417  0270              ; 185     drowRectEndY = (a = wifiSettingsViewEY);
 418  0270 3A B1 0C     	ld a, (wifisettingsviewey)
 419  0273 32 89 03     	ld (drowrectendy), a
 420  0276              ; 186     drowRect();
 421  0276 CD F2 02     	call drowrect
 422  0279              ; 187
 423  0279              ; 188     hl = wifiSettingsPos;
 424  0279 2A B2 0C     	ld hl, (wifisettingspos)
 425  027C              ; 189     setPosCursor();
 426  027C CD 3C F8     	call setposcursor
 427  027F              ; 190     hl = wifiSettingsLabel;
 428  027F 21 B4 0C     	ld hl, wifisettingslabel
 429  0282              ; 191     printHLStr();
 430  0282 CD 18 F8     	call printhlstr
 431  0285              ; 192
 432  0285              ; 193     hl = wifiSettingsSsidLabelPos;
 433  0285 2A D7 0C     	ld hl, (wifisettingsssidlabelpos)
 434  0288              ; 194     setPosCursor();
 435  0288 CD 3C F8     	call setposcursor
 436  028B              ; 195     hl = wifiSettingsSsidLabel;
 437  028B 21 C5 0C     	ld hl, wifisettingsssidlabel
 438  028E              ; 196     printHLStr();
 439  028E CD 18 F8     	call printhlstr
 440  0291              ; 197
 441  0291              ; 198     hl = wifiSettingsIpLabelPos;
 442  0291 2A D9 0C     	ld hl, (wifisettingsiplabelpos)
 443  0294              ; 199     setPosCursor();
 444  0294 CD 3C F8     	call setposcursor
 445  0297              ; 200     hl = wifiSettingsIpLabel;
 446  0297 21 CB 0C     	ld hl, wifisettingsiplabel
 447  029A              ; 201     printHLStr();
 448  029A CD 18 F8     	call printhlstr
 449  029D              ; 202
 450  029D              ; 203     hl = wifiSettingsMacLabelPos;
 451  029D 2A DB 0C     	ld hl, (wifisettingsmaclabelpos)
 452  02A0              ; 204     setPosCursor();
 453  02A0 CD 3C F8     	call setposcursor
 454  02A3              ; 205     hl = wifiSettingsMacLabel;
 455  02A3 21 D1 0C     	ld hl, wifisettingsmaclabel
 456  02A6              ; 206     printHLStr();
 457  02A6 CD 18 F8     	call printhlstr
 458  02A9              ; 207
 459  02A9              ; 208     hl = wifiSettingsSsidValPos;
 460  02A9 2A DD 0C     	ld hl, (wifisettingsssidvalpos)
 461  02AC              ; 209     setPosCursor();
 462  02AC CD 3C F8     	call setposcursor
 463  02AF              ; 210     hl = wifiSettingsSsidVal;
 464  02AF 21 DF 0C     	ld hl, wifisettingsssidval
 465  02B2              ; 211     printHLStr();
 466  02B2 CD 18 F8     	call printhlstr
 467  02B5              ; 212
 468  02B5              ; 213     updateWiFiViewValData();
 469  02B5 C3 D0 02     	jp updatewifiviewvaldata
 470  02B8              ; 214 }
 471  02B8              ; 215
 472  02B8              ; 216 void clearWiFiViewValData() {
 473  02B8              clearwifiviewvaldata:
 474  02B8              ; 217     hl = wifiSettingsIpValPos;
 475  02B8 2A EF 0C     	ld hl, (wifisettingsipvalpos)
 476  02BB              ; 218     setPosCursor();
 477  02BB CD 3C F8     	call setposcursor
 478  02BE              ; 219     hl = wifiSettingsEmpty18;
 479  02BE 21 15 0D     	ld hl, wifisettingsempty18
 480  02C1              ; 220     printHLStr();
 481  02C1 CD 18 F8     	call printhlstr
 482  02C4              ; 221
 483  02C4              ; 222     hl = wifiSettingsMacValPos;
 484  02C4 2A 01 0D     	ld hl, (wifisettingsmacvalpos)
 485  02C7              ; 223     setPosCursor();
 486  02C7 CD 3C F8     	call setposcursor
 487  02CA              ; 224     hl = wifiSettingsEmpty18;
 488  02CA 21 15 0D     	ld hl, wifisettingsempty18
 489  02CD              ; 225     printHLStr();
 490  02CD C3 18 F8     	jp printhlstr
 491  02D0              ; 226 }
 492  02D0              ; 227
 493  02D0              ; 228 void updateWiFiViewValData() {
 494  02D0              updatewifiviewvaldata:
 495  02D0              ; 229     hl = wifiSettingsIpValPos;
 496  02D0 2A EF 0C     	ld hl, (wifisettingsipvalpos)
 497  02D3              ; 230     setPosCursor();
 498  02D3 CD 3C F8     	call setposcursor
 499  02D6              ; 231     hl = wifiSettingsIpVal;
 500  02D6 21 F1 0C     	ld hl, wifisettingsipval
 501  02D9              ; 232     printHLStr();
 502  02D9 CD 18 F8     	call printhlstr
 503  02DC              ; 233
 504  02DC              ; 234     hl = wifiSettingsMacValPos;
 505  02DC 2A 01 0D     	ld hl, (wifisettingsmacvalpos)
 506  02DF              ; 235     setPosCursor();
 507  02DF CD 3C F8     	call setposcursor
 508  02E2              ; 236     hl = wifiSettingsMacVal;
 509  02E2 21 03 0D     	ld hl, wifisettingsmacval
 510  02E5              ; 237     printHLStr();
 511  02E5 C3 18 F8     	jp printhlstr
 512  02E8              ; 238 }
 513  02E8              ; 239
 514  02E8              ; 240 void clearScreen() {
 515  02E8              clearscreen:
 516  02E8              ; 241     c = 0x1B;
 517  02E8 0E 1B        	ld c, 27
 518  02EA              ; 242     printChatC();
 519  02EA CD 09 F8     	call printchatc
 520  02ED              ; 243     c = 0x45;
 521  02ED 0E 45        	ld c, 69
 522  02EF              ; 244     printChatC();
 523  02EF C3 09 F8     	jp printchatc
 524  02F2              ; 245 }
 525  02F2              ; 246
 526  02F2              ; 247 void drowRect() {
 527  02F2              drowrect:
 528  02F2              ; 248     setMyFont();
 529  02F2 CD 6E 03     	call setmyfont
 530  02F5              ; 249
 531  02F5              ; 250     //h = y
 532  02F5              ; 251     a = drowRectY;
 533  02F5 3A 87 03     	ld a, (drowrecty)
 534  02F8              ; 252     h = a;
 535  02F8 67           	ld h, a
 536  02F9              ; 253
 537  02F9              ; 254     do {
 538  02F9              l_29:
 539  02F9              ; 255         //l = x
 540  02F9              ; 256         a = drowRectX;
 541  02F9 3A 86 03     	ld a, (drowrectx)
 542  02FC              ; 257         l = a;
 543  02FC 6F           	ld l, a
 544  02FD              ; 258
 545  02FD              ; 259         push_pop(hl) {
 546  02FD E5           	push hl
 547  02FE              ; 260             setPosCursor();
 548  02FE CD 3C F8     	call setposcursor
 549  0301 E1           	pop hl
 550  0302              ; 261         }
 551  0302              ; 262
 552  0302              ; 263         do {
 553  0302              l_32:
 554  0302              ; 264             if ((a = drowRectY) == h) {
 555  0302 3A 87 03     	ld a, (drowrecty)
 556  0305 BC           	cp h
 557  0306 C2 21 03     	jp nz, l_35
 558  0309              ; 265                 c = 0x26;
 559  0309 0E 26        	ld c, 38
 560  030B              ; 266                 if ((a = drowRectX) == l) {
 561  030B 3A 86 03     	ld a, (drowrectx)
 562  030E BD           	cp l
 563  030F C2 14 03     	jp nz, l_37
 564  0312              ; 267                     c = 0x21;
 565  0312 0E 21        	ld c, 33
 566  0314              l_37:
 567  0314              ; 268                 }
 568  0314              ; 269                 if ((a = drowRectEndX)-- == l) {
 569  0314 3A 88 03     	ld a, (drowrectendx)
 570  0317 3D           	dec a
 571  0318 BD           	cp l
 572  0319 C2 1E 03     	jp nz, l_39
 573  031C              ; 270                     c = 0x23;
 574  031C 0E 23        	ld c, 35
 575  031E              l_39:
 576  031E C3 56 03     	jp l_36
 577  0321              l_35:
 578  0321              ; 271                 }
 579  0321              ; 272             } else if ((a = drowRectEndY)-- == h) {
 580  0321 3A 89 03     	ld a, (drowrectendy)
 581  0324 3D           	dec a
 582  0325 BC           	cp h
 583  0326 C2 41 03     	jp nz, l_41
 584  0329              ; 273                 c = 0x26;
 585  0329 0E 26        	ld c, 38
 586  032B              ; 274                 if ((a = drowRectX) == l) {
 587  032B 3A 86 03     	ld a, (drowrectx)
 588  032E BD           	cp l
 589  032F C2 34 03     	jp nz, l_43
 590  0332              ; 275                     c = 0x22;
 591  0332 0E 22        	ld c, 34
 592  0334              l_43:
 593  0334              ; 276                 }
 594  0334              ; 277                 if ((a = drowRectEndX)-- == l) {
 595  0334 3A 88 03     	ld a, (drowrectendx)
 596  0337 3D           	dec a
 597  0338 BD           	cp l
 598  0339 C2 3E 03     	jp nz, l_45
 599  033C              ; 278                     c = 0x24;
 600  033C 0E 24        	ld c, 36
 601  033E              l_45:
 602  033E C3 56 03     	jp l_42
 603  0341              l_41:
 604  0341              ; 279                 }
 605  0341              ; 280             } else {
 606  0341              ; 281                 c = 0x20;
 607  0341 0E 20        	ld c, 32
 608  0343              ; 282                 if ((a = drowRectX) == l) {
 609  0343 3A 86 03     	ld a, (drowrectx)
 610  0346 BD           	cp l
 611  0347 C2 4C 03     	jp nz, l_47
 612  034A              ; 283                     c = 0x25;
 613  034A 0E 25        	ld c, 37
 614  034C              l_47:
 615  034C              ; 284                 }
 616  034C              ; 285                 if ((a = drowRectEndX)-- == l) {
 617  034C 3A 88 03     	ld a, (drowrectendx)
 618  034F 3D           	dec a
 619  0350 BD           	cp l
 620  0351 C2 56 03     	jp nz, l_49
 621  0354              ; 286                     c = 0x25;
 622  0354 0E 25        	ld c, 37
 623  0356              l_49:
 624  0356              l_42:
 625  0356              l_36:
 626  0356              ; 287                 }
 627  0356              ; 288             }
 628  0356              ; 289
 629  0356              ; 290             push_pop(hl) {
 630  0356 E5           	push hl
 631  0357              ; 291                 printChatC();
 632  0357 CD 09 F8     	call printchatc
 633  035A E1           	pop hl
 634  035B              ; 292             }
 635  035B              ; 293
 636  035B              ; 294             a = drowRectEndX;
 637  035B 3A 88 03     	ld a, (drowrectendx)
 638  035E              ; 295             l++;
 639  035E 2C           	inc l
 640  035F              ; 296             a -= l;
 641  035F 95           	sub l
 642  0360              l_33:
 643  0360 C2 02 03     	jp nz, l_32
 644  0363              ; 297         } while (flag_nz);
 645  0363              ; 298
 646  0363              ; 299         a = drowRectEndY;
 647  0363 3A 89 03     	ld a, (drowrectendy)
 648  0366              ; 300         h++;
 649  0366 24           	inc h
 650  0367              ; 301         a -= h;
 651  0367 94           	sub h
 652  0368              l_30:
 653  0368 C2 F9 02     	jp nz, l_29
 654  036B              ; 302     } while (flag_nz);
 655  036B              ; 303
 656  036B              ; 304     setSystemFont();
 657  036B C3 7D 03     	jp setsystemfont
 658  036E              ; 305 }
 659  036E              ; 306
 660  036E              ; 307 void setMyFont() {
 661  036E              setmyfont:
 662  036E              ; 308     push_pop(hl) {
 663  036E E5           	push hl
 664  036F              ; 309         hl = fontAddress;
 665  036F 2A D1 F3     	ld hl, (fontaddress)
 666  0372              ; 310         systemFontAddress = hl;
 667  0372 22 8A 03     	ld (systemfontaddress), hl
 668  0375              ; 311         hl = &myFont;
 669  0375 21 66 0C     	ld hl, myfont
 670  0378              ; 312         fontAddress = hl;
 671  0378 22 D1 F3     	ld (fontaddress), hl
 672  037B E1           	pop hl
 673  037C C9           	ret
 674  037D              ; 313     }
 675  037D              ; 314 }
 676  037D              ; 315
 677  037D              ; 316 void setSystemFont() {
 678  037D              setsystemfont:
 679  037D              ; 317     push_pop(hl) {
 680  037D E5           	push hl
 681  037E              ; 318         hl = systemFontAddress;
 682  037E 2A 8A 03     	ld hl, (systemfontaddress)
 683  0381              ; 319         fontAddress = hl;
 684  0381 22 D1 F3     	ld (fontaddress), hl
 685  0384 E1           	pop hl
 686  0385 C9           	ret
 687  0386              ; 320     }
 688  0386              ; 321 }
 689  0386              ; 322
 690  0386              ; 323 uint8_t drowRectX = 0x00;
 691  0386              drowrectx:
 692  0386 00           	db 0
 693  0387              ; 324 uint8_t drowRectY = 0x00;
 694  0387              drowrecty:
 695  0387 00           	db 0
 696  0388              ; 325 uint8_t drowRectEndX = 0x00;
 697  0388              drowrectendx:
 698  0388 00           	db 0
 699  0389              ; 326 uint8_t drowRectEndY = 0x00;
 700  0389              drowrectendy:
 701  0389 00           	db 0
 702  038A              ; 328 uint16_t systemFontAddress = 0x0000;
 703  038A              systemfontaddress:
 704  038A 00 00        	dw 0
 705  038C              ; 330 void updateDiskList() {
 706  038C              updatedisklist:
 707  038C              ; 331     a = diskViewDiskNum;
 708  038C 3A C0 0D     	ld a, (diskviewdisknum)
 709  038F              ; 332     ordos_wnd();
 710  038F CD D6 BF     	call ordos_wnd
 711  0392              ; 333     hl = startListBufer;
 712  0392 21 00 00     	ld hl, 0
 713  0395              ; 334     ordos_dirm();
 714  0395 CD E8 BF     	call ordos_dirm
 715  0398              ; 335     diskViewListCount = a;
 716  0398 32 C1 0D     	ld (diskviewlistcount), a
 717  039B C9           	ret
 718  039C              ; 336 }
 719  039C              ; 337
 720  039C              ; 338 void showDiskList() {
 721  039C              showdisklist:
 722  039C              ; 339     b = 0;
 723  039C 06 00        	ld b, 0
 724  039E              ; 340     showDiskDriveName();
 725  039E CD C2 03     	call showdiskdrivename
 726  03A1              ; 341     showDiskDir();
 727  03A1 CD D1 03     	call showdiskdir
 728  03A4              ; 342     hl = diskViewListNamePos;
 729  03A4 2A C3 0D     	ld hl, (diskviewlistnamepos)
 730  03A7              ; 343
 731  03A7              ; 344     if ((a = diskViewListCount) == 0) {
 732  03A7 3A C1 0D     	ld a, (diskviewlistcount)
 733  03AA B7           	or a
 734  03AB C2 AF 03     	jp nz, l_51
 735  03AE              ; 345         return;
 736  03AE C9           	ret
 737  03AF              l_51:
 738  03AF              ; 346     }
 739  03AF              ; 347
 740  03AF              ; 348     do {
 741  03AF              l_53:
 742  03AF              ; 349         setPosCursor();
 743  03AF CD 3C F8     	call setposcursor
 744  03B2              ; 350         a = b;
 745  03B2 78           	ld a, b
 746  03B3              ; 351         push_pop(hl) {
 747  03B3 E5           	push hl
 748  03B4              ; 352             showDiskApp();
 749  03B4 CD FF 03     	call showdiskapp
 750  03B7 E1           	pop hl
 751  03B8              ; 353         };
 752  03B8              ; 354
 753  03B8              ; 355         h++;
 754  03B8 24           	inc h
 755  03B9              ; 356         b++;
 756  03B9 04           	inc b
 757  03BA              ; 357         a = diskViewListCount;
 758  03BA 3A C1 0D     	ld a, (diskviewlistcount)
 759  03BD              ; 358         a -= b;
 760  03BD 90           	sub b
 761  03BE              l_54:
 762  03BE C2 AF 03     	jp nz, l_53
 763  03C1 C9           	ret
 764  03C2              ; 359     } while (flag_nz);
 765  03C2              ; 360 }
 766  03C2              ; 361
 767  03C2              ; 362 void showDiskDriveName() {
 768  03C2              showdiskdrivename:
 769  03C2              ; 363     push_pop(hl) {
 770  03C2 E5           	push hl
 771  03C3              ; 364         hl = diskViewDriveNamePos;
 772  03C3 2A D2 0D     	ld hl, (diskviewdrivenamepos)
 773  03C6              ; 365         setPosCursor();
 774  03C6 CD 3C F8     	call setposcursor
 775  03C9              ; 366         a = diskViewDiskNum;
 776  03C9 3A C0 0D     	ld a, (diskviewdisknum)
 777  03CC              ; 367         printChatA();
 778  03CC CD 0F F8     	call printchata
 779  03CF E1           	pop hl
 780  03D0 C9           	ret
 781  03D1              ; 368     }
 782  03D1              ; 369 }
 783  03D1              ; 370
 784  03D1              ; 371 void showDiskDir() {
 785  03D1              showdiskdir:
 786  03D1              ; 372     push_pop(hl) {
 787  03D1 E5           	push hl
 788  03D2              ; 373         hl = diskViewListDirPos;
 789  03D2 2A C5 0D     	ld hl, (diskviewlistdirpos)
 790  03D5              ; 374         setPosCursor();
 791  03D5 CD 3C F8     	call setposcursor
 792  03D8              ; 375         hl = diskViewListDirLabel;
 793  03D8 21 C7 0D     	ld hl, diskviewlistdirlabel
 794  03DB              ; 376         push_pop(bc) {
 795  03DB C5           	push bc
 796  03DC              ; 377             a = 0;
 797  03DC 3E 00        	ld a, 0
 798  03DE              ; 378             inverceAddress = a;
 799  03DE 32 D3 F3     	ld (inverceaddress), a
 800  03E1              ; 379             if ((a = diskViewCurrPos) == 0) {
 801  03E1 3A C2 0D     	ld a, (diskviewcurrpos)
 802  03E4 B7           	or a
 803  03E5 C2 F4 03     	jp nz, l_56
 804  03E8              ; 380                 if ((a = rootViewCurrentView) == rootViewCurrentDiskView) {
 805  03E8 3A 93 0F     	ld a, (rootviewcurrentview)
 806  03EB B7           	or a
 807  03EC C2 F4 03     	jp nz, l_58
 808  03EF              ; 381                     a = 0xFF;
 809  03EF 3E FF        	ld a, 255
 810  03F1              ; 382                     inverceAddress = a;
 811  03F1 32 D3 F3     	ld (inverceaddress), a
 812  03F4              l_58:
 813  03F4              l_56:
 814  03F4              ; 383                 }
 815  03F4              ; 384             }
 816  03F4              ; 385             printHLStr();
 817  03F4 CD 18 F8     	call printhlstr
 818  03F7              ; 386             a = 0;
 819  03F7 3E 00        	ld a, 0
 820  03F9              ; 387             inverceAddress = a;
 821  03F9 32 D3 F3     	ld (inverceaddress), a
 822  03FC C1           	pop bc
 823  03FD E1           	pop hl
 824  03FE C9           	ret
 825  03FF              ; 388         }
 826  03FF              ; 389     }
 827  03FF              ; 390 }
 828  03FF              ; 391
 829  03FF              ; 392 ///A - count app
 830  03FF              ; 393 void showDiskApp() {
 831  03FF              showdiskapp:
 832  03FF              ; 394     push_pop(bc) {
 833  03FF C5           	push bc
 834  0400              ; 395
 835  0400              ; 396         c = a;
 836  0400 4F           	ld c, a
 837  0401              ; 397         carry_rotate_left(a, 4);
 838  0401 17           	rla
 839  0402 17           	rla
 840  0403 17           	rla
 841  0404 17           	rla
 842  0405              ; 398         hl = startListBufer;
 843  0405 21 00 00     	ld hl, 0
 844  0408              ; 399         a += l;
 845  0408 85           	add l
 846  0409              ; 400         l = a;
 847  0409 6F           	ld l, a
 848  040A              ; 401         if (flag_c) {
 849  040A D2 0E 04     	jp nc, l_60
 850  040D              ; 402             h++;
 851  040D 24           	inc h
 852  040E              l_60:
 853  040E              ; 403         }
 854  040E              ; 404
 855  040E              ; 405         a = 0x00;
 856  040E 3E 00        	ld a, 0
 857  0410              ; 406         inverceAddress = a;
 858  0410 32 D3 F3     	ld (inverceaddress), a
 859  0413              ; 407
 860  0413              ; 408         if ((a = diskViewCurrPos)-- == c) {
 861  0413 3A C2 0D     	ld a, (diskviewcurrpos)
 862  0416 3D           	dec a
 863  0417 B9           	cp c
 864  0418 C2 27 04     	jp nz, l_62
 865  041B              ; 409             if ((a = rootViewCurrentView) == rootViewCurrentDiskView) {
 866  041B 3A 93 0F     	ld a, (rootviewcurrentview)
 867  041E B7           	or a
 868  041F C2 27 04     	jp nz, l_64
 869  0422              ; 410                 a = 0xFF;
 870  0422 3E FF        	ld a, 255
 871  0424              ; 411                 inverceAddress = a;
 872  0424 32 D3 F3     	ld (inverceaddress), a
 873  0427              l_64:
 874  0427              l_62:
 875  0427              ; 412             }
 876  0427              ; 413         }
 877  0427              ; 414
 878  0427              ; 415         a = ' ';
 879  0427 3E 20        	ld a, 32
 880  0429              ; 416         printChatA();
 881  0429 CD 0F F8     	call printchata
 882  042C              ; 417         b = 0;
 883  042C 06 00        	ld b, 0
 884  042E              ; 418
 885  042E              ; 419         do {
 886  042E              l_66:
 887  042E              ; 420             a = *hl;
 888  042E 7E           	ld a, (hl)
 889  042F              ; 421             printChatA();
 890  042F CD 0F F8     	call printchata
 891  0432              ; 422             hl++;
 892  0432 23           	inc hl
 893  0433              ; 423             b++;
 894  0433 04           	inc b
 895  0434              ; 424             a = 8;
 896  0434 3E 08        	ld a, 8
 897  0436              ; 425             a -= b;
 898  0436 90           	sub b
 899  0437              l_67:
 900  0437 C2 2E 04     	jp nz, l_66
 901  043A              ; 426         } while (flag_nz);
 902  043A              ; 427         a = ' ';
 903  043A 3E 20        	ld a, 32
 904  043C              ; 428         printChatA();
 905  043C CD 0F F8     	call printchata
 906  043F C1           	pop bc
 907  0440              ; 429     };
 908  0440              ; 430     a = 0x00;
 909  0440 3E 00        	ld a, 0
 910  0442              ; 431     inverceAddress = a;
 911  0442 32 D3 F3     	ld (inverceaddress), a
 912  0445 C9           	ret
 913  0446              ; 432 }
 914  0446              ; 433
 915  0446              ; 434 void diskViewKeyA() {
 916  0446              diskviewkeya:
 917  0446              ; 435     push_pop(bc) {
 918  0446 C5           	push bc
 919  0447              ; 436         b = a;
 920  0447 47           	ld b, a
 921  0448              ; 437
 922  0448              ; 438         if (a == 0x1A) { //down
 923  0448 FE 1A        	cp 26
 924  044A C2 5F 04     	jp nz, l_69
 925  044D              ; 439             a = diskViewListCount;
 926  044D 3A C1 0D     	ld a, (diskviewlistcount)
 927  0450              ; 440             c = a;
 928  0450 4F           	ld c, a
 929  0451              ; 441             if ( (a = diskViewCurrPos) < c  ) {
 930  0451 3A C2 0D     	ld a, (diskviewcurrpos)
 931  0454 B9           	cp c
 932  0455 D2 5C 04     	jp nc, l_71
 933  0458              ; 442                 a++;
 934  0458 3C           	inc a
 935  0459              ; 443                 diskViewCurrPos = a;
 936  0459 32 C2 0D     	ld (diskviewcurrpos), a
 937  045C              l_71:
 938  045C C3 BB 04     	jp l_70
 939  045F              l_69:
 940  045F              ; 444             }
 941  045F              ; 445         } else if (a == 0x19) { //up
 942  045F FE 19        	cp 25
 943  0461 C2 72 04     	jp nz, l_73
 944  0464              ; 446             if ( (a = diskViewCurrPos) > 0 ) {
 945  0464 3A C2 0D     	ld a, (diskviewcurrpos)
 946  0467 B7           	or a
 947  0468 CA 6F 04     	jp z, l_75
 948  046B              ; 447                 a--;
 949  046B 3D           	dec a
 950  046C              ; 448                 diskViewCurrPos = a;
 951  046C 32 C2 0D     	ld (diskviewcurrpos), a
 952  046F              l_75:
 953  046F C3 BB 04     	jp l_74
 954  0472              l_73:
 955  0472              ; 449             }
 956  0472              ; 450         } else if (a == 0x0D) { //Enter
 957  0472 FE 0D        	cp 13
 958  0474 C2 AB 04     	jp nz, l_77
 959  0477              ; 451             if ((a = diskViewCurrPos) == 0) { // Change drive
 960  0477 3A C2 0D     	ld a, (diskviewcurrpos)
 961  047A B7           	or a
 962  047B C2 A8 04     	jp nz, l_79
 963  047E              ; 452                 a = diskViewDiskNum;
 964  047E 3A C0 0D     	ld a, (diskviewdisknum)
 965  0481              ; 453                 if (a == 'B') {
 966  0481 FE 42        	cp 66
 967  0483 C2 8B 04     	jp nz, l_81
 968  0486              ; 454                     a = 'C';
 969  0486 3E 43        	ld a, 67
 970  0488 C3 9C 04     	jp l_82
 971  048B              l_81:
 972  048B              ; 455                 } else if (a == 'C') {
 973  048B FE 43        	cp 67
 974  048D C2 95 04     	jp nz, l_83
 975  0490              ; 456                     a = 'D';
 976  0490 3E 44        	ld a, 68
 977  0492 C3 9C 04     	jp l_84
 978  0495              l_83:
 979  0495              ; 457                 } else if (a == 'D') {
 980  0495 FE 44        	cp 68
 981  0497 C2 9C 04     	jp nz, l_85
 982  049A              ; 458                     a = 'B';
 983  049A 3E 42        	ld a, 66
 984  049C              l_85:
 985  049C              l_84:
 986  049C              l_82:
 987  049C              ; 459                 }
 988  049C              ; 460                 diskViewDiskNum = a;
 989  049C 32 C0 0D     	ld (diskviewdisknum), a
 990  049F              ; 461                 diskView();
 991  049F CD 37 02     	call diskview
 992  04A2              ; 462                 updateDiskList();
 993  04A2 CD 8C 03     	call updatedisklist
 994  04A5 C3 A8 04     	jp l_80
 995  04A8              l_79:
 996  04A8              ; 463             } else { // Upload file to FTP
 997  04A8              l_80:
 998  04A8 C3 BB 04     	jp l_78
 999  04AB              l_77:
1000  04AB              ; 464
1001  04AB              ; 465             }
1002  04AB              ; 466         } else if (a == 0x09) { //TAB
1003  04AB FE 09        	cp 9
1004  04AD C2 BB 04     	jp nz, l_87
1005  04B0              ; 467             a = rootViewCurrentFTPView; // переходим на список файлов FTP
1006  04B0 3E 01        	ld a, 1
1007  04B2              ; 468             rootViewCurrentView = a;
1008  04B2 32 93 0F     	ld (rootviewcurrentview), a
1009  04B5              ; 469             // Сбросить выделение строки на диске
1010  04B5              ; 470             showDiskList();
1011  04B5 CD 9C 03     	call showdisklist
1012  04B8              ; 471             // Выделить текущую позицию на FTP
1013  04B8              ; 472             ftpViewDataUpdate();
1014  04B8 CD 1A 19     	call ftpviewdataupdate
1015  04BB              l_87:
1016  04BB              l_78:
1017  04BB              l_74:
1018  04BB              l_70:
1019  04BB C1           	pop bc
1020  04BC C9           	ret
1021  04BD              ; 473         }
1022  04BD              ; 474     }
1023  04BD              ; 475 }
1024  04BD              ; 476
1025  04BD              ; 477 void showHelpStr() {
1026  04BD              showhelpstr:
1027  04BD              ; 478     push_pop(hl) {
1028  04BD E5           	push hl
1029  04BE              ; 479         hl = rootViewHelpStrPos;
1030  04BE 2A 94 0F     	ld hl, (rootviewhelpstrpos)
1031  04C1              ; 480         setPosCursor();
1032  04C1 CD 3C F8     	call setposcursor
1033  04C4              ; 481         hl = rootViewHelpStr;
1034  04C4 21 96 0F     	ld hl, rootviewhelpstr
1035  04C7              ; 482         printHLStr();
1036  04C7 CD 18 F8     	call printhlstr
1037  04CA E1           	pop hl
1038  04CB C9           	ret
1039  04CC              ; 483     }
1040  04CC              ; 484 }
1041  04CC              ; 485
1042  04CC              ; 486 void showFtpSettingsEditView() {
1043  04CC              showftpsettingseditview:
1044  04CC              ; 487     drowRectX = (a = ftpSettingsEditViewX);
1045  04CC 3A D5 0F     	ld a, (ftpsettingseditviewx)
1046  04CF 32 86 03     	ld (drowrectx), a
1047  04D2              ; 488     drowRectY = (a = ftpSettingsEditViewY);
1048  04D2 3A D6 0F     	ld a, (ftpsettingseditviewy)
1049  04D5 32 87 03     	ld (drowrecty), a
1050  04D8              ; 489     drowRectEndX = (a = ftpSettingsEditViewEX);
1051  04D8 3A D7 0F     	ld a, (ftpsettingseditviewex)
1052  04DB 32 88 03     	ld (drowrectendx), a
1053  04DE              ; 490     drowRectEndY = (a = ftpSettingsEditViewEY);
1054  04DE 3A D8 0F     	ld a, (ftpsettingseditviewey)
1055  04E1 32 89 03     	ld (drowrectendy), a
1056  04E4              ; 491     drowRect();
1057  04E4 CD F2 02     	call drowrect
1058  04E7              ; 492
1059  04E7              ; 493     hl = ftpSettingsEditViewLabelPos;
1060  04E7 2A D9 0F     	ld hl, (ftpsettingseditviewlabelpos)
1061  04EA              ; 494     setPosCursor();
1062  04EA CD 3C F8     	call setposcursor
1063  04ED              ; 495     hl = ftpSettingsEditViewLabel;
1064  04ED 21 DB 0F     	ld hl, ftpsettingseditviewlabel
1065  04F0              ; 496     printHLStr();
1066  04F0 CD 18 F8     	call printhlstr
1067  04F3              ; 497
1068  04F3              ; 498     hl = ftpSettingsEditViewIpLabelPos;
1069  04F3 2A EA 0F     	ld hl, (ftpsettingseditviewiplabelpos)
1070  04F6              ; 499     setPosCursor();
1071  04F6 CD 3C F8     	call setposcursor
1072  04F9              ; 500     hl = ftpSettingsIpLabel;
1073  04F9 21 3E 0D     	ld hl, ftpsettingsiplabel
1074  04FC              ; 501     printHLStr();
1075  04FC CD 18 F8     	call printhlstr
1076  04FF              ; 502
1077  04FF              ; 503     hl = ftpSettingsEditViewPortLabelPos;
1078  04FF 2A EC 0F     	ld hl, (ftpsettingseditviewportlabelpos)
1079  0502              ; 504     setPosCursor();
1080  0502 CD 3C F8     	call setposcursor
1081  0505              ; 505     hl = ftpSettingsPortLabel;
1082  0505 21 44 0D     	ld hl, ftpsettingsportlabel
1083  0508              ; 506     printHLStr();
1084  0508 CD 18 F8     	call printhlstr
1085  050B              ; 507
1086  050B              ; 508     hl = ftpSettingsEditViewUserLabelPos;
1087  050B 2A EE 0F     	ld hl, (ftpsettingseditviewuserlabelpos)
1088  050E              ; 509     setPosCursor();
1089  050E CD 3C F8     	call setposcursor
1090  0511              ; 510     hl = ftpSettingsUserLabel;
1091  0511 21 4C 0D     	ld hl, ftpsettingsuserlabel
1092  0514              ; 511     printHLStr();
1093  0514 CD 18 F8     	call printhlstr
1094  0517              ; 512
1095  0517              ; 513     hl = ftpSettingsEditViewPasswordLabelPos;
1096  0517 2A F0 0F     	ld hl, (ftpsettingseditviewpasswordlabel)
1097  051A              ; 514     setPosCursor();
1098  051A CD 3C F8     	call setposcursor
1099  051D              ; 515     hl = ftpSettingsEditViewPasswordLabel;
1100  051D 21 F2 0F     	ld hl, ftpsettingseditviewpasswordlabel_0
1101  0520              ; 516     printHLStr();
1102  0520 CD 18 F8     	call printhlstr
1103  0523              ; 517
1104  0523              ; 518     hl = ftpSettingsEditViewOkLabelPos;
1105  0523 2A F8 0F     	ld hl, (ftpsettingseditviewoklabelpos)
1106  0526              ; 519     setPosCursor();
1107  0526 CD 3C F8     	call setposcursor
1108  0529              ; 520     hl = ftpSettingsEditViewOkLabel;
1109  0529 21 FA 0F     	ld hl, ftpsettingseditviewoklabel
1110  052C              ; 521     printHLStr();
1111  052C C3 18 F8     	jp printhlstr
1112  052F              ; 522 }
1113  052F              ; 523
1114  052F              ; 524 void needOpenFTPSettingsEditView() {
1115  052F              needopenftpsettingseditview:
1116  052F              ; 525     push_pop(hl) {
1117  052F E5           	push hl
1118  0530              ; 526         if ((a = rootViewCurrentView) != rootViewCurrentFTPSettingsEditView) { //Если уже открыты настройки - не открываем
1119  0530 3A 93 0F     	ld a, (rootviewcurrentview)
1120  0533 FE 02        	cp 2
1121  0535 CA 53 05     	jp z, l_89
1122  0538              ; 527             if ((a = rootViewCurrentView) != rootViewCurrentWiFiSettingsEditView) { //Если открыта настройка WiFi тоже не открываем
1123  0538 3A 93 0F     	ld a, (rootviewcurrentview)
1124  053B FE 03        	cp 3
1125  053D CA 53 05     	jp z, l_91
1126  0540              ; 528
1127  0540              ; 529                 a = rootViewCurrentFTPSettingsEditView;
1128  0540 3E 02        	ld a, 2
1129  0542              ; 530                 rootViewCurrentView = a;
1130  0542 32 93 0F     	ld (rootviewcurrentview), a
1131  0545              ; 531                 a = 4;
1132  0545 3E 04        	ld a, 4
1133  0547              ; 532                 ftpSettingsEditViewCurrentPos = a;
1134  0547 32 19 10     	ld (ftpsettingseditviewcurrentpos), a
1135  054A              ; 533
1136  054A              ; 534                 showDiskList(); //Сбросить выделение строки
1137  054A CD 9C 03     	call showdisklist
1138  054D              ; 535                 showFtpSettingsEditView();
1139  054D CD CC 04     	call showftpsettingseditview
1140  0550              ; 536                 ftpSettingsEditViewDataUpdate();
1141  0550 CD C0 06     	call ftpsettingseditviewdataupdate
1142  0553              l_91:
1143  0553              l_89:
1144  0553 E1           	pop hl
1145  0554 C9           	ret
1146  0555              ; 537             }
1147  0555              ; 538         }
1148  0555              ; 539     }
1149  0555              ; 540 }
1150  0555              ; 541
1151  0555              ; 542 void ftpSettingsEditViewSelectEditField() {
1152  0555              ftpsettingseditviewselecteditfie:
1153  0555              ; 543     a = ftpSettingsEditViewCurrentPos;
1154  0555 3A 19 10     	ld a, (ftpsettingseditviewcurrentpos)
1155  0558              ; 544     if (a == 0) {
1156  0558 B7           	or a
1157  0559 C2 70 05     	jp nz, l_93
1158  055C              ; 545         hl = ftpSettingsEditViewIpValPos;
1159  055C 2A 01 10     	ld hl, (ftpsettingseditviewipvalpos)
1160  055F              ; 546         ftpSettingsEditViewEditValuePos = hl;
1161  055F 22 1A 10     	ld (ftpsettingseditvieweditvaluepos), hl
1162  0562              ; 547         setPosCursor();
1163  0562 CD 3C F8     	call setposcursor
1164  0565              ; 548
1165  0565              ; 549         push_pop(hl) {
1166  0565 E5           	push hl
1167  0566              ; 550             hl = ftpSettingsIpValue;
1168  0566 21 5E 0D     	ld hl, ftpsettingsipvalue
1169  0569              ; 551             ftpSettingsEditView_CopyStrFromHL();
1170  0569 CD D5 05     	call ftpsettingseditview_copystrfromh
1171  056C E1           	pop hl
1172  056D C3 B8 05     	jp l_94
1173  0570              l_93:
1174  0570              ; 552         }
1175  0570              ; 553     } else if (a == 1) {
1176  0570 FE 01        	cp 1
1177  0572 C2 89 05     	jp nz, l_95
1178  0575              ; 554         hl = ftpSettingsEditViewPortValPos;
1179  0575 2A 03 10     	ld hl, (ftpsettingseditviewportvalpos)
1180  0578              ; 555         ftpSettingsEditViewEditValuePos = hl;
1181  0578 22 1A 10     	ld (ftpsettingseditvieweditvaluepos), hl
1182  057B              ; 556         setPosCursor();
1183  057B CD 3C F8     	call setposcursor
1184  057E              ; 557
1185  057E              ; 558         push_pop(hl) {
1186  057E E5           	push hl
1187  057F              ; 559             hl = ftpSettingsPortValue;
1188  057F 21 70 0D     	ld hl, ftpsettingsportvalue
1189  0582              ; 560             ftpSettingsEditView_CopyStrFromHL();
1190  0582 CD D5 05     	call ftpsettingseditview_copystrfromh
1191  0585 E1           	pop hl
1192  0586 C3 B8 05     	jp l_96
1193  0589              l_95:
1194  0589              ; 561         }
1195  0589              ; 562     } else if (a == 2) {
1196  0589 FE 02        	cp 2
1197  058B C2 A2 05     	jp nz, l_97
1198  058E              ; 563         hl = ftpSettingsEditViewUserValPos;
1199  058E 2A 05 10     	ld hl, (ftpsettingseditviewuservalpos)
1200  0591              ; 564         ftpSettingsEditViewEditValuePos = hl;
1201  0591 22 1A 10     	ld (ftpsettingseditvieweditvaluepos), hl
1202  0594              ; 565         setPosCursor();
1203  0594 CD 3C F8     	call setposcursor
1204  0597              ; 566
1205  0597              ; 567         push_pop(hl) {
1206  0597 E5           	push hl
1207  0598              ; 568             hl = ftpSettingsUserValue;
1208  0598 21 A0 0D     	ld hl, ftpsettingsuservalue
1209  059B              ; 569             ftpSettingsEditView_CopyStrFromHL();
1210  059B CD D5 05     	call ftpsettingseditview_copystrfromh
1211  059E E1           	pop hl
1212  059F C3 B8 05     	jp l_98
1213  05A2              l_97:
1214  05A2              ; 570         }
1215  05A2              ; 571     } else if (a == 3) {
1216  05A2 FE 03        	cp 3
1217  05A4 C2 B8 05     	jp nz, l_99
1218  05A7              ; 572         hl = ftpSettingsEditViewPasswordValPos;
1219  05A7 2A 07 10     	ld hl, (ftpsettingseditviewpasswordvalpo)
1220  05AA              ; 573         ftpSettingsEditViewEditValuePos = hl;
1221  05AA 22 1A 10     	ld (ftpsettingseditvieweditvaluepos), hl
1222  05AD              ; 574         setPosCursor();
1223  05AD CD 3C F8     	call setposcursor
1224  05B0              ; 575
1225  05B0              ; 576         push_pop(hl) {
1226  05B0 E5           	push hl
1227  05B1              ; 577             hl = ftpSettingsEditViewPasswordVal;
1228  05B1 21 09 10     	ld hl, ftpsettingseditviewpasswordval
1229  05B4              ; 578             ftpSettingsEditView_CopyStrFromHL();
1230  05B4 CD D5 05     	call ftpsettingseditview_copystrfromh
1231  05B7 E1           	pop hl
1232  05B8              l_99:
1233  05B8              l_98:
1234  05B8              l_96:
1235  05B8              l_94:
1236  05B8              ; 579         }
1237  05B8              ; 580     }
1238  05B8              ; 581     ftpSettingsEditViewEditField();
1239  05B8 C3 12 06     	jp ftpsettingseditvieweditfield
1240  05BB              ; 582 }
1241  05BB              ; 583
1242  05BB              ; 584 void ftpSettingsEditViewSaveEditValueToHL() {
1243  05BB              ftpsettingseditviewsaveeditvalue:
1244  05BB              ; 585     push_pop(de) {
1245  05BB D5           	push de
1246  05BC              ; 586         push_pop(bc) {
1247  05BC C5           	push bc
1248  05BD              ; 587             de = ftpSettingsEditViewEditValue;
1249  05BD 11 1C 10     	ld de, ftpsettingseditvieweditvalue
1250  05C0              ; 588             a = ftpSettingsEditViewEditPos;
1251  05C0 3A 34 10     	ld a, (ftpsettingseditvieweditpos)
1252  05C3              ; 589             c = a;
1253  05C3 4F           	ld c, a
1254  05C4              ; 590             b = 0;
1255  05C4 06 00        	ld b, 0
1256  05C6              ; 591             do {
1257  05C6              l_101:
1258  05C6              ; 592                 a = *de;
1259  05C6 1A           	ld a, (de)
1260  05C7              ; 593                 *hl = a;
1261  05C7 77           	ld (hl), a
1262  05C8              ; 594                 hl++;
1263  05C8 23           	inc hl
1264  05C9              ; 595                 de++;
1265  05C9 13           	inc de
1266  05CA              ; 596                 b++;
1267  05CA 04           	inc b
1268  05CB              ; 597                 a = b;
1269  05CB 78           	ld a, b
1270  05CC              ; 598                 a -= c;
1271  05CC 91           	sub c
1272  05CD              l_102:
1273  05CD C2 C6 05     	jp nz, l_101
1274  05D0              ; 599             } while (flag_nz);
1275  05D0              ; 600             *hl = 0;
1276  05D0 36 00        	ld (hl), 0
1277  05D2 C1           	pop bc
1278  05D3 D1           	pop de
1279  05D4 C9           	ret
1280  05D5              ; 601         }
1281  05D5              ; 602     }
1282  05D5              ; 603 }
1283  05D5              ; 604
1284  05D5              ; 605 void ftpSettingsEditView_CopyStrFromHL() {
1285  05D5              ftpsettingseditview_copystrfromh:
1286  05D5              ; 606     push_pop(de) {
1287  05D5 D5           	push de
1288  05D6              ; 607         push_pop(bc) {
1289  05D6 C5           	push bc
1290  05D7              ; 608             de = ftpSettingsEditViewEditValue;
1291  05D7 11 1C 10     	ld de, ftpsettingseditvieweditvalue
1292  05DA              ; 609             b = 0;
1293  05DA 06 00        	ld b, 0
1294  05DC              ; 610             c = 0;
1295  05DC 0E 00        	ld c, 0
1296  05DE              ; 611             do {
1297  05DE              l_104:
1298  05DE              ; 612                 a = *hl;
1299  05DE 7E           	ld a, (hl)
1300  05DF              ; 613                 *de = a;
1301  05DF 12           	ld (de), a
1302  05E0              ; 614                 if ((a = b) == 22) {
1303  05E0 78           	ld a, b
1304  05E1 FE 16        	cp 22
1305  05E3 C2 EC 05     	jp nz, l_107
1306  05E6              ; 615                     a = 0;
1307  05E6 3E 00        	ld a, 0
1308  05E8              ; 616                     *de = a;
1309  05E8 12           	ld (de), a
1310  05E9 C3 06 06     	jp l_108
1311  05EC              l_107:
1312  05EC              ; 617                 } else if ((a = c) == 1) {
1313  05EC 79           	ld a, c
1314  05ED FE 01        	cp 1
1315  05EF C2 F8 05     	jp nz, l_109
1316  05F2              ; 618                     a = ' ';
1317  05F2 3E 20        	ld a, 32
1318  05F4              ; 619                     *de = a;
1319  05F4 12           	ld (de), a
1320  05F5 C3 06 06     	jp l_110
1321  05F8              l_109:
1322  05F8              ; 620                 } else if ((a = *de) == 0) {
1323  05F8 1A           	ld a, (de)
1324  05F9 B7           	or a
1325  05FA C2 06 06     	jp nz, l_111
1326  05FD              ; 621                     c = 1;
1327  05FD 0E 01        	ld c, 1
1328  05FF              ; 622                     a = ' ';
1329  05FF 3E 20        	ld a, 32
1330  0601              ; 623                     *de = a;
1331  0601 12           	ld (de), a
1332  0602              ; 624                     a = b;
1333  0602 78           	ld a, b
1334  0603              ; 625                     ftpSettingsEditViewEditPos = a;
1335  0603 32 34 10     	ld (ftpsettingseditvieweditpos), a
1336  0606              l_111:
1337  0606              l_110:
1338  0606              l_108:
1339  0606              ; 626                 }
1340  0606              ; 627
1341  0606              ; 628                 hl ++;
1342  0606 23           	inc hl
1343  0607              ; 629                 de++;
1344  0607 13           	inc de
1345  0608              ; 630                 b++;
1346  0608 04           	inc b
1347  0609              ; 631                 a = b;
1348  0609 78           	ld a, b
1349  060A              ; 632                 a -= 23;
1350  060A D6 17        	sub 23
1351  060C              l_105:
1352  060C C2 DE 05     	jp nz, l_104
1353  060F C1           	pop bc
1354  0610 D1           	pop de
1355  0611 C9           	ret
1356  0612              ; 633             } while (flag_nz);
1357  0612              ; 634         }
1358  0612              ; 635     }
1359  0612              ; 636 }
1360  0612              ; 637
1361  0612              ; 638 void ftpSettingsEditViewEditField() {
1362  0612              ftpsettingseditvieweditfield:
1363  0612              ; 639     hl = ftpSettingsEditViewEditValuePos;
1364  0612 2A 1A 10     	ld hl, (ftpsettingseditvieweditvaluepos)
1365  0615              ; 640     setPosCursor();
1366  0615 CD 3C F8     	call setposcursor
1367  0618              ; 641
1368  0618              ; 642     a = 0xFF;
1369  0618 3E FF        	ld a, 255
1370  061A              ; 643     inverceAddress = a;
1371  061A 32 D3 F3     	ld (inverceaddress), a
1372  061D              ; 644
1373  061D              ; 645     hl = ftpSettingsEditViewEditValue;
1374  061D 21 1C 10     	ld hl, ftpsettingseditvieweditvalue
1375  0620              ; 646     printHLStr();
1376  0620 CD 18 F8     	call printhlstr
1377  0623              ; 647
1378  0623              ; 648     ftpSettingsEditViewSetEditCursor();
1379  0623 CD B2 06     	call ftpsettingseditviewseteditcursor
1380  0626              ; 649     push_pop(bc) {
1381  0626 C5           	push bc
1382  0627              ; 650         b = 0;
1383  0627 06 00        	ld b, 0
1384  0629              ; 651         do {
1385  0629              l_113:
1386  0629              ; 652             getKeyboardCharA();
1387  0629 CD 03 F8     	call getkeyboardchara
1388  062C              ; 653
1389  062C              ; 654             if (a == 0x1B) { // выход из редактирования без сохранения
1390  062C FE 1B        	cp 27
1391  062E C2 36 06     	jp nz, l_116
1392  0631              ; 655                 b = 1;
1393  0631 06 01        	ld b, 1
1394  0633 C3 83 06     	jp l_117
1395  0636              l_116:
1396  0636              ; 656             } else if (a == 0x0D) { // Сохранить и выйти из редактирования
1397  0636 FE 0D        	cp 13
1398  0638 C2 43 06     	jp nz, l_118
1399  063B              ; 657                 b = 1;
1400  063B 06 01        	ld b, 1
1401  063D              ; 658                 ftpSettingsEditViewSaveField();
1402  063D CD 50 07     	call ftpsettingseditviewsavefield
1403  0640 C3 83 06     	jp l_119
1404  0643              l_118:
1405  0643              ; 659             } else if (a >= 0x20) {
1406  0643 FE 20        	cp 32
1407  0645 DA 83 06     	jp c, l_120
1408  0648              ; 660                 if (a < 0x7F) { //Ввод символа
1409  0648 FE 7F        	cp 127
1410  064A D2 6B 06     	jp nc, l_122
1411  064D              ; 661                     c = a;
1412  064D 4F           	ld c, a
1413  064E              ; 662                     // Если достигли предела - то перемещаем курсор на 1 назад
1414  064E              ; 663                     a = ftpSettingsEditViewEditPos;
1415  064E 3A 34 10     	ld a, (ftpsettingseditvieweditpos)
1416  0651              ; 664                     if (a >= 15) {
1417  0651 FE 0F        	cp 15
1418  0653 DA 57 06     	jp c, l_124
1419  0656              ; 665                         a--;
1420  0656 3D           	dec a
1421  0657              l_124:
1422  0657              ; 666                     }
1423  0657              ; 667                     ftpSettingsEditViewEditPos = a;
1424  0657 32 34 10     	ld (ftpsettingseditvieweditpos), a
1425  065A              ; 668
1426  065A              ; 669                     //Сохраняем символ
1427  065A              ; 670                     a = c;
1428  065A 79           	ld a, c
1429  065B              ; 671                     ftpSettingsEditViewSetValueA();
1430  065B CD 95 06     	call ftpsettingseditviewsetvaluea
1431  065E              ; 672                     a = ftpSettingsEditViewEditPos;
1432  065E 3A 34 10     	ld a, (ftpsettingseditvieweditpos)
1433  0661              ; 673                     a++;
1434  0661 3C           	inc a
1435  0662              ; 674                     ftpSettingsEditViewEditPos = a;
1436  0662 32 34 10     	ld (ftpsettingseditvieweditpos), a
1437  0665              ; 675                     ftpSettingsEditViewSetEditCursor();
1438  0665 CD B2 06     	call ftpsettingseditviewseteditcursor
1439  0668 C3 83 06     	jp l_123
1440  066B              l_122:
1441  066B              ; 676                 } else if (a == 0x7F) { //Забой... (удаление символа)
1442  066B FE 7F        	cp 127
1443  066D C2 83 06     	jp nz, l_126
1444  0670              ; 677                     if ((a = ftpSettingsEditViewEditPos) > 0) {
1445  0670 3A 34 10     	ld a, (ftpsettingseditvieweditpos)
1446  0673 B7           	or a
1447  0674 CA 83 06     	jp z, l_128
1448  0677              ; 678                         a--;
1449  0677 3D           	dec a
1450  0678              ; 679                         ftpSettingsEditViewEditPos = a;
1451  0678 32 34 10     	ld (ftpsettingseditvieweditpos), a
1452  067B              ; 680                         ftpSettingsEditViewSetEditCursor();
1453  067B CD B2 06     	call ftpsettingseditviewseteditcursor
1454  067E              ; 681                         a = ' ';
1455  067E 3E 20        	ld a, 32
1456  0680              ; 682                         ftpSettingsEditViewSetValueA();
1457  0680 CD 95 06     	call ftpsettingseditviewsetvaluea
1458  0683              l_128:
1459  0683              l_126:
1460  0683              l_123:
1461  0683              l_120:
1462  0683              l_119:
1463  0683              l_117:
1464  0683              ; 683                     }
1465  0683              ; 684                 }
1466  0683              ; 685             }
1467  0683              ; 686
1468  0683              ; 687             a = b;
1469  0683 78           	ld a, b
1470  0684              ; 688             a -= 1;
1471  0684 D6 01        	sub 1
1472  0686              l_114:
1473  0686 C2 29 06     	jp nz, l_113
1474  0689 C1           	pop bc
1475  068A              ; 689         } while (flag_nz);
1476  068A              ; 690     }
1477  068A              ; 691
1478  068A              ; 692     a = 0x00;
1479  068A 3E 00        	ld a, 0
1480  068C              ; 693     inverceAddress = a;
1481  068C 32 D3 F3     	ld (inverceaddress), a
1482  068F              ; 694
1483  068F              ; 695     showFtpSettingsEditView();
1484  068F CD CC 04     	call showftpsettingseditview
1485  0692              ; 696     ftpSettingsEditViewDataUpdate();
1486  0692 C3 C0 06     	jp ftpsettingseditviewdataupdate
1487  0695              ; 697 }
1488  0695              ; 698
1489  0695              ; 699 void ftpSettingsEditViewSetValueA() {
1490  0695              ftpsettingseditviewsetvaluea:
1491  0695              ; 700     push_pop(hl) {
1492  0695 E5           	push hl
1493  0696              ; 701         push_pop(bc) {
1494  0696 C5           	push bc
1495  0697              ; 702             b = a;
1496  0697 47           	ld b, a
1497  0698              ; 703             //Сохраним символ в ftpSettingsEditViewEditValue
1498  0698              ; 704             hl = ftpSettingsEditViewEditValue;
1499  0698 21 1C 10     	ld hl, ftpsettingseditvieweditvalue
1500  069B              ; 705             a = ftpSettingsEditViewEditPos;
1501  069B 3A 34 10     	ld a, (ftpsettingseditvieweditpos)
1502  069E              ; 706             a += l;
1503  069E 85           	add l
1504  069F              ; 707             l = a;
1505  069F 6F           	ld l, a
1506  06A0              ; 708             if (flag_c) {
1507  06A0 D2 A4 06     	jp nc, l_130
1508  06A3              ; 709                 h++;
1509  06A3 24           	inc h
1510  06A4              l_130:
1511  06A4              ; 710             }
1512  06A4              ; 711             *hl = b;
1513  06A4 70           	ld (hl), b
1514  06A5              ; 712             //Отрисуем символ на экране
1515  06A5              ; 713             ftpSettingsEditViewSetEditCursor();
1516  06A5 CD B2 06     	call ftpsettingseditviewseteditcursor
1517  06A8              ; 714             a = b;
1518  06A8 78           	ld a, b
1519  06A9              ; 715             printChatA();
1520  06A9 CD 0F F8     	call printchata
1521  06AC              ; 716             ftpSettingsEditViewSetEditCursor();
1522  06AC CD B2 06     	call ftpsettingseditviewseteditcursor
1523  06AF C1           	pop bc
1524  06B0 E1           	pop hl
1525  06B1 C9           	ret
1526  06B2              ; 717         }
1527  06B2              ; 718     }
1528  06B2              ; 719 }
1529  06B2              ; 720
1530  06B2              ; 721 void ftpSettingsEditViewSetEditCursor() {
1531  06B2              ftpsettingseditviewseteditcursor:
1532  06B2              ; 722     push_pop(hl) {
1533  06B2 E5           	push hl
1534  06B3              ; 723         hl = ftpSettingsEditViewEditValuePos;
1535  06B3 2A 1A 10     	ld hl, (ftpsettingseditvieweditvaluepos)
1536  06B6              ; 724         a = ftpSettingsEditViewEditPos;
1537  06B6 3A 34 10     	ld a, (ftpsettingseditvieweditpos)
1538  06B9              ; 725         a += l;
1539  06B9 85           	add l
1540  06BA              ; 726         l = a;
1541  06BA 6F           	ld l, a
1542  06BB              ; 727         setPosCursor();
1543  06BB CD 3C F8     	call setposcursor
1544  06BE E1           	pop hl
1545  06BF C9           	ret
1546  06C0              ; 728     }
1547  06C0              ; 729 }
1548  06C0              ; 730
1549  06C0              ; 731 void ftpSettingsEditViewDataUpdate() {
1550  06C0              ftpsettingseditviewdataupdate:
1551  06C0              ; 732     if ((a = rootViewCurrentView) != rootViewCurrentFTPSettingsEditView) {
1552  06C0 3A 93 0F     	ld a, (rootviewcurrentview)
1553  06C3 FE 02        	cp 2
1554  06C5 CA C9 06     	jp z, l_132
1555  06C8              ; 733         return;
1556  06C8 C9           	ret
1557  06C9              l_132:
1558  06C9              ; 734     }
1559  06C9              ; 735
1560  06C9              ; 736     push_pop(bc) {
1561  06C9 C5           	push bc
1562  06CA              ; 737         b = 0;
1563  06CA 06 00        	ld b, 0
1564  06CC              ; 738         do {
1565  06CC              l_134:
1566  06CC              ; 739             a = 0x00;
1567  06CC 3E 00        	ld a, 0
1568  06CE              ; 740             inverceAddress = a;
1569  06CE 32 D3 F3     	ld (inverceaddress), a
1570  06D1              ; 741
1571  06D1              ; 742             if ((a = ftpSettingsEditViewCurrentPos) == b) {
1572  06D1 3A 19 10     	ld a, (ftpsettingseditviewcurrentpos)
1573  06D4 B8           	cp b
1574  06D5 C2 DD 06     	jp nz, l_137
1575  06D8              ; 743                 a = 0xFF;
1576  06D8 3E FF        	ld a, 255
1577  06DA              ; 744                 inverceAddress = a;
1578  06DA 32 D3 F3     	ld (inverceaddress), a
1579  06DD              l_137:
1580  06DD              ; 745             }
1581  06DD              ; 746
1582  06DD              ; 747             a = b;
1583  06DD 78           	ld a, b
1584  06DE              ; 748             ftpSettingsEditViewShowValueA();
1585  06DE CD EF 06     	call ftpsettingseditviewshowvaluea
1586  06E1              ; 749
1587  06E1              ; 750             a = 0x00;
1588  06E1 3E 00        	ld a, 0
1589  06E3              ; 751             inverceAddress = a;
1590  06E3 32 D3 F3     	ld (inverceaddress), a
1591  06E6              ; 752
1592  06E6              ; 753             b++;
1593  06E6 04           	inc b
1594  06E7              ; 754             a = b;
1595  06E7 78           	ld a, b
1596  06E8              ; 755             a -= 5;
1597  06E8 D6 05        	sub 5
1598  06EA              l_135:
1599  06EA C2 CC 06     	jp nz, l_134
1600  06ED C1           	pop bc
1601  06EE C9           	ret
1602  06EF              ; 11 void ftpSettingsEditViewShowValueA() {
1603  06EF              ftpsettingseditviewshowvaluea:
1604  06EF              ; 12     if (a == 0) {
1605  06EF B7           	or a
1606  06F0 C2 02 07     	jp nz, l_139
1607  06F3              ; 13         hl = ftpSettingsEditViewIpValPos;
1608  06F3 2A 01 10     	ld hl, (ftpsettingseditviewipvalpos)
1609  06F6              ; 14         setPosCursor();
1610  06F6 CD 3C F8     	call setposcursor
1611  06F9              ; 15
1612  06F9              ; 16         hl = ftpSettingsIpValue;
1613  06F9 21 5E 0D     	ld hl, ftpsettingsipvalue
1614  06FC              ; 17         printHLStr();
1615  06FC CD 18 F8     	call printhlstr
1616  06FF C3 4F 07     	jp l_140
1617  0702              l_139:
1618  0702              ; 18     } else if (a == 1) {
1619  0702 FE 01        	cp 1
1620  0704 C2 16 07     	jp nz, l_141
1621  0707              ; 19         hl = ftpSettingsEditViewPortValPos;
1622  0707 2A 03 10     	ld hl, (ftpsettingseditviewportvalpos)
1623  070A              ; 20         setPosCursor();
1624  070A CD 3C F8     	call setposcursor
1625  070D              ; 21
1626  070D              ; 22         hl = ftpSettingsPortValue;
1627  070D 21 70 0D     	ld hl, ftpsettingsportvalue
1628  0710              ; 23         printHLStr();
1629  0710 CD 18 F8     	call printhlstr
1630  0713 C3 4F 07     	jp l_142
1631  0716              l_141:
1632  0716              ; 24     } else if (a == 2) {
1633  0716 FE 02        	cp 2
1634  0718 C2 2A 07     	jp nz, l_143
1635  071B              ; 25         hl = ftpSettingsEditViewUserValPos;
1636  071B 2A 05 10     	ld hl, (ftpsettingseditviewuservalpos)
1637  071E              ; 26         setPosCursor();
1638  071E CD 3C F8     	call setposcursor
1639  0721              ; 27
1640  0721              ; 28         hl = ftpSettingsUserValue;
1641  0721 21 A0 0D     	ld hl, ftpsettingsuservalue
1642  0724              ; 29         printHLStr();
1643  0724 CD 18 F8     	call printhlstr
1644  0727 C3 4F 07     	jp l_144
1645  072A              l_143:
1646  072A              ; 30     } else if (a == 3) {
1647  072A FE 03        	cp 3
1648  072C C2 3E 07     	jp nz, l_145
1649  072F              ; 31         hl = ftpSettingsEditViewPasswordValPos;
1650  072F 2A 07 10     	ld hl, (ftpsettingseditviewpasswordvalpo)
1651  0732              ; 32         setPosCursor();
1652  0732 CD 3C F8     	call setposcursor
1653  0735              ; 33
1654  0735              ; 34         hl = ftpSettingsEditViewPasswordVal;
1655  0735 21 09 10     	ld hl, ftpsettingseditviewpasswordval
1656  0738              ; 35         printHLStr();
1657  0738 CD 18 F8     	call printhlstr
1658  073B C3 4F 07     	jp l_146
1659  073E              l_145:
1660  073E              ; 36     } else if (a == 4) {
1661  073E FE 04        	cp 4
1662  0740 C2 4F 07     	jp nz, l_147
1663  0743              ; 37         hl = ftpSettingsEditViewOkLabelPos;
1664  0743 2A F8 0F     	ld hl, (ftpsettingseditviewoklabelpos)
1665  0746              ; 38         setPosCursor();
1666  0746 CD 3C F8     	call setposcursor
1667  0749              ; 39         hl = ftpSettingsEditViewOkLabel;
1668  0749 21 FA 0F     	ld hl, ftpsettingseditviewoklabel
1669  074C              ; 40         printHLStr();
1670  074C CD 18 F8     	call printhlstr
1671  074F              l_147:
1672  074F              l_146:
1673  074F              l_144:
1674  074F              l_142:
1675  074F              l_140:
1676  074F C9           	ret
1677  0750              ; 41     }
1678  0750              ; 42 }
1679  0750              ; 43
1680  0750              ; 44 void ftpSettingsEditViewSaveField() {
1681  0750              ftpsettingseditviewsavefield:
1682  0750              ; 45     a = ftpSettingsEditViewCurrentPos;
1683  0750 3A 19 10     	ld a, (ftpsettingseditviewcurrentpos)
1684  0753              ; 46     if (a == 0) {
1685  0753 B7           	or a
1686  0754 C2 5D 07     	jp nz, l_149
1687  0757              ; 47         hl = ftpSettingsIpValue;
1688  0757 21 5E 0D     	ld hl, ftpsettingsipvalue
1689  075A C3 7B 07     	jp l_150
1690  075D              l_149:
1691  075D              ; 48     } else if (a == 1) {
1692  075D FE 01        	cp 1
1693  075F C2 68 07     	jp nz, l_151
1694  0762              ; 49         hl = ftpSettingsPortValue;
1695  0762 21 70 0D     	ld hl, ftpsettingsportvalue
1696  0765 C3 7B 07     	jp l_152
1697  0768              l_151:
1698  0768              ; 50     } else if (a == 2) {
1699  0768 FE 02        	cp 2
1700  076A C2 73 07     	jp nz, l_153
1701  076D              ; 51         hl = ftpSettingsUserValue;
1702  076D 21 A0 0D     	ld hl, ftpsettingsuservalue
1703  0770 C3 7B 07     	jp l_154
1704  0773              l_153:
1705  0773              ; 52     } else if (a == 3) {
1706  0773 FE 03        	cp 3
1707  0775 C2 7B 07     	jp nz, l_155
1708  0778              ; 53         hl = ftpSettingsEditViewPasswordVal;
1709  0778 21 09 10     	ld hl, ftpsettingseditviewpasswordval
1710  077B              l_155:
1711  077B              l_154:
1712  077B              l_152:
1713  077B              l_150:
1714  077B              ; 54     }
1715  077B              ; 55     ftpSettingsEditViewSaveEditValueToHL();
1716  077B CD BB 05     	call ftpsettingseditviewsaveeditvalue
1717  077E              ; 56     //Save ESP
1718  077E              ; 57     a = ftpSettingsEditViewCurrentPos;
1719  077E 3A 19 10     	ld a, (ftpsettingseditviewcurrentpos)
1720  0781              ; 58     if (a == 0) {
1721  0781 B7           	or a
1722  0782 C2 8B 07     	jp nz, l_157
1723  0785              ; 59         setFTPUrl();
1724  0785 CD 83 15     	call setftpurl
1725  0788 C3 A9 07     	jp l_158
1726  078B              l_157:
1727  078B              ; 60     } else if (a == 1) {
1728  078B FE 01        	cp 1
1729  078D C2 96 07     	jp nz, l_159
1730  0790              ; 61         setFTPPort();
1731  0790 CD D3 16     	call setftpport
1732  0793 C3 A9 07     	jp l_160
1733  0796              l_159:
1734  0796              ; 62     } else if (a == 2) {
1735  0796 FE 02        	cp 2
1736  0798 C2 A1 07     	jp nz, l_161
1737  079B              ; 63         setFTPUser();
1738  079B CD F3 15     	call setftpuser
1739  079E C3 A9 07     	jp l_162
1740  07A1              l_161:
1741  07A1              ; 64     } else if (a == 3) {
1742  07A1 FE 03        	cp 3
1743  07A3 C2 A9 07     	jp nz, l_163
1744  07A6              ; 65         setFTPPassword();
1745  07A6 CD 63 16     	call setftppassword
1746  07A9              l_163:
1747  07A9              l_162:
1748  07A9              l_160:
1749  07A9              l_158:
1750  07A9 C9           	ret
1751  07AA              ; 66     }
1752  07AA              ; 67 }
1753  07AA              ; 68
1754  07AA              ; 69 void ftpSettingsEditViewKeyA() {
1755  07AA              ftpsettingseditviewkeya:
1756  07AA              ; 70     push_pop(hl) {
1757  07AA E5           	push hl
1758  07AB              ; 71         l = a;
1759  07AB 6F           	ld l, a
1760  07AC              ; 72         if ((a = rootViewCurrentView) == rootViewCurrentFTPSettingsEditView) {
1761  07AC 3A 93 0F     	ld a, (rootviewcurrentview)
1762  07AF FE 02        	cp 2
1763  07B1 C2 17 08     	jp nz, l_165
1764  07B4              ; 73             a = l;
1765  07B4 7D           	ld a, l
1766  07B5              ; 74             if (a == 0x1B) { //ESC выход из настройки
1767  07B5 FE 1B        	cp 27
1768  07B7 C2 C8 07     	jp nz, l_167
1769  07BA              ; 75                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
1770  07BA 3E 00        	ld a, 0
1771  07BC              ; 76                 rootViewCurrentView = a;
1772  07BC 32 93 0F     	ld (rootviewcurrentview), a
1773  07BF              ; 77
1774  07BF              ; 78                 updateRootUI();
1775  07BF CD E2 01     	call updaterootui
1776  07C2              ; 79                 updateRootDataUI();
1777  07C2 CD DF 01     	call updaterootdataui
1778  07C5 C3 17 08     	jp l_168
1779  07C8              l_167:
1780  07C8              ; 80             } else {
1781  07C8              ; 81                 if (a == 0x1A) { //down
1782  07C8 FE 1A        	cp 26
1783  07CA C2 DE 07     	jp nz, l_169
1784  07CD              ; 82                     a = ftpSettingsEditViewCurrentPos;
1785  07CD 3A 19 10     	ld a, (ftpsettingseditviewcurrentpos)
1786  07D0              ; 83                     a++;
1787  07D0 3C           	inc a
1788  07D1              ; 84                     if (a == 5) {
1789  07D1 FE 05        	cp 5
1790  07D3 C2 D8 07     	jp nz, l_171
1791  07D6              ; 85                         a = 0;
1792  07D6 3E 00        	ld a, 0
1793  07D8              l_171:
1794  07D8              ; 86                     }
1795  07D8              ; 87                     ftpSettingsEditViewCurrentPos = a;
1796  07D8 32 19 10     	ld (ftpsettingseditviewcurrentpos), a
1797  07DB C3 17 08     	jp l_170
1798  07DE              l_169:
1799  07DE              ; 88                 } else if (a == 0x19) { //up
1800  07DE FE 19        	cp 25
1801  07E0 C2 F6 07     	jp nz, l_173
1802  07E3              ; 89                     a = ftpSettingsEditViewCurrentPos;
1803  07E3 3A 19 10     	ld a, (ftpsettingseditviewcurrentpos)
1804  07E6              ; 90                     if (a == 0) {
1805  07E6 B7           	or a
1806  07E7 C2 EF 07     	jp nz, l_175
1807  07EA              ; 91                         a = 4;
1808  07EA 3E 04        	ld a, 4
1809  07EC C3 F0 07     	jp l_176
1810  07EF              l_175:
1811  07EF              ; 92                     } else {
1812  07EF              ; 93                         a--;
1813  07EF 3D           	dec a
1814  07F0              l_176:
1815  07F0              ; 94                     }
1816  07F0              ; 95                     ftpSettingsEditViewCurrentPos = a;
1817  07F0 32 19 10     	ld (ftpsettingseditviewcurrentpos), a
1818  07F3 C3 17 08     	jp l_174
1819  07F6              l_173:
1820  07F6              ; 96                 } else if (a == 0x0D) { //Enter
1821  07F6 FE 0D        	cp 13
1822  07F8 C2 17 08     	jp nz, l_177
1823  07FB              ; 97                     /// и подключиться к FTP
1824  07FB              ; 98                     needFtpConnect();
1825  07FB CD 0D 17     	call needftpconnect
1826  07FE              ; 99                     ///
1827  07FE              ; 100                     if ((a = ftpSettingsEditViewCurrentPos) == 4) { // Нажатие на кнопку ОК
1828  07FE 3A 19 10     	ld a, (ftpsettingseditviewcurrentpos)
1829  0801 FE 04        	cp 4
1830  0803 C2 14 08     	jp nz, l_179
1831  0806              ; 101                         a = rootViewCurrentDiskView; // переходим на список файлов на диске
1832  0806 3E 00        	ld a, 0
1833  0808              ; 102                         rootViewCurrentView = a;
1834  0808 32 93 0F     	ld (rootviewcurrentview), a
1835  080B              ; 103
1836  080B              ; 104                         updateRootUI();
1837  080B CD E2 01     	call updaterootui
1838  080E              ; 105                         updateRootDataUI();
1839  080E CD DF 01     	call updaterootdataui
1840  0811 C3 17 08     	jp l_180
1841  0814              l_179:
1842  0814              ; 106                     } else {
1843  0814              ; 107                         ftpSettingsEditViewSelectEditField();
1844  0814 CD 55 05     	call ftpsettingseditviewselecteditfie
1845  0817              l_180:
1846  0817              l_177:
1847  0817              l_174:
1848  0817              l_170:
1849  0817              l_168:
1850  0817              l_165:
1851  0817 E1           	pop hl
1852  0818 C9           	ret
1853  0819              ; 108                     }
1854  0819              ; 109                 }
1855  0819              ; 110             }
1856  0819              ; 111         }
1857  0819              ; 112     }
1858  0819              ; 113 }
1859  0819              ; 114
1860  0819              ; 115 void updateFtpStatus() {
1861  0819              updateftpstatus:
1862  0819              ; 116     a = updateFtpStatusTike;
1863  0819 3A 35 10     	ld a, (updateftpstatustike)
1864  081C              ; 117     if (a < 240) {
1865  081C FE F0        	cp 240
1866  081E D2 26 08     	jp nc, l_181
1867  0821              ; 118         a++;
1868  0821 3C           	inc a
1869  0822              ; 119         updateFtpStatusTike = a;
1870  0822 32 35 10     	ld (updateftpstatustike), a
1871  0825              ; 120         return;
1872  0825 C9           	ret
1873  0826              l_181:
1874  0826              ; 121     }
1875  0826              ; 122     a = 0;
1876  0826 3E 00        	ld a, 0
1877  0828              ; 123     updateFtpStatusTike = a;
1878  0828 32 35 10     	ld (updateftpstatustike), a
1879  082B              ; 124     //
1880  082B              ; 125     getFtpState();
1881  082B CD 1D 17     	call getftpstate
1882  082E              ; 126     //
1883  082E              ; 127     updateFtpStatusUI();
1884  082E              ; 128 }
1885  082E              ; 129
1886  082E              ; 130 void updateFtpStatusUI() {
1887  082E              updateftpstatusui:
1888  082E              ; 131     if ((a = ftpSettingsStateChange) == 0x01) {
1889  082E 3A 85 0D     	ld a, (ftpsettingsstatechange)
1890  0831 FE 01        	cp 1
1891  0833 C2 4F 08     	jp nz, l_183
1892  0836              ; 132         a = 0x00;
1893  0836 3E 00        	ld a, 0
1894  0838              ; 133         ftpSettingsStateChange = a;
1895  0838 32 85 0D     	ld (ftpsettingsstatechange), a
1896  083B              ; 134
1897  083B              ; 135         updateFtpViewStatusText();
1898  083B CD A8 1B     	call updateftpviewstatustext
1899  083E              ; 136         //
1900  083E              ; 137         clearFtpViewValData();
1901  083E CD 90 1B     	call clearftpviewvaldata
1902  0841              ; 138         updateFtpViewValData();
1903  0841 CD 9C 1B     	call updateftpviewvaldata
1904  0844              ; 139
1905  0844              ; 140         // Получаем каталог
1906  0844              ; 141         if ((a = ftpSettingsStateVal) == 0x01) {
1907  0844 3A 84 0D     	ld a, (ftpsettingsstateval)
1908  0847 FE 01        	cp 1
1909  0849 C2 4F 08     	jp nz, l_185
1910  084C              ; 142             needUpdateFtpList();
1911  084C CD B0 18     	call needupdateftplist
1912  084F              l_185:
1913  084F              l_183:
1914  084F C9           	ret
1915  0850              ; 11 void needOpenWiFiSettingsEditView() {
1916  0850              needopenwifisettingseditview:
1917  0850              ; 12     push_pop(hl) {
1918  0850 E5           	push hl
1919  0851              ; 13         if ((a = rootViewCurrentView) != rootViewCurrentWiFiSettingsEditView) { //Если уже открыты настройки - не открываем
1920  0851 3A 93 0F     	ld a, (rootviewcurrentview)
1921  0854 FE 03        	cp 3
1922  0856 CA 74 08     	jp z, l_187
1923  0859              ; 14             if ((a = rootViewCurrentView) != rootViewCurrentFTPSettingsEditView) { //Если открыта настройка WiFi тоже не открываем
1924  0859 3A 93 0F     	ld a, (rootviewcurrentview)
1925  085C FE 02        	cp 2
1926  085E CA 74 08     	jp z, l_189
1927  0861              ; 15
1928  0861              ; 16                 a = rootViewCurrentWiFiSettingsEditView;
1929  0861 3E 03        	ld a, 3
1930  0863              ; 17                 rootViewCurrentView = a;
1931  0863 32 93 0F     	ld (rootviewcurrentview), a
1932  0866              ; 18
1933  0866              ; 19                 a = 2;
1934  0866 3E 02        	ld a, 2
1935  0868              ; 20                 wifiSettingsEditViewCurrentPos = a;
1936  0868 32 9A 10     	ld (wifisettingseditviewcurrentpos), a
1937  086B              ; 21
1938  086B              ; 22                 showDiskList(); //Сбросить выделение строки
1939  086B CD 9C 03     	call showdisklist
1940  086E              ; 23                 showWiFiSettingsEditView();
1941  086E CD 76 08     	call showwifisettingseditview
1942  0871              ; 24                 wifiSettingsEditViewDataUpdate();
1943  0871 CD C1 08     	call wifisettingseditviewdataupdate
1944  0874              l_189:
1945  0874              l_187:
1946  0874 E1           	pop hl
1947  0875 C9           	ret
1948  0876              ; 25             }
1949  0876              ; 26         }
1950  0876              ; 27     }
1951  0876              ; 28 }
1952  0876              ; 29
1953  0876              ; 30 void showWiFiSettingsEditView() {
1954  0876              showwifisettingseditview:
1955  0876              ; 31     drowRectX = (a = wifiSettingsEditViewX);
1956  0876 3A 9B 10     	ld a, (wifisettingseditviewx)
1957  0879 32 86 03     	ld (drowrectx), a
1958  087C              ; 32     drowRectY = (a = wifiSettingsEditViewY);
1959  087C 3A 9C 10     	ld a, (wifisettingseditviewy)
1960  087F 32 87 03     	ld (drowrecty), a
1961  0882              ; 33     drowRectEndX = (a = wifiSettingsEditViewEX);
1962  0882 3A 9D 10     	ld a, (wifisettingseditviewex)
1963  0885 32 88 03     	ld (drowrectendx), a
1964  0888              ; 34     drowRectEndY = (a = wifiSettingsEditViewEY);
1965  0888 3A 9E 10     	ld a, (wifisettingseditviewey)
1966  088B 32 89 03     	ld (drowrectendy), a
1967  088E              ; 35     drowRect();
1968  088E CD F2 02     	call drowrect
1969  0891              ; 36
1970  0891              ; 37     hl = wifiSettingsEditViewLabelPos;
1971  0891 2A 9F 10     	ld hl, (wifisettingseditviewlabelpos)
1972  0894              ; 38     setPosCursor();
1973  0894 CD 3C F8     	call setposcursor
1974  0897              ; 39     hl = wifiSettingsEditViewLabel;
1975  0897 21 A1 10     	ld hl, wifisettingseditviewlabel
1976  089A              ; 40     printHLStr();
1977  089A CD 18 F8     	call printhlstr
1978  089D              ; 41
1979  089D              ; 42     hl = wifiSettingsEditViewSSIDLabelPos;
1980  089D 2A B2 10     	ld hl, (wifisettingseditviewssidlabelpos)
1981  08A0              ; 43     setPosCursor();
1982  08A0 CD 3C F8     	call setposcursor
1983  08A3              ; 44     hl = wifiSettingsEditViewSSIDLabel;
1984  08A3 21 B4 10     	ld hl, wifisettingseditviewssidlabel
1985  08A6              ; 45     printHLStr();
1986  08A6 CD 18 F8     	call printhlstr
1987  08A9              ; 46
1988  08A9              ; 47     hl = wifiSettingsEditViewSSIDPasswordLabelPos;
1989  08A9 2A BA 10     	ld hl, (wifisettingseditviewssidpassword)
1990  08AC              ; 48     setPosCursor();
1991  08AC CD 3C F8     	call setposcursor
1992  08AF              ; 49     hl = wifiSettingsEditViewSSIDPasswordLabel;
1993  08AF 21 BC 10     	ld hl, wifisettingseditviewssidpassword_1
1994  08B2              ; 50     printHLStr();
1995  08B2 CD 18 F8     	call printhlstr
1996  08B5              ; 51
1997  08B5              ; 52     hl = wifiSettingsEditViewOkLabelPos;
1998  08B5 2A C2 10     	ld hl, (wifisettingseditviewoklabelpos)
1999  08B8              ; 53     setPosCursor();
2000  08B8 CD 3C F8     	call setposcursor
2001  08BB              ; 54     hl = wifiSettingsEditViewOkLabel;
2002  08BB 21 C4 10     	ld hl, wifisettingseditviewoklabel
2003  08BE              ; 55     printHLStr();
2004  08BE C3 18 F8     	jp printhlstr
2005  08C1              ; 56 }
2006  08C1              ; 57
2007  08C1              ; 58 void wifiSettingsEditViewDataUpdate() {
2008  08C1              wifisettingseditviewdataupdate:
2009  08C1              ; 59     if ((a = rootViewCurrentView) != rootViewCurrentWiFiSettingsEditView) {
2010  08C1 3A 93 0F     	ld a, (rootviewcurrentview)
2011  08C4 FE 03        	cp 3
2012  08C6 CA CA 08     	jp z, l_191
2013  08C9              ; 60         return;
2014  08C9 C9           	ret
2015  08CA              l_191:
2016  08CA              ; 61     }
2017  08CA              ; 62
2018  08CA              ; 63     push_pop(bc) {
2019  08CA C5           	push bc
2020  08CB              ; 64         b = 0;
2021  08CB 06 00        	ld b, 0
2022  08CD              ; 65         do {
2023  08CD              l_193:
2024  08CD              ; 66             a = 0x00;
2025  08CD 3E 00        	ld a, 0
2026  08CF              ; 67             inverceAddress = a;
2027  08CF 32 D3 F3     	ld (inverceaddress), a
2028  08D2              ; 68
2029  08D2              ; 69             if ((a = wifiSettingsEditViewCurrentPos) == b) {
2030  08D2 3A 9A 10     	ld a, (wifisettingseditviewcurrentpos)
2031  08D5 B8           	cp b
2032  08D6 C2 DE 08     	jp nz, l_196
2033  08D9              ; 70                 a = 0xFF;
2034  08D9 3E FF        	ld a, 255
2035  08DB              ; 71                 inverceAddress = a;
2036  08DB 32 D3 F3     	ld (inverceaddress), a
2037  08DE              l_196:
2038  08DE              ; 72             }
2039  08DE              ; 73
2040  08DE              ; 74             a = b;
2041  08DE 78           	ld a, b
2042  08DF              ; 75             wifiSettingsEditViewShowValueA();
2043  08DF CD F0 08     	call wifisettingseditviewshowvaluea
2044  08E2              ; 76
2045  08E2              ; 77             a = 0x00;
2046  08E2 3E 00        	ld a, 0
2047  08E4              ; 78             inverceAddress = a;
2048  08E4 32 D3 F3     	ld (inverceaddress), a
2049  08E7              ; 79
2050  08E7              ; 80             b++;
2051  08E7 04           	inc b
2052  08E8              ; 81             a = b;
2053  08E8 78           	ld a, b
2054  08E9              ; 82             a -= 5;
2055  08E9 D6 05        	sub 5
2056  08EB              l_194:
2057  08EB C2 CD 08     	jp nz, l_193
2058  08EE C1           	pop bc
2059  08EF C9           	ret
2060  08F0              ; 83         } while (flag_nz);
2061  08F0              ; 84     }
2062  08F0              ; 85 }
2063  08F0              ; 86
2064  08F0              ; 87 void wifiSettingsEditViewShowValueA() {
2065  08F0              wifisettingseditviewshowvaluea:
2066  08F0              ; 88     if (a == 0) {
2067  08F0 B7           	or a
2068  08F1 C2 03 09     	jp nz, l_198
2069  08F4              ; 89         hl = wifiSettingsEditViewSSIDValPos;
2070  08F4 2A CB 10     	ld hl, (wifisettingseditviewssidvalpos)
2071  08F7              ; 90         setPosCursor();
2072  08F7 CD 3C F8     	call setposcursor
2073  08FA              ; 91
2074  08FA              ; 92         hl = wifiSettingsSsidVal;
2075  08FA 21 DF 0C     	ld hl, wifisettingsssidval
2076  08FD              ; 93         printHLStr();
2077  08FD CD 18 F8     	call printhlstr
2078  0900 C3 28 09     	jp l_199
2079  0903              l_198:
2080  0903              ; 94     } else if (a == 1) {
2081  0903 FE 01        	cp 1
2082  0905 C2 17 09     	jp nz, l_200
2083  0908              ; 95         hl = wifiSettingsEditViewSSIDPasswordValPos;
2084  0908 2A CD 10     	ld hl, (wifisettingseditviewssidpassword_2)
2085  090B              ; 96         setPosCursor();
2086  090B CD 3C F8     	call setposcursor
2087  090E              ; 97
2088  090E              ; 98         hl = wifiSettingsEditViewSSIDPasswordVal;
2089  090E 21 CF 10     	ld hl, wifisettingseditviewssidpassword_3
2090  0911              ; 99         printHLStr();
2091  0911 CD 18 F8     	call printhlstr
2092  0914 C3 28 09     	jp l_201
2093  0917              l_200:
2094  0917              ; 100     } else if (a == 2) {
2095  0917 FE 02        	cp 2
2096  0919 C2 28 09     	jp nz, l_202
2097  091C              ; 101         hl = wifiSettingsEditViewOkLabelPos;
2098  091C 2A C2 10     	ld hl, (wifisettingseditviewoklabelpos)
2099  091F              ; 102         setPosCursor();
2100  091F CD 3C F8     	call setposcursor
2101  0922              ; 103         hl = wifiSettingsEditViewOkLabel;
2102  0922 21 C4 10     	ld hl, wifisettingseditviewoklabel
2103  0925              ; 104         printHLStr();
2104  0925 CD 18 F8     	call printhlstr
2105  0928              l_202:
2106  0928              l_201:
2107  0928              l_199:
2108  0928 C9           	ret
2109  0929              ; 105     }
2110  0929              ; 106 }
2111  0929              ; 107
2112  0929              ; 108 void wifiSettingsEditViewKeyA() {
2113  0929              wifisettingseditviewkeya:
2114  0929              ; 109     push_pop(hl) {
2115  0929 E5           	push hl
2116  092A              ; 110         l = a;
2117  092A 6F           	ld l, a
2118  092B              ; 111         if ((a = rootViewCurrentView) == rootViewCurrentWiFiSettingsEditView) {
2119  092B 3A 93 0F     	ld a, (rootviewcurrentview)
2120  092E FE 03        	cp 3
2121  0930 C2 96 09     	jp nz, l_204
2122  0933              ; 112             a = l;
2123  0933 7D           	ld a, l
2124  0934              ; 113             if (a == 0x1B) { //ESC выход из настройки
2125  0934 FE 1B        	cp 27
2126  0936 C2 47 09     	jp nz, l_206
2127  0939              ; 114                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
2128  0939 3E 00        	ld a, 0
2129  093B              ; 115                 rootViewCurrentView = a;
2130  093B 32 93 0F     	ld (rootviewcurrentview), a
2131  093E              ; 116
2132  093E              ; 117                 updateRootUI();
2133  093E CD E2 01     	call updaterootui
2134  0941              ; 118                 updateRootDataUI();
2135  0941 CD DF 01     	call updaterootdataui
2136  0944 C3 96 09     	jp l_207
2137  0947              l_206:
2138  0947              ; 119             } else {
2139  0947              ; 120                 if (a == 0x1A) { //down
2140  0947 FE 1A        	cp 26
2141  0949 C2 5D 09     	jp nz, l_208
2142  094C              ; 121                     a = wifiSettingsEditViewCurrentPos;
2143  094C 3A 9A 10     	ld a, (wifisettingseditviewcurrentpos)
2144  094F              ; 122                     a++;
2145  094F 3C           	inc a
2146  0950              ; 123                     if (a == 3) {
2147  0950 FE 03        	cp 3
2148  0952 C2 57 09     	jp nz, l_210
2149  0955              ; 124                         a = 0;
2150  0955 3E 00        	ld a, 0
2151  0957              l_210:
2152  0957              ; 125                     }
2153  0957              ; 126                     wifiSettingsEditViewCurrentPos = a;
2154  0957 32 9A 10     	ld (wifisettingseditviewcurrentpos), a
2155  095A C3 96 09     	jp l_209
2156  095D              l_208:
2157  095D              ; 127                 } else if (a == 0x19) { //up
2158  095D FE 19        	cp 25
2159  095F C2 75 09     	jp nz, l_212
2160  0962              ; 128                     a = wifiSettingsEditViewCurrentPos;
2161  0962 3A 9A 10     	ld a, (wifisettingseditviewcurrentpos)
2162  0965              ; 129                     if (a == 0) {
2163  0965 B7           	or a
2164  0966 C2 6E 09     	jp nz, l_214
2165  0969              ; 130                         a = 2;
2166  0969 3E 02        	ld a, 2
2167  096B C3 6F 09     	jp l_215
2168  096E              l_214:
2169  096E              ; 131                     } else {
2170  096E              ; 132                         a--;
2171  096E 3D           	dec a
2172  096F              l_215:
2173  096F              ; 133                     }
2174  096F              ; 134                     wifiSettingsEditViewCurrentPos = a;
2175  096F 32 9A 10     	ld (wifisettingseditviewcurrentpos), a
2176  0972 C3 96 09     	jp l_213
2177  0975              l_212:
2178  0975              ; 135                 } else if (a == 0x0D) { //Enter
2179  0975 FE 0D        	cp 13
2180  0977 C2 96 09     	jp nz, l_216
2181  097A              ; 136                     if ((a = wifiSettingsEditViewCurrentPos) == 2) { // Нажатие на кнопку ОК
2182  097A 3A 9A 10     	ld a, (wifisettingseditviewcurrentpos)
2183  097D FE 02        	cp 2
2184  097F C2 93 09     	jp nz, l_218
2185  0982              ; 137
2186  0982              ; 138                         //Пробуем подключиться в WiFi
2187  0982              ; 139                         needSsidConnect();
2188  0982 CD 80 14     	call needssidconnect
2189  0985              ; 140
2190  0985              ; 141                         a = rootViewCurrentDiskView; // переходим на список файлов на диске
2191  0985 3E 00        	ld a, 0
2192  0987              ; 142                         rootViewCurrentView = a;
2193  0987 32 93 0F     	ld (rootviewcurrentview), a
2194  098A              ; 143
2195  098A              ; 144                         updateRootUI();
2196  098A CD E2 01     	call updaterootui
2197  098D              ; 145                         updateRootDataUI();
2198  098D CD DF 01     	call updaterootdataui
2199  0990 C3 96 09     	jp l_219
2200  0993              l_218:
2201  0993              ; 146                     } else {
2202  0993              ; 147                         wifiSettingsEditViewSelectEditField();
2203  0993 CD 98 09     	call wifisettingseditviewselecteditfi
2204  0996              l_219:
2205  0996              l_216:
2206  0996              l_213:
2207  0996              l_209:
2208  0996              l_207:
2209  0996              l_204:
2210  0996 E1           	pop hl
2211  0997 C9           	ret
2212  0998              ; 148                     }
2213  0998              ; 149                 }
2214  0998              ; 150             }
2215  0998              ; 151         }
2216  0998              ; 152     }
2217  0998              ; 153 }
2218  0998              ; 154
2219  0998              ; 155 void wifiSettingsEditViewSelectEditField() {
2220  0998              wifisettingseditviewselecteditfi:
2221  0998              ; 156     a = wifiSettingsEditViewCurrentPos;
2222  0998 3A 9A 10     	ld a, (wifisettingseditviewcurrentpos)
2223  099B              ; 157     if (a == 1) {
2224  099B FE 01        	cp 1
2225  099D C2 B4 09     	jp nz, l_220
2226  09A0              ; 158         hl = wifiSettingsEditViewSSIDPasswordValPos;
2227  09A0 2A CD 10     	ld hl, (wifisettingseditviewssidpassword_2)
2228  09A3              ; 159         wifiSettingsEditViewEditValuePos = hl;
2229  09A3 22 DF 10     	ld (wifisettingseditvieweditvaluepos), hl
2230  09A6              ; 160         setPosCursor();
2231  09A6 CD 3C F8     	call setposcursor
2232  09A9              ; 161
2233  09A9              ; 162         push_pop(hl) {
2234  09A9 E5           	push hl
2235  09AA              ; 163             hl = wifiSettingsEditViewSSIDPasswordVal;
2236  09AA 21 CF 10     	ld hl, wifisettingseditviewssidpassword_3
2237  09AD              ; 164             wifiSettingsEditView_CopyStrFromHL();
2238  09AD CD BB 09     	call wifisettingseditview_copystrfrom
2239  09B0 E1           	pop hl
2240  09B1 C3 B8 09     	jp l_221
2241  09B4              l_220:
2242  09B4              ; 165         }
2243  09B4              ; 166     } else {
2244  09B4              ; 167         // открыть список доступных сетей
2245  09B4              ; 168         needOpenSSIDListView();
2246  09B4 CD 02 0B     	call needopenssidlistview
2247  09B7              ; 169         return;
2248  09B7 C9           	ret
2249  09B8              l_221:
2250  09B8              ; 170     }
2251  09B8              ; 171     wifiSettingsEditViewEditField();
2252  09B8 C3 F8 09     	jp wifisettingseditvieweditfield
2253  09BB              ; 172 }
2254  09BB              ; 173
2255  09BB              ; 174 void wifiSettingsEditView_CopyStrFromHL() {
2256  09BB              wifisettingseditview_copystrfrom:
2257  09BB              ; 175     push_pop(de) {
2258  09BB D5           	push de
2259  09BC              ; 176         push_pop(bc) {
2260  09BC C5           	push bc
2261  09BD              ; 177             de = wifiSettingsEditViewEditValue;
2262  09BD 11 E1 10     	ld de, wifisettingseditvieweditvalue
2263  09C0              ; 178             b = 0;
2264  09C0 06 00        	ld b, 0
2265  09C2              ; 179             c = 0;
2266  09C2 0E 00        	ld c, 0
2267  09C4              ; 180             do {
2268  09C4              l_222:
2269  09C4              ; 181                 a = *hl;
2270  09C4 7E           	ld a, (hl)
2271  09C5              ; 182                 *de = a;
2272  09C5 12           	ld (de), a
2273  09C6              ; 183                 if ((a = b) == 22) {
2274  09C6 78           	ld a, b
2275  09C7 FE 16        	cp 22
2276  09C9 C2 D2 09     	jp nz, l_225
2277  09CC              ; 184                     a = 0;
2278  09CC 3E 00        	ld a, 0
2279  09CE              ; 185                     *de = a;
2280  09CE 12           	ld (de), a
2281  09CF C3 EC 09     	jp l_226
2282  09D2              l_225:
2283  09D2              ; 186                 } else if ((a = c) == 1) {
2284  09D2 79           	ld a, c
2285  09D3 FE 01        	cp 1
2286  09D5 C2 DE 09     	jp nz, l_227
2287  09D8              ; 187                     a = ' ';
2288  09D8 3E 20        	ld a, 32
2289  09DA              ; 188                     *de = a;
2290  09DA 12           	ld (de), a
2291  09DB C3 EC 09     	jp l_228
2292  09DE              l_227:
2293  09DE              ; 189                 } else if ((a = *de) == 0) {
2294  09DE 1A           	ld a, (de)
2295  09DF B7           	or a
2296  09E0 C2 EC 09     	jp nz, l_229
2297  09E3              ; 190                     c = 1;
2298  09E3 0E 01        	ld c, 1
2299  09E5              ; 191                     a = ' ';
2300  09E5 3E 20        	ld a, 32
2301  09E7              ; 192                     *de = a;
2302  09E7 12           	ld (de), a
2303  09E8              ; 193                     a = b;
2304  09E8 78           	ld a, b
2305  09E9              ; 194                     wifiSettingsEditViewEditPos = a;
2306  09E9 32 F9 10     	ld (wifisettingseditvieweditpos), a
2307  09EC              l_229:
2308  09EC              l_228:
2309  09EC              l_226:
2310  09EC              ; 195                 }
2311  09EC              ; 196
2312  09EC              ; 197                 hl ++;
2313  09EC 23           	inc hl
2314  09ED              ; 198                 de++;
2315  09ED 13           	inc de
2316  09EE              ; 199                 b++;
2317  09EE 04           	inc b
2318  09EF              ; 200                 a = b;
2319  09EF 78           	ld a, b
2320  09F0              ; 201                 a -= 23;
2321  09F0 D6 17        	sub 23
2322  09F2              l_223:
2323  09F2 C2 C4 09     	jp nz, l_222
2324  09F5 C1           	pop bc
2325  09F6 D1           	pop de
2326  09F7 C9           	ret
2327  09F8              ; 202             } while (flag_nz);
2328  09F8              ; 203         }
2329  09F8              ; 204     }
2330  09F8              ; 205 }
2331  09F8              ; 206
2332  09F8              ; 207 void wifiSettingsEditViewEditField() {
2333  09F8              wifisettingseditvieweditfield:
2334  09F8              ; 208     hl = wifiSettingsEditViewEditValuePos;
2335  09F8 2A DF 10     	ld hl, (wifisettingseditvieweditvaluepos)
2336  09FB              ; 209     setPosCursor();
2337  09FB CD 3C F8     	call setposcursor
2338  09FE              ; 210
2339  09FE              ; 211     a = 0xFF;
2340  09FE 3E FF        	ld a, 255
2341  0A00              ; 212     inverceAddress = a;
2342  0A00 32 D3 F3     	ld (inverceaddress), a
2343  0A03              ; 213
2344  0A03              ; 214     hl = wifiSettingsEditViewEditValue;
2345  0A03 21 E1 10     	ld hl, wifisettingseditvieweditvalue
2346  0A06              ; 215     printHLStr();
2347  0A06 CD 18 F8     	call printhlstr
2348  0A09              ; 216
2349  0A09              ; 217     wifiSettingsEditViewSetEditCursor();
2350  0A09 CD 7B 0A     	call wifisettingseditviewseteditcurso
2351  0A0C              ; 218     push_pop(bc) {
2352  0A0C C5           	push bc
2353  0A0D              ; 219         b = 0;
2354  0A0D 06 00        	ld b, 0
2355  0A0F              ; 220         do {
2356  0A0F              l_231:
2357  0A0F              ; 221             getKeyboardCharA();
2358  0A0F CD 03 F8     	call getkeyboardchara
2359  0A12              ; 222
2360  0A12              ; 223             if (a == 0x1B) { // выход из редактирования без сохранения
2361  0A12 FE 1B        	cp 27
2362  0A14 C2 1C 0A     	jp nz, l_234
2363  0A17              ; 224                 b = 1;
2364  0A17 06 01        	ld b, 1
2365  0A19 C3 69 0A     	jp l_235
2366  0A1C              l_234:
2367  0A1C              ; 225             } else if (a == 0x0D) { // Сохранить и выйти из редактирования
2368  0A1C FE 0D        	cp 13
2369  0A1E C2 29 0A     	jp nz, l_236
2370  0A21              ; 226                 b = 1;
2371  0A21 06 01        	ld b, 1
2372  0A23              ; 227                 wifiSettingsEditViewSaveField();
2373  0A23 CD 89 0A     	call wifisettingseditviewsavefield
2374  0A26 C3 69 0A     	jp l_237
2375  0A29              l_236:
2376  0A29              ; 228             } else if (a >= 0x20) {
2377  0A29 FE 20        	cp 32
2378  0A2B DA 69 0A     	jp c, l_238
2379  0A2E              ; 229                 if (a < 0x7F) { //Ввод символа
2380  0A2E FE 7F        	cp 127
2381  0A30 D2 51 0A     	jp nc, l_240
2382  0A33              ; 230                     c = a;
2383  0A33 4F           	ld c, a
2384  0A34              ; 231                     // Если достигли предела - то перемещаем курсор на 1 назад
2385  0A34              ; 232                     a = wifiSettingsEditViewEditPos;
2386  0A34 3A F9 10     	ld a, (wifisettingseditvieweditpos)
2387  0A37              ; 233                     if (a >= 15) {
2388  0A37 FE 0F        	cp 15
2389  0A39 DA 3D 0A     	jp c, l_242
2390  0A3C              ; 234                         a--;
2391  0A3C 3D           	dec a
2392  0A3D              l_242:
2393  0A3D              ; 235                     }
2394  0A3D              ; 236                     wifiSettingsEditViewEditPos = a;
2395  0A3D 32 F9 10     	ld (wifisettingseditvieweditpos), a
2396  0A40              ; 237
2397  0A40              ; 238                     //Сохраняем символ
2398  0A40              ; 239                     a = c;
2399  0A40 79           	ld a, c
2400  0A41              ; 240                     wifiSettingsEditViewSetValueA();
2401  0A41 CD 97 0A     	call wifisettingseditviewsetvaluea
2402  0A44              ; 241                     a = wifiSettingsEditViewEditPos;
2403  0A44 3A F9 10     	ld a, (wifisettingseditvieweditpos)
2404  0A47              ; 242                     a++;
2405  0A47 3C           	inc a
2406  0A48              ; 243                     wifiSettingsEditViewEditPos = a;
2407  0A48 32 F9 10     	ld (wifisettingseditvieweditpos), a
2408  0A4B              ; 244                     wifiSettingsEditViewSetEditCursor();
2409  0A4B CD 7B 0A     	call wifisettingseditviewseteditcurso
2410  0A4E C3 69 0A     	jp l_241
2411  0A51              l_240:
2412  0A51              ; 245                 } else if (a == 0x7F) { //Забой... (удаление символа)
2413  0A51 FE 7F        	cp 127
2414  0A53 C2 69 0A     	jp nz, l_244
2415  0A56              ; 246                     if ((a = wifiSettingsEditViewEditPos) > 0) {
2416  0A56 3A F9 10     	ld a, (wifisettingseditvieweditpos)
2417  0A59 B7           	or a
2418  0A5A CA 69 0A     	jp z, l_246
2419  0A5D              ; 247                         a--;
2420  0A5D 3D           	dec a
2421  0A5E              ; 248                         wifiSettingsEditViewEditPos = a;
2422  0A5E 32 F9 10     	ld (wifisettingseditvieweditpos), a
2423  0A61              ; 249                         wifiSettingsEditViewSetEditCursor();
2424  0A61 CD 7B 0A     	call wifisettingseditviewseteditcurso
2425  0A64              ; 250                         a = ' ';
2426  0A64 3E 20        	ld a, 32
2427  0A66              ; 251                         wifiSettingsEditViewSetValueA();
2428  0A66 CD 97 0A     	call wifisettingseditviewsetvaluea
2429  0A69              l_246:
2430  0A69              l_244:
2431  0A69              l_241:
2432  0A69              l_238:
2433  0A69              l_237:
2434  0A69              l_235:
2435  0A69              ; 252                     }
2436  0A69              ; 253                 }
2437  0A69              ; 254             }
2438  0A69              ; 255
2439  0A69              ; 256             a = b;
2440  0A69 78           	ld a, b
2441  0A6A              ; 257             a -= 1;
2442  0A6A D6 01        	sub 1
2443  0A6C              l_232:
2444  0A6C C2 0F 0A     	jp nz, l_231
2445  0A6F C1           	pop bc
2446  0A70              ; 258         } while (flag_nz);
2447  0A70              ; 259     }
2448  0A70              ; 260
2449  0A70              ; 261     a = 0x00;
2450  0A70 3E 00        	ld a, 0
2451  0A72              ; 262     inverceAddress = a;
2452  0A72 32 D3 F3     	ld (inverceaddress), a
2453  0A75              ; 263
2454  0A75              ; 264     showWiFiSettingsEditView();
2455  0A75 CD 76 08     	call showwifisettingseditview
2456  0A78              ; 265     wifiSettingsEditViewDataUpdate();
2457  0A78 C3 C1 08     	jp wifisettingseditviewdataupdate
2458  0A7B              ; 266 }
2459  0A7B              ; 267
2460  0A7B              ; 268 void wifiSettingsEditViewSetEditCursor() {
2461  0A7B              wifisettingseditviewseteditcurso:
2462  0A7B              ; 269     push_pop(hl) {
2463  0A7B E5           	push hl
2464  0A7C              ; 270         hl = wifiSettingsEditViewEditValuePos;
2465  0A7C 2A DF 10     	ld hl, (wifisettingseditvieweditvaluepos)
2466  0A7F              ; 271         a = wifiSettingsEditViewEditPos;
2467  0A7F 3A F9 10     	ld a, (wifisettingseditvieweditpos)
2468  0A82              ; 272         a += l;
2469  0A82 85           	add l
2470  0A83              ; 273         l = a;
2471  0A83 6F           	ld l, a
2472  0A84              ; 274         setPosCursor();
2473  0A84 CD 3C F8     	call setposcursor
2474  0A87 E1           	pop hl
2475  0A88 C9           	ret
2476  0A89              ; 275     }
2477  0A89              ; 276 }
2478  0A89              ; 277
2479  0A89              ; 278 void wifiSettingsEditViewSaveField() {
2480  0A89              wifisettingseditviewsavefield:
2481  0A89              ; 279     a = wifiSettingsEditViewCurrentPos;
2482  0A89 3A 9A 10     	ld a, (wifisettingseditviewcurrentpos)
2483  0A8C              ; 280     if (a == 1) {
2484  0A8C FE 01        	cp 1
2485  0A8E C2 94 0A     	jp nz, l_248
2486  0A91              ; 281         hl = wifiSettingsEditViewSSIDPasswordVal;
2487  0A91 21 CF 10     	ld hl, wifisettingseditviewssidpassword_3
2488  0A94              l_248:
2489  0A94              ; 282     }
2490  0A94              ; 283     wifiSettingsEditViewSaveEditValueToHL();
2491  0A94 C3 B4 0A     	jp wifisettingseditviewsaveeditvalu
2492  0A97              ; 284 }
2493  0A97              ; 285
2494  0A97              ; 286 void wifiSettingsEditViewSetValueA() {
2495  0A97              wifisettingseditviewsetvaluea:
2496  0A97              ; 287     push_pop(hl) {
2497  0A97 E5           	push hl
2498  0A98              ; 288         push_pop(bc) {
2499  0A98 C5           	push bc
2500  0A99              ; 289             b = a;
2501  0A99 47           	ld b, a
2502  0A9A              ; 290             //Сохраним символ в wifiSettingsEditViewEditValue
2503  0A9A              ; 291             hl = wifiSettingsEditViewEditValue;
2504  0A9A 21 E1 10     	ld hl, wifisettingseditvieweditvalue
2505  0A9D              ; 292             a = wifiSettingsEditViewEditPos;
2506  0A9D 3A F9 10     	ld a, (wifisettingseditvieweditpos)
2507  0AA0              ; 293             a += l;
2508  0AA0 85           	add l
2509  0AA1              ; 294             l = a;
2510  0AA1 6F           	ld l, a
2511  0AA2              ; 295             if (flag_c) {
2512  0AA2 D2 A6 0A     	jp nc, l_250
2513  0AA5              ; 296                 h++;
2514  0AA5 24           	inc h
2515  0AA6              l_250:
2516  0AA6              ; 297             }
2517  0AA6              ; 298             *hl = b;
2518  0AA6 70           	ld (hl), b
2519  0AA7              ; 299             //Отрисуем символ на экране
2520  0AA7              ; 300             wifiSettingsEditViewSetEditCursor();
2521  0AA7 CD 7B 0A     	call wifisettingseditviewseteditcurso
2522  0AAA              ; 301             a = b;
2523  0AAA 78           	ld a, b
2524  0AAB              ; 302             printChatA();
2525  0AAB CD 0F F8     	call printchata
2526  0AAE              ; 303             wifiSettingsEditViewSetEditCursor();
2527  0AAE CD 7B 0A     	call wifisettingseditviewseteditcurso
2528  0AB1 C1           	pop bc
2529  0AB2 E1           	pop hl
2530  0AB3 C9           	ret
2531  0AB4              ; 304         }
2532  0AB4              ; 305     }
2533  0AB4              ; 306 }
2534  0AB4              ; 307
2535  0AB4              ; 308 void wifiSettingsEditViewSaveEditValueToHL() {
2536  0AB4              wifisettingseditviewsaveeditvalu:
2537  0AB4              ; 309     push_pop(de) {
2538  0AB4 D5           	push de
2539  0AB5              ; 310         push_pop(bc) {
2540  0AB5 C5           	push bc
2541  0AB6              ; 311             de = wifiSettingsEditViewEditValue;
2542  0AB6 11 E1 10     	ld de, wifisettingseditvieweditvalue
2543  0AB9              ; 312             a = wifiSettingsEditViewEditPos;
2544  0AB9 3A F9 10     	ld a, (wifisettingseditvieweditpos)
2545  0ABC              ; 313             c = a;
2546  0ABC 4F           	ld c, a
2547  0ABD              ; 314             b = 0;
2548  0ABD 06 00        	ld b, 0
2549  0ABF              ; 315             do {
2550  0ABF              l_252:
2551  0ABF              ; 316                 a = *de;
2552  0ABF 1A           	ld a, (de)
2553  0AC0              ; 317                 *hl = a;
2554  0AC0 77           	ld (hl), a
2555  0AC1              ; 318                 hl++;
2556  0AC1 23           	inc hl
2557  0AC2              ; 319                 de++;
2558  0AC2 13           	inc de
2559  0AC3              ; 320                 b++;
2560  0AC3 04           	inc b
2561  0AC4              ; 321                 a = b;
2562  0AC4 78           	ld a, b
2563  0AC5              ; 322                 a -= c;
2564  0AC5 91           	sub c
2565  0AC6              l_253:
2566  0AC6 C2 BF 0A     	jp nz, l_252
2567  0AC9              ; 323             } while (flag_nz);
2568  0AC9              ; 324             *hl = 0;
2569  0AC9 36 00        	ld (hl), 0
2570  0ACB C1           	pop bc
2571  0ACC D1           	pop de
2572  0ACD              ; 325         }
2573  0ACD              ; 326     }
2574  0ACD              ; 327     setSSIDPasswordValue();
2575  0ACD CD 46 14     	call setssidpasswordvalue
2576  0AD0              ; 328     setSSIDPasswordValue();
2577  0AD0 C3 46 14     	jp setssidpasswordvalue
2578  0AD3              ; 329     //getSSIDPasswordValue();
2579  0AD3              ; 330 }
2580  0AD3              ; 331
2581  0AD3              ; 332 ///  Обновить данные WiFi
2582  0AD3              ; 333 void updateWiFiStatus() {
2583  0AD3              updatewifistatus:
2584  0AD3              ; 334     a = updateWiFiStatusTike;
2585  0AD3 3A FA 10     	ld a, (updatewifistatustike)
2586  0AD6              ; 335     if (a < 240) {
2587  0AD6 FE F0        	cp 240
2588  0AD8 D2 E0 0A     	jp nc, l_255
2589  0ADB              ; 336         a++;
2590  0ADB 3C           	inc a
2591  0ADC              ; 337         updateWiFiStatusTike = a;
2592  0ADC 32 FA 10     	ld (updatewifistatustike), a
2593  0ADF              ; 338         return;
2594  0ADF C9           	ret
2595  0AE0              l_255:
2596  0AE0              ; 339     }
2597  0AE0              ; 340     a = 0;
2598  0AE0 3E 00        	ld a, 0
2599  0AE2              ; 341     updateWiFiStatusTike = a;
2600  0AE2 32 FA 10     	ld (updatewifistatustike), a
2601  0AE5              ; 342     //
2602  0AE5              ; 343     getSSIDState();
2603  0AE5 CD 18 15     	call getssidstate
2604  0AE8              ; 344     if ((a = WiFiStateUpdate) == 0x01) {
2605  0AE8 3A FC 10     	ld a, (wifistateupdate)
2606  0AEB FE 01        	cp 1
2607  0AED C2 01 0B     	jp nz, l_257
2608  0AF0              ; 345         a = 0x00;
2609  0AF0 3E 00        	ld a, 0
2610  0AF2              ; 346         WiFiStateUpdate = a;
2611  0AF2 32 FC 10     	ld (wifistateupdate), a
2612  0AF5              ; 347         getSSIDIPAddress();
2613  0AF5 CD B6 14     	call getssidipaddress
2614  0AF8              ; 348         getSSIDMacAddress();
2615  0AF8 CD D4 14     	call getssidmacaddress
2616  0AFB              ; 349         //
2617  0AFB              ; 350         clearWiFiViewValData();
2618  0AFB CD B8 02     	call clearwifiviewvaldata
2619  0AFE              ; 351         updateWiFiViewValData();
2620  0AFE CD D0 02     	call updatewifiviewvaldata
2621  0B01              l_257:
2622  0B01 C9           	ret
2623  0B02              ; 13 void needOpenSSIDListView() {
2624  0B02              needopenssidlistview:
2625  0B02              ; 14     push_pop(hl) {
2626  0B02 E5           	push hl
2627  0B03              ; 15         if ((a = rootViewCurrentView) != rootSSIDListView) { //Если уже открыто окно - не открываем
2628  0B03 3A 93 0F     	ld a, (rootviewcurrentview)
2629  0B06 FE 04        	cp 4
2630  0B08 CA 1B 0B     	jp z, l_259
2631  0B0B              ; 16             a = rootSSIDListView;
2632  0B0B 3E 04        	ld a, 4
2633  0B0D              ; 17             rootViewCurrentView = a;
2634  0B0D 32 93 0F     	ld (rootviewcurrentview), a
2635  0B10              ; 18
2636  0B10              ; 19             a = 0;
2637  0B10 3E 00        	ld a, 0
2638  0B12              ; 20             SSIDListViewCurrentPos = a;
2639  0B12 32 10 11     	ld (ssidlistviewcurrentpos), a
2640  0B15              ; 21
2641  0B15              ; 22             showSSIDListView();
2642  0B15 CD 55 0B     	call showssidlistview
2643  0B18              ; 23             SSIDListViewDataUpdate();
2644  0B18 CD A9 0B     	call ssidlistviewdataupdate
2645  0B1B              l_259:
2646  0B1B E1           	pop hl
2647  0B1C C9           	ret
2648  0B1D              ; 24         }
2649  0B1D              ; 25     }
2650  0B1D              ; 26 }
2651  0B1D              ; 27
2652  0B1D              ; 28 void SSIDListGetCount() {
2653  0B1D              ssidlistgetcount:
2654  0B1D              ; 29     push_pop(hl) {
2655  0B1D E5           	push hl
2656  0B1E              ; 30         push_pop(bc) {
2657  0B1E C5           	push bc
2658  0B1F              ; 31             push_pop(de) {
2659  0B1F D5           	push de
2660  0B20              ; 32                 a = 0;
2661  0B20 3E 00        	ld a, 0
2662  0B22              ; 33                 SSIDListCount = a;
2663  0B22 32 0F 11     	ld (ssidlistcount), a
2664  0B25              ; 34                 de = 16;
2665  0B25 11 10 00     	ld de, 16
2666  0B28              ; 35
2667  0B28              ; 36                 b = 16;
2668  0B28 06 10        	ld b, 16
2669  0B2A              ; 37                 hl = SSIDList;
2670  0B2A 21 12 11     	ld hl, ssidlist
2671  0B2D              ; 38                 do {
2672  0B2D              l_261:
2673  0B2D              ; 39                     a = *hl;
2674  0B2D 7E           	ld a, (hl)
2675  0B2E              ; 40                     if (a > 0) {
2676  0B2E B7           	or a
2677  0B2F CA 39 0B     	jp z, l_264
2678  0B32              ; 41                         a = SSIDListCount;
2679  0B32 3A 0F 11     	ld a, (ssidlistcount)
2680  0B35              ; 42                         a++;
2681  0B35 3C           	inc a
2682  0B36              ; 43                         SSIDListCount = a;
2683  0B36 32 0F 11     	ld (ssidlistcount), a
2684  0B39              l_264:
2685  0B39              ; 44                     }
2686  0B39              ; 45                     hl += de;
2687  0B39 19           	add hl, de
2688  0B3A              ; 46                     b--;
2689  0B3A 05           	dec b
2690  0B3B              l_262:
2691  0B3B C2 2D 0B     	jp nz, l_261
2692  0B3E D1           	pop de
2693  0B3F C1           	pop bc
2694  0B40 E1           	pop hl
2695  0B41 C9           	ret
2696  0B42              ; 47                 } while (flag_nz);
2697  0B42              ; 48             }
2698  0B42              ; 49         }
2699  0B42              ; 50     }
2700  0B42              ; 51 }
2701  0B42              ; 52
2702  0B42              ; 53 void setSSIDPosCursorC() {
2703  0B42              setssidposcursorc:
2704  0B42              ; 54     push_pop(hl) {
2705  0B42 E5           	push hl
2706  0B43              ; 55         a = SSIDListViewY;
2707  0B43 3A FE 10     	ld a, (ssidlistviewy)
2708  0B46              ; 56         a += 2;
2709  0B46 C6 02        	add 2
2710  0B48              ; 57         a += c;
2711  0B48 81           	add c
2712  0B49              ; 58         h = a;
2713  0B49 67           	ld h, a
2714  0B4A              ; 59         a = SSIDListViewX;
2715  0B4A 3A FD 10     	ld a, (ssidlistviewx)
2716  0B4D              ; 60         a += 3;
2717  0B4D C6 03        	add 3
2718  0B4F              ; 61         l = a;
2719  0B4F 6F           	ld l, a
2720  0B50              ; 62         setPosCursor();
2721  0B50 CD 3C F8     	call setposcursor
2722  0B53 E1           	pop hl
2723  0B54 C9           	ret
2724  0B55              ; 63     }
2725  0B55              ; 64 }
2726  0B55              ; 65
2727  0B55              ; 66 void showSSIDListView() {
2728  0B55              showssidlistview:
2729  0B55              ; 67     drowRectX = (a = SSIDListViewX);
2730  0B55 3A FD 10     	ld a, (ssidlistviewx)
2731  0B58 32 86 03     	ld (drowrectx), a
2732  0B5B              ; 68     drowRectY = (a = SSIDListViewY);
2733  0B5B 3A FE 10     	ld a, (ssidlistviewy)
2734  0B5E 32 87 03     	ld (drowrecty), a
2735  0B61              ; 69     drowRectEndX = (a = SSIDListViewEX);
2736  0B61 3A FF 10     	ld a, (ssidlistviewex)
2737  0B64 32 88 03     	ld (drowrectendx), a
2738  0B67              ; 70     drowRectEndY = (a = SSIDListViewEY);
2739  0B67 3A 00 11     	ld a, (ssidlistviewey)
2740  0B6A 32 89 03     	ld (drowrectendy), a
2741  0B6D              ; 71     drowRect();
2742  0B6D CD F2 02     	call drowrect
2743  0B70              ; 72
2744  0B70              ; 73     hl = SSIDListViewTitlePos;
2745  0B70 2A 01 11     	ld hl, (ssidlistviewtitlepos)
2746  0B73              ; 74     setPosCursor();
2747  0B73 CD 3C F8     	call setposcursor
2748  0B76              ; 75     hl = SSIDListViewTitle;
2749  0B76 21 03 11     	ld hl, ssidlistviewtitle
2750  0B79              ; 76     printHLStr();
2751  0B79 CD 18 F8     	call printhlstr
2752  0B7C              ; 77
2753  0B7C              ; 78     i2cWaitingForAccess();
2754  0B7C CD DE 12     	call i2cwaitingforaccess
2755  0B7F              ; 79     needUpdateSSIDList();
2756  0B7F CD 90 14     	call needupdatessidlist
2757  0B82              ; 80     i2cWaitingForAccess();
2758  0B82 CD DE 12     	call i2cwaitingforaccess
2759  0B85              ; 81     getSSIDList();
2760  0B85 CD AB 13     	call getssidlist
2761  0B88              ; 82
2762  0B88              ; 83     SSIDFixBuffer();
2763  0B88 CD 8E 0B     	call ssidfixbuffer
2764  0B8B              ; 84
2765  0B8B              ; 85     // Получить кол-во сетей
2766  0B8B              ; 86     SSIDListGetCount();
2767  0B8B C3 1D 0B     	jp ssidlistgetcount
2768  0B8E              ; 87 }
2769  0B8E              ; 88
2770  0B8E              ; 89 void SSIDFixBuffer() {
2771  0B8E              ssidfixbuffer:
2772  0B8E              ; 90     push_pop(bc) {
2773  0B8E C5           	push bc
2774  0B8F              ; 91         push_pop(de) {
2775  0B8F D5           	push de
2776  0B90              ; 92             push_pop(hl) {
2777  0B90 E5           	push hl
2778  0B91              ; 93                 hl = SSIDList;
2779  0B91 21 12 11     	ld hl, ssidlist
2780  0B94              ; 94                 de = 15;
2781  0B94 11 0F 00     	ld de, 15
2782  0B97              ; 95                 hl += de;
2783  0B97 19           	add hl, de
2784  0B98              ; 96                 de = 16;
2785  0B98 11 10 00     	ld de, 16
2786  0B9B              ; 97                 b = 16;
2787  0B9B 06 10        	ld b, 16
2788  0B9D              ; 98                 do {
2789  0B9D              l_266:
2790  0B9D              ; 99                     a = 0;
2791  0B9D 3E 00        	ld a, 0
2792  0B9F              ; 100                     *hl = a;
2793  0B9F 77           	ld (hl), a
2794  0BA0              ; 101                     hl += de;
2795  0BA0 19           	add hl, de
2796  0BA1              ; 102                     b--;
2797  0BA1 05           	dec b
2798  0BA2              l_267:
2799  0BA2 C2 9D 0B     	jp nz, l_266
2800  0BA5 E1           	pop hl
2801  0BA6 D1           	pop de
2802  0BA7 C1           	pop bc
2803  0BA8 C9           	ret
2804  0BA9              ; 103                 } while (flag_nz);
2805  0BA9              ; 104             }
2806  0BA9              ; 105         }
2807  0BA9              ; 106     }
2808  0BA9              ; 107 }
2809  0BA9              ; 108
2810  0BA9              ; 109 void SSIDListViewDataUpdate() {
2811  0BA9              ssidlistviewdataupdate:
2812  0BA9              ; 110     if ((a = rootViewCurrentView) != rootSSIDListView) {
2813  0BA9 3A 93 0F     	ld a, (rootviewcurrentview)
2814  0BAC FE 04        	cp 4
2815  0BAE CA B2 0B     	jp z, l_269
2816  0BB1              ; 111         return;
2817  0BB1 C9           	ret
2818  0BB2              l_269:
2819  0BB2              ; 112     }
2820  0BB2              ; 113
2821  0BB2              ; 114     push_pop(bc) {
2822  0BB2 C5           	push bc
2823  0BB3              ; 115         b = 0;
2824  0BB3 06 00        	ld b, 0
2825  0BB5              ; 116         do {
2826  0BB5              l_271:
2827  0BB5              ; 117             a = 0x00;
2828  0BB5 3E 00        	ld a, 0
2829  0BB7              ; 118             inverceAddress = a;
2830  0BB7 32 D3 F3     	ld (inverceaddress), a
2831  0BBA              ; 119
2832  0BBA              ; 120             if ((a = SSIDListViewCurrentPos) == b) {
2833  0BBA 3A 10 11     	ld a, (ssidlistviewcurrentpos)
2834  0BBD B8           	cp b
2835  0BBE C2 C6 0B     	jp nz, l_274
2836  0BC1              ; 121                 a = 0xFF;
2837  0BC1 3E FF        	ld a, 255
2838  0BC3              ; 122                 inverceAddress = a;
2839  0BC3 32 D3 F3     	ld (inverceaddress), a
2840  0BC6              l_274:
2841  0BC6              ; 123             }
2842  0BC6              ; 124
2843  0BC6              ; 125             a = b;
2844  0BC6 78           	ld a, b
2845  0BC7              ; 126             SSIDListViewShowValueA();
2846  0BC7 CD D9 0B     	call ssidlistviewshowvaluea
2847  0BCA              ; 127
2848  0BCA              ; 128             a = 0x00;
2849  0BCA 3E 00        	ld a, 0
2850  0BCC              ; 129             inverceAddress = a;
2851  0BCC 32 D3 F3     	ld (inverceaddress), a
2852  0BCF              ; 130
2853  0BCF              ; 131             b++;
2854  0BCF 04           	inc b
2855  0BD0              ; 132             a = SSIDListCount;
2856  0BD0 3A 0F 11     	ld a, (ssidlistcount)
2857  0BD3              ; 133             a -= b;
2858  0BD3 90           	sub b
2859  0BD4              l_272:
2860  0BD4 C2 B5 0B     	jp nz, l_271
2861  0BD7 C1           	pop bc
2862  0BD8 C9           	ret
2863  0BD9              ; 134             //a = b;
2864  0BD9              ; 135             //a -= SSIDListCount;
2865  0BD9              ; 136         } while (flag_nz);
2866  0BD9              ; 137     }
2867  0BD9              ; 138 }
2868  0BD9              ; 139
2869  0BD9              ; 140 void SSIDListViewShowValueA() {
2870  0BD9              ssidlistviewshowvaluea:
2871  0BD9              ; 141     push_pop(hl) {
2872  0BD9 E5           	push hl
2873  0BDA              ; 142         push_pop(de) {
2874  0BDA D5           	push de
2875  0BDB              ; 143             de = 16;
2876  0BDB 11 10 00     	ld de, 16
2877  0BDE              ; 144             c = a;
2878  0BDE 4F           	ld c, a
2879  0BDF              ; 145             setSSIDPosCursorC();
2880  0BDF CD 42 0B     	call setssidposcursorc
2881  0BE2              ; 146             hl = SSIDList;
2882  0BE2 21 12 11     	ld hl, ssidlist
2883  0BE5              ; 147             if ((a = c) > 0) {
2884  0BE5 79           	ld a, c
2885  0BE6 B7           	or a
2886  0BE7 CA EF 0B     	jp z, l_276
2887  0BEA              ; 148                 do {
2888  0BEA              l_278:
2889  0BEA              ; 149                     hl += de;
2890  0BEA 19           	add hl, de
2891  0BEB              ; 150                     c--;
2892  0BEB 0D           	dec c
2893  0BEC              l_279:
2894  0BEC C2 EA 0B     	jp nz, l_278
2895  0BEF              l_276:
2896  0BEF              ; 151                 } while (flag_nz);
2897  0BEF              ; 152             }
2898  0BEF              ; 153             printHLStr();
2899  0BEF CD 18 F8     	call printhlstr
2900  0BF2 D1           	pop de
2901  0BF3 E1           	pop hl
2902  0BF4 C9           	ret
2903  0BF5              ; 154         }
2904  0BF5              ; 155     }
2905  0BF5              ; 156 }
2906  0BF5              ; 157
2907  0BF5              ; 158 void SSIDListViewKeyA() {
2908  0BF5              ssidlistviewkeya:
2909  0BF5              ; 159     push_pop(hl) {
2910  0BF5 E5           	push hl
2911  0BF6              ; 160         l = a;
2912  0BF6 6F           	ld l, a
2913  0BF7              ; 161         if ((a = rootViewCurrentView) == rootSSIDListView) {
2914  0BF7 3A 93 0F     	ld a, (rootviewcurrentview)
2915  0BFA FE 04        	cp 4
2916  0BFC C2 64 0C     	jp nz, l_281
2917  0BFF              ; 162             a = l;
2918  0BFF 7D           	ld a, l
2919  0C00              ; 163             if (a == 0x1B) { //ESC выход из настройки
2920  0C00 FE 1B        	cp 27
2921  0C02 C2 16 0C     	jp nz, l_283
2922  0C05              ; 164                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
2923  0C05 3E 00        	ld a, 0
2924  0C07              ; 165                 rootViewCurrentView = a;
2925  0C07 32 93 0F     	ld (rootviewcurrentview), a
2926  0C0A              ; 166
2927  0C0A              ; 167                 updateRootUI();
2928  0C0A CD E2 01     	call updaterootui
2929  0C0D              ; 168                 updateRootDataUI();
2930  0C0D CD DF 01     	call updaterootdataui
2931  0C10              ; 169                 needOpenWiFiSettingsEditView();
2932  0C10 CD 50 08     	call needopenwifisettingseditview
2933  0C13 C3 64 0C     	jp l_284
2934  0C16              l_283:
2935  0C16              ; 170             } else {
2936  0C16              ; 171                 a = SSIDListCount;
2937  0C16 3A 0F 11     	ld a, (ssidlistcount)
2938  0C19              ; 172                 h = a;
2939  0C19 67           	ld h, a
2940  0C1A              ; 173                 a = l;
2941  0C1A 7D           	ld a, l
2942  0C1B              ; 174                 if (a == 0x1A) { //down
2943  0C1B FE 1A        	cp 26
2944  0C1D C2 30 0C     	jp nz, l_285
2945  0C20              ; 175                     a = SSIDListViewCurrentPos;
2946  0C20 3A 10 11     	ld a, (ssidlistviewcurrentpos)
2947  0C23              ; 176                     a++;
2948  0C23 3C           	inc a
2949  0C24              ; 177                     if (a == h) {
2950  0C24 BC           	cp h
2951  0C25 C2 2A 0C     	jp nz, l_287
2952  0C28              ; 178                         a = 0;
2953  0C28 3E 00        	ld a, 0
2954  0C2A              l_287:
2955  0C2A              ; 179                     }
2956  0C2A              ; 180                     SSIDListViewCurrentPos = a;
2957  0C2A 32 10 11     	ld (ssidlistviewcurrentpos), a
2958  0C2D C3 64 0C     	jp l_286
2959  0C30              l_285:
2960  0C30              ; 181                 } else if (a == 0x19) { //up
2961  0C30 FE 19        	cp 25
2962  0C32 C2 48 0C     	jp nz, l_289
2963  0C35              ; 182                     a = SSIDListViewCurrentPos;
2964  0C35 3A 10 11     	ld a, (ssidlistviewcurrentpos)
2965  0C38              ; 183                     if (a == 0) {
2966  0C38 B7           	or a
2967  0C39 C2 41 0C     	jp nz, l_291
2968  0C3C              ; 184                         a = h;
2969  0C3C 7C           	ld a, h
2970  0C3D              ; 185                         a--;
2971  0C3D 3D           	dec a
2972  0C3E C3 42 0C     	jp l_292
2973  0C41              l_291:
2974  0C41              ; 186                     } else {
2975  0C41              ; 187                         a--;
2976  0C41 3D           	dec a
2977  0C42              l_292:
2978  0C42              ; 188                     }
2979  0C42              ; 189                     SSIDListViewCurrentPos = a;
2980  0C42 32 10 11     	ld (ssidlistviewcurrentpos), a
2981  0C45 C3 64 0C     	jp l_290
2982  0C48              l_289:
2983  0C48              ; 190                 } else if (a == 0x0D) { //Enter
2984  0C48 FE 0D        	cp 13
2985  0C4A C2 64 0C     	jp nz, l_293
2986  0C4D              ; 191                     // Надо отправить на ESP
2987  0C4D              ; 192                     a = SSIDListViewCurrentPos;
2988  0C4D 3A 10 11     	ld a, (ssidlistviewcurrentpos)
2989  0C50              ; 193
2990  0C50              ; 194                     // Отправляем index на ESP
2991  0C50              ; 195                     setSSIDNumberA();
2992  0C50 CD A0 14     	call setssidnumbera
2993  0C53              ; 196                     // Подождем
2994  0C53              ; 197
2995  0C53              ; 198                     getSSIDValue();
2996  0C53 CD F2 13     	call getssidvalue
2997  0C56              ; 199
2998  0C56              ; 200                     // закрываем
2999  0C56              ; 201                     a = rootViewCurrentDiskView; // переходим на список файлов на диске
3000  0C56 3E 00        	ld a, 0
3001  0C58              ; 202                     rootViewCurrentView = a;
3002  0C58 32 93 0F     	ld (rootviewcurrentview), a
3003  0C5B              ; 203
3004  0C5B              ; 204                     updateRootUI();
3005  0C5B CD E2 01     	call updaterootui
3006  0C5E              ; 205                     updateRootDataUI();
3007  0C5E CD DF 01     	call updaterootdataui
3008  0C61              ; 206                     needOpenWiFiSettingsEditView();
3009  0C61 CD 50 08     	call needopenwifisettingseditview
3010  0C64              l_293:
3011  0C64              l_290:
3012  0C64              l_286:
3013  0C64              l_284:
3014  0C64              l_281:
3015  0C64 E1           	pop hl
3016  0C65 C9           	ret
3017  0C66              ; 12 uint8_t myFont[] =
3018  0C66              myfont:
3019  0C66 00           	db 0
3020  0C67 00           	db 0
3021  0C68 00           	db 0
3022  0C69 00           	db 0
3023  0C6A 00           	db 0
3024  0C6B 00           	db 0
3025  0C6C 00           	db 0
3026  0C6D 00           	db 0
3027  0C6E 00           	db 0
3028  0C6F 00           	db 0
3029  0C70 1F           	db 31
3030  0C71 10           	db 16
3031  0C72 10           	db 16
3032  0C73 13           	db 19
3033  0C74 12           	db 18
3034  0C75 12           	db 18
3035  0C76 12           	db 18
3036  0C77 12           	db 18
3037  0C78 13           	db 19
3038  0C79 10           	db 16
3039  0C7A 10           	db 16
3040  0C7B 1F           	db 31
3041  0C7C 00           	db 0
3042  0C7D 00           	db 0
3043  0C7E 00           	db 0
3044  0C7F 00           	db 0
3045  0C80 3E           	db 62
3046  0C81 02           	db 2
3047  0C82 02           	db 2
3048  0C83 32           	db 50
3049  0C84 12           	db 18
3050  0C85 12           	db 18
3051  0C86 12           	db 18
3052  0C87 12           	db 18
3053  0C88 32           	db 50
3054  0C89 02           	db 2
3055  0C8A 02           	db 2
3056  0C8B 3E           	db 62
3057  0C8C 00           	db 0
3058  0C8D 00           	db 0
3059  0C8E 12           	db 18
3060  0C8F 12           	db 18
3061  0C90 12           	db 18
3062  0C91 12           	db 18
3063  0C92 12           	db 18
3064  0C93 12           	db 18
3065  0C94 12           	db 18
3066  0C95 12           	db 18
3067  0C96 00           	db 0
3068  0C97 00           	db 0
3069  0C98 3F           	db 63
3070  0C99 00           	db 0
3071  0C9A 00           	db 0
3072  0C9B 3F           	db 63
3073  0C9C 00           	db 0
3074  0C9D 00           	db 0
3075  0C9E 2A           	db 42
3076  0C9F 15           	db 21
3077  0CA0 2A           	db 42
3078  0CA1 15           	db 21
3079  0CA2 2A           	db 42
3080  0CA3 15           	db 21
3081  0CA4 2A           	db 42
3082  0CA5 15           	db 21
3083  0CA6 3F           	db 63
3084  0CA7 3F           	db 63
3085  0CA8 3F           	db 63
3086  0CA9 3F           	db 63
3087  0CAA 3F           	db 63
3088  0CAB 3F           	db 63
3089  0CAC 3F           	db 63
3090  0CAD 3F           	db 63
3091  0CAE              ; 11 uint8_t wifiSettingsViewX = 0x00;
3092  0CAE              wifisettingsviewx:
3093  0CAE 00           	db 0
3094  0CAF              ; 12 uint8_t wifiSettingsViewY = 0x01;
3095  0CAF              wifisettingsviewy:
3096  0CAF 01           	db 1
3097  0CB0              ; 13 uint8_t wifiSettingsViewEX = 29;
3098  0CB0              wifisettingsviewex:
3099  0CB0 1D           	db 29
3100  0CB1              ; 14 uint8_t wifiSettingsViewEY = 6;
3101  0CB1              wifisettingsviewey:
3102  0CB1 06           	db 6
3103  0CB2              ; 15 uint16_t wifiSettingsPos = 0x0108;
3104  0CB2              wifisettingspos:
3105  0CB2 08 01        	dw 264
3106  0CB4              ; 16 uint8_t wifiSettingsLabel[] = " WI-FI SETTINGS ";
3107  0CB4              wifisettingslabel:
3108  0CB4 20           	db 32
3109  0CB5 57           	db 87
3110  0CB6 49           	db 73
3111  0CB7 2D           	db 45
3112  0CB8 46           	db 70
3113  0CB9 49           	db 73
3114  0CBA 20           	db 32
3115  0CBB 53           	db 83
3116  0CBC 45           	db 69
3117  0CBD 54           	db 84
3118  0CBE 54           	db 84
3119  0CBF 49           	db 73
3120  0CC0 4E           	db 78
3121  0CC1 47           	db 71
3122  0CC2 53           	db 83
3123  0CC3 20           	db 32
3124  0CC4 00           	ds 1
3125  0CC5              ; 17 uint8_t wifiSettingsSsidLabel[] = "SSID:";
3126  0CC5              wifisettingsssidlabel:
3127  0CC5 53           	db 83
3128  0CC6 53           	db 83
3129  0CC7 49           	db 73
3130  0CC8 44           	db 68
3131  0CC9 3A           	db 58
3132  0CCA 00           	ds 1
3133  0CCB              ; 18 uint8_t wifiSettingsIpLabel[] = "IP  :";
3134  0CCB              wifisettingsiplabel:
3135  0CCB 49           	db 73
3136  0CCC 50           	db 80
3137  0CCD 20           	db 32
3138  0CCE 20           	db 32
3139  0CCF 3A           	db 58
3140  0CD0 00           	ds 1
3141  0CD1              ; 19 uint8_t wifiSettingsMacLabel[] = "MAC :";
3142  0CD1              wifisettingsmaclabel:
3143  0CD1 4D           	db 77
3144  0CD2 41           	db 65
3145  0CD3 43           	db 67
3146  0CD4 20           	db 32
3147  0CD5 3A           	db 58
3148  0CD6 00           	ds 1
3149  0CD7              ; 21 uint16_t wifiSettingsSsidLabelPos = 0x0202;
3150  0CD7              wifisettingsssidlabelpos:
3151  0CD7 02 02        	dw 514
3152  0CD9              ; 22 uint16_t wifiSettingsIpLabelPos = 0x0302;
3153  0CD9              wifisettingsiplabelpos:
3154  0CD9 02 03        	dw 770
3155  0CDB              ; 23 uint16_t wifiSettingsMacLabelPos = 0x0402;
3156  0CDB              wifisettingsmaclabelpos:
3157  0CDB 02 04        	dw 1026
3158  0CDD              ; 25 uint16_t wifiSettingsSsidValPos = 0x0208;
3159  0CDD              wifisettingsssidvalpos:
3160  0CDD 08 02        	dw 520
3161  0CDF              ; 26 uint8_t wifiSettingsSsidVal[16] = "K159";
3162  0CDF              wifisettingsssidval:
3163  0CDF 4B           	db 75
3164  0CE0 31           	db 49
3165  0CE1 35           	db 53
3166  0CE2 39           	db 57
3167  0CE3 00 00 00...  	ds 12
3168  0CEF              ; 27 uint16_t wifiSettingsIpValPos = 0x0308;
3169  0CEF              wifisettingsipvalpos:
3170  0CEF 08 03        	dw 776
3171  0CF1              ; 28 uint8_t wifiSettingsIpVal[16] = "-";
3172  0CF1              wifisettingsipval:
3173  0CF1 2D           	db 45
3174  0CF2 00 00 00...  	ds 15
3175  0D01              ; 29 uint16_t wifiSettingsMacValPos = 0x0408;
3176  0D01              wifisettingsmacvalpos:
3177  0D01 08 04        	dw 1032
3178  0D03              ; 30 uint8_t wifiSettingsMacVal[18] = "-";
3179  0D03              wifisettingsmacval:
3180  0D03 2D           	db 45
3181  0D04 00 00 00...  	ds 17
3182  0D15              ; 32 uint8_t wifiSettingsEmpty18[18] = "                ";
3183  0D15              wifisettingsempty18:
3184  0D15 20           	db 32
3185  0D16 20           	db 32
3186  0D17 20           	db 32
3187  0D18 20           	db 32
3188  0D19 20           	db 32
3189  0D1A 20           	db 32
3190  0D1B 20           	db 32
3191  0D1C 20           	db 32
3192  0D1D 20           	db 32
3193  0D1E 20           	db 32
3194  0D1F 20           	db 32
3195  0D20 20           	db 32
3196  0D21 20           	db 32
3197  0D22 20           	db 32
3198  0D23 20           	db 32
3199  0D24 20           	db 32
3200  0D25 00 00        	ds 2
3201  0D27              ; 11 uint8_t ftpSettingsViewX = 30;
3202  0D27              ftpsettingsviewx:
3203  0D27 1E           	db 30
3204  0D28              ; 12 uint8_t ftpSettingsViewY = 1;
3205  0D28              ftpsettingsviewy:
3206  0D28 01           	db 1
3207  0D29              ; 13 uint8_t ftpSettingsViewEX = 63; //54;
3208  0D29              ftpsettingsviewex:
3209  0D29 3F           	db 63
3210  0D2A              ; 14 uint8_t ftpSettingsViewEY = 6;
3211  0D2A              ftpsettingsviewey:
3212  0D2A 06           	db 6
3213  0D2B              ; 16 uint16_t ftpSettingsLabelPos = 0x0127;
3214  0D2B              ftpsettingslabelpos:
3215  0D2B 27 01        	dw 295
3216  0D2D              ; 17 uint8_t ftpSettingsLabel[] = " FTP SETTINGS ";
3217  0D2D              ftpsettingslabel:
3218  0D2D 20           	db 32
3219  0D2E 46           	db 70
3220  0D2F 54           	db 84
3221  0D30 50           	db 80
3222  0D31 20           	db 32
3223  0D32 53           	db 83
3224  0D33 45           	db 69
3225  0D34 54           	db 84
3226  0D35 54           	db 84
3227  0D36 49           	db 73
3228  0D37 4E           	db 78
3229  0D38 47           	db 71
3230  0D39 53           	db 83
3231  0D3A 20           	db 32
3232  0D3B 00           	ds 1
3233  0D3C              ; 20 uint16_t ftpSettingsIpLabelPos = 0x0220;
3234  0D3C              ftpsettingsiplabelpos:
3235  0D3C 20 02        	dw 544
3236  0D3E              ; 21 uint8_t ftpSettingsIpLabel[] = "IP:";
3237  0D3E              ftpsettingsiplabel:
3238  0D3E 49           	db 73
3239  0D3F 50           	db 80
3240  0D40 3A           	db 58
3241  0D41 00           	ds 1
3242  0D42              ; 23 uint16_t ftpSettingsPortLabelPos = 0x0234;
3243  0D42              ftpsettingsportlabelpos:
3244  0D42 34 02        	dw 564
3245  0D44              ; 24 uint8_t ftpSettingsPortLabel[] = "PORT:";
3246  0D44              ftpsettingsportlabel:
3247  0D44 50           	db 80
3248  0D45 4F           	db 79
3249  0D46 52           	db 82
3250  0D47 54           	db 84
3251  0D48 3A           	db 58
3252  0D49 00           	ds 1
3253  0D4A              ; 26 uint16_t ftpSettingsUserLabelPos = 0x0320;
3254  0D4A              ftpsettingsuserlabelpos:
3255  0D4A 20 03        	dw 800
3256  0D4C              ; 27 uint8_t ftpSettingsUserLabel[] = "USER:";
3257  0D4C              ftpsettingsuserlabel:
3258  0D4C 55           	db 85
3259  0D4D 53           	db 83
3260  0D4E 45           	db 69
3261  0D4F 52           	db 82
3262  0D50 3A           	db 58
3263  0D51 00           	ds 1
3264  0D52              ; 29 uint16_t ftpSettingsStatusLabelPos = 0x0420;
3265  0D52              ftpsettingsstatuslabelpos:
3266  0D52 20 04        	dw 1056
3267  0D54              ; 30 uint8_t ftpSettingsStatusLabel[] = "STATUS:";
3268  0D54              ftpsettingsstatuslabel:
3269  0D54 53           	db 83
3270  0D55 54           	db 84
3271  0D56 41           	db 65
3272  0D57 54           	db 84
3273  0D58 55           	db 85
3274  0D59 53           	db 83
3275  0D5A 3A           	db 58
3276  0D5B 00           	ds 1
3277  0D5C              ; 32 uint16_t ftpSettingsIpValuePos = 0x0224;
3278  0D5C              ftpsettingsipvaluepos:
3279  0D5C 24 02        	dw 548
3280  0D5E              ; 33 uint8_t ftpSettingsIpValue[16] = "100.100.100.100";
3281  0D5E              ftpsettingsipvalue:
3282  0D5E 31           	db 49
3283  0D5F 30           	db 48
3284  0D60 30           	db 48
3285  0D61 2E           	db 46
3286  0D62 31           	db 49
3287  0D63 30           	db 48
3288  0D64 30           	db 48
3289  0D65 2E           	db 46
3290  0D66 31           	db 49
3291  0D67 30           	db 48
3292  0D68 30           	db 48
3293  0D69 2E           	db 46
3294  0D6A 31           	db 49
3295  0D6B 30           	db 48
3296  0D6C 30           	db 48
3297  0D6D 00           	ds 1
3298  0D6E              ; 35 uint16_t ftpSettingsPortValuePos = 0x023A;
3299  0D6E              ftpsettingsportvaluepos:
3300  0D6E 3A 02        	dw 570
3301  0D70              ; 36 uint8_t ftpSettingsPortValue[6] = "21";
3302  0D70              ftpsettingsportvalue:
3303  0D70 32           	db 50
3304  0D71 31           	db 49
3305  0D72 00 00 00 00  	ds 4
3306  0D76              ; 38 uint16_t ftpSettingsStatusValuePos = 0x0428;
3307  0D76              ftpsettingsstatusvaluepos:
3308  0D76 28 04        	dw 1064
3309  0D78              ; 39 uint8_t ftpSettingsStatusValue[12] = "-";
3310  0D78              ftpsettingsstatusvalue:
3311  0D78 2D           	db 45
3312  0D79 00 00 00...  	ds 11
3313  0D84              ; 40 uint8_t ftpSettingsStateVal = 0;
3314  0D84              ftpsettingsstateval:
3315  0D84 00           	db 0
3316  0D85              ; 41 uint8_t ftpSettingsStateChange = 1;
3317  0D85              ftpsettingsstatechange:
3318  0D85 01           	db 1
3319  0D86              ; 42 uint8_t ftpSettingsStatus0[12] = "DISCONNECT ";
3320  0D86              ftpsettingsstatus0:
3321  0D86 44           	db 68
3322  0D87 49           	db 73
3323  0D88 53           	db 83
3324  0D89 43           	db 67
3325  0D8A 4F           	db 79
3326  0D8B 4E           	db 78
3327  0D8C 4E           	db 78
3328  0D8D 45           	db 69
3329  0D8E 43           	db 67
3330  0D8F 54           	db 84
3331  0D90 20           	db 32
3332  0D91 00           	ds 1
3333  0D92              ; 43 uint8_t ftpSettingsStatus1[12] = "CONNECT    ";
3334  0D92              ftpsettingsstatus1:
3335  0D92 43           	db 67
3336  0D93 4F           	db 79
3337  0D94 4E           	db 78
3338  0D95 4E           	db 78
3339  0D96 45           	db 69
3340  0D97 43           	db 67
3341  0D98 54           	db 84
3342  0D99 20           	db 32
3343  0D9A 20           	db 32
3344  0D9B 20           	db 32
3345  0D9C 20           	db 32
3346  0D9D 00           	ds 1
3347  0D9E              ; 45 uint16_t ftpSettingsUserValuePos = 0x0326;
3348  0D9E              ftpsettingsuservaluepos:
3349  0D9E 26 03        	dw 806
3350  0DA0              ; 46 uint8_t ftpSettingsUserValue[16] = "ESP8266";
3351  0DA0              ftpsettingsuservalue:
3352  0DA0 45           	db 69
3353  0DA1 53           	db 83
3354  0DA2 50           	db 80
3355  0DA3 38           	db 56
3356  0DA4 32           	db 50
3357  0DA5 36           	db 54
3358  0DA6 36           	db 54
3359  0DA7 00 00 00...  	ds 9
3360  0DB0              ; 11 uint8_t diskViewX = 0;
3361  0DB0              diskviewx:
3362  0DB0 00           	db 0
3363  0DB1              ; 12 uint8_t diskViewY = 7;
3364  0DB1              diskviewy:
3365  0DB1 07           	db 7
3366  0DB2              ; 13 uint8_t diskViewEX = 29; //54;
3367  0DB2              diskviewex:
3368  0DB2 1D           	db 29
3369  0DB3              ; 14 uint8_t diskViewEY = 25;
3370  0DB3              diskviewey:
3371  0DB3 19           	db 25
3372  0DB4              ; 16 uint16_t diskViewLabelPos = 0x0709;
3373  0DB4              diskviewlabelpos:
3374  0DB4 09 07        	dw 1801
3375  0DB6              ; 17 uint8_t diskViewLabel[] = " DISK:   ";
3376  0DB6              diskviewlabel:
3377  0DB6 20           	db 32
3378  0DB7 44           	db 68
3379  0DB8 49           	db 73
3380  0DB9 53           	db 83
3381  0DBA 4B           	db 75
3382  0DBB 3A           	db 58
3383  0DBC 20           	db 32
3384  0DBD 20           	db 32
3385  0DBE 20           	db 32
3386  0DBF 00           	ds 1
3387  0DC0              ; 19 uint8_t diskViewDiskNum = 'B';
3388  0DC0              diskviewdisknum:
3389  0DC0 42           	db 66
3390  0DC1              ; 20 uint8_t diskViewListCount = 0;
3391  0DC1              diskviewlistcount:
3392  0DC1 00           	db 0
3393  0DC2              ; 21 uint8_t diskViewCurrPos = 1;
3394  0DC2              diskviewcurrpos:
3395  0DC2 01           	db 1
3396  0DC3              ; 22 uint16_t diskViewListNamePos = 0x0902;
3397  0DC3              diskviewlistnamepos:
3398  0DC3 02 09        	dw 2306
3399  0DC5              ; 24 uint16_t diskViewListDirPos = 0x0802;
3400  0DC5              diskviewlistdirpos:
3401  0DC5 02 08        	dw 2050
3402  0DC7              ; 25 uint8_t diskViewListDirLabel[] = " ..       ";
3403  0DC7              diskviewlistdirlabel:
3404  0DC7 20           	db 32
3405  0DC8 2E           	db 46
3406  0DC9 2E           	db 46
3407  0DCA 20           	db 32
3408  0DCB 20           	db 32
3409  0DCC 20           	db 32
3410  0DCD 20           	db 32
3411  0DCE 20           	db 32
3412  0DCF 20           	db 32
3413  0DD0 20           	db 32
3414  0DD1 00           	ds 1
3415  0DD2              ; 27 uint16_t diskViewDriveNamePos = 0x0710;
3416  0DD2              diskviewdrivenamepos:
3417  0DD2 10 07        	dw 1808
3418  0DD4              ; 29 uint16_t diskStartNewFile = 0x0000;
3419  0DD4              diskstartnewfile:
3420  0DD4 00 00        	dw 0
3421  0DD6              ; 11 uint8_t ftpViewX = 30;
3422  0DD6              ftpviewx:
3423  0DD6 1E           	db 30
3424  0DD7              ; 12 uint8_t ftpViewY = 7;
3425  0DD7              ftpviewy:
3426  0DD7 07           	db 7
3427  0DD8              ; 13 uint8_t ftpViewEX = 63;
3428  0DD8              ftpviewex:
3429  0DD8 3F           	db 63
3430  0DD9              ; 14 uint8_t ftpViewEY = 25;
3431  0DD9              ftpviewey:
3432  0DD9 19           	db 25
3433  0DDA              ; 16 uint16_t ftpLabelPos = 0x0728;
3434  0DDA              ftplabelpos:
3435  0DDA 28 07        	dw 1832
3436  0DDC              ; 17 uint8_t ftpLabel[] = " FTP: ";
3437  0DDC              ftplabel:
3438  0DDC 20           	db 32
3439  0DDD 46           	db 70
3440  0DDE 54           	db 84
3441  0DDF 50           	db 80
3442  0DE0 3A           	db 58
3443  0DE1 20           	db 32
3444  0DE2 00           	ds 1
3445  0DE3              ; 19 uint8_t ftpDirList[16 * 24];
3446  0DE3              ftpdirlist:
3447  0DE3 00 00 00...  	ds 384
3448  0F63              ; 20 uint8_t ftpDirListNext = 0;
3449  0F63              ftpdirlistnext:
3450  0F63 00           	db 0
3451  0F64              ; 21 uint8_t ftpDirListCount = 0;
3452  0F64              ftpdirlistcount:
3453  0F64 00           	db 0
3454  0F65              ; 22 uint8_t ftpDirListIsDir = 0;
3455  0F65              ftpdirlistisdir:
3456  0F65 00           	db 0
3457  0F66              ; 24 uint8_t ftpViewCurrentPos = 0;
3458  0F66              ftpviewcurrentpos:
3459  0F66 00           	db 0
3460  0F67              ; 25 uint8_t ftpViewEmpty16[16] = "               ";
3461  0F67              ftpviewempty16:
3462  0F67 20           	db 32
3463  0F68 20           	db 32
3464  0F69 20           	db 32
3465  0F6A 20           	db 32
3466  0F6B 20           	db 32
3467  0F6C 20           	db 32
3468  0F6D 20           	db 32
3469  0F6E 20           	db 32
3470  0F6F 20           	db 32
3471  0F70 20           	db 32
3472  0F71 20           	db 32
3473  0F72 20           	db 32
3474  0F73 20           	db 32
3475  0F74 20           	db 32
3476  0F75 20           	db 32
3477  0F76 00           	ds 1
3478  0F77              ; 27 uint8_t ftpViewDirPath[26] = "";
3479  0F77              ftpviewdirpath:
3480  0F77 00 00 00...  	ds 26
3481  0F91              ; 28 uint16_t ftpViewDirPathPos = 0x1822;
3482  0F91              ftpviewdirpathpos:
3483  0F91 22 18        	dw 6178
3484  0F93              ; 16 uint8_t rootViewCurrentView = 0;
3485  0F93              rootviewcurrentview:
3486  0F93 00           	db 0
3487  0F94              ; 18 uint16_t rootViewHelpStrPos = 0x0600;
3488  0F94              rootviewhelpstrpos:
3489  0F94 00 06        	dw 1536
3490  0F96              ; 19 uint8_t rootViewHelpStr[] = " F1: ..          F2: WI-FI          F3: FTP          F4: QUIT";
3491  0F96              rootviewhelpstr:
3492  0F96 20           	db 32
3493  0F97 46           	db 70
3494  0F98 31           	db 49
3495  0F99 3A           	db 58
3496  0F9A 20           	db 32
3497  0F9B 2E           	db 46
3498  0F9C 2E           	db 46
3499  0F9D 20           	db 32
3500  0F9E 20           	db 32
3501  0F9F 20           	db 32
3502  0FA0 20           	db 32
3503  0FA1 20           	db 32
3504  0FA2 20           	db 32
3505  0FA3 20           	db 32
3506  0FA4 20           	db 32
3507  0FA5 20           	db 32
3508  0FA6 20           	db 32
3509  0FA7 46           	db 70
3510  0FA8 32           	db 50
3511  0FA9 3A           	db 58
3512  0FAA 20           	db 32
3513  0FAB 57           	db 87
3514  0FAC 49           	db 73
3515  0FAD 2D           	db 45
3516  0FAE 46           	db 70
3517  0FAF 49           	db 73
3518  0FB0 20           	db 32
3519  0FB1 20           	db 32
3520  0FB2 20           	db 32
3521  0FB3 20           	db 32
3522  0FB4 20           	db 32
3523  0FB5 20           	db 32
3524  0FB6 20           	db 32
3525  0FB7 20           	db 32
3526  0FB8 20           	db 32
3527  0FB9 20           	db 32
3528  0FBA 46           	db 70
3529  0FBB 33           	db 51
3530  0FBC 3A           	db 58
3531  0FBD 20           	db 32
3532  0FBE 46           	db 70
3533  0FBF 54           	db 84
3534  0FC0 50           	db 80
3535  0FC1 20           	db 32
3536  0FC2 20           	db 32
3537  0FC3 20           	db 32
3538  0FC4 20           	db 32
3539  0FC5 20           	db 32
3540  0FC6 20           	db 32
3541  0FC7 20           	db 32
3542  0FC8 20           	db 32
3543  0FC9 20           	db 32
3544  0FCA 20           	db 32
3545  0FCB 46           	db 70
3546  0FCC 34           	db 52
3547  0FCD 3A           	db 58
3548  0FCE 20           	db 32
3549  0FCF 51           	db 81
3550  0FD0 55           	db 85
3551  0FD1 49           	db 73
3552  0FD2 54           	db 84
3553  0FD3 00           	ds 1
3554  0FD4              ; 21 uint8_t rootViewOldKey = 0xFF;
3555  0FD4              rootviewoldkey:
3556  0FD4 FF           	db 255
3557  0FD5              ; 11 uint8_t ftpSettingsEditViewX = 14;
3558  0FD5              ftpsettingseditviewx:
3559  0FD5 0E           	db 14
3560  0FD6              ; 12 uint8_t ftpSettingsEditViewY = 4;
3561  0FD6              ftpsettingseditviewy:
3562  0FD6 04           	db 4
3563  0FD7              ; 13 uint8_t ftpSettingsEditViewEX = 50;
3564  0FD7              ftpsettingseditviewex:
3565  0FD7 32           	db 50
3566  0FD8              ; 14 uint8_t ftpSettingsEditViewEY = 20;
3567  0FD8              ftpsettingseditviewey:
3568  0FD8 14           	db 20
3569  0FD9              ; 16 uint16_t ftpSettingsEditViewLabelPos = 0x0418;
3570  0FD9              ftpsettingseditviewlabelpos:
3571  0FD9 18 04        	dw 1048
3572  0FDB              ; 17 uint8_t ftpSettingsEditViewLabel[] = " FTP SETTINGS ";
3573  0FDB              ftpsettingseditviewlabel:
3574  0FDB 20           	db 32
3575  0FDC 46           	db 70
3576  0FDD 54           	db 84
3577  0FDE 50           	db 80
3578  0FDF 20           	db 32
3579  0FE0 53           	db 83
3580  0FE1 45           	db 69
3581  0FE2 54           	db 84
3582  0FE3 54           	db 84
3583  0FE4 49           	db 73
3584  0FE5 4E           	db 78
3585  0FE6 47           	db 71
3586  0FE7 53           	db 83
3587  0FE8 20           	db 32
3588  0FE9 00           	ds 1
3589  0FEA              ; 19 uint16_t ftpSettingsEditViewIpLabelPos = 0x0713;
3590  0FEA              ftpsettingseditviewiplabelpos:
3591  0FEA 13 07        	dw 1811
3592  0FEC              ; 20 uint16_t ftpSettingsEditViewPortLabelPos = 0x0911;
3593  0FEC              ftpsettingseditviewportlabelpos:
3594  0FEC 11 09        	dw 2321
3595  0FEE              ; 21 uint16_t ftpSettingsEditViewUserLabelPos = 0x0B11;
3596  0FEE              ftpsettingseditviewuserlabelpos:
3597  0FEE 11 0B        	dw 2833
3598  0FF0              ; 23 uint16_t ftpSettingsEditViewPasswordLabelPos = 0x0D11;
3599  0FF0              ftpsettingseditviewpasswordlabel:
3600  0FF0 11 0D        	dw 3345
3601  0FF2              ; 24 uint8_t ftpSettingsEditViewPasswordLabel[] = "PASS:";
3602  0FF2              ftpsettingseditviewpasswordlabel_0:
3603  0FF2 50           	db 80
3604  0FF3 41           	db 65
3605  0FF4 53           	db 83
3606  0FF5 53           	db 83
3607  0FF6 3A           	db 58
3608  0FF7 00           	ds 1
3609  0FF8              ; 26 uint16_t ftpSettingsEditViewOkLabelPos = 0x101D;
3610  0FF8              ftpsettingseditviewoklabelpos:
3611  0FF8 1D 10        	dw 4125
3612  0FFA              ; 27 uint8_t ftpSettingsEditViewOkLabel[] = "  OK  ";
3613  0FFA              ftpsettingseditviewoklabel:
3614  0FFA 20           	db 32
3615  0FFB 20           	db 32
3616  0FFC 4F           	db 79
3617  0FFD 4B           	db 75
3618  0FFE 20           	db 32
3619  0FFF 20           	db 32
3620  1000 00           	ds 1
3621  1001              ; 29 uint16_t ftpSettingsEditViewIpValPos = 0x0719;
3622  1001              ftpsettingseditviewipvalpos:
3623  1001 19 07        	dw 1817
3624  1003              ; 30 uint16_t ftpSettingsEditViewPortValPos = 0x0919;
3625  1003              ftpsettingseditviewportvalpos:
3626  1003 19 09        	dw 2329
3627  1005              ; 31 uint16_t ftpSettingsEditViewUserValPos = 0x0B19;
3628  1005              ftpsettingseditviewuservalpos:
3629  1005 19 0B        	dw 2841
3630  1007              ; 32 uint16_t ftpSettingsEditViewPasswordValPos = 0x0D19;
3631  1007              ftpsettingseditviewpasswordvalpo:
3632  1007 19 0D        	dw 3353
3633  1009              ; 33 uint8_t ftpSettingsEditViewPasswordVal[16] = "ESP8266";
3634  1009              ftpsettingseditviewpasswordval:
3635  1009 45           	db 69
3636  100A 53           	db 83
3637  100B 50           	db 80
3638  100C 38           	db 56
3639  100D 32           	db 50
3640  100E 36           	db 54
3641  100F 36           	db 54
3642  1010 00 00 00...  	ds 9
3643  1019              ; 35 uint8_t ftpSettingsEditViewCurrentPos = 0;
3644  1019              ftpsettingseditviewcurrentpos:
3645  1019 00           	db 0
3646  101A              ; 37 uint16_t ftpSettingsEditViewEditValuePos = 0x0000;
3647  101A              ftpsettingseditvieweditvaluepos:
3648  101A 00 00        	dw 0
3649  101C              ; 38 uint8_t ftpSettingsEditViewEditValue[24] = "";
3650  101C              ftpsettingseditvieweditvalue:
3651  101C 00 00 00...  	ds 24
3652  1034              ; 39 uint8_t ftpSettingsEditViewEditPos = 0;
3653  1034              ftpsettingseditvieweditpos:
3654  1034 00           	db 0
3655  1035              ; 41 uint8_t updateFtpStatusTike = 0;
3656  1035              updateftpstatustike:
3657  1035 00           	db 0
3658  1036              ; 11 void createTestFile() {
3659  1036              createtestfile:
3660  1036              ; 12     push_pop(hl) {
3661  1036 E5           	push hl
3662  1037              ; 13         a = diskViewDiskNum;
3663  1037 3A C0 0D     	ld a, (diskviewdisknum)
3664  103A              ; 14         ordos_wnd();
3665  103A CD D6 BF     	call ordos_wnd
3666  103D              ; 15
3667  103D              ; 16         ordos_mxdsk();
3668  103D CD B8 BF     	call ordos_mxdsk
3669  1040              ; 17         diskStartNewFile = hl;
3670  1040 22 D4 0D     	ld (diskstartnewfile), hl
3671  1043              ; 18         de = fileTable;
3672  1043 11 5A 10     	ld de, filetable
3673  1046              ; 19         b = 0;
3674  1046 06 00        	ld b, 0
3675  1048              ; 20         do {
3676  1048              l_295:
3677  1048              ; 21             a = *de;
3678  1048 1A           	ld a, (de)
3679  1049              ; 22             ordos_wdisk();
3680  1049 CD DF BF     	call ordos_wdisk
3681  104C              ; 23             hl++;
3682  104C 23           	inc hl
3683  104D              ; 24             de++;
3684  104D 13           	inc de
3685  104E              ; 25             b++;
3686  104E 04           	inc b
3687  104F              ; 26             a = b;
3688  104F 78           	ld a, b
3689  1050              ; 27             a -= 64;
3690  1050 D6 40        	sub 64
3691  1052              l_296:
3692  1052 C2 48 10     	jp nz, l_295
3693  1055              ; 28         } while (flag_nz);
3694  1055              ; 29         ordos_stop();
3695  1055 CD E2 BF     	call ordos_stop
3696  1058 E1           	pop hl
3697  1059 C9           	ret
3698  105A              ; 30     }
3699  105A              ; 31 }
3700  105A              ; 32
3701  105A              ; 33 uint8_t fileTable[] = {
3702  105A              filetable:
3703  105A 42           	db 66
3704  105B 4F           	db 79
3705  105C 4F           	db 79
3706  105D 54           	db 84
3707  105E 24           	db 36
3708  105F 20           	db 32
3709  1060 20           	db 32
3710  1061 20           	db 32
3711  1062 00           	db 0
3712  1063 B4           	db 180
3713  1064 30           	db 48
3714  1065 00           	db 0
3715  1066 00           	db 0
3716  1067 FF           	db 255
3717  1068 FF           	db 255
3718  1069 FF           	db 255
3719  106A 21           	db 33
3720  106B D0           	db 208
3721  106C B4           	db 180
3722  106D CD           	db 205
3723  106E 18           	db 24
3724  106F F8           	db 248
3725  1070 11           	db 17
3726  1071 00           	db 0
3727  1072 F7           	db 247
3728  1073 3E           	db 62
3729  1074 10           	db 16
3730  1075 32           	db 50
3731  1076 20           	db 32
3732  1077 F7           	db 247
3733  1078 AF           	db 175
3734  1079 32           	db 50
3735  107A 01           	db 1
3736  107B F7           	db 247
3737  107C 3E           	db 62
3738  107D D0           	db 208
3739  107E CD           	db 205
3740  107F BF           	db 191
3741  1080 B4           	db 180
3742  1081 06           	db 6
3743  1082 05           	db 5
3744  1083 3E           	db 62
3745  1084 4B           	db 75
3746  1085 CD           	db 205
3747  1086 BF           	db 191
3748  1087 B4           	db 180
3749  1088 05           	db 5
3750  1089 C2           	db 194
3751  108A 19           	db 25
3752  108B B4           	db 180
3753  108C 3E           	db 62
3754  108D 0B           	db 11
3755  108E CD           	db 205
3756  108F BF           	db 191
3757  1090 B4           	db 180
3758  1091 1A           	db 26
3759  1092 07           	db 7
3760  1093 DA           	db 218
3761  1094 27           	db 39
3762  1095 B4           	db 180
3763  1096 CD           	db 205
3764  1097 8D           	db 141
3765  1098 B4           	db 180
3766  1099 CA           	db 202
3767  109A              ; 11 uint8_t wifiSettingsEditViewCurrentPos = 0;
3768  109A              wifisettingseditviewcurrentpos:
3769  109A 00           	db 0
3770  109B              ; 13 uint8_t wifiSettingsEditViewX = 14;
3771  109B              wifisettingseditviewx:
3772  109B 0E           	db 14
3773  109C              ; 14 uint8_t wifiSettingsEditViewY = 4;
3774  109C              wifisettingseditviewy:
3775  109C 04           	db 4
3776  109D              ; 15 uint8_t wifiSettingsEditViewEX = 50;
3777  109D              wifisettingseditviewex:
3778  109D 32           	db 50
3779  109E              ; 16 uint8_t wifiSettingsEditViewEY = 15;
3780  109E              wifisettingseditviewey:
3781  109E 0F           	db 15
3782  109F              ; 18 uint16_t wifiSettingsEditViewLabelPos = 0x0418;
3783  109F              wifisettingseditviewlabelpos:
3784  109F 18 04        	dw 1048
3785  10A1              ; 19 uint8_t wifiSettingsEditViewLabel[] = " WI-FI SETTINGS ";
3786  10A1              wifisettingseditviewlabel:
3787  10A1 20           	db 32
3788  10A2 57           	db 87
3789  10A3 49           	db 73
3790  10A4 2D           	db 45
3791  10A5 46           	db 70
3792  10A6 49           	db 73
3793  10A7 20           	db 32
3794  10A8 53           	db 83
3795  10A9 45           	db 69
3796  10AA 54           	db 84
3797  10AB 54           	db 84
3798  10AC 49           	db 73
3799  10AD 4E           	db 78
3800  10AE 47           	db 71
3801  10AF 53           	db 83
3802  10B0 20           	db 32
3803  10B1 00           	ds 1
3804  10B2              ; 21 uint16_t wifiSettingsEditViewSSIDLabelPos = 0x0711;
3805  10B2              wifisettingseditviewssidlabelpos:
3806  10B2 11 07        	dw 1809
3807  10B4              ; 22 uint8_t wifiSettingsEditViewSSIDLabel[] = "SSID:";
3808  10B4              wifisettingseditviewssidlabel:
3809  10B4 53           	db 83
3810  10B5 53           	db 83
3811  10B6 49           	db 73
3812  10B7 44           	db 68
3813  10B8 3A           	db 58
3814  10B9 00           	ds 1
3815  10BA              ; 24 uint16_t wifiSettingsEditViewSSIDPasswordLabelPos = 0x0911;
3816  10BA              wifisettingseditviewssidpassword:
3817  10BA 11 09        	dw 2321
3818  10BC              ; 25 uint8_t wifiSettingsEditViewSSIDPasswordLabel[] = "PASS:";
3819  10BC              wifisettingseditviewssidpassword_1:
3820  10BC 50           	db 80
3821  10BD 41           	db 65
3822  10BE 53           	db 83
3823  10BF 53           	db 83
3824  10C0 3A           	db 58
3825  10C1 00           	ds 1
3826  10C2              ; 27 uint16_t wifiSettingsEditViewOkLabelPos = 0x0B1D;
3827  10C2              wifisettingseditviewoklabelpos:
3828  10C2 1D 0B        	dw 2845
3829  10C4              ; 28 uint8_t wifiSettingsEditViewOkLabel[] = "  OK  ";
3830  10C4              wifisettingseditviewoklabel:
3831  10C4 20           	db 32
3832  10C5 20           	db 32
3833  10C6 4F           	db 79
3834  10C7 4B           	db 75
3835  10C8 20           	db 32
3836  10C9 20           	db 32
3837  10CA 00           	ds 1
3838  10CB              ; 30 uint16_t wifiSettingsEditViewSSIDValPos = 0x0719;
3839  10CB              wifisettingseditviewssidvalpos:
3840  10CB 19 07        	dw 1817
3841  10CD              ; 31 uint16_t wifiSettingsEditViewSSIDPasswordValPos = 0x0919;
3842  10CD              wifisettingseditviewssidpassword_2:
3843  10CD 19 09        	dw 2329
3844  10CF              ; 33 uint8_t wifiSettingsEditViewSSIDPasswordVal[16] = "---";
3845  10CF              wifisettingseditviewssidpassword_3:
3846  10CF 2D           	db 45
3847  10D0 2D           	db 45
3848  10D1 2D           	db 45
3849  10D2 00 00 00...  	ds 13
3850  10DF              ; 35 uint16_t wifiSettingsEditViewEditValuePos = 0x0000;
3851  10DF              wifisettingseditvieweditvaluepos:
3852  10DF 00 00        	dw 0
3853  10E1              ; 36 uint8_t wifiSettingsEditViewEditValue[24] = "";
3854  10E1              wifisettingseditvieweditvalue:
3855  10E1 00 00 00...  	ds 24
3856  10F9              ; 37 uint8_t wifiSettingsEditViewEditPos = 0;
3857  10F9              wifisettingseditvieweditpos:
3858  10F9 00           	db 0
3859  10FA              ; 39 uint8_t updateWiFiStatusTike = 0;
3860  10FA              updatewifistatustike:
3861  10FA 00           	db 0
3862  10FB              ; 40 uint8_t WiFiState = 0;
3863  10FB              wifistate:
3864  10FB 00           	db 0
3865  10FC              ; 41 uint8_t WiFiStateUpdate = 1;
3866  10FC              wifistateupdate:
3867  10FC 01           	db 1
3868  10FD              ; 11 uint8_t SSIDListViewX = 22;
3869  10FD              ssidlistviewx:
3870  10FD 16           	db 22
3871  10FE              ; 12 uint8_t SSIDListViewY = 3;
3872  10FE              ssidlistviewy:
3873  10FE 03           	db 3
3874  10FF              ; 13 uint8_t SSIDListViewEX = 44;
3875  10FF              ssidlistviewex:
3876  10FF 2C           	db 44
3877  1100              ; 14 uint8_t SSIDListViewEY = 23;
3878  1100              ssidlistviewey:
3879  1100 17           	db 23
3880  1101              ; 16 uint16_t SSIDListViewTitlePos = 0x031B;
3881  1101              ssidlistviewtitlepos:
3882  1101 1B 03        	dw 795
3883  1103              ; 17 uint8_t SSIDListViewTitle[] = " SSID LIST ";
3884  1103              ssidlistviewtitle:
3885  1103 20           	db 32
3886  1104 53           	db 83
3887  1105 53           	db 83
3888  1106 49           	db 73
3889  1107 44           	db 68
3890  1108 20           	db 32
3891  1109 4C           	db 76
3892  110A 49           	db 73
3893  110B 53           	db 83
3894  110C 54           	db 84
3895  110D 20           	db 32
3896  110E 00           	ds 1
3897  110F              ; 19 uint8_t SSIDListCount = 0;
3898  110F              ssidlistcount:
3899  110F 00           	db 0
3900  1110              ; 20 uint8_t SSIDListViewCurrentPos = 0;
3901  1110              ssidlistviewcurrentpos:
3902  1110 00           	db 0
3903  1111              ; 21 uint8_t SSIDListNext = 0;
3904  1111              ssidlistnext:
3905  1111 00           	db 0
3906  1112              ; 23 uint8_t SSIDList[] = {
3907  1112              ssidlist:
3908  1112 44           	db 68
3909  1113 49           	db 73
3910  1114 52           	db 82
3911  1115 45           	db 69
3912  1116 43           	db 67
3913  1117 54           	db 84
3914  1118 2D           	db 45
3915  1119 4C           	db 76
3916  111A 30           	db 48
3917  111B 5B           	db 91
3918  111C 42           	db 66
3919  111D 44           	db 68
3920  111E 5D           	db 93
3921  111F 53           	db 83
3922  1120 4C           	db 76
3923  1121 00           	db 0
3924  1122 4B           	db 75
3925  1123 56           	db 86
3926  1124 31           	db 49
3927  1125 35           	db 53
3928  1126 31           	db 49
3929  1127 00           	db 0
3930  1128 00           	db 0
3931  1129 00           	db 0
3932  112A 00           	db 0
3933  112B 00           	db 0
3934  112C 00           	db 0
3935  112D 00           	db 0
3936  112E 00           	db 0
3937  112F 00           	db 0
3938  1130 00           	db 0
3939  1131 00           	db 0
3940  1132 4D           	db 77
3941  1133 47           	db 71
3942  1134 54           	db 84
3943  1135 53           	db 83
3944  1136 5F           	db 95
3945  1137 47           	db 71
3946  1138 50           	db 80
3947  1139 4F           	db 79
3948  113A 4E           	db 78
3949  113B 5F           	db 95
3950  113C 44           	db 68
3951  113D 44           	db 68
3952  113E 31           	db 49
3953  113F 35           	db 53
3954  1140 00           	db 0
3955  1141 00           	db 0
3956  1142 4D           	db 77
3957  1143 47           	db 71
3958  1144 54           	db 84
3959  1145 53           	db 83
3960  1146 5F           	db 95
3961  1147 47           	db 71
3962  1148 50           	db 80
3963  1149 4F           	db 79
3964  114A 4E           	db 78
3965  114B 5F           	db 95
3966  114C 39           	db 57
3967  114D 30           	db 48
3968  114E 36           	db 54
3969  114F 39           	db 57
3970  1150 00           	db 0
3971  1151 00           	db 0
3972  1152 41           	db 65
3973  1153 45           	db 69
3974  1154 52           	db 82
3975  1155 4F           	db 79
3976  1156 4C           	db 76
3977  1157 49           	db 73
3978  1158 4E           	db 78
3979  1159 4B           	db 75
3980  115A 44           	db 68
3981  115B 00           	db 0
3982  115C 00           	db 0
3983  115D 00           	db 0
3984  115E 00           	db 0
3985  115F 00           	db 0
3986  1160 00           	db 0
3987  1161 00           	db 0
3988  1162 4D           	db 77
3989  1163 47           	db 71
3990  1164 54           	db 84
3991  1165 53           	db 83
3992  1166 5F           	db 95
3993  1167 47           	db 71
3994  1168 50           	db 80
3995  1169 4F           	db 79
3996  116A 4E           	db 78
3997  116B 5F           	db 95
3998  116C 36           	db 54
3999  116D 34           	db 52
4000  116E 36           	db 54
4001  116F 30           	db 48
4002  1170 00           	db 0
4003  1171 00           	db 0
4004  1172 4D           	db 77
4005  1173 54           	db 84
4006  1174 53           	db 83
4007  1175 5F           	db 95
4008  1176 47           	db 71
4009  1177 50           	db 80
4010  1178 4F           	db 79
4011  1179 4E           	db 78
4012  117A 5F           	db 95
4013  117B 39           	db 57
4014  117C 33           	db 51
4015  117D 32           	db 50
4016  117E 41           	db 65
4017  117F 46           	db 70
4018  1180 38           	db 56
4019  1181 00           	db 0
4020  1182 4D           	db 77
4021  1183 47           	db 71
4022  1184 54           	db 84
4023  1185 53           	db 83
4024  1186 5F           	db 95
4025  1187 47           	db 71
4026  1188 50           	db 80
4027  1189 4F           	db 79
4028  118A 4E           	db 78
4029  118B 5F           	db 95
4030  118C 39           	db 57
4031  118D 41           	db 65
4032  118E 36           	db 54
4033  118F 32           	db 50
4034  1190 00           	db 0
4035  1191 00           	db 0
4036  1192 42           	db 66
4037  1193 45           	db 69
4038  1194 45           	db 69
4039  1195 4C           	db 76
4040  1196 49           	db 73
4041  1197 4E           	db 78
4042  1198 45           	db 69
4043  1199 2D           	db 45
4044  119A 52           	db 82
4045  119B 4F           	db 79
4046  119C 55           	db 85
4047  119D 54           	db 84
4048  119E 45           	db 69
4049  119F 52           	db 82
4050  11A0 45           	db 69
4051  11A1 00           	db 0
4052  11A2 54           	db 84
4053  11A3 4F           	db 79
4054  11A4 54           	db 84
4055  11A5 4F           	db 79
4056  11A6 52           	db 82
4057  11A7 4F           	db 79
4058  11A8 00           	db 0
4059  11A9 00           	db 0
4060  11AA 00           	db 0
4061  11AB 00           	db 0
4062  11AC 00           	db 0
4063  11AD 00           	db 0
4064  11AE 00           	db 0
4065  11AF 00           	db 0
4066  11B0 00           	db 0
4067  11B1 00           	db 0
4068  11B2 50           	db 80
4069  11B3 4F           	db 79
4070  11B4 4B           	db 75
4071  11B5 45           	db 69
4072  11B6 4D           	db 77
4073  11B7 4F           	db 79
4074  11B8 4E           	db 78
4075  11B9 00           	db 0
4076  11BA 00           	db 0
4077  11BB 00           	db 0
4078  11BC 00           	db 0
4079  11BD 00           	db 0
4080  11BE 00           	db 0
4081  11BF 00           	db 0
4082  11C0 00           	db 0
4083  11C1 00           	db 0
4084  11C2 4B           	db 75
4085  11C3 45           	db 69
4086  11C4 45           	db 69
4087  11C5 4E           	db 78
4088  11C6 45           	db 69
4089  11C7 54           	db 84
4090  11C8 49           	db 73
4091  11C9 43           	db 67
4092  11CA 2D           	db 45
4093  11CB 35           	db 53
4094  11CC 35           	db 53
4095  11CD 35           	db 53
4096  11CE 32           	db 50
4097  11CF 00           	db 0
4098  11D0 00           	db 0
4099  11D1 00           	db 0
4100  11D2 4B           	db 75
4101  11D3 31           	db 49
4102  11D4 35           	db 53
4103  11D5 39           	db 57
4104  11D6 00           	db 0
4105  11D7 00           	db 0
4106  11D8 00           	db 0
4107  11D9 00           	db 0
4108  11DA 00           	db 0
4109  11DB 00           	db 0
4110  11DC 00           	db 0
4111  11DD 00           	db 0
4112  11DE 00           	db 0
4113  11DF 00           	db 0
4114  11E0 00           	db 0
4115  11E1 00           	db 0
4116  11E2 4B           	db 75
4117  11E3 54           	db 84
4118  11E4 31           	db 49
4119  11E5 35           	db 53
4120  11E6 39           	db 57
4121  11E7 00           	db 0
4122  11E8 00           	db 0
4123  11E9 00           	db 0
4124  11EA 00           	db 0
4125  11EB 00           	db 0
4126  11EC 00           	db 0
4127  11ED 00           	db 0
4128  11EE 00           	db 0
4129  11EF 00           	db 0
4130  11F0 00           	db 0
4131  11F1 00           	db 0
4132  11F2 00           	db 0
4133  11F3 00           	db 0
4134  11F4 00           	db 0
4135  11F5 00           	db 0
4136  11F6 00           	db 0
4137  11F7 00           	db 0
4138  11F8 00           	db 0
4139  11F9 00           	db 0
4140  11FA 00           	db 0
4141  11FB 00           	db 0
4142  11FC 00           	db 0
4143  11FD 00           	db 0
4144  11FE 00           	db 0
4145  11FF 00           	db 0
4146  1200 00           	db 0
4147  1201 00           	db 0
4148  1202 00           	db 0
4149  1203 00           	db 0
4150  1204 00           	db 0
4151  1205 00           	db 0
4152  1206 00           	db 0
4153  1207 00           	db 0
4154  1208 00           	db 0
4155  1209 00           	db 0
4156  120A 00           	db 0
4157  120B 00           	db 0
4158  120C 00           	db 0
4159  120D 00           	db 0
4160  120E 00           	db 0
4161  120F 00           	db 0
4162  1210 00           	db 0
4163  1211 00           	db 0
4164  1212              ; 17 void initI2C() {
4165  1212              initi2c:
4166  1212              ; 18     a = 0x81;
4167  1212 3E 81        	ld a, 129
4168  1214              ; 19     VV55_SETUP = a;
4169  1214 32 03 F6     	ld (vv55_setup), a
4170  1217              ; 20     #ifdef _SLOW_SETTINGS
4171  1217              ; 21     NOPS
4172  1217 00           	nop
4173  1218 00           	nop
4174  1219              ; 22     #endif
4175  1219              ; 23     a = 0xC0;
4176  1219 3E C0        	ld a, 192
4177  121B              ; 24     VV55_PORT_C = a;
4178  121B 32 02 F6     	ld (vv55_port_c), a
4179  121E C9           	ret
4180  121F              ; 25 }
4181  121F              ; 26
4182  121F              ; 27 void startI2C() {
4183  121F              starti2c:
4184  121F              ; 28     #ifdef _SLOW_SETTINGS
4185  121F              ; 29     NOPS
4186  121F 00           	nop
4187  1220 00           	nop
4188  1221              ; 30     #endif
4189  1221              ; 31     a = 0x40;
4190  1221 3E 40        	ld a, 64
4191  1223              ; 32     VV55_PORT_C = a;
4192  1223 32 02 F6     	ld (vv55_port_c), a
4193  1226              ; 33     #ifdef _SLOW_SETTINGS
4194  1226              ; 34     NOPS
4195  1226 00           	nop
4196  1227 00           	nop
4197  1228              ; 35     #endif
4198  1228              ; 36     nop();
4199  1228 00           	nop
4200  1229              ; 37     a = 0x00;
4201  1229 3E 00        	ld a, 0
4202  122B              ; 38     VV55_PORT_C = a;
4203  122B 32 02 F6     	ld (vv55_port_c), a
4204  122E C9           	ret
4205  122F              ; 39 }
4206  122F              ; 40
4207  122F              ; 41 void stopI2C() {
4208  122F              stopi2c:
4209  122F              ; 42     #ifdef _SLOW_SETTINGS
4210  122F              ; 43     NOPS
4211  122F 00           	nop
4212  1230 00           	nop
4213  1231              ; 44     #endif
4214  1231              ; 45     a = 0x40;
4215  1231 3E 40        	ld a, 64
4216  1233              ; 46     VV55_PORT_C = a;
4217  1233 32 02 F6     	ld (vv55_port_c), a
4218  1236              ; 47     #ifdef _SLOW_SETTINGS
4219  1236              ; 48     NOPS
4220  1236 00           	nop
4221  1237 00           	nop
4222  1238              ; 49     #endif
4223  1238              ; 50     nop();
4224  1238 00           	nop
4225  1239              ; 51     a = 0xC0;
4226  1239 3E C0        	ld a, 192
4227  123B              ; 52     VV55_PORT_C = a;
4228  123B 32 02 F6     	ld (vv55_port_c), a
4229  123E C9           	ret
4230  123F              ; 53 }
4231  123F              ; 54
4232  123F              ; 55 /// вх. [A] - устанавливаемое значение (8 бит)
4233  123F              ; 56 void setSDAI2C(){
4234  123F              setsdai2c:
4235  123F              ; 57 //    #ifdef _SLOW_SETTINGS
4236  123F              ; 58 //    NOPS
4237  123F              ; 59 //    #endif
4238  123F              ; 60     a &= 0x80;
4239  123F E6 80        	and 128
4240  1241              ; 61     I2C_CURRETN_VALUE = a;
4241  1241 32 23 13     	ld (i2c_curretn_value), a
4242  1244              ; 62     VV55_PORT_C = a;
4243  1244 32 02 F6     	ld (vv55_port_c), a
4244  1247 C9           	ret
4245  1248              ; 63 }
4246  1248              ; 64
4247  1248              ; 65 void pulseNewI2C() {
4248  1248              pulsenewi2c:
4249  1248              ; 66     #ifdef _SLOW_SETTINGS
4250  1248              ; 67     NOPS
4251  1248 00           	nop
4252  1249 00           	nop
4253  124A              ; 68     #endif
4254  124A              ; 69     a = I2C_CURRETN_VALUE;
4255  124A 3A 23 13     	ld a, (i2c_curretn_value)
4256  124D              ; 70     a += 0x40;
4257  124D C6 40        	add 64
4258  124F              ; 71     VV55_PORT_C = a;
4259  124F 32 02 F6     	ld (vv55_port_c), a
4260  1252              ; 72 //    /// - Проверим что SLAVE не тормозит передачу -
4261  1252              ; 73 //    /// - После установки 1 - проверяем - есть ли 1 на SCL. Если там 0 - то ждем SLAVE
4262  1252              ; 74 //    do {
4263  1252              ; 75 //        a = VV55_PORT_C;
4264  1252              ; 76 //        a &= 0x40;
4265  1252              ; 77 //    } while (a != 0x40);
4266  1252              ; 78 //    /// -------------------------------------
4267  1252              ; 79     #ifdef _SLOW_SETTINGS
4268  1252              ; 80     NOPS
4269  1252 00           	nop
4270  1253 00           	nop
4271  1254              ; 81     #endif
4272  1254              ; 82     nop();
4273  1254 00           	nop
4274  1255              ; 83     a = I2C_CURRETN_VALUE;
4275  1255 3A 23 13     	ld a, (i2c_curretn_value)
4276  1258              ; 84     a += 0x00;
4277  1258              ; 85     VV55_PORT_C = a;
4278  1258 32 02 F6     	ld (vv55_port_c), a
4279  125B C9           	ret
4280  125C              ; 86 }
4281  125C              ; 87
4282  125C              ; 88 /// вх. [C] передаваемый байт
4283  125C              ; 89 /// вых.[A]=0 - OK
4284  125C              ; 90 void transmitNewI2C() {
4285  125C              transmitnewi2c:
4286  125C              ; 91     push_pop(bc) {
4287  125C C5           	push bc
4288  125D              ; 92         b = 8;
4289  125D 06 08        	ld b, 8
4290  125F              ; 93         do {
4291  125F              l_298:
4292  125F              ; 94             setSDAI2C(a = c);
4293  125F 79           	ld a, c
4294  1260 CD 3F 12     	call setsdai2c
4295  1263              ; 95             pulseNewI2C();
4296  1263 CD 48 12     	call pulsenewi2c
4297  1266              ; 96             a = c;
4298  1266 79           	ld a, c
4299  1267              ; 97             carry_rotate_left(a, 1);
4300  1267 17           	rla
4301  1268              ; 98             c = a;
4302  1268 4F           	ld c, a
4303  1269              ; 99             b--;
4304  1269 05           	dec b
4305  126A              l_299:
4306  126A C2 5F 12     	jp nz, l_298
4307  126D              ; 100         } while (flag_nz);
4308  126D              ; 101
4309  126D              ; 102         setSDAI2C(a = 0x80);
4310  126D 3E 80        	ld a, 128
4311  126F CD 3F 12     	call setsdai2c
4312  1272              ; 103         a = VV55_PORT_C;
4313  1272 3A 02 F6     	ld a, (vv55_port_c)
4314  1275              ; 104         a &= 1;
4315  1275 E6 01        	and 1
4316  1277              ; 105         b = a;
4317  1277 47           	ld b, a
4318  1278              ; 106         setSDAI2C(a = 0x00);
4319  1278 3E 00        	ld a, 0
4320  127A CD 3F 12     	call setsdai2c
4321  127D              ; 107         pulseNewI2C();
4322  127D CD 48 12     	call pulsenewi2c
4323  1280              ; 108         a = b;
4324  1280 78           	ld a, b
4325  1281 C1           	pop bc
4326  1282 C9           	ret
4327  1283              ; 109     }
4328  1283              ; 110 }
4329  1283              ; 111
4330  1283              ; 112 /// вых.[C] принятый байт
4331  1283              ; 113 /// вых.[B] ACK/NAK
4332  1283              ; 114 void recieveNewI2C() {
4333  1283              recievenewi2c:
4334  1283              ; 115     push_pop(de) {
4335  1283 D5           	push de
4336  1284              ; 116         setSDAI2C(a = 0x80);
4337  1284 3E 80        	ld a, 128
4338  1286 CD 3F 12     	call setsdai2c
4339  1289              ; 117         c = 0;
4340  1289 0E 00        	ld c, 0
4341  128B              ; 118         d = 0x08;
4342  128B 16 08        	ld d, 8
4343  128D              ; 119         do {
4344  128D              l_301:
4345  128D              ; 120             a = c;
4346  128D 79           	ld a, c
4347  128E              ; 121             carry_rotate_left(a, 1);
4348  128E 17           	rla
4349  128F              ; 122             c = a;
4350  128F 4F           	ld c, a
4351  1290              ; 123             a = VV55_PORT_C; // READ BIT
4352  1290 3A 02 F6     	ld a, (vv55_port_c)
4353  1293              ; 124             a &= 1;
4354  1293 E6 01        	and 1
4355  1295              ; 125             a += c;
4356  1295 81           	add c
4357  1296              ; 126             c = a;
4358  1296 4F           	ld c, a
4359  1297              ; 127             pulseNewI2C();
4360  1297 CD 48 12     	call pulsenewi2c
4361  129A              ; 128             d--;
4362  129A 15           	dec d
4363  129B              ; 129             a = d;
4364  129B 7A           	ld a, d
4365  129C              l_302:
4366  129C C2 8D 12     	jp nz, l_301
4367  129F              ; 130         } while (flag_nz);
4368  129F              ; 131 //        setSDAI2C(a = 0x80);
4369  129F              ; 132 //        a &= 1;
4370  129F              ; 133 //        b = a;
4371  129F              ; 134 //        setSDAI2C(a = 0x00);
4372  129F              ; 135 //        if ((a = b) == 0x01) {
4373  129F              ; 136 //            setSDAI2C(a = 0x80);
4374  129F              ; 137 //        } else {
4375  129F              ; 138 //            setSDAI2C(a = 0x00);
4376  129F              ; 139 //        }
4377  129F              ; 140
4378  129F              ; 141         setSDAI2C(a = 0x00);
4379  129F 3E 00        	ld a, 0
4380  12A1 CD 3F 12     	call setsdai2c
4381  12A4              ; 142
4382  12A4              ; 143         pulseNewI2C();
4383  12A4 CD 48 12     	call pulsenewi2c
4384  12A7              ; 144
4385  12A7              ; 145         a = VV55_PORT_C;
4386  12A7 3A 02 F6     	ld a, (vv55_port_c)
4387  12AA              ; 146         a &= 1;
4388  12AA E6 01        	and 1
4389  12AC              ; 147         b = a;
4390  12AC 47           	ld b, a
4391  12AD D1           	pop de
4392  12AE C9           	ret
4393  12AF              ; 148     }
4394  12AF              ; 149 }
4395  12AF              ; 150
4396  12AF              ; 151 void readSDAState() {
4397  12AF              readsdastate:
4398  12AF              ; 152     a = 0x80;
4399  12AF 3E 80        	ld a, 128
4400  12B1              ; 153     VV55_PORT_C = a;
4401  12B1 32 02 F6     	ld (vv55_port_c), a
4402  12B4              ; 154     nop();
4403  12B4 00           	nop
4404  12B5              ; 155     a = VV55_PORT_C;
4405  12B5 3A 02 F6     	ld a, (vv55_port_c)
4406  12B8              ; 156     a &= 1;
4407  12B8 E6 01        	and 1
4408  12BA              ; 157     if (a == 0) {
4409  12BA B7           	or a
4410  12BB C2 C3 12     	jp nz, l_304
4411  12BE              ; 158         a = 0x01;
4412  12BE 3E 01        	ld a, 1
4413  12C0 C3 C5 12     	jp l_305
4414  12C3              l_304:
4415  12C3              ; 159     } else {
4416  12C3              ; 160         a = 0x00;
4417  12C3 3E 00        	ld a, 0
4418  12C5              l_305:
4419  12C5 C9           	ret
4420  12C6              ; 161     }
4421  12C6              ; 162 }
4422  12C6              ; 163
4423  12C6              ; 164 void needAccess() {
4424  12C6              needaccess:
4425  12C6              ; 165     do {
4426  12C6              l_306:
4427  12C6              ; 166         readSDAState();
4428  12C6 CD AF 12     	call readsdastate
4429  12C9              ; 167         if (a == 1) {
4430  12C9 FE 01        	cp 1
4431  12CB C2 D1 12     	jp nz, l_309
4432  12CE              ; 168             nop();
4433  12CE 00           	nop
4434  12CF              ; 169             nop();
4435  12CF 00           	nop
4436  12D0              ; 170             nop();
4437  12D0 00           	nop
4438  12D1              l_309:
4439  12D1              l_307:
4440  12D1              ; 171         }
4441  12D1              ; 172     } while (a == 0x01);
4442  12D1 FE 01        	cp 1
4443  12D3 CA C6 12     	jp z, l_306
4444  12D6 C9           	ret
4445  12D7              ; 173 }
4446  12D7              ; 174
4447  12D7              ; 175 /// вых.[B] - 1 устройство занято
4448  12D7              ; 176 void i2cBusy() {
4449  12D7              i2cbusy:
4450  12D7              ; 177     a = VV55_PORT_C;
4451  12D7 3A 02 F6     	ld a, (vv55_port_c)
4452  12DA              ; 178     a &= 2;
4453  12DA E6 02        	and 2
4454  12DC              ; 179     carry_rotate_right(a, 1);
4455  12DC 1F           	rra
4456  12DD C9           	ret
4457  12DE              ; 180 }
4458  12DE              ; 181
4459  12DE              ; 182 /// Ожидание готовности I2C
4460  12DE              ; 183 void i2cWaitingForAccess() {
4461  12DE              i2cwaitingforaccess:
4462  12DE              ; 184     do {
4463  12DE              l_311:
4464  12DE              ; 185         i2cBusy();
4465  12DE CD D7 12     	call i2cbusy
4466  12E1              ; 186         if (a == 1) {
4467  12E1 FE 01        	cp 1
4468  12E3 C2 EB 12     	jp nz, l_314
4469  12E6              ; 187             nop();
4470  12E6 00           	nop
4471  12E7              ; 188             nop();
4472  12E7 00           	nop
4473  12E8              ; 189             nop();
4474  12E8 00           	nop
4475  12E9              ; 190             nop();
4476  12E9 00           	nop
4477  12EA              ; 191             nop();
4478  12EA 00           	nop
4479  12EB              l_314:
4480  12EB              l_312:
4481  12EB              ; 192         }
4482  12EB              ; 193     } while (a == 1);
4483  12EB FE 01        	cp 1
4484  12ED CA DE 12     	jp z, l_311
4485  12F0 C9           	ret
4486  12F1              ; 194 }
4487  12F1              ; 195
4488  12F1              ; 196 void delay5msI2C() {
4489  12F1              delay5msi2c:
4490  12F1              ; 197     push_pop(bc) {
4491  12F1 C5           	push bc
4492  12F2              ; 198         bc = 0x500;
4493  12F2 01 00 05     	ld bc, 1280
4494  12F5              ; 199         do {
4495  12F5              l_316:
4496  12F5              ; 200             bc--;
4497  12F5 0B           	dec bc
4498  12F6              ; 201             a = b;
4499  12F6 78           	ld a, b
4500  12F7              ; 202             a |= c;
4501  12F7 B1           	or c
4502  12F8              l_317:
4503  12F8 C2 F5 12     	jp nz, l_316
4504  12FB C1           	pop bc
4505  12FC C9           	ret
4506  12FD              ; 203         } while (flag_nz);
4507  12FD              ; 204     }
4508  12FD              ; 205 }
4509  12FD              ; 206
4510  12FD              ; 207 void busRecoveryI2C() {
4511  12FD              busrecoveryi2c:
4512  12FD              ; 208     startI2C();
4513  12FD CD 1F 12     	call starti2c
4514  1300              ; 209     a = 0;
4515  1300 3E 00        	ld a, 0
4516  1302              ; 210     setSDAI2C();
4517  1302 CD 3F 12     	call setsdai2c
4518  1305              ; 211     pulseNewI2C();
4519  1305 CD 48 12     	call pulsenewi2c
4520  1308              ; 212     pulseNewI2C();
4521  1308 CD 48 12     	call pulsenewi2c
4522  130B              ; 213     pulseNewI2C();
4523  130B CD 48 12     	call pulsenewi2c
4524  130E              ; 214     pulseNewI2C();
4525  130E CD 48 12     	call pulsenewi2c
4526  1311              ; 215     pulseNewI2C();
4527  1311 CD 48 12     	call pulsenewi2c
4528  1314              ; 216     pulseNewI2C();
4529  1314 CD 48 12     	call pulsenewi2c
4530  1317              ; 217     pulseNewI2C();
4531  1317 CD 48 12     	call pulsenewi2c
4532  131A              ; 218     pulseNewI2C();
4533  131A CD 48 12     	call pulsenewi2c
4534  131D              ; 219     pulseNewI2C();
4535  131D CD 48 12     	call pulsenewi2c
4536  1320              ; 220     stopI2C();
4537  1320 C3 2F 12     	jp stopi2c
4538  1323              ; 11 uint8_t I2C_CURRETN_VALUE = 0x00;
4539  1323              i2c_curretn_value:
4540  1323 00           	db 0
4541  1324              ; 12 uint8_t CHIP_ADDRESS = 0x12;
4542  1324              chip_address:
4543  1324 12           	db 18
4544  1325              ; 14 void sendCommand() {
4545  1325              sendcommand:
4546  1325              ; 15     push_pop(de) {
4547  1325 D5           	push de
4548  1326              ; 16         d = h;
4549  1326 54           	ld d, h
4550  1327              ; 17         // form the slave address with the R/W bit (R=1, W=0) at LSB
4551  1327              ; 18         a ^= a; // XRA     A Carry = 0
4552  1327 AF           	xor a
4553  1328              ; 19         a = CHIP_ADDRESS;
4554  1328 3A 24 13     	ld a, (chip_address)
4555  132B              ; 20         carry_rotate_left(a, 1); // shift address left, set R/W bit to 0 (write)
4556  132B 17           	rla
4557  132C              ; 21         h = a;
4558  132C 67           	ld h, a
4559  132D              ; 22
4560  132D              ; 23         startI2C();
4561  132D CD 1F 12     	call starti2c
4562  1330              ; 24         c = h;
4563  1330 4C           	ld c, h
4564  1331              ; 25         transmitNewI2C(); // Адрес и направление
4565  1331 CD 5C 12     	call transmitnewi2c
4566  1334              ; 26
4567  1334              ; 27         c = l;
4568  1334 4D           	ld c, l
4569  1335              ; 28         transmitNewI2C(); // Комманда
4570  1335 CD 5C 12     	call transmitnewi2c
4571  1338              ; 29
4572  1338              ; 30         // Отправляемые данные
4573  1338              ; 31         if ((a = d) > 0) {
4574  1338 7A           	ld a, d
4575  1339 B7           	or a
4576  133A CA 4B 13     	jp z, l_319
4577  133D              ; 32             h = d;
4578  133D 62           	ld h, d
4579  133E              ; 33             de = ESP_I2S_BUFFER;
4580  133E 11 8B 13     	ld de, esp_i2s_buffer
4581  1341              ; 34             do {
4582  1341              l_321:
4583  1341              ; 35                 a = *de;
4584  1341 1A           	ld a, (de)
4585  1342              ; 36                 de++;
4586  1342 13           	inc de
4587  1343              ; 37                 c = a;
4588  1343 4F           	ld c, a
4589  1344              ; 38                 transmitNewI2C();
4590  1344 CD 5C 12     	call transmitnewi2c
4591  1347              ; 39                 h--;
4592  1347 25           	dec h
4593  1348              l_322:
4594  1348 C2 41 13     	jp nz, l_321
4595  134B              l_319:
4596  134B              ; 40             } while(flag_nz);
4597  134B              ; 41         }
4598  134B              ; 42
4599  134B              ; 43         // Конец отправки
4600  134B              ; 44         stopI2C();
4601  134B CD 2F 12     	call stopi2c
4602  134E D1           	pop de
4603  134F C9           	ret
4604  1350              ; 45     }
4605  1350              ; 46 }
4606  1350              ; 47
4607  1350              ; 48 /// вх. [L] - Кол-во считываемых байт
4608  1350              ; 49 void readNewInBuffer() {
4609  1350              readnewinbuffer:
4610  1350              ; 50     push_pop(hl) {
4611  1350 E5           	push hl
4612  1351              ; 51         push_pop(de) {
4613  1351 D5           	push de
4614  1352              ; 52             a ^= a; // XRA
4615  1352 AF           	xor a
4616  1353              ; 53             a = CHIP_ADDRESS;
4617  1353 3A 24 13     	ld a, (chip_address)
4618  1356              ; 54             carry_rotate_left(a, 1);
4619  1356 17           	rla
4620  1357              ; 55             a += 1;
4621  1357 C6 01        	add 1
4622  1359              ; 56             h = a;
4623  1359 67           	ld h, a
4624  135A              ; 57             //
4625  135A              ; 58             startI2C();
4626  135A CD 1F 12     	call starti2c
4627  135D              ; 59             c = h;
4628  135D 4C           	ld c, h
4629  135E              ; 60             transmitNewI2C();
4630  135E CD 5C 12     	call transmitnewi2c
4631  1361              ; 61
4632  1361              ; 62             i2cWaitingForAccess();
4633  1361 CD DE 12     	call i2cwaitingforaccess
4634  1364              ; 63
4635  1364              ; 64             //l = 20;
4636  1364              ; 65             de = ESP_I2S_BUFFER;
4637  1364 11 8B 13     	ld de, esp_i2s_buffer
4638  1367              ; 66             do {
4639  1367              l_324:
4640  1367              ; 67                 push_pop(bc) {
4641  1367 C5           	push bc
4642  1368              ; 68                     // Если последний ожидаемый байт - то передаем NACK
4643  1368              ; 69                     if ((a = l) == 1) {
4644  1368 7D           	ld a, l
4645  1369 FE 01        	cp 1
4646  136B C2 73 13     	jp nz, l_327
4647  136E              ; 70                         b = 0x01;
4648  136E 06 01        	ld b, 1
4649  1370 C3 75 13     	jp l_328
4650  1373              l_327:
4651  1373              ; 71                     } else {
4652  1373              ; 72                         b = 0x00;
4653  1373 06 00        	ld b, 0
4654  1375              l_328:
4655  1375              ; 73                     }
4656  1375              ; 74                     recieveNewI2C();
4657  1375 CD 83 12     	call recievenewi2c
4658  1378              ; 75 //                    if ((a = b) == 0x01) {
4659  1378              ; 76 //                        l = 1;
4660  1378              ; 77 //                    }
4661  1378              ; 78                     a = c;
4662  1378 79           	ld a, c
4663  1379 C1           	pop bc
4664  137A              ; 79                 }
4665  137A              ; 80                 *de = a;
4666  137A 12           	ld (de), a
4667  137B              ; 81                 de++;
4668  137B 13           	inc de
4669  137C              ; 82                 l--;
4670  137C 2D           	dec l
4671  137D              l_325:
4672  137D              ; 83             } while ((a = l) > 0);
4673  137D 7D           	ld a, l
4674  137E B7           	or a
4675  137F C2 67 13     	jp nz, l_324
4676  1382              ; 84             a = 0; // stop byte
4677  1382 3E 00        	ld a, 0
4678  1384              ; 85             *de = a;
4679  1384 12           	ld (de), a
4680  1385              ; 86             //
4681  1385              ; 87             stopI2C();
4682  1385 CD 2F 12     	call stopi2c
4683  1388 D1           	pop de
4684  1389 E1           	pop hl
4685  138A C9           	ret
4686  138B              ; 88         }
4687  138B              ; 89     }
4688  138B              ; 90 }
4689  138B              ; 91
4690  138B              ; 92 uint8_t ESP_I2S_BUFFER[32];
4691  138B              esp_i2s_buffer:
4692  138B 00 00 00...  	ds 32
4693  13AB              ; 12 void getSSIDList() {
4694  13AB              getssidlist:
4695  13AB              ; 13     // Получить ответ
4696  13AB              ; 14     // Ответ ESP_I2S_BUFFER
4697  13AB              ; 15     // SSIDList буфер заполнения
4698  13AB              ; 16     push_pop(bc) {
4699  13AB C5           	push bc
4700  13AC              ; 17         do {
4701  13AC              l_329:
4702  13AC              ; 18             //
4703  13AC              ; 19             delay5msI2C();
4704  13AC CD F1 12     	call delay5msi2c
4705  13AF              ; 20             i2cWaitingForAccess();
4706  13AF CD DE 12     	call i2cwaitingforaccess
4707  13B2              ; 21             l = 5;
4708  13B2 2E 05        	ld l, 5
4709  13B4              ; 22             h = 0;
4710  13B4 26 00        	ld h, 0
4711  13B6              ; 23             sendCommand();
4712  13B6 CD 25 13     	call sendcommand
4713  13B9              ; 24             //
4714  13B9              ; 25             delay5msI2C();
4715  13B9 CD F1 12     	call delay5msi2c
4716  13BC              ; 26             i2cWaitingForAccess();
4717  13BC CD DE 12     	call i2cwaitingforaccess
4718  13BF              ; 27             l = 22;
4719  13BF 2E 16        	ld l, 22
4720  13C1              ; 28             readNewInBuffer();
4721  13C1 CD 50 13     	call readnewinbuffer
4722  13C4              ; 29             push_pop(a) {
4723  13C4 F5           	push af
4724  13C5              ; 30                 push_pop(de) {
4725  13C5 D5           	push de
4726  13C6              ; 31                     push_pop(hl) {
4727  13C6 E5           	push hl
4728  13C7              ; 32                         de = ESP_I2S_BUFFER;
4729  13C7 11 8B 13     	ld de, esp_i2s_buffer
4730  13CA              ; 33                         a = *de; // позиция
4731  13CA 1A           	ld a, (de)
4732  13CB              ; 34                         carry_rotate_left(a, 4);
4733  13CB 17           	rla
4734  13CC 17           	rla
4735  13CD 17           	rla
4736  13CE 17           	rla
4737  13CF              ; 35                         c = a;
4738  13CF 4F           	ld c, a
4739  13D0              ; 36                         // смещаем адрес буфера на 16 * на позицию
4740  13D0              ; 37                         b = 0;
4741  13D0 06 00        	ld b, 0
4742  13D2              ; 38                         hl = SSIDList;
4743  13D2 21 12 11     	ld hl, ssidlist
4744  13D5              ; 39                         hl += bc;
4745  13D5 09           	add hl, bc
4746  13D6              ; 40                         //
4747  13D6              ; 41                         de++;
4748  13D6 13           	inc de
4749  13D7              ; 42                         a = *de; // flag
4750  13D7 1A           	ld a, (de)
4751  13D8              ; 43                         SSIDListNext = a;
4752  13D8 32 11 11     	ld (ssidlistnext), a
4753  13DB              ; 44                         de++;
4754  13DB 13           	inc de
4755  13DC              ; 45                         // copy 16 byte
4756  13DC              ; 46                         b = 16;
4757  13DC 06 10        	ld b, 16
4758  13DE              ; 47                         do {
4759  13DE              l_332:
4760  13DE              ; 48                             a = *de;
4761  13DE 1A           	ld a, (de)
4762  13DF              ; 49                             *hl = a;
4763  13DF 77           	ld (hl), a
4764  13E0              ; 50                             de++;
4765  13E0 13           	inc de
4766  13E1              ; 51                             hl++;
4767  13E1 23           	inc hl
4768  13E2              ; 52                             b--;
4769  13E2 05           	dec b
4770  13E3              l_333:
4771  13E3 C2 DE 13     	jp nz, l_332
4772  13E6 E1           	pop hl
4773  13E7 D1           	pop de
4774  13E8 F1           	pop af
4775  13E9              ; 53                         } while (flag_nz);
4776  13E9              ; 54                     }
4777  13E9              ; 55                 }
4778  13E9              ; 56             }
4779  13E9              ; 57             a = SSIDListNext;
4780  13E9 3A 11 11     	ld a, (ssidlistnext)
4781  13EC              l_330:
4782  13EC              ; 58         } while (a != 0);
4783  13EC B7           	or a
4784  13ED C2 AC 13     	jp nz, l_329
4785  13F0 C1           	pop bc
4786  13F1 C9           	ret
4787  13F2              ; 59     }
4788  13F2              ; 60 }
4789  13F2              ; 61
4790  13F2              ; 62 /// Получить текущее имя сети
4791  13F2              ; 63 void getSSIDValue() {
4792  13F2              getssidvalue:
4793  13F2              ; 64     push_pop(hl) {
4794  13F2 E5           	push hl
4795  13F3              ; 65         do {
4796  13F3              l_335:
4797  13F3              ; 66             delay5msI2C();
4798  13F3 CD F1 12     	call delay5msi2c
4799  13F6              ; 67             i2cWaitingForAccess();
4800  13F6 CD DE 12     	call i2cwaitingforaccess
4801  13F9              ; 68             l = 6;
4802  13F9 2E 06        	ld l, 6
4803  13FB              ; 69             h = 0;
4804  13FB 26 00        	ld h, 0
4805  13FD              ; 70             sendCommand();
4806  13FD CD 25 13     	call sendcommand
4807  1400              ; 71             //
4808  1400              ; 72             loadStringToHL(hl = wifiSettingsSsidVal);
4809  1400 21 DF 0C     	ld hl, wifisettingsssidval
4810  1403 CD F2 14     	call loadstringtohl
4811  1406              l_336:
4812  1406              ; 73         } while ((a = parsePageBufferIsCheck) != 1);
4813  1406 3A 53 1D     	ld a, (parsepagebufferischeck)
4814  1409 FE 01        	cp 1
4815  140B C2 F3 13     	jp nz, l_335
4816  140E E1           	pop hl
4817  140F C9           	ret
4818  1410              ; 74     }
4819  1410              ; 75 }
4820  1410              ; 76
4821  1410              ; 77 /// Получить пароль wifi
4822  1410              ; 78 void getSSIDPasswordValue() {
4823  1410              getssidpasswordvalue:
4824  1410              ; 79     push_pop(hl) {
4825  1410 E5           	push hl
4826  1411              ; 80         push_pop(de) {
4827  1411 D5           	push de
4828  1412              ; 81             push_pop(bc) {
4829  1412 C5           	push bc
4830  1413              ; 82                 delay5msI2C();
4831  1413 CD F1 12     	call delay5msi2c
4832  1416              ; 83                 i2cWaitingForAccess();
4833  1416 CD DE 12     	call i2cwaitingforaccess
4834  1419              ; 84                 l = 8;
4835  1419 2E 08        	ld l, 8
4836  141B              ; 85                 h = 0;
4837  141B 26 00        	ld h, 0
4838  141D              ; 86                 sendCommand();
4839  141D CD 25 13     	call sendcommand
4840  1420              ; 87
4841  1420              ; 88                 delay5msI2C();
4842  1420 CD F1 12     	call delay5msi2c
4843  1423              ; 89
4844  1423              ; 90                 i2cWaitingForAccess();
4845  1423 CD DE 12     	call i2cwaitingforaccess
4846  1426              ; 91                 l = 26;
4847  1426 2E 1A        	ld l, 26
4848  1428              ; 92                 readNewInBuffer();
4849  1428 CD 50 13     	call readnewinbuffer
4850  142B              ; 93
4851  142B              ; 94                 de = ESP_I2S_BUFFER;
4852  142B 11 8B 13     	ld de, esp_i2s_buffer
4853  142E              ; 95                 hl = wifiSettingsEditViewSSIDPasswordVal;
4854  142E 21 CF 10     	ld hl, wifisettingseditviewssidpassword_3
4855  1431              ; 96                 b = 16;
4856  1431 06 10        	ld b, 16
4857  1433              ; 97                 do {
4858  1433              l_338:
4859  1433              ; 98                     a = *de;
4860  1433 1A           	ld a, (de)
4861  1434              ; 99                     if(a==0xFF){
4862  1434 FE FF        	cp 255
4863  1436 C2 3B 14     	jp nz, l_341
4864  1439              ; 100                         a = 0x00;
4865  1439 3E 00        	ld a, 0
4866  143B              l_341:
4867  143B              ; 101                     }
4868  143B              ; 102                     *hl = a;
4869  143B 77           	ld (hl), a
4870  143C              ; 103                     de++;
4871  143C 13           	inc de
4872  143D              ; 104                     hl++;
4873  143D 23           	inc hl
4874  143E              ; 105                     b--;
4875  143E 05           	dec b
4876  143F              l_339:
4877  143F C2 33 14     	jp nz, l_338
4878  1442 C1           	pop bc
4879  1443 D1           	pop de
4880  1444 E1           	pop hl
4881  1445 C9           	ret
4882  1446              ; 106                 } while (flag_nz);
4883  1446              ; 107             }
4884  1446              ; 108         }
4885  1446              ; 109     }
4886  1446              ; 110 }
4887  1446              ; 111
4888  1446              ; 112 /// Отправить пароль wifi
4889  1446              ; 113 void setSSIDPasswordValue() {
4890  1446              setssidpasswordvalue:
4891  1446              ; 114     push_pop(hl) {
4892  1446 E5           	push hl
4893  1447              ; 115         push_pop(de) {
4894  1447 D5           	push de
4895  1448              ; 116             push_pop(bc) {
4896  1448 C5           	push bc
4897  1449              ; 117                 de = wifiSettingsEditViewSSIDPasswordVal;
4898  1449 11 CF 10     	ld de, wifisettingseditviewssidpassword_3
4899  144C              ; 118                 hl = ESP_I2S_BUFFER;
4900  144C 21 8B 13     	ld hl, esp_i2s_buffer
4901  144F              ; 119                 b = 16;
4902  144F 06 10        	ld b, 16
4903  1451              ; 120                 c = 0;
4904  1451 0E 00        	ld c, 0
4905  1453              ; 121                 do {
4906  1453              l_343:
4907  1453              ; 122                     a = *de;
4908  1453 1A           	ld a, (de)
4909  1454              ; 123                     if ((a = c) == 1) {
4910  1454 79           	ld a, c
4911  1455 FE 01        	cp 1
4912  1457 C2 5F 14     	jp nz, l_346
4913  145A              ; 124                         a = 0xFF;
4914  145A 3E FF        	ld a, 255
4915  145C C3 68 14     	jp l_347
4916  145F              l_346:
4917  145F              ; 125                     } else if((a = *de) == 0) {
4918  145F 1A           	ld a, (de)
4919  1460 B7           	or a
4920  1461 C2 68 14     	jp nz, l_348
4921  1464              ; 126                         c = 1;
4922  1464 0E 01        	ld c, 1
4923  1466              ; 127                         a = 0x00;
4924  1466 3E 00        	ld a, 0
4925  1468              l_348:
4926  1468              l_347:
4927  1468              ; 128                     }
4928  1468              ; 129                     *hl = a;
4929  1468 77           	ld (hl), a
4930  1469              ; 130                     de++;
4931  1469 13           	inc de
4932  146A              ; 131                     hl++;
4933  146A 23           	inc hl
4934  146B              ; 132                     b--;
4935  146B 05           	dec b
4936  146C              l_344:
4937  146C C2 53 14     	jp nz, l_343
4938  146F              ; 133                 } while (flag_nz);
4939  146F              ; 134
4940  146F              ; 135                 delay5msI2C();
4941  146F CD F1 12     	call delay5msi2c
4942  1472              ; 136                 i2cWaitingForAccess();
4943  1472 CD DE 12     	call i2cwaitingforaccess
4944  1475              ; 137                 l = 9;
4945  1475 2E 09        	ld l, 9
4946  1477              ; 138                 h = 16;
4947  1477 26 10        	ld h, 16
4948  1479              ; 139                 sendCommand();
4949  1479 CD 25 13     	call sendcommand
4950  147C C1           	pop bc
4951  147D D1           	pop de
4952  147E E1           	pop hl
4953  147F C9           	ret
4954  1480              ; 140             }
4955  1480              ; 141         }
4956  1480              ; 142     }
4957  1480              ; 143 }
4958  1480              ; 144
4959  1480              ; 145 /// Подключиться в WiFi
4960  1480              ; 146 void needSsidConnect() {
4961  1480              needssidconnect:
4962  1480              ; 147     push_pop(hl) {
4963  1480 E5           	push hl
4964  1481              ; 148         delay5msI2C();
4965  1481 CD F1 12     	call delay5msi2c
4966  1484              ; 149         i2cWaitingForAccess();
4967  1484 CD DE 12     	call i2cwaitingforaccess
4968  1487              ; 150         l = 10;
4969  1487 2E 0A        	ld l, 10
4970  1489              ; 151         h = 0;
4971  1489 26 00        	ld h, 0
4972  148B              ; 152         sendCommand();
4973  148B CD 25 13     	call sendcommand
4974  148E E1           	pop hl
4975  148F C9           	ret
4976  1490              ; 153     }
4977  1490              ; 154 }
4978  1490              ; 155
4979  1490              ; 156 /// Запросить обновление списка сетей
4980  1490              ; 157 void needUpdateSSIDList() {
4981  1490              needupdatessidlist:
4982  1490              ; 158     push_pop(hl) {
4983  1490 E5           	push hl
4984  1491              ; 159         delay5msI2C();
4985  1491 CD F1 12     	call delay5msi2c
4986  1494              ; 160         i2cWaitingForAccess();
4987  1494 CD DE 12     	call i2cwaitingforaccess
4988  1497              ; 161         l = 4;
4989  1497 2E 04        	ld l, 4
4990  1499              ; 162         h = 0;
4991  1499 26 00        	ld h, 0
4992  149B              ; 163         sendCommand();
4993  149B CD 25 13     	call sendcommand
4994  149E E1           	pop hl
4995  149F C9           	ret
4996  14A0              ; 164     }
4997  14A0              ; 165 }
4998  14A0              ; 166
4999  14A0              ; 167 /// Установить имя сети по номеру в списке
5000  14A0              ; 168 /// вх. [A] - номер сети
5001  14A0              ; 169 void setSSIDNumberA() {
5002  14A0              setssidnumbera:
5003  14A0              ; 170     push_pop(de) {
5004  14A0 D5           	push de
5005  14A1              ; 171         push_pop(hl) {
5006  14A1 E5           	push hl
5007  14A2              ; 172             de = ESP_I2S_BUFFER;
5008  14A2 11 8B 13     	ld de, esp_i2s_buffer
5009  14A5              ; 173             *de = a;
5010  14A5 12           	ld (de), a
5011  14A6              ; 174             //
5012  14A6              ; 175             delay5msI2C();
5013  14A6 CD F1 12     	call delay5msi2c
5014  14A9              ; 176             i2cWaitingForAccess();
5015  14A9 CD DE 12     	call i2cwaitingforaccess
5016  14AC              ; 177             //
5017  14AC              ; 178             l = 7; // SET_SSID
5018  14AC 2E 07        	ld l, 7
5019  14AE              ; 179             h = 1; // 1 байт
5020  14AE 26 01        	ld h, 1
5021  14B0              ; 180             sendCommand();
5022  14B0 CD 25 13     	call sendcommand
5023  14B3 E1           	pop hl
5024  14B4 D1           	pop de
5025  14B5 C9           	ret
5026  14B6              ; 181         }
5027  14B6              ; 182     }
5028  14B6              ; 183 }
5029  14B6              ; 184
5030  14B6              ; 185 /// Получить IP_Address
5031  14B6              ; 186 void getSSIDIPAddress() {
5032  14B6              getssidipaddress:
5033  14B6              ; 187     push_pop(hl) {
5034  14B6 E5           	push hl
5035  14B7              ; 188         do {
5036  14B7              l_350:
5037  14B7              ; 189             delay5msI2C();
5038  14B7 CD F1 12     	call delay5msi2c
5039  14BA              ; 190             i2cWaitingForAccess();
5040  14BA CD DE 12     	call i2cwaitingforaccess
5041  14BD              ; 191             l = 12;
5042  14BD 2E 0C        	ld l, 12
5043  14BF              ; 192             h = 0;
5044  14BF 26 00        	ld h, 0
5045  14C1              ; 193             sendCommand();
5046  14C1 CD 25 13     	call sendcommand
5047  14C4              ; 194             //
5048  14C4              ; 195             loadStringToHL(hl = wifiSettingsIpVal);
5049  14C4 21 F1 0C     	ld hl, wifisettingsipval
5050  14C7 CD F2 14     	call loadstringtohl
5051  14CA              l_351:
5052  14CA              ; 196         } while ((a = parsePageBufferIsCheck) != 1);
5053  14CA 3A 53 1D     	ld a, (parsepagebufferischeck)
5054  14CD FE 01        	cp 1
5055  14CF C2 B7 14     	jp nz, l_350
5056  14D2 E1           	pop hl
5057  14D3 C9           	ret
5058  14D4              ; 197     }
5059  14D4              ; 198 }
5060  14D4              ; 199
5061  14D4              ; 200 /// Получить MAC_Address
5062  14D4              ; 201 void getSSIDMacAddress() {
5063  14D4              getssidmacaddress:
5064  14D4              ; 202     push_pop(hl) {
5065  14D4 E5           	push hl
5066  14D5              ; 203         do {
5067  14D5              l_353:
5068  14D5              ; 204             delay5msI2C();
5069  14D5 CD F1 12     	call delay5msi2c
5070  14D8              ; 205             i2cWaitingForAccess();
5071  14D8 CD DE 12     	call i2cwaitingforaccess
5072  14DB              ; 206             l = 13;
5073  14DB 2E 0D        	ld l, 13
5074  14DD              ; 207             h = 0;
5075  14DD 26 00        	ld h, 0
5076  14DF              ; 208             sendCommand();
5077  14DF CD 25 13     	call sendcommand
5078  14E2              ; 209             //
5079  14E2              ; 210             loadStringToHL(hl = wifiSettingsMacVal);
5080  14E2 21 03 0D     	ld hl, wifisettingsmacval
5081  14E5 CD F2 14     	call loadstringtohl
5082  14E8              l_354:
5083  14E8              ; 211         } while ((a = parsePageBufferIsCheck) != 1);
5084  14E8 3A 53 1D     	ld a, (parsepagebufferischeck)
5085  14EB FE 01        	cp 1
5086  14ED C2 D5 14     	jp nz, l_353
5087  14F0 E1           	pop hl
5088  14F1 C9           	ret
5089  14F2              ; 212     }
5090  14F2              ; 213 }
5091  14F2              ; 214
5092  14F2              ; 215 /// Загрузить данные (не больше 255) по адресу HL
5093  14F2              ; 216 /// вх. [HL] - Куда записывать результат
5094  14F2              ; 217 void loadStringToHL() {
5095  14F2              loadstringtohl:
5096  14F2              ; 218     do {
5097  14F2              l_356:
5098  14F2              ; 219         push_pop(hl) {
5099  14F2 E5           	push hl
5100  14F3              ; 220             // Получить новый буфер
5101  14F3              ; 221             delay5msI2C();
5102  14F3 CD F1 12     	call delay5msi2c
5103  14F6              ; 222             i2cWaitingForAccess();
5104  14F6 CD DE 12     	call i2cwaitingforaccess
5105  14F9              ; 223             l = 34; //GET_NEXT_PAGE_BUFFER, // 34
5106  14F9 2E 22        	ld l, 34
5107  14FB              ; 224             h = 0;
5108  14FB 26 00        	ld h, 0
5109  14FD              ; 225             sendCommand();
5110  14FD CD 25 13     	call sendcommand
5111  1500              ; 226             //
5112  1500              ; 227             delay5msI2C();
5113  1500 CD F1 12     	call delay5msi2c
5114  1503              ; 228             i2cWaitingForAccess();
5115  1503 CD DE 12     	call i2cwaitingforaccess
5116  1506              ; 229             l = 15;
5117  1506 2E 0F        	ld l, 15
5118  1508              ; 230             readNewInBuffer(); //ESP_I2S_BUFFER
5119  1508 CD 50 13     	call readnewinbuffer
5120  150B E1           	pop hl
5121  150C              ; 231         }
5122  150C              ; 232         // Parse ESP_I2S_BUFFER
5123  150C              ; 233         parsePageBuffer();
5124  150C CD EF 1C     	call parsepagebuffer
5125  150F              l_357:
5126  150F              ; 234     } while ((a = parsePageBufferNext) != 0x5A);
5127  150F 3A 52 1D     	ld a, (parsepagebuffernext)
5128  1512 FE 5A        	cp 90
5129  1514 C2 F2 14     	jp nz, l_356
5130  1517 C9           	ret
5131  1518              ; 235 }
5132  1518              ; 236
5133  1518              ; 237 /// Получить STATE_SSID
5134  1518              ; 238 void getSSIDState() {
5135  1518              getssidstate:
5136  1518              ; 239     push_pop(hl) {
5137  1518 E5           	push hl
5138  1519              ; 240         push_pop(de) {
5139  1519 D5           	push de
5140  151A              ; 241             push_pop(bc) {
5141  151A C5           	push bc
5142  151B              ; 242                 delay5msI2C();
5143  151B CD F1 12     	call delay5msi2c
5144  151E              ; 243                 i2cWaitingForAccess();
5145  151E CD DE 12     	call i2cwaitingforaccess
5146  1521              ; 244                 l = 11;
5147  1521 2E 0B        	ld l, 11
5148  1523              ; 245                 h = 0;
5149  1523 26 00        	ld h, 0
5150  1525              ; 246                 sendCommand();
5151  1525 CD 25 13     	call sendcommand
5152  1528              ; 247                 //
5153  1528              ; 248                 delay5msI2C();
5154  1528 CD F1 12     	call delay5msi2c
5155  152B              ; 249                 i2cWaitingForAccess();
5156  152B CD DE 12     	call i2cwaitingforaccess
5157  152E              ; 250                 l = 4;
5158  152E 2E 04        	ld l, 4
5159  1530              ; 251                 readNewInBuffer();
5160  1530 CD 50 13     	call readnewinbuffer
5161  1533              ; 252                 //
5162  1533              ; 253                 a = WiFiState;
5163  1533 3A FB 10     	ld a, (wifistate)
5164  1536              ; 254                 h = a;
5165  1536 67           	ld h, a
5166  1537              ; 255                 de = ESP_I2S_BUFFER;
5167  1537 11 8B 13     	ld de, esp_i2s_buffer
5168  153A              ; 256                 a = *de;
5169  153A 1A           	ld a, (de)
5170  153B              ; 257                 a &= 0x01;
5171  153B E6 01        	and 1
5172  153D              ; 258                 WiFiState = a;
5173  153D 32 FB 10     	ld (wifistate), a
5174  1540              ; 259                 if(a != h){
5175  1540 BC           	cp h
5176  1541 CA 49 15     	jp z, l_359
5177  1544              ; 260                     a = 0x01;
5178  1544 3E 01        	ld a, 1
5179  1546              ; 261                     WiFiStateUpdate = a;
5180  1546 32 FC 10     	ld (wifistateupdate), a
5181  1549              l_359:
5182  1549 C1           	pop bc
5183  154A D1           	pop de
5184  154B E1           	pop hl
5185  154C C9           	ret
5186  154D              ; 262                 }
5187  154D              ; 263             }
5188  154D              ; 264         }
5189  154D              ; 265     }
5190  154D              ; 266 }
5191  154D              ; 267
5192  154D              ; 268 /// FTP
5193  154D              ; 269
5194  154D              ; 270 /// Получить FTP URL
5195  154D              ; 271 void getFTPUrl() {
5196  154D              getftpurl:
5197  154D              ; 272     push_pop(hl) {
5198  154D E5           	push hl
5199  154E              ; 273         push_pop(de) {
5200  154E D5           	push de
5201  154F              ; 274             push_pop(bc) {
5202  154F C5           	push bc
5203  1550              ; 275                 delay5msI2C();
5204  1550 CD F1 12     	call delay5msi2c
5205  1553              ; 276                 i2cWaitingForAccess();
5206  1553 CD DE 12     	call i2cwaitingforaccess
5207  1556              ; 277                 l = 2;
5208  1556 2E 02        	ld l, 2
5209  1558              ; 278                 h = 0;
5210  1558 26 00        	ld h, 0
5211  155A              ; 279                 sendCommand();
5212  155A CD 25 13     	call sendcommand
5213  155D              ; 280                 //
5214  155D              ; 281                 delay5msI2C();
5215  155D CD F1 12     	call delay5msi2c
5216  1560              ; 282                 i2cWaitingForAccess();
5217  1560 CD DE 12     	call i2cwaitingforaccess
5218  1563              ; 283                 l = 26;
5219  1563 2E 1A        	ld l, 26
5220  1565              ; 284                 readNewInBuffer();
5221  1565 CD 50 13     	call readnewinbuffer
5222  1568              ; 285                 //
5223  1568              ; 286                 de = ESP_I2S_BUFFER;
5224  1568 11 8B 13     	ld de, esp_i2s_buffer
5225  156B              ; 287                 hl = ftpSettingsIpValue;
5226  156B 21 5E 0D     	ld hl, ftpsettingsipvalue
5227  156E              ; 288                 b = 16;
5228  156E 06 10        	ld b, 16
5229  1570              ; 289                 do {
5230  1570              l_361:
5231  1570              ; 290                     a = *de;
5232  1570 1A           	ld a, (de)
5233  1571              ; 291                     if(a==0xFF){
5234  1571 FE FF        	cp 255
5235  1573 C2 78 15     	jp nz, l_364
5236  1576              ; 292                         a = 0x00;
5237  1576 3E 00        	ld a, 0
5238  1578              l_364:
5239  1578              ; 293                     }
5240  1578              ; 294                     *hl = a;
5241  1578 77           	ld (hl), a
5242  1579              ; 295                     de++;
5243  1579 13           	inc de
5244  157A              ; 296                     hl++;
5245  157A 23           	inc hl
5246  157B              ; 297                     b--;
5247  157B 05           	dec b
5248  157C              l_362:
5249  157C C2 70 15     	jp nz, l_361
5250  157F C1           	pop bc
5251  1580 D1           	pop de
5252  1581 E1           	pop hl
5253  1582 C9           	ret
5254  1583              ; 298                 } while (flag_nz);
5255  1583              ; 299             }
5256  1583              ; 300         }
5257  1583              ; 301     }
5258  1583              ; 302 }
5259  1583              ; 303
5260  1583              ; 304 /// Отправить FTP URL
5261  1583              ; 305 void setFTPUrl() {
5262  1583              setftpurl:
5263  1583              ; 306     push_pop(hl) {
5264  1583 E5           	push hl
5265  1584              ; 307         push_pop(de) {
5266  1584 D5           	push de
5267  1585              ; 308             push_pop(bc) {
5268  1585 C5           	push bc
5269  1586              ; 309                 de = ftpSettingsIpValue;
5270  1586 11 5E 0D     	ld de, ftpsettingsipvalue
5271  1589              ; 310                 hl = ESP_I2S_BUFFER;
5272  1589 21 8B 13     	ld hl, esp_i2s_buffer
5273  158C              ; 311                 b = 16;
5274  158C 06 10        	ld b, 16
5275  158E              ; 312                 c = 0;
5276  158E 0E 00        	ld c, 0
5277  1590              ; 313                 do {
5278  1590              l_366:
5279  1590              ; 314                     a = *de;
5280  1590 1A           	ld a, (de)
5281  1591              ; 315                     if ((a = c) == 1) {
5282  1591 79           	ld a, c
5283  1592 FE 01        	cp 1
5284  1594 C2 9C 15     	jp nz, l_369
5285  1597              ; 316                         a = 0xFF;
5286  1597 3E FF        	ld a, 255
5287  1599 C3 A5 15     	jp l_370
5288  159C              l_369:
5289  159C              ; 317                     } else if((a = *de) == 0) {
5290  159C 1A           	ld a, (de)
5291  159D B7           	or a
5292  159E C2 A5 15     	jp nz, l_371
5293  15A1              ; 318                         c = 1;
5294  15A1 0E 01        	ld c, 1
5295  15A3              ; 319                         a = 0x00;
5296  15A3 3E 00        	ld a, 0
5297  15A5              l_371:
5298  15A5              l_370:
5299  15A5              ; 320                     }
5300  15A5              ; 321                     *hl = a;
5301  15A5 77           	ld (hl), a
5302  15A6              ; 322                     de++;
5303  15A6 13           	inc de
5304  15A7              ; 323                     hl++;
5305  15A7 23           	inc hl
5306  15A8              ; 324                     b--;
5307  15A8 05           	dec b
5308  15A9              l_367:
5309  15A9 C2 90 15     	jp nz, l_366
5310  15AC              ; 325                 } while (flag_nz);
5311  15AC              ; 326
5312  15AC              ; 327                 delay5msI2C();
5313  15AC CD F1 12     	call delay5msi2c
5314  15AF              ; 328                 i2cWaitingForAccess();
5315  15AF CD DE 12     	call i2cwaitingforaccess
5316  15B2              ; 329                 l = 3;
5317  15B2 2E 03        	ld l, 3
5318  15B4              ; 330                 h = 16;
5319  15B4 26 10        	ld h, 16
5320  15B6              ; 331                 sendCommand();
5321  15B6 CD 25 13     	call sendcommand
5322  15B9 C1           	pop bc
5323  15BA D1           	pop de
5324  15BB E1           	pop hl
5325  15BC C9           	ret
5326  15BD              ; 332             }
5327  15BD              ; 333         }
5328  15BD              ; 334     }
5329  15BD              ; 335 }
5330  15BD              ; 336
5331  15BD              ; 337 /// Получить FTP User
5332  15BD              ; 338 void getFTPUser() {
5333  15BD              getftpuser:
5334  15BD              ; 339     push_pop(hl) {
5335  15BD E5           	push hl
5336  15BE              ; 340         push_pop(de) {
5337  15BE D5           	push de
5338  15BF              ; 341             push_pop(bc) {
5339  15BF C5           	push bc
5340  15C0              ; 342                 delay5msI2C();
5341  15C0 CD F1 12     	call delay5msi2c
5342  15C3              ; 343                 i2cWaitingForAccess();
5343  15C3 CD DE 12     	call i2cwaitingforaccess
5344  15C6              ; 344                 l = 18;
5345  15C6 2E 12        	ld l, 18
5346  15C8              ; 345                 h = 0;
5347  15C8 26 00        	ld h, 0
5348  15CA              ; 346                 sendCommand();
5349  15CA CD 25 13     	call sendcommand
5350  15CD              ; 347                 //
5351  15CD              ; 348                 delay5msI2C();
5352  15CD CD F1 12     	call delay5msi2c
5353  15D0              ; 349                 i2cWaitingForAccess();
5354  15D0 CD DE 12     	call i2cwaitingforaccess
5355  15D3              ; 350                 l = 26;
5356  15D3 2E 1A        	ld l, 26
5357  15D5              ; 351                 readNewInBuffer();
5358  15D5 CD 50 13     	call readnewinbuffer
5359  15D8              ; 352                 //
5360  15D8              ; 353                 de = ESP_I2S_BUFFER;
5361  15D8 11 8B 13     	ld de, esp_i2s_buffer
5362  15DB              ; 354                 hl = ftpSettingsUserValue;
5363  15DB 21 A0 0D     	ld hl, ftpsettingsuservalue
5364  15DE              ; 355                 b = 16;
5365  15DE 06 10        	ld b, 16
5366  15E0              ; 356                 do {
5367  15E0              l_373:
5368  15E0              ; 357                     a = *de;
5369  15E0 1A           	ld a, (de)
5370  15E1              ; 358                     if(a==0xFF){
5371  15E1 FE FF        	cp 255
5372  15E3 C2 E8 15     	jp nz, l_376
5373  15E6              ; 359                         a = 0x00;
5374  15E6 3E 00        	ld a, 0
5375  15E8              l_376:
5376  15E8              ; 360                     }
5377  15E8              ; 361                     *hl = a;
5378  15E8 77           	ld (hl), a
5379  15E9              ; 362                     de++;
5380  15E9 13           	inc de
5381  15EA              ; 363                     hl++;
5382  15EA 23           	inc hl
5383  15EB              ; 364                     b--;
5384  15EB 05           	dec b
5385  15EC              l_374:
5386  15EC C2 E0 15     	jp nz, l_373
5387  15EF C1           	pop bc
5388  15F0 D1           	pop de
5389  15F1 E1           	pop hl
5390  15F2 C9           	ret
5391  15F3              ; 365                 } while (flag_nz);
5392  15F3              ; 366             }
5393  15F3              ; 367         }
5394  15F3              ; 368     }
5395  15F3              ; 369 }
5396  15F3              ; 370
5397  15F3              ; 371 /// Отправить FTP User
5398  15F3              ; 372 void setFTPUser() {
5399  15F3              setftpuser:
5400  15F3              ; 373     push_pop(hl) {
5401  15F3 E5           	push hl
5402  15F4              ; 374         push_pop(de) {
5403  15F4 D5           	push de
5404  15F5              ; 375             push_pop(bc) {
5405  15F5 C5           	push bc
5406  15F6              ; 376                 de = ftpSettingsUserValue;
5407  15F6 11 A0 0D     	ld de, ftpsettingsuservalue
5408  15F9              ; 377                 hl = ESP_I2S_BUFFER;
5409  15F9 21 8B 13     	ld hl, esp_i2s_buffer
5410  15FC              ; 378                 b = 16;
5411  15FC 06 10        	ld b, 16
5412  15FE              ; 379                 c = 0;
5413  15FE 0E 00        	ld c, 0
5414  1600              ; 380                 do {
5415  1600              l_378:
5416  1600              ; 381                     a = *de;
5417  1600 1A           	ld a, (de)
5418  1601              ; 382                     if ((a = c) == 1) {
5419  1601 79           	ld a, c
5420  1602 FE 01        	cp 1
5421  1604 C2 0C 16     	jp nz, l_381
5422  1607              ; 383                         a = 0xFF;
5423  1607 3E FF        	ld a, 255
5424  1609 C3 15 16     	jp l_382
5425  160C              l_381:
5426  160C              ; 384                     } else if((a = *de) == 0) {
5427  160C 1A           	ld a, (de)
5428  160D B7           	or a
5429  160E C2 15 16     	jp nz, l_383
5430  1611              ; 385                         c = 1;
5431  1611 0E 01        	ld c, 1
5432  1613              ; 386                         a = 0x00;
5433  1613 3E 00        	ld a, 0
5434  1615              l_383:
5435  1615              l_382:
5436  1615              ; 387                     }
5437  1615              ; 388                     *hl = a;
5438  1615 77           	ld (hl), a
5439  1616              ; 389                     de++;
5440  1616 13           	inc de
5441  1617              ; 390                     hl++;
5442  1617 23           	inc hl
5443  1618              ; 391                     b--;
5444  1618 05           	dec b
5445  1619              l_379:
5446  1619 C2 00 16     	jp nz, l_378
5447  161C              ; 392                 } while (flag_nz);
5448  161C              ; 393
5449  161C              ; 394                 delay5msI2C();
5450  161C CD F1 12     	call delay5msi2c
5451  161F              ; 395                 i2cWaitingForAccess();
5452  161F CD DE 12     	call i2cwaitingforaccess
5453  1622              ; 396                 l = 19;
5454  1622 2E 13        	ld l, 19
5455  1624              ; 397                 h = 16;
5456  1624 26 10        	ld h, 16
5457  1626              ; 398                 sendCommand();
5458  1626 CD 25 13     	call sendcommand
5459  1629 C1           	pop bc
5460  162A D1           	pop de
5461  162B E1           	pop hl
5462  162C C9           	ret
5463  162D              ; 399             }
5464  162D              ; 400         }
5465  162D              ; 401     }
5466  162D              ; 402 }
5467  162D              ; 403
5468  162D              ; 404 /// Получить FTP Password
5469  162D              ; 405 void getFTPPassword() {
5470  162D              getftppassword:
5471  162D              ; 406     push_pop(hl) {
5472  162D E5           	push hl
5473  162E              ; 407         push_pop(de) {
5474  162E D5           	push de
5475  162F              ; 408             push_pop(bc) {
5476  162F C5           	push bc
5477  1630              ; 409                 delay5msI2C();
5478  1630 CD F1 12     	call delay5msi2c
5479  1633              ; 410                 i2cWaitingForAccess();
5480  1633 CD DE 12     	call i2cwaitingforaccess
5481  1636              ; 411                 l = 20;
5482  1636 2E 14        	ld l, 20
5483  1638              ; 412                 h = 0;
5484  1638 26 00        	ld h, 0
5485  163A              ; 413                 sendCommand();
5486  163A CD 25 13     	call sendcommand
5487  163D              ; 414                 //
5488  163D              ; 415                 delay5msI2C();
5489  163D CD F1 12     	call delay5msi2c
5490  1640              ; 416                 i2cWaitingForAccess();
5491  1640 CD DE 12     	call i2cwaitingforaccess
5492  1643              ; 417                 l = 26;
5493  1643 2E 1A        	ld l, 26
5494  1645              ; 418                 readNewInBuffer();
5495  1645 CD 50 13     	call readnewinbuffer
5496  1648              ; 419                 //
5497  1648              ; 420                 de = ESP_I2S_BUFFER;
5498  1648 11 8B 13     	ld de, esp_i2s_buffer
5499  164B              ; 421                 hl = ftpSettingsEditViewPasswordVal;
5500  164B 21 09 10     	ld hl, ftpsettingseditviewpasswordval
5501  164E              ; 422                 b = 16;
5502  164E 06 10        	ld b, 16
5503  1650              ; 423                 do {
5504  1650              l_385:
5505  1650              ; 424                     a = *de;
5506  1650 1A           	ld a, (de)
5507  1651              ; 425                     if(a==0xFF){
5508  1651 FE FF        	cp 255
5509  1653 C2 58 16     	jp nz, l_388
5510  1656              ; 426                         a = 0x00;
5511  1656 3E 00        	ld a, 0
5512  1658              l_388:
5513  1658              ; 427                     }
5514  1658              ; 428                     *hl = a;
5515  1658 77           	ld (hl), a
5516  1659              ; 429                     de++;
5517  1659 13           	inc de
5518  165A              ; 430                     hl++;
5519  165A 23           	inc hl
5520  165B              ; 431                     b--;
5521  165B 05           	dec b
5522  165C              l_386:
5523  165C C2 50 16     	jp nz, l_385
5524  165F C1           	pop bc
5525  1660 D1           	pop de
5526  1661 E1           	pop hl
5527  1662 C9           	ret
5528  1663              ; 432                 } while (flag_nz);
5529  1663              ; 433             }
5530  1663              ; 434         }
5531  1663              ; 435     }
5532  1663              ; 436 }
5533  1663              ; 437
5534  1663              ; 438 /// Отправить FTP Password
5535  1663              ; 439 void setFTPPassword() {
5536  1663              setftppassword:
5537  1663              ; 440     push_pop(hl) {
5538  1663 E5           	push hl
5539  1664              ; 441         push_pop(de) {
5540  1664 D5           	push de
5541  1665              ; 442             push_pop(bc) {
5542  1665 C5           	push bc
5543  1666              ; 443                 de = ftpSettingsEditViewPasswordVal;
5544  1666 11 09 10     	ld de, ftpsettingseditviewpasswordval
5545  1669              ; 444                 hl = ESP_I2S_BUFFER;
5546  1669 21 8B 13     	ld hl, esp_i2s_buffer
5547  166C              ; 445                 b = 16;
5548  166C 06 10        	ld b, 16
5549  166E              ; 446                 c = 0;
5550  166E 0E 00        	ld c, 0
5551  1670              ; 447                 do {
5552  1670              l_390:
5553  1670              ; 448                     a = *de;
5554  1670 1A           	ld a, (de)
5555  1671              ; 449                     if ((a = c) == 1) {
5556  1671 79           	ld a, c
5557  1672 FE 01        	cp 1
5558  1674 C2 7C 16     	jp nz, l_393
5559  1677              ; 450                         a = 0xFF;
5560  1677 3E FF        	ld a, 255
5561  1679 C3 85 16     	jp l_394
5562  167C              l_393:
5563  167C              ; 451                     } else if((a = *de) == 0) {
5564  167C 1A           	ld a, (de)
5565  167D B7           	or a
5566  167E C2 85 16     	jp nz, l_395
5567  1681              ; 452                         c = 1;
5568  1681 0E 01        	ld c, 1
5569  1683              ; 453                         a = 0x00;
5570  1683 3E 00        	ld a, 0
5571  1685              l_395:
5572  1685              l_394:
5573  1685              ; 454                     }
5574  1685              ; 455                     *hl = a;
5575  1685 77           	ld (hl), a
5576  1686              ; 456                     de++;
5577  1686 13           	inc de
5578  1687              ; 457                     hl++;
5579  1687 23           	inc hl
5580  1688              ; 458                     b--;
5581  1688 05           	dec b
5582  1689              l_391:
5583  1689 C2 70 16     	jp nz, l_390
5584  168C              ; 459                 } while (flag_nz);
5585  168C              ; 460
5586  168C              ; 461                 delay5msI2C();
5587  168C CD F1 12     	call delay5msi2c
5588  168F              ; 462                 i2cWaitingForAccess();
5589  168F CD DE 12     	call i2cwaitingforaccess
5590  1692              ; 463                 l = 21;
5591  1692 2E 15        	ld l, 21
5592  1694              ; 464                 h = 16;
5593  1694 26 10        	ld h, 16
5594  1696              ; 465                 sendCommand();
5595  1696 CD 25 13     	call sendcommand
5596  1699 C1           	pop bc
5597  169A D1           	pop de
5598  169B E1           	pop hl
5599  169C C9           	ret
5600  169D              ; 466             }
5601  169D              ; 467         }
5602  169D              ; 468     }
5603  169D              ; 469 }
5604  169D              ; 470
5605  169D              ; 471 /// Получить FTP Port
5606  169D              ; 472 void getFTPPort() {
5607  169D              getftpport:
5608  169D              ; 473     push_pop(hl) {
5609  169D E5           	push hl
5610  169E              ; 474         push_pop(de) {
5611  169E D5           	push de
5612  169F              ; 475             push_pop(bc) {
5613  169F C5           	push bc
5614  16A0              ; 476                 delay5msI2C();
5615  16A0 CD F1 12     	call delay5msi2c
5616  16A3              ; 477                 i2cWaitingForAccess();
5617  16A3 CD DE 12     	call i2cwaitingforaccess
5618  16A6              ; 478                 l = 16;
5619  16A6 2E 10        	ld l, 16
5620  16A8              ; 479                 h = 0;
5621  16A8 26 00        	ld h, 0
5622  16AA              ; 480                 sendCommand();
5623  16AA CD 25 13     	call sendcommand
5624  16AD              ; 481                 //
5625  16AD              ; 482                 delay5msI2C();
5626  16AD CD F1 12     	call delay5msi2c
5627  16B0              ; 483                 i2cWaitingForAccess();
5628  16B0 CD DE 12     	call i2cwaitingforaccess
5629  16B3              ; 484                 l = 10;
5630  16B3 2E 0A        	ld l, 10
5631  16B5              ; 485                 readNewInBuffer();
5632  16B5 CD 50 13     	call readnewinbuffer
5633  16B8              ; 486                 //
5634  16B8              ; 487                 de = ESP_I2S_BUFFER;
5635  16B8 11 8B 13     	ld de, esp_i2s_buffer
5636  16BB              ; 488                 hl = ftpSettingsPortValue;
5637  16BB 21 70 0D     	ld hl, ftpsettingsportvalue
5638  16BE              ; 489                 b = 6;
5639  16BE 06 06        	ld b, 6
5640  16C0              ; 490                 do {
5641  16C0              l_397:
5642  16C0              ; 491                     a = *de;
5643  16C0 1A           	ld a, (de)
5644  16C1              ; 492                     if(a==0xFF){
5645  16C1 FE FF        	cp 255
5646  16C3 C2 C8 16     	jp nz, l_400
5647  16C6              ; 493                         a = 0x00;
5648  16C6 3E 00        	ld a, 0
5649  16C8              l_400:
5650  16C8              ; 494                     }
5651  16C8              ; 495                     *hl = a;
5652  16C8 77           	ld (hl), a
5653  16C9              ; 496                     de++;
5654  16C9 13           	inc de
5655  16CA              ; 497                     hl++;
5656  16CA 23           	inc hl
5657  16CB              ; 498                     b--;
5658  16CB 05           	dec b
5659  16CC              l_398:
5660  16CC C2 C0 16     	jp nz, l_397
5661  16CF C1           	pop bc
5662  16D0 D1           	pop de
5663  16D1 E1           	pop hl
5664  16D2 C9           	ret
5665  16D3              ; 499                 } while (flag_nz);
5666  16D3              ; 500             }
5667  16D3              ; 501         }
5668  16D3              ; 502     }
5669  16D3              ; 503 }
5670  16D3              ; 504
5671  16D3              ; 505 /// Отправить FTP Port
5672  16D3              ; 506 void setFTPPort() {
5673  16D3              setftpport:
5674  16D3              ; 507     push_pop(hl) {
5675  16D3 E5           	push hl
5676  16D4              ; 508         push_pop(de) {
5677  16D4 D5           	push de
5678  16D5              ; 509             push_pop(bc) {
5679  16D5 C5           	push bc
5680  16D6              ; 510                 de = ftpSettingsPortValue;
5681  16D6 11 70 0D     	ld de, ftpsettingsportvalue
5682  16D9              ; 511                 hl = ESP_I2S_BUFFER;
5683  16D9 21 8B 13     	ld hl, esp_i2s_buffer
5684  16DC              ; 512                 b = 6;
5685  16DC 06 06        	ld b, 6
5686  16DE              ; 513                 c = 0;
5687  16DE 0E 00        	ld c, 0
5688  16E0              ; 514                 do {
5689  16E0              l_402:
5690  16E0              ; 515                     a = *de;
5691  16E0 1A           	ld a, (de)
5692  16E1              ; 516                     if ((a = c) == 1) {
5693  16E1 79           	ld a, c
5694  16E2 FE 01        	cp 1
5695  16E4 C2 EC 16     	jp nz, l_405
5696  16E7              ; 517                         a = 0xFF;
5697  16E7 3E FF        	ld a, 255
5698  16E9 C3 F5 16     	jp l_406
5699  16EC              l_405:
5700  16EC              ; 518                     } else if((a = *de) == 0) {
5701  16EC 1A           	ld a, (de)
5702  16ED B7           	or a
5703  16EE C2 F5 16     	jp nz, l_407
5704  16F1              ; 519                         c = 1;
5705  16F1 0E 01        	ld c, 1
5706  16F3              ; 520                         a = 0x00;
5707  16F3 3E 00        	ld a, 0
5708  16F5              l_407:
5709  16F5              l_406:
5710  16F5              ; 521                     }
5711  16F5              ; 522                     *hl = a;
5712  16F5 77           	ld (hl), a
5713  16F6              ; 523                     de++;
5714  16F6 13           	inc de
5715  16F7              ; 524                     hl++;
5716  16F7 23           	inc hl
5717  16F8              ; 525                     b--;
5718  16F8 05           	dec b
5719  16F9              l_403:
5720  16F9 C2 E0 16     	jp nz, l_402
5721  16FC              ; 526                 } while (flag_nz);
5722  16FC              ; 527
5723  16FC              ; 528                 delay5msI2C();
5724  16FC CD F1 12     	call delay5msi2c
5725  16FF              ; 529                 i2cWaitingForAccess();
5726  16FF CD DE 12     	call i2cwaitingforaccess
5727  1702              ; 530                 l = 17;
5728  1702 2E 11        	ld l, 17
5729  1704              ; 531                 h = 6;
5730  1704 26 06        	ld h, 6
5731  1706              ; 532                 sendCommand();
5732  1706 CD 25 13     	call sendcommand
5733  1709 C1           	pop bc
5734  170A D1           	pop de
5735  170B E1           	pop hl
5736  170C C9           	ret
5737  170D              ; 533             }
5738  170D              ; 534         }
5739  170D              ; 535     }
5740  170D              ; 536 }
5741  170D              ; 537
5742  170D              ; 538 /// Подключиться в FTP
5743  170D              ; 539 void needFtpConnect() {
5744  170D              needftpconnect:
5745  170D              ; 540     push_pop(hl) {
5746  170D E5           	push hl
5747  170E              ; 541         delay5msI2C();
5748  170E CD F1 12     	call delay5msi2c
5749  1711              ; 542         i2cWaitingForAccess();
5750  1711 CD DE 12     	call i2cwaitingforaccess
5751  1714              ; 543         l = 23;
5752  1714 2E 17        	ld l, 23
5753  1716              ; 544         h = 0;
5754  1716 26 00        	ld h, 0
5755  1718              ; 545         sendCommand();
5756  1718 CD 25 13     	call sendcommand
5757  171B E1           	pop hl
5758  171C C9           	ret
5759  171D              ; 546     }
5760  171D              ; 547 }
5761  171D              ; 548
5762  171D              ; 549 /// Получить статус FTP
5763  171D              ; 550 void getFtpState() {
5764  171D              getftpstate:
5765  171D              ; 551     push_pop(hl) {
5766  171D E5           	push hl
5767  171E              ; 552         push_pop(de) {
5768  171E D5           	push de
5769  171F              ; 553             push_pop(bc) {
5770  171F C5           	push bc
5771  1720              ; 554                 delay5msI2C();
5772  1720 CD F1 12     	call delay5msi2c
5773  1723              ; 555                 i2cWaitingForAccess();
5774  1723 CD DE 12     	call i2cwaitingforaccess
5775  1726              ; 556                 l = 24;
5776  1726 2E 18        	ld l, 24
5777  1728              ; 557                 h = 0;
5778  1728 26 00        	ld h, 0
5779  172A              ; 558                 sendCommand();
5780  172A CD 25 13     	call sendcommand
5781  172D              ; 559                 //
5782  172D              ; 560                 delay5msI2C();
5783  172D CD F1 12     	call delay5msi2c
5784  1730              ; 561                 i2cWaitingForAccess();
5785  1730 CD DE 12     	call i2cwaitingforaccess
5786  1733              ; 562                 l = 4;
5787  1733 2E 04        	ld l, 4
5788  1735              ; 563                 readNewInBuffer();
5789  1735 CD 50 13     	call readnewinbuffer
5790  1738              ; 564                 //
5791  1738              ; 565                 a = ftpSettingsStateVal;
5792  1738 3A 84 0D     	ld a, (ftpsettingsstateval)
5793  173B              ; 566                 h = a;
5794  173B 67           	ld h, a
5795  173C              ; 567                 de = ESP_I2S_BUFFER;
5796  173C 11 8B 13     	ld de, esp_i2s_buffer
5797  173F              ; 568                 a = *de;
5798  173F 1A           	ld a, (de)
5799  1740              ; 569                 a &= 0x01;
5800  1740 E6 01        	and 1
5801  1742              ; 570                 ftpSettingsStateVal = a;
5802  1742 32 84 0D     	ld (ftpsettingsstateval), a
5803  1745              ; 571                 if(a != h){
5804  1745 BC           	cp h
5805  1746 CA 4E 17     	jp z, l_409
5806  1749              ; 572                     a = 0x01;
5807  1749 3E 01        	ld a, 1
5808  174B              ; 573                     ftpSettingsStateChange = a;
5809  174B 32 85 0D     	ld (ftpsettingsstatechange), a
5810  174E              l_409:
5811  174E C1           	pop bc
5812  174F D1           	pop de
5813  1750 E1           	pop hl
5814  1751 C9           	ret
5815  1752              ; 574                 }
5816  1752              ; 575             }
5817  1752              ; 576         }
5818  1752              ; 577     }
5819  1752              ; 578 }
5820  1752              ; 579
5821  1752              ; 580 /// обновить сисок FTP файлов
5822  1752              ; 581 void updateFtpList() {
5823  1752              updateftplist:
5824  1752              ; 582     push_pop(hl) {
5825  1752 E5           	push hl
5826  1753              ; 583         a = 0;
5827  1753 3E 00        	ld a, 0
5828  1755              ; 584         ftpDirListCount = a;
5829  1755 32 64 0F     	ld (ftpdirlistcount), a
5830  1758              ; 585         delay5msI2C();
5831  1758 CD F1 12     	call delay5msi2c
5832  175B              ; 586         i2cWaitingForAccess();
5833  175B CD DE 12     	call i2cwaitingforaccess
5834  175E              ; 587         l = 25;
5835  175E 2E 19        	ld l, 25
5836  1760              ; 588         h = 0;
5837  1760 26 00        	ld h, 0
5838  1762              ; 589         sendCommand();
5839  1762 CD 25 13     	call sendcommand
5840  1765              ; 590
5841  1765              ; 591         delay5msI2C();
5842  1765 CD F1 12     	call delay5msi2c
5843  1768              ; 592         i2cWaitingForAccess();
5844  1768 CD DE 12     	call i2cwaitingforaccess
5845  176B              ; 593         busRecoveryI2C();
5846  176B CD FD 12     	call busrecoveryi2c
5847  176E E1           	pop hl
5848  176F C9           	ret
5849  1770              ; 594     }
5850  1770              ; 595 }
5851  1770              ; 596
5852  1770              ; 597 void convert4bitToCharA() {
5853  1770              convert4bittochara:
5854  1770              ; 598     if (a < 10) {
5855  1770 FE 0A        	cp 10
5856  1772 D2 7A 17     	jp nc, l_411
5857  1775              ; 599         a += 0x30;
5858  1775 C6 30        	add 48
5859  1777 C3 7C 17     	jp l_412
5860  177A              l_411:
5861  177A              ; 600     } else {
5862  177A              ; 601         a += 0x37;
5863  177A C6 37        	add 55
5864  177C              l_412:
5865  177C C9           	ret
5866  177D              ; 602     }
5867  177D              ; 603 }
5868  177D              ; 604
5869  177D              ; 605 /// Получаем список файлов и директорий в текущей папке
5870  177D              ; 606 void getFtpList() {
5871  177D              getftplist:
5872  177D              ; 607     // Получить ответ
5873  177D              ; 608     // Ответ ESP_I2S_BUFFER
5874  177D              ; 609     // ftpDirList буфер заполнения
5875  177D              ; 610     a = 0;
5876  177D 3E 00        	ld a, 0
5877  177F              ; 611     parseFtpListBufferIsCheck = a;
5878  177F 32 47 1F     	ld (parseftplistbufferischeck), a
5879  1782              ; 612     do {
5880  1782              l_413:
5881  1782              ; 613         push_pop(hl) {
5882  1782 E5           	push hl
5883  1783              ; 614             if ((a = parseFtpListBufferIsCheck) == 1) {
5884  1783 3A 47 1F     	ld a, (parseftplistbufferischeck)
5885  1786 FE 01        	cp 1
5886  1788 C2 98 17     	jp nz, l_416
5887  178B              ; 615                 delay5msI2C();
5888  178B CD F1 12     	call delay5msi2c
5889  178E              ; 616                 i2cWaitingForAccess();
5890  178E CD DE 12     	call i2cwaitingforaccess
5891  1791              ; 617                 l = 35; //GET_FTP_LIST_NEXT, // 35
5892  1791 2E 23        	ld l, 35
5893  1793              ; 618                 h = 0;
5894  1793 26 00        	ld h, 0
5895  1795              ; 619                 sendCommand();
5896  1795 CD 25 13     	call sendcommand
5897  1798              l_416:
5898  1798              ; 620             }
5899  1798              ; 621
5900  1798              ; 622             delay5msI2C();
5901  1798 CD F1 12     	call delay5msi2c
5902  179B              ; 623             i2cWaitingForAccess();
5903  179B CD DE 12     	call i2cwaitingforaccess
5904  179E              ; 624             l = 26; //GET_FTP_LIST
5905  179E 2E 1A        	ld l, 26
5906  17A0              ; 625             h = 0;
5907  17A0 26 00        	ld h, 0
5908  17A2              ; 626             sendCommand();
5909  17A2 CD 25 13     	call sendcommand
5910  17A5              ; 627             //
5911  17A5              ; 628             delay5msI2C();
5912  17A5 CD F1 12     	call delay5msi2c
5913  17A8              ; 629             i2cWaitingForAccess();
5914  17A8 CD DE 12     	call i2cwaitingforaccess
5915  17AB              ; 630             l = 15;
5916  17AB 2E 0F        	ld l, 15
5917  17AD              ; 631             readNewInBuffer();
5918  17AD CD 50 13     	call readnewinbuffer
5919  17B0              ; 632
5920  17B0              ; 633             parseFtpListBuffer();
5921  17B0 CD 54 1D     	call parseftplistbuffer
5922  17B3 E1           	pop hl
5923  17B4              l_414:
5924  17B4              ; 634         }
5925  17B4              ; 635     } while ((a = ftpDirListNext) != 0x5A);
5926  17B4 3A 63 0F     	ld a, (ftpdirlistnext)
5927  17B7 FE 5A        	cp 90
5928  17B9 C2 82 17     	jp nz, l_413
5929  17BC              ; 636     a = ftpDirListCount;
5930  17BC 3A 64 0F     	ld a, (ftpdirlistcount)
5931  17BF              ; 637     a++;
5932  17BF 3C           	inc a
5933  17C0              ; 638     ftpDirListCount = a;
5934  17C0 32 64 0F     	ld (ftpdirlistcount), a
5935  17C3 C9           	ret
5936  17C4              ; 639 }
5937  17C4              ; 640
5938  17C4              ; 641 /// Получаем список файлов и директорий в текущей папке
5939  17C4              ; 642 void getFtpListOld() {
5940  17C4              getftplistold:
5941  17C4              ; 643     // Получить ответ
5942  17C4              ; 644     // Ответ ESP_I2S_BUFFER
5943  17C4              ; 645     // ftpDirList буфер заполнения
5944  17C4              ; 646     push_pop(bc) {
5945  17C4 C5           	push bc
5946  17C5              ; 647         do {
5947  17C5              l_418:
5948  17C5              ; 648             //
5949  17C5              ; 649             delay5msI2C();
5950  17C5 CD F1 12     	call delay5msi2c
5951  17C8              ; 650             i2cWaitingForAccess();
5952  17C8 CD DE 12     	call i2cwaitingforaccess
5953  17CB              ; 651             l = 26; //GET_FTP_LIST
5954  17CB 2E 1A        	ld l, 26
5955  17CD              ; 652             h = 0;
5956  17CD 26 00        	ld h, 0
5957  17CF              ; 653             sendCommand();
5958  17CF CD 25 13     	call sendcommand
5959  17D2              ; 654             //
5960  17D2              ; 655             delay5msI2C();
5961  17D2 CD F1 12     	call delay5msi2c
5962  17D5              ; 656             i2cWaitingForAccess();
5963  17D5 CD DE 12     	call i2cwaitingforaccess
5964  17D8              ; 657             l = 15;
5965  17D8 2E 0F        	ld l, 15
5966  17DA              ; 658             readNewInBuffer();
5967  17DA CD 50 13     	call readnewinbuffer
5968  17DD              ; 659
5969  17DD              ; 660
5970  17DD              ; 661             push_pop(a) {
5971  17DD F5           	push af
5972  17DE              ; 662                 push_pop(de) {
5973  17DE D5           	push de
5974  17DF              ; 663                     push_pop(hl) {
5975  17DF E5           	push hl
5976  17E0              ; 664                         parceBufferToFile();
5977  17E0 CD 35 1A     	call parcebuffertofile
5978  17E3 E1           	pop hl
5979  17E4 D1           	pop de
5980  17E5 F1           	pop af
5981  17E6              l_419:
5982  17E6              ; 665                     }
5983  17E6              ; 666                 }
5984  17E6              ; 667             }
5985  17E6              ; 668         } while ((a = ftpDirListNext) != 0x5A); // == 1
5986  17E6 3A 63 0F     	ld a, (ftpdirlistnext)
5987  17E9 FE 5A        	cp 90
5988  17EB C2 C5 17     	jp nz, l_418
5989  17EE              ; 669
5990  17EE              ; 670         delay5msI2C();
5991  17EE CD F1 12     	call delay5msi2c
5992  17F1              ; 671         i2cWaitingForAccess();
5993  17F1 CD DE 12     	call i2cwaitingforaccess
5994  17F4              ; 672         busRecoveryI2C();
5995  17F4 CD FD 12     	call busrecoveryi2c
5996  17F7 C1           	pop bc
5997  17F8 C9           	ret
5998  17F9              ; 673     }
5999  17F9              ; 674 }
6000  17F9              ; 675
6001  17F9              ; 676 /// Указать какой файл скачивать
6002  17F9              ; 677 void ftpFileDownload() {
6003  17F9              ftpfiledownload:
6004  17F9              ; 678     push_pop(de) {
6005  17F9 D5           	push de
6006  17FA              ; 679         push_pop(hl) {
6007  17FA E5           	push hl
6008  17FB              ; 680             de = ESP_I2S_BUFFER;
6009  17FB 11 8B 13     	ld de, esp_i2s_buffer
6010  17FE              ; 681             a = ftpViewCurrentPos;
6011  17FE 3A 66 0F     	ld a, (ftpviewcurrentpos)
6012  1801              ; 682             *de = a;
6013  1801 12           	ld (de), a
6014  1802              ; 683             //
6015  1802              ; 684             delay5msI2C();
6016  1802 CD F1 12     	call delay5msi2c
6017  1805              ; 685             i2cWaitingForAccess();
6018  1805 CD DE 12     	call i2cwaitingforaccess
6019  1808              ; 686             //
6020  1808              ; 687             l = 28; // FILE_DOWNLOAD
6021  1808 2E 1C        	ld l, 28
6022  180A              ; 688             h = 1; // 1 байт
6023  180A 26 01        	ld h, 1
6024  180C              ; 689             sendCommand();
6025  180C CD 25 13     	call sendcommand
6026  180F E1           	pop hl
6027  1810 D1           	pop de
6028  1811 C9           	ret
6029  1812              ; 690         }
6030  1812              ; 691     }
6031  1812              ; 692 }
6032  1812              ; 693
6033  1812              ; 694 /// Скачать указанный файл
6034  1812              ; 695 void ftpFileDownloadNext() {
6035  1812              ftpfiledownloadnext:
6036  1812              ; 696     push_pop(hl) {
6037  1812 E5           	push hl
6038  1813              ; 697         a = 0x01;
6039  1813 3E 01        	ld a, 1
6040  1815              ; 698         ftpFileLoadViewCheckSumState = a;
6041  1815 32 DE 1C     	ld (ftpfileloadviewchecksumstate), a
6042  1818              ; 699         do {
6043  1818              l_421:
6044  1818              ; 700             // Если контрольная сумма верна просим следующий буфер
6045  1818              ; 701             if ((a = ftpFileLoadViewCheckSumState) == 0x01) {
6046  1818 3A DE 1C     	ld a, (ftpfileloadviewchecksumstate)
6047  181B FE 01        	cp 1
6048  181D C2 2D 18     	jp nz, l_424
6049  1820              ; 702                 delay5msI2C();
6050  1820 CD F1 12     	call delay5msi2c
6051  1823              ; 703                 i2cWaitingForAccess();
6052  1823 CD DE 12     	call i2cwaitingforaccess
6053  1826              ; 704                 l = 29;
6054  1826 2E 1D        	ld l, 29
6055  1828              ; 705                 h = 0;
6056  1828 26 00        	ld h, 0
6057  182A              ; 706                 sendCommand();
6058  182A CD 25 13     	call sendcommand
6059  182D              l_424:
6060  182D              ; 707             }
6061  182D              ; 708
6062  182D              ; 709             // Получить буфер
6063  182D              ; 710             delay5msI2C();
6064  182D CD F1 12     	call delay5msi2c
6065  1830              ; 711             i2cWaitingForAccess();
6066  1830 CD DE 12     	call i2cwaitingforaccess
6067  1833              ; 712             l = 30;
6068  1833 2E 1E        	ld l, 30
6069  1835              ; 713             h = 0;
6070  1835 26 00        	ld h, 0
6071  1837              ; 714             sendCommand();
6072  1837 CD 25 13     	call sendcommand
6073  183A              ; 715             //
6074  183A              ; 716             delay5msI2C();
6075  183A CD F1 12     	call delay5msi2c
6076  183D              ; 717             i2cWaitingForAccess();
6077  183D CD DE 12     	call i2cwaitingforaccess
6078  1840              ; 718             l = 15;
6079  1840 2E 0F        	ld l, 15
6080  1842              ; 719             readNewInBuffer();
6081  1842 CD 50 13     	call readnewinbuffer
6082  1845              ; 720
6083  1845              ; 721             // Распарсить буфер и пррверить контрольную сумму
6084  1845              ; 722             //ftpFileLoadViewParce(); Старая реализация
6085  1845              ; 723             ftpFileDownloadParse();
6086  1845 CD 51 1E     	call ftpfiledownloadparse
6087  1848              ; 724
6088  1848              ; 725             updateProgress();
6089  1848 CD FE 1B     	call updateprogress
6090  184B              l_422:
6091  184B              ; 726         } while ((a = ftpFileLoadViewIsNextData) != 0x5A);
6092  184B 3A DA 1C     	ld a, (ftpfileloadviewisnextdata)
6093  184E FE 5A        	cp 90
6094  1850 C2 18 18     	jp nz, l_421
6095  1853 E1           	pop hl
6096  1854 C9           	ret
6097  1855              ; 727         // 0x5A признак окончания файла
6098  1855              ; 728     }
6099  1855              ; 729 }
6100  1855              ; 730
6101  1855              ; 731 /// Сменить директорию
6102  1855              ; 732 void ftpChangeDirPos() {
6103  1855              ftpchangedirpos:
6104  1855              ; 733     push_pop(de) {
6105  1855 D5           	push de
6106  1856              ; 734         push_pop(hl) {
6107  1856 E5           	push hl
6108  1857              ; 735             de = ESP_I2S_BUFFER;
6109  1857 11 8B 13     	ld de, esp_i2s_buffer
6110  185A              ; 736             a = ftpViewCurrentPos;
6111  185A 3A 66 0F     	ld a, (ftpviewcurrentpos)
6112  185D              ; 737             *de = a;
6113  185D 12           	ld (de), a
6114  185E              ; 738             //
6115  185E              ; 739             delay5msI2C();
6116  185E CD F1 12     	call delay5msi2c
6117  1861              ; 740             i2cWaitingForAccess();
6118  1861 CD DE 12     	call i2cwaitingforaccess
6119  1864              ; 741             //
6120  1864              ; 742             l = 32; // FTP_DIR_INDEX
6121  1864 2E 20        	ld l, 32
6122  1866              ; 743             h = 1; // 1 байт
6123  1866 26 01        	ld h, 1
6124  1868              ; 744             sendCommand();
6125  1868 CD 25 13     	call sendcommand
6126  186B              ; 745
6127  186B              ; 746             delay5msI2C();
6128  186B CD F1 12     	call delay5msi2c
6129  186E              ; 747             i2cWaitingForAccess();
6130  186E CD DE 12     	call i2cwaitingforaccess
6131  1871              ; 748             busRecoveryI2C();
6132  1871 CD FD 12     	call busrecoveryi2c
6133  1874 E1           	pop hl
6134  1875 D1           	pop de
6135  1876 C9           	ret
6136  1877              ; 749         }
6137  1877              ; 750     }
6138  1877              ; 751 }
6139  1877              ; 752
6140  1877              ; 753 /// Сменить директорию вверх
6141  1877              ; 754 void ftpChangeDirUp() {
6142  1877              ftpchangedirup:
6143  1877              ; 755     push_pop(de) {
6144  1877 D5           	push de
6145  1878              ; 756         push_pop(hl) {
6146  1878 E5           	push hl
6147  1879              ; 757             delay5msI2C();
6148  1879 CD F1 12     	call delay5msi2c
6149  187C              ; 758             i2cWaitingForAccess();
6150  187C CD DE 12     	call i2cwaitingforaccess
6151  187F              ; 759             //
6152  187F              ; 760             l = 31; // FTP_DIR_UP
6153  187F 2E 1F        	ld l, 31
6154  1881              ; 761             h = 0;
6155  1881 26 00        	ld h, 0
6156  1883              ; 762             sendCommand();
6157  1883 CD 25 13     	call sendcommand
6158  1886              ; 763
6159  1886              ; 764             delay5msI2C();
6160  1886 CD F1 12     	call delay5msi2c
6161  1889              ; 765             i2cWaitingForAccess();
6162  1889 CD DE 12     	call i2cwaitingforaccess
6163  188C              ; 766             busRecoveryI2C();
6164  188C CD FD 12     	call busrecoveryi2c
6165  188F E1           	pop hl
6166  1890 D1           	pop de
6167  1891 C9           	ret
6168  1892              ; 767         }
6169  1892              ; 768     }
6170  1892              ; 769 }
6171  1892              ; 770
6172  1892              ; 771 /// Получить текущий путь FTP
6173  1892              ; 772 void getFtpCurrentPath() {
6174  1892              getftpcurrentpath:
6175  1892              ; 773     push_pop(hl) {
6176  1892 E5           	push hl
6177  1893              ; 774         do {
6178  1893              l_426:
6179  1893              ; 775             delay5msI2C();
6180  1893 CD F1 12     	call delay5msi2c
6181  1896              ; 776             i2cWaitingForAccess();
6182  1896 CD DE 12     	call i2cwaitingforaccess
6183  1899              ; 777             l = 33; //GET_FTP_DIR, // 33
6184  1899 2E 21        	ld l, 33
6185  189B              ; 778             h = 0;
6186  189B 26 00        	ld h, 0
6187  189D              ; 779             sendCommand();
6188  189D CD 25 13     	call sendcommand
6189  18A0              ; 780             //
6190  18A0              ; 781             loadStringToHL(hl = ftpViewDirPath);
6191  18A0 21 77 0F     	ld hl, ftpviewdirpath
6192  18A3 CD F2 14     	call loadstringtohl
6193  18A6              l_427:
6194  18A6              ; 782         } while ((a = parsePageBufferIsCheck) != 1);
6195  18A6 3A 53 1D     	ld a, (parsepagebufferischeck)
6196  18A9 FE 01        	cp 1
6197  18AB C2 93 18     	jp nz, l_426
6198  18AE E1           	pop hl
6199  18AF C9           	ret
6200  18B0              ; 11 void needUpdateFtpList() {
6201  18B0              needupdateftplist:
6202  18B0              ; 12     i2cWaitingForAccess();
6203  18B0 CD DE 12     	call i2cwaitingforaccess
6204  18B3              ; 13     updateFtpList();
6205  18B3 CD 52 17     	call updateftplist
6206  18B6              ; 14     i2cWaitingForAccess();
6207  18B6 CD DE 12     	call i2cwaitingforaccess
6208  18B9              ; 15     getFtpList();
6209  18B9 CD 7D 17     	call getftplist
6210  18BC              ; 16
6211  18BC              ; 17 //    a = ftpDirListCount;
6212  18BC              ; 18 //    if (a >= 16) {
6213  18BC              ; 19 //        a = 16;
6214  18BC              ; 20 //        ftpDirListCount = a;
6215  18BC              ; 21 //    }
6216  18BC              ; 22
6217  18BC              ; 23     a = 0;
6218  18BC 3E 00        	ld a, 0
6219  18BE              ; 24     ftpViewCurrentPos = a;
6220  18BE 32 66 0F     	ld (ftpviewcurrentpos), a
6221  18C1              ; 25
6222  18C1              ; 26     ftpViewDataUpdate();
6223  18C1 C3 1A 19     	jp ftpviewdataupdate
6224  18C4              ; 27 }
6225  18C4              ; 28
6226  18C4              ; 29 void clearView() {
6227  18C4              clearview:
6228  18C4              ; 30     push_pop(hl) {
6229  18C4 E5           	push hl
6230  18C5              ; 31         push_pop(bc) {
6231  18C5 C5           	push bc
6232  18C6              ; 32             b = 15;
6233  18C6 06 0F        	ld b, 15
6234  18C8              ; 33             //
6235  18C8              ; 34             a = ftpDirListCount;
6236  18C8 3A 64 0F     	ld a, (ftpdirlistcount)
6237  18CB              ; 35             c = a; //0;
6238  18CB 4F           	ld c, a
6239  18CC              ; 36             // Отнять от B
6240  18CC              ; 37             a = b;
6241  18CC 78           	ld a, b
6242  18CD              ; 38             a -= c;
6243  18CD 91           	sub c
6244  18CE              ; 39             b = a;
6245  18CE 47           	ld b, a
6246  18CF              ; 40             //--
6247  18CF              ; 41             do {
6248  18CF              l_429:
6249  18CF              ; 42                 ftpViewPosCursorC();
6250  18CF CD 6C 19     	call ftpviewposcursorc
6251  18D2              ; 43                 hl = ftpViewEmpty16; //wifiSettingsEmpty18;
6252  18D2 21 67 0F     	ld hl, ftpviewempty16
6253  18D5              ; 44                 printHLStr();
6254  18D5 CD 18 F8     	call printhlstr
6255  18D8              ; 45                 b--;
6256  18D8 05           	dec b
6257  18D9              ; 46                 c++;
6258  18D9 0C           	inc c
6259  18DA              l_430:
6260  18DA              ; 47             } while ((a = b) > 0);
6261  18DA 78           	ld a, b
6262  18DB B7           	or a
6263  18DC C2 CF 18     	jp nz, l_429
6264  18DF C1           	pop bc
6265  18E0 E1           	pop hl
6266  18E1 C9           	ret
6267  18E2              ; 48         }
6268  18E2              ; 49     }
6269  18E2              ; 50 }
6270  18E2              ; 51
6271  18E2              ; 52 /// Обновить на экране текущий путь на FTP
6272  18E2              ; 53 void updateCurrentPath() {
6273  18E2              updatecurrentpath:
6274  18E2              ; 54     push_pop(hl, bc) {
6275  18E2 E5           	push hl
6276  18E3 C5           	push bc
6277  18E4              ; 55         hl = ftpViewDirPath;
6278  18E4 21 77 0F     	ld hl, ftpviewdirpath
6279  18E7              ; 56         b = 25;
6280  18E7 06 19        	ld b, 25
6281  18E9              ; 57         c = 0; // признак что нужно проставить пробелы
6282  18E9 0E 00        	ld c, 0
6283  18EB              ; 58         do {
6284  18EB              l_432:
6285  18EB              ; 59             a = *hl;
6286  18EB 7E           	ld a, (hl)
6287  18EC              ; 60             if (a == 0) {
6288  18EC B7           	or a
6289  18ED C2 F2 18     	jp nz, l_435
6290  18F0              ; 61                 c = 1;
6291  18F0 0E 01        	ld c, 1
6292  18F2              l_435:
6293  18F2              ; 62             }
6294  18F2              ; 63             if ((a = c) == 1) {
6295  18F2 79           	ld a, c
6296  18F3 FE 01        	cp 1
6297  18F5 C2 FB 18     	jp nz, l_437
6298  18F8              ; 64                 a = ' ';
6299  18F8 3E 20        	ld a, 32
6300  18FA              ; 65                 *hl = a;
6301  18FA 77           	ld (hl), a
6302  18FB              l_437:
6303  18FB              ; 66             }
6304  18FB              ; 67             hl++;
6305  18FB 23           	inc hl
6306  18FC              ; 68             b--;
6307  18FC 05           	dec b
6308  18FD              l_433:
6309  18FD              ; 69         } while ((a = b) > 0);
6310  18FD 78           	ld a, b
6311  18FE B7           	or a
6312  18FF C2 EB 18     	jp nz, l_432
6313  1902              ; 70         // Если был признак простановки пробелов, ставим в конце 0
6314  1902              ; 71         if ((a = c) == 1) {
6315  1902 79           	ld a, c
6316  1903 FE 01        	cp 1
6317  1905 C2 0B 19     	jp nz, l_439
6318  1908              ; 72             a = 0;
6319  1908 3E 00        	ld a, 0
6320  190A              ; 73             *hl = a;
6321  190A 77           	ld (hl), a
6322  190B              l_439:
6323  190B              ; 74         }
6324  190B              ; 75         setPosCursor(hl = ftpViewDirPathPos);
6325  190B 2A 91 0F     	ld hl, (ftpviewdirpathpos)
6326  190E CD 3C F8     	call setposcursor
6327  1911              ; 76         printHLStr(hl = ftpViewDirPath);
6328  1911 21 77 0F     	ld hl, ftpviewdirpath
6329  1914 CD 18 F8     	call printhlstr
6330  1917 C1           	pop bc
6331  1918 E1           	pop hl
6332  1919 C9           	ret
6333  191A              ; 77     }
6334  191A              ; 78 }
6335  191A              ; 79
6336  191A              ; 80 void ftpViewDataUpdate() {
6337  191A              ftpviewdataupdate:
6338  191A              ; 81     push_pop(bc) {
6339  191A C5           	push bc
6340  191B              ; 82         b = 0;
6341  191B 06 00        	ld b, 0
6342  191D              ; 83         a = ftpDirListCount;
6343  191D 3A 64 0F     	ld a, (ftpdirlistcount)
6344  1920              ; 84         c = a;
6345  1920 4F           	ld c, a
6346  1921              ; 85         do {
6347  1921              l_441:
6348  1921              ; 86             a = 0x00;
6349  1921 3E 00        	ld a, 0
6350  1923              ; 87             inverceAddress = a;
6351  1923 32 D3 F3     	ld (inverceaddress), a
6352  1926              ; 88
6353  1926              ; 89             if ((a = rootViewCurrentView) == rootViewCurrentFTPView) {
6354  1926 3A 93 0F     	ld a, (rootviewcurrentview)
6355  1929 FE 01        	cp 1
6356  192B C2 3A 19     	jp nz, l_444
6357  192E              ; 90                 if ((a = ftpViewCurrentPos) == b) {
6358  192E 3A 66 0F     	ld a, (ftpviewcurrentpos)
6359  1931 B8           	cp b
6360  1932 C2 3A 19     	jp nz, l_446
6361  1935              ; 91                     a = 0xFF;
6362  1935 3E FF        	ld a, 255
6363  1937              ; 92                     inverceAddress = a;
6364  1937 32 D3 F3     	ld (inverceaddress), a
6365  193A              l_446:
6366  193A              l_444:
6367  193A              ; 93                 }
6368  193A              ; 94             }
6369  193A              ; 95
6370  193A              ; 96             a = b;
6371  193A 78           	ld a, b
6372  193B              ; 97             ftpViewShowValueA();
6373  193B CD 4E 19     	call ftpviewshowvaluea
6374  193E              ; 98
6375  193E              ; 99             a = 0x00;
6376  193E 3E 00        	ld a, 0
6377  1940              ; 100             inverceAddress = a;
6378  1940 32 D3 F3     	ld (inverceaddress), a
6379  1943              ; 101
6380  1943              ; 102             b++;
6381  1943 04           	inc b
6382  1944              ; 103             c--;
6383  1944 0D           	dec c
6384  1945              l_442:
6385  1945              ; 104         } while ((a = c) > 0);
6386  1945 79           	ld a, c
6387  1946 B7           	or a
6388  1947 C2 21 19     	jp nz, l_441
6389  194A C1           	pop bc
6390  194B              ; 105     }
6391  194B              ; 106     clearView();
6392  194B C3 C4 18     	jp clearview
6393  194E              ; 107 }
6394  194E              ; 108
6395  194E              ; 109 void ftpViewShowValueA() {
6396  194E              ftpviewshowvaluea:
6397  194E              ; 110     push_pop(hl) {
6398  194E E5           	push hl
6399  194F              ; 111         push_pop(de) {
6400  194F D5           	push de
6401  1950              ; 112             push_pop(bc) {
6402  1950 C5           	push bc
6403  1951              ; 113                 de = 16;
6404  1951 11 10 00     	ld de, 16
6405  1954              ; 114                 c = a;
6406  1954 4F           	ld c, a
6407  1955              ; 115                 ftpViewPosCursorC();
6408  1955 CD 6C 19     	call ftpviewposcursorc
6409  1958              ; 116                 hl = ftpDirList;
6410  1958 21 E3 0D     	ld hl, ftpdirlist
6411  195B              ; 117                 if ((a = c) > 0) {
6412  195B 79           	ld a, c
6413  195C B7           	or a
6414  195D CA 65 19     	jp z, l_448
6415  1960              ; 118                     do {
6416  1960              l_450:
6417  1960              ; 119                         hl += de;
6418  1960 19           	add hl, de
6419  1961              ; 120                         c--;
6420  1961 0D           	dec c
6421  1962              l_451:
6422  1962 C2 60 19     	jp nz, l_450
6423  1965              l_448:
6424  1965              ; 121                     } while (flag_nz);
6425  1965              ; 122                 }
6426  1965              ; 123                 //hl = ftpLabel;
6427  1965              ; 124                 printHLStr();
6428  1965 CD 18 F8     	call printhlstr
6429  1968 C1           	pop bc
6430  1969 D1           	pop de
6431  196A E1           	pop hl
6432  196B C9           	ret
6433  196C              ; 125             }
6434  196C              ; 126         }
6435  196C              ; 127     }
6436  196C              ; 128 }
6437  196C              ; 129
6438  196C              ; 130 void ftpViewPosCursorC() {
6439  196C              ftpviewposcursorc:
6440  196C              ; 131     push_pop(hl) {
6441  196C E5           	push hl
6442  196D              ; 132         a = ftpViewY;
6443  196D 3A D7 0D     	ld a, (ftpviewy)
6444  1970              ; 133         a += 1;
6445  1970 C6 01        	add 1
6446  1972              ; 134         a += c;
6447  1972 81           	add c
6448  1973              ; 135         h = a;
6449  1973 67           	ld h, a
6450  1974              ; 136         a = ftpViewX;
6451  1974 3A D6 0D     	ld a, (ftpviewx)
6452  1977              ; 137         a += 3;
6453  1977 C6 03        	add 3
6454  1979              ; 138         l = a;
6455  1979 6F           	ld l, a
6456  197A              ; 139         setPosCursor();
6457  197A CD 3C F8     	call setposcursor
6458  197D E1           	pop hl
6459  197E C9           	ret
6460  197F              ; 140     }
6461  197F              ; 141 }
6462  197F              ; 142
6463  197F              ; 143 void ftpViewKeyA() {
6464  197F              ftpviewkeya:
6465  197F              ; 144     push_pop(hl) {
6466  197F E5           	push hl
6467  1980              ; 145         l = a;
6468  1980 6F           	ld l, a
6469  1981              ; 146         if ((a = rootViewCurrentView) == rootViewCurrentFTPView) {
6470  1981 3A 93 0F     	ld a, (rootviewcurrentview)
6471  1984 FE 01        	cp 1
6472  1986 C2 24 1A     	jp nz, l_453
6473  1989              ; 147             a = l;
6474  1989 7D           	ld a, l
6475  198A              ; 148             if (a == 0x09) { // TAB - Change to local disk
6476  198A FE 09        	cp 9
6477  198C C2 9D 19     	jp nz, l_455
6478  198F              ; 149                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
6479  198F 3E 00        	ld a, 0
6480  1991              ; 150                 rootViewCurrentView = a;
6481  1991 32 93 0F     	ld (rootviewcurrentview), a
6482  1994              ; 151                 ftpViewDataUpdate();
6483  1994 CD 1A 19     	call ftpviewdataupdate
6484  1997              ; 152                 showDiskList();
6485  1997 CD 9C 03     	call showdisklist
6486  199A C3 24 1A     	jp l_456
6487  199D              l_455:
6488  199D              ; 153             } else {
6489  199D              ; 154                 a = ftpDirListCount;
6490  199D 3A 64 0F     	ld a, (ftpdirlistcount)
6491  19A0              ; 155                 h = a;
6492  19A0 67           	ld h, a
6493  19A1              ; 156                 a = l;
6494  19A1 7D           	ld a, l
6495  19A2              ; 157                 if (a == 0x1A) { //down
6496  19A2 FE 1A        	cp 26
6497  19A4 C2 B7 19     	jp nz, l_457
6498  19A7              ; 158                     a = ftpViewCurrentPos;
6499  19A7 3A 66 0F     	ld a, (ftpviewcurrentpos)
6500  19AA              ; 159                     a++;
6501  19AA 3C           	inc a
6502  19AB              ; 160                     if (a == h) {
6503  19AB BC           	cp h
6504  19AC C2 B1 19     	jp nz, l_459
6505  19AF              ; 161                         a = 0;
6506  19AF 3E 00        	ld a, 0
6507  19B1              l_459:
6508  19B1              ; 162                     }
6509  19B1              ; 163                     ftpViewCurrentPos = a;
6510  19B1 32 66 0F     	ld (ftpviewcurrentpos), a
6511  19B4 C3 24 1A     	jp l_458
6512  19B7              l_457:
6513  19B7              ; 164                 } else if (a == 0x19) { //up
6514  19B7 FE 19        	cp 25
6515  19B9 C2 CF 19     	jp nz, l_461
6516  19BC              ; 165                     a = ftpViewCurrentPos;
6517  19BC 3A 66 0F     	ld a, (ftpviewcurrentpos)
6518  19BF              ; 166                     if (a == 0) {
6519  19BF B7           	or a
6520  19C0 C2 C8 19     	jp nz, l_463
6521  19C3              ; 167                         a = h;
6522  19C3 7C           	ld a, h
6523  19C4              ; 168                         a--;
6524  19C4 3D           	dec a
6525  19C5 C3 C9 19     	jp l_464
6526  19C8              l_463:
6527  19C8              ; 169                     } else {
6528  19C8              ; 170                         a--;
6529  19C8 3D           	dec a
6530  19C9              l_464:
6531  19C9              ; 171                     }
6532  19C9              ; 172                     ftpViewCurrentPos = a;
6533  19C9 32 66 0F     	ld (ftpviewcurrentpos), a
6534  19CC C3 24 1A     	jp l_462
6535  19CF              l_461:
6536  19CF              ; 173                 } else if (a == 0x0D) { //Enter
6537  19CF FE 0D        	cp 13
6538  19D1 C2 01 1A     	jp nz, l_465
6539  19D4              ; 174                     ftpViewCurrentPosIsDir();
6540  19D4 CD E4 1A     	call ftpviewcurrentposisdir
6541  19D7              ; 175                     if ((a = ftpDirListIsDir) == 1) {
6542  19D7 3A 65 0F     	ld a, (ftpdirlistisdir)
6543  19DA FE 01        	cp 1
6544  19DC C2 FB 19     	jp nz, l_467
6545  19DF              ; 176                         if ((a = ftpViewCurrentPos) == 0) {
6546  19DF 3A 66 0F     	ld a, (ftpviewcurrentpos)
6547  19E2 B7           	or a
6548  19E3 C2 EC 19     	jp nz, l_469
6549  19E6              ; 177                             ftpChangeDirUp();
6550  19E6 CD 77 18     	call ftpchangedirup
6551  19E9 C3 EF 19     	jp l_470
6552  19EC              l_469:
6553  19EC              ; 178                         } else {
6554  19EC              ; 179                             ftpChangeDirPos();
6555  19EC CD 55 18     	call ftpchangedirpos
6556  19EF              l_470:
6557  19EF              ; 180                         }
6558  19EF              ; 181                         getFtpCurrentPath();
6559  19EF CD 92 18     	call getftpcurrentpath
6560  19F2              ; 182                         needUpdateFtpList();
6561  19F2 CD B0 18     	call needupdateftplist
6562  19F5              ; 183                         updateCurrentPath();
6563  19F5 CD E2 18     	call updatecurrentpath
6564  19F8 C3 FE 19     	jp l_468
6565  19FB              l_467:
6566  19FB              ; 184                     } else {
6567  19FB              ; 185                         loadSelectFile();
6568  19FB CD 26 1A     	call loadselectfile
6569  19FE              l_468:
6570  19FE C3 24 1A     	jp l_466
6571  1A01              l_465:
6572  1A01              ; 186                     }
6573  1A01              ; 187                 } else if (a == 0x34) { // C (COPY)
6574  1A01 FE 34        	cp 52
6575  1A03 C2 16 1A     	jp nz, l_471
6576  1A06              ; 188                     ftpViewCurrentPosIsDir();
6577  1A06 CD E4 1A     	call ftpviewcurrentposisdir
6578  1A09              ; 189                     if ((a = ftpDirListIsDir) == 0) {
6579  1A09 3A 65 0F     	ld a, (ftpdirlistisdir)
6580  1A0C B7           	or a
6581  1A0D C2 13 1A     	jp nz, l_473
6582  1A10              ; 190                         loadSelectFile();
6583  1A10 CD 26 1A     	call loadselectfile
6584  1A13              l_473:
6585  1A13 C3 24 1A     	jp l_472
6586  1A16              l_471:
6587  1A16              ; 191                     }
6588  1A16              ; 192                 } else if (a == 'R') { // R (Refresh)
6589  1A16 FE 52        	cp 82
6590  1A18 C2 24 1A     	jp nz, l_475
6591  1A1B              ; 193                     getFtpCurrentPath();
6592  1A1B CD 92 18     	call getftpcurrentpath
6593  1A1E              ; 194                     needUpdateFtpList();
6594  1A1E CD B0 18     	call needupdateftplist
6595  1A21              ; 195                     updateCurrentPath();
6596  1A21 CD E2 18     	call updatecurrentpath
6597  1A24              l_475:
6598  1A24              l_472:
6599  1A24              l_466:
6600  1A24              l_462:
6601  1A24              l_458:
6602  1A24              l_456:
6603  1A24              l_453:
6604  1A24 E1           	pop hl
6605  1A25 C9           	ret
6606  1A26              ; 196                 }
6607  1A26              ; 197             }
6608  1A26              ; 198         }
6609  1A26              ; 199     }
6610  1A26              ; 200 }
6611  1A26              ; 201
6612  1A26              ; 202 void loadSelectFile() {
6613  1A26              loadselectfile:
6614  1A26              ; 203     showFtpFileLoadView();
6615  1A26 CD D7 1B     	call showftpfileloadview
6616  1A29              ; 204     ftpFileLoadViewNeedLoad();
6617  1A29 CD 36 1C     	call ftpfileloadviewneedload
6618  1A2C              ; 205     updateDiskList();
6619  1A2C CD 8C 03     	call updatedisklist
6620  1A2F              ; 206     updateRootUI();
6621  1A2F CD E2 01     	call updaterootui
6622  1A32              ; 207     showDiskList();
6623  1A32 C3 9C 03     	jp showdisklist
6624  1A35              ; 208 }
6625  1A35              ; 209
6626  1A35              ; 210 /// from ESP_I2S_BUFFER
6627  1A35              ; 211 /// to ftpDirList
6628  1A35              ; 212 /// count ftpDirListCount
6629  1A35              ; 213 /// next ftpDirListNext
6630  1A35              ; 214 void parceBufferToFile() {
6631  1A35              parcebuffertofile:
6632  1A35              ; 215     de = ESP_I2S_BUFFER;
6633  1A35 11 8B 13     	ld de, esp_i2s_buffer
6634  1A38              ; 216     // (0) - порядковый номер Должен быть == ftpDirListCount + 1
6635  1A38              ; 217     a = ftpDirListCount;
6636  1A38 3A 64 0F     	ld a, (ftpdirlistcount)
6637  1A3B              ; 218 //    b = a;
6638  1A3B              ; 219 //    a = *de;
6639  1A3B              ; 220 //    if (a != b) {
6640  1A3B              ; 221 //        a = 0x5A;
6641  1A3B              ; 222 //        ftpDirListNext = a;
6642  1A3B              ; 223 //        return;
6643  1A3B              ; 224 //    }
6644  1A3B              ; 225     hl = ftpDirList;
6645  1A3B 21 E3 0D     	ld hl, ftpdirlist
6646  1A3E              ; 226     b = 0;
6647  1A3E 06 00        	ld b, 0
6648  1A40              ; 227     carry_rotate_left(a, 4);
6649  1A40 17           	rla
6650  1A41 17           	rla
6651  1A42 17           	rla
6652  1A43 17           	rla
6653  1A44              ; 228     if (flag_c) { // Если переполняние младшего разряда, инкремент старшего
6654  1A44 D2 48 1A     	jp nc, l_477
6655  1A47              ; 229         b++;
6656  1A47 04           	inc b
6657  1A48              l_477:
6658  1A48              ; 230     }
6659  1A48              ; 231     c = a;
6660  1A48 4F           	ld c, a
6661  1A49              ; 232     hl += bc; // ftpDirList + смещение
6662  1A49 09           	add hl, bc
6663  1A4A              ; 233 //    a = ftpDirListCount;
6664  1A4A              ; 234 //    a ++;
6665  1A4A              ; 235 //    ftpDirListCount = a;
6666  1A4A              ; 236     // (1) - Флаг окончания пакета. Если 1 - то продолжаем. Любой другой - СТОП!
6667  1A4A              ; 237     de++;
6668  1A4A 13           	inc de
6669  1A4B              ; 238     a = *de;
6670  1A4B 1A           	ld a, (de)
6671  1A4C              ; 239     ftpDirListNext = a;
6672  1A4C 32 63 0F     	ld (ftpdirlistnext), a
6673  1A4F              ; 240     if (a != 0x5A) {
6674  1A4F FE 5A        	cp 90
6675  1A51 CA 5B 1A     	jp z, l_479
6676  1A54              ; 241         a = ftpDirListCount;
6677  1A54 3A 64 0F     	ld a, (ftpdirlistcount)
6678  1A57              ; 242         a ++;
6679  1A57 3C           	inc a
6680  1A58              ; 243         ftpDirListCount = a;
6681  1A58 32 64 0F     	ld (ftpdirlistcount), a
6682  1A5B              l_479:
6683  1A5B              ; 244     }
6684  1A5B              ; 245 //    if (a == 0x01) {
6685  1A5B              ; 246 //        a = 1;
6686  1A5B              ; 247 //        ftpDirListNext = a;
6687  1A5B              ; 248 //    } else {
6688  1A5B              ; 249 //        a = 0;
6689  1A5B              ; 250 //        ftpDirListNext = a;
6690  1A5B              ; 251 //        return;
6691  1A5B              ; 252 //    }
6692  1A5B              ; 253     // (2) - Флаг директоии
6693  1A5B              ; 254     de++;
6694  1A5B 13           	inc de
6695  1A5C              ; 255     a = *de;
6696  1A5C 1A           	ld a, (de)
6697  1A5D              ; 256     a &= 0x01;
6698  1A5D E6 01        	and 1
6699  1A5F              ; 257     ftpDirListIsDir = a;
6700  1A5F 32 65 0F     	ld (ftpdirlistisdir), a
6701  1A62              ; 258     if (a == 0) {
6702  1A62 B7           	or a
6703  1A63 C2 6C 1A     	jp nz, l_481
6704  1A66              ; 259         a = ' ';
6705  1A66 3E 20        	ld a, 32
6706  1A68              ; 260         *hl = a;
6707  1A68 77           	ld (hl), a
6708  1A69 C3 6F 1A     	jp l_482
6709  1A6C              l_481:
6710  1A6C              ; 261     } else {
6711  1A6C              ; 262         a = ' '; //'>';
6712  1A6C 3E 20        	ld a, 32
6713  1A6E              ; 263         *hl = a;
6714  1A6E 77           	ld (hl), a
6715  1A6F              l_482:
6716  1A6F              ; 264     }
6717  1A6F              ; 265     hl++;
6718  1A6F 23           	inc hl
6719  1A70              ; 266     // (3-4) - размер файла
6720  1A70              ; 267     de++;
6721  1A70 13           	inc de
6722  1A71              ; 268     parceSizeFileInBuffer();
6723  1A71 CD 8E 1A     	call parcesizefileinbuffer
6724  1A74              ; 269     // (5-) Имя файла/директории
6725  1A74              ; 270     b = 9;
6726  1A74 06 09        	ld b, 9
6727  1A76              ; 271     do {
6728  1A76              l_483:
6729  1A76              ; 272         a = *de;
6730  1A76 1A           	ld a, (de)
6731  1A77              ; 273         if (a == 0x00) {
6732  1A77 B7           	or a
6733  1A78 C2 7D 1A     	jp nz, l_486
6734  1A7B              ; 274             a = ' ';
6735  1A7B 3E 20        	ld a, 32
6736  1A7D              l_486:
6737  1A7D              ; 275         }
6738  1A7D              ; 276         *hl = a;
6739  1A7D 77           	ld (hl), a
6740  1A7E              ; 277         if ((a = b) == 1) {
6741  1A7E 78           	ld a, b
6742  1A7F FE 01        	cp 1
6743  1A81 C2 87 1A     	jp nz, l_488
6744  1A84              ; 278             a = ' ';
6745  1A84 3E 20        	ld a, 32
6746  1A86              ; 279             *hl = a;
6747  1A86 77           	ld (hl), a
6748  1A87              l_488:
6749  1A87              ; 280         }
6750  1A87              ; 281         de++;
6751  1A87 13           	inc de
6752  1A88              ; 282         hl++;
6753  1A88 23           	inc hl
6754  1A89              ; 283         b--;
6755  1A89 05           	dec b
6756  1A8A              l_484:
6757  1A8A C2 76 1A     	jp nz, l_483
6758  1A8D C9           	ret
6759  1A8E              ; 284     } while (flag_nz);
6760  1A8E              ; 285 }
6761  1A8E              ; 286
6762  1A8E              ; 287 /// HL - result string
6763  1A8E              ; 288 /// DE - 2 byte size
6764  1A8E              ; 289 void parceSizeFileInBuffer() {
6765  1A8E              parcesizefileinbuffer:
6766  1A8E              ; 290     push_pop(hl) {
6767  1A8E E5           	push hl
6768  1A8F              ; 291         push_pop(bc) {
6769  1A8F C5           	push bc
6770  1A90              ; 292             bc = 9;
6771  1A90 01 09 00     	ld bc, 9
6772  1A93              ; 293             hl += bc; // смещаем указатель на позицию с размеров файла
6773  1A93 09           	add hl, bc
6774  1A94              ; 294             a = ' ';
6775  1A94 3E 20        	ld a, 32
6776  1A96              ; 295             *hl = a;
6777  1A96 77           	ld (hl), a
6778  1A97              ; 296             hl++;
6779  1A97 23           	inc hl
6780  1A98              ; 297             // Размер
6781  1A98              ; 298             if ((a = ftpDirListIsDir) == 0) {
6782  1A98 3A 65 0F     	ld a, (ftpdirlistisdir)
6783  1A9B B7           	or a
6784  1A9C C2 CC 1A     	jp nz, l_490
6785  1A9F              ; 299                 a = *de;
6786  1A9F 1A           	ld a, (de)
6787  1AA0              ; 300                 a &= 0xF0;
6788  1AA0 E6 F0        	and 240
6789  1AA2              ; 301                 cyclic_rotate_right(a, 4);
6790  1AA2 0F           	rrca
6791  1AA3 0F           	rrca
6792  1AA4 0F           	rrca
6793  1AA5 0F           	rrca
6794  1AA6              ; 302                 convert4bitToCharA();
6795  1AA6 CD 70 17     	call convert4bittochara
6796  1AA9              ; 303                 *hl = a;
6797  1AA9 77           	ld (hl), a
6798  1AAA              ; 304                 hl++;
6799  1AAA 23           	inc hl
6800  1AAB              ; 305                 a = *de;
6801  1AAB 1A           	ld a, (de)
6802  1AAC              ; 306                 a &= 0x0F;
6803  1AAC E6 0F        	and 15
6804  1AAE              ; 307                 convert4bitToCharA();
6805  1AAE CD 70 17     	call convert4bittochara
6806  1AB1              ; 308                 *hl = a;
6807  1AB1 77           	ld (hl), a
6808  1AB2              ; 309                 hl++;
6809  1AB2 23           	inc hl
6810  1AB3              ; 310                 de++;
6811  1AB3 13           	inc de
6812  1AB4              ; 311
6813  1AB4              ; 312                 a = *de;
6814  1AB4 1A           	ld a, (de)
6815  1AB5              ; 313                 a &= 0xF0;
6816  1AB5 E6 F0        	and 240
6817  1AB7              ; 314                 cyclic_rotate_right(a, 4);
6818  1AB7 0F           	rrca
6819  1AB8 0F           	rrca
6820  1AB9 0F           	rrca
6821  1ABA 0F           	rrca
6822  1ABB              ; 315                 convert4bitToCharA();
6823  1ABB CD 70 17     	call convert4bittochara
6824  1ABE              ; 316                 *hl = a;
6825  1ABE 77           	ld (hl), a
6826  1ABF              ; 317                 hl++;
6827  1ABF 23           	inc hl
6828  1AC0              ; 318                 a = *de;
6829  1AC0 1A           	ld a, (de)
6830  1AC1              ; 319                 a &= 0x0F;
6831  1AC1 E6 0F        	and 15
6832  1AC3              ; 320                 convert4bitToCharA();
6833  1AC3 CD 70 17     	call convert4bittochara
6834  1AC6              ; 321                 *hl = a;
6835  1AC6 77           	ld (hl), a
6836  1AC7              ; 322                 hl++;
6837  1AC7 23           	inc hl
6838  1AC8              ; 323                 de++;
6839  1AC8 13           	inc de
6840  1AC9 C3 DE 1A     	jp l_491
6841  1ACC              l_490:
6842  1ACC              ; 324             } else {
6843  1ACC              ; 325                 a = ' ';
6844  1ACC 3E 20        	ld a, 32
6845  1ACE              ; 326                 *hl = a;
6846  1ACE 77           	ld (hl), a
6847  1ACF              ; 327                 hl++;
6848  1ACF 23           	inc hl
6849  1AD0              ; 328                 a = 'D';
6850  1AD0 3E 44        	ld a, 68
6851  1AD2              ; 329                 *hl = a;
6852  1AD2 77           	ld (hl), a
6853  1AD3              ; 330                 hl++;
6854  1AD3 23           	inc hl
6855  1AD4              ; 331                 a = 'I';
6856  1AD4 3E 49        	ld a, 73
6857  1AD6              ; 332                 *hl = a;
6858  1AD6 77           	ld (hl), a
6859  1AD7              ; 333                 hl++;
6860  1AD7 23           	inc hl
6861  1AD8              ; 334                 a = 'R';
6862  1AD8 3E 52        	ld a, 82
6863  1ADA              ; 335                 *hl = a;
6864  1ADA 77           	ld (hl), a
6865  1ADB              ; 336                 hl++;
6866  1ADB 23           	inc hl
6867  1ADC              ; 337                 de++;
6868  1ADC 13           	inc de
6869  1ADD              ; 338                 de++;
6870  1ADD 13           	inc de
6871  1ADE              l_491:
6872  1ADE              ; 339             }
6873  1ADE              ; 340             //
6874  1ADE              ; 341             a = 0;
6875  1ADE 3E 00        	ld a, 0
6876  1AE0              ; 342             *hl = a; // End char string
6877  1AE0 77           	ld (hl), a
6878  1AE1 C1           	pop bc
6879  1AE2 E1           	pop hl
6880  1AE3 C9           	ret
6881  1AE4              ; 343         }
6882  1AE4              ; 344     }
6883  1AE4              ; 345 }
6884  1AE4              ; 346
6885  1AE4              ; 347 void ftpViewCurrentPosIsDir() {
6886  1AE4              ftpviewcurrentposisdir:
6887  1AE4              ; 348     push_pop(hl) {
6888  1AE4 E5           	push hl
6889  1AE5              ; 349         push_pop(bc) {
6890  1AE5 C5           	push bc
6891  1AE6              ; 350             hl = ftpDirList;
6892  1AE6 21 E3 0D     	ld hl, ftpdirlist
6893  1AE9              ; 351             a = ftpViewCurrentPos;
6894  1AE9 3A 66 0F     	ld a, (ftpviewcurrentpos)
6895  1AEC              ; 352             b = 0;
6896  1AEC 06 00        	ld b, 0
6897  1AEE              ; 353             carry_rotate_left(a, 4);
6898  1AEE 17           	rla
6899  1AEF 17           	rla
6900  1AF0 17           	rla
6901  1AF1 17           	rla
6902  1AF2              ; 354             if (flag_c) { // Если переполняние младшего разряда, инкремент старшего
6903  1AF2 D2 F6 1A     	jp nc, l_492
6904  1AF5              ; 355                 b++;
6905  1AF5 04           	inc b
6906  1AF6              l_492:
6907  1AF6              ; 356             }
6908  1AF6              ; 357             c = a;
6909  1AF6 4F           	ld c, a
6910  1AF7              ; 358             hl += bc;
6911  1AF7 09           	add hl, bc
6912  1AF8              ; 359             // + 12 (DIR)
6913  1AF8              ; 360             bc = 12;
6914  1AF8 01 0C 00     	ld bc, 12
6915  1AFB              ; 361             hl += bc;
6916  1AFB 09           	add hl, bc
6917  1AFC              ; 362             a = *hl;
6918  1AFC 7E           	ld a, (hl)
6919  1AFD              ; 363             if (a == 'D') {
6920  1AFD FE 44        	cp 68
6921  1AFF C2 07 1B     	jp nz, l_494
6922  1B02              ; 364                 a = 1;
6923  1B02 3E 01        	ld a, 1
6924  1B04 C3 09 1B     	jp l_495
6925  1B07              l_494:
6926  1B07              ; 365             } else {
6927  1B07              ; 366                 a = 0;
6928  1B07 3E 00        	ld a, 0
6929  1B09              l_495:
6930  1B09              ; 367             }
6931  1B09              ; 368             ftpDirListIsDir = a;
6932  1B09 32 65 0F     	ld (ftpdirlistisdir), a
6933  1B0C C1           	pop bc
6934  1B0D E1           	pop hl
6935  1B0E C9           	ret
6936  1B0F              ; 11 void showFtpView() {
6937  1B0F              showftpview:
6938  1B0F              ; 12     drowRectX = (a = ftpSettingsViewX);
6939  1B0F 3A 27 0D     	ld a, (ftpsettingsviewx)
6940  1B12 32 86 03     	ld (drowrectx), a
6941  1B15              ; 13     drowRectY = (a = ftpSettingsViewY);
6942  1B15 3A 28 0D     	ld a, (ftpsettingsviewy)
6943  1B18 32 87 03     	ld (drowrecty), a
6944  1B1B              ; 14     drowRectEndX = (a = ftpSettingsViewEX);
6945  1B1B 3A 29 0D     	ld a, (ftpsettingsviewex)
6946  1B1E 32 88 03     	ld (drowrectendx), a
6947  1B21              ; 15     drowRectEndY = (a = ftpSettingsViewEY);
6948  1B21 3A 2A 0D     	ld a, (ftpsettingsviewey)
6949  1B24 32 89 03     	ld (drowrectendy), a
6950  1B27              ; 16     drowRect();
6951  1B27 CD F2 02     	call drowrect
6952  1B2A              ; 17
6953  1B2A              ; 18     hl = ftpSettingsLabelPos;
6954  1B2A 2A 2B 0D     	ld hl, (ftpsettingslabelpos)
6955  1B2D              ; 19     setPosCursor();
6956  1B2D CD 3C F8     	call setposcursor
6957  1B30              ; 20     hl = ftpSettingsLabel;
6958  1B30 21 2D 0D     	ld hl, ftpsettingslabel
6959  1B33              ; 21     printHLStr();
6960  1B33 CD 18 F8     	call printhlstr
6961  1B36              ; 22
6962  1B36              ; 23     hl = ftpSettingsStatusLabelPos;
6963  1B36 2A 52 0D     	ld hl, (ftpsettingsstatuslabelpos)
6964  1B39              ; 24     setPosCursor();
6965  1B39 CD 3C F8     	call setposcursor
6966  1B3C              ; 25     hl = ftpSettingsStatusLabel;
6967  1B3C 21 54 0D     	ld hl, ftpsettingsstatuslabel
6968  1B3F              ; 26     printHLStr();
6969  1B3F CD 18 F8     	call printhlstr
6970  1B42              ; 27
6971  1B42              ; 28     hl = ftpSettingsIpLabelPos;
6972  1B42 2A 3C 0D     	ld hl, (ftpsettingsiplabelpos)
6973  1B45              ; 29     setPosCursor();
6974  1B45 CD 3C F8     	call setposcursor
6975  1B48              ; 30     hl = ftpSettingsIpLabel;
6976  1B48 21 3E 0D     	ld hl, ftpsettingsiplabel
6977  1B4B              ; 31     printHLStr();
6978  1B4B CD 18 F8     	call printhlstr
6979  1B4E              ; 32
6980  1B4E              ; 33     hl = ftpSettingsPortLabelPos;
6981  1B4E 2A 42 0D     	ld hl, (ftpsettingsportlabelpos)
6982  1B51              ; 34     setPosCursor();
6983  1B51 CD 3C F8     	call setposcursor
6984  1B54              ; 35     hl = ftpSettingsPortLabel;
6985  1B54 21 44 0D     	ld hl, ftpsettingsportlabel
6986  1B57              ; 36     printHLStr();
6987  1B57 CD 18 F8     	call printhlstr
6988  1B5A              ; 37
6989  1B5A              ; 38     hl = ftpSettingsUserLabelPos;
6990  1B5A 2A 4A 0D     	ld hl, (ftpsettingsuserlabelpos)
6991  1B5D              ; 39     setPosCursor();
6992  1B5D CD 3C F8     	call setposcursor
6993  1B60              ; 40     hl = ftpSettingsUserLabel;
6994  1B60 21 4C 0D     	ld hl, ftpsettingsuserlabel
6995  1B63              ; 41     printHLStr();
6996  1B63 CD 18 F8     	call printhlstr
6997  1B66              ; 42
6998  1B66              ; 43     //Value
6999  1B66              ; 44     hl = ftpSettingsIpValuePos;
7000  1B66 2A 5C 0D     	ld hl, (ftpsettingsipvaluepos)
7001  1B69              ; 45     setPosCursor();
7002  1B69 CD 3C F8     	call setposcursor
7003  1B6C              ; 46     hl = ftpSettingsIpValue;
7004  1B6C 21 5E 0D     	ld hl, ftpsettingsipvalue
7005  1B6F              ; 47     printHLStr();
7006  1B6F CD 18 F8     	call printhlstr
7007  1B72              ; 48
7008  1B72              ; 49     hl = ftpSettingsPortValuePos;
7009  1B72 2A 6E 0D     	ld hl, (ftpsettingsportvaluepos)
7010  1B75              ; 50     setPosCursor();
7011  1B75 CD 3C F8     	call setposcursor
7012  1B78              ; 51     hl = ftpSettingsPortValue;
7013  1B78 21 70 0D     	ld hl, ftpsettingsportvalue
7014  1B7B              ; 52     printHLStr();
7015  1B7B CD 18 F8     	call printhlstr
7016  1B7E              ; 53
7017  1B7E              ; 54     hl = ftpSettingsUserValuePos;
7018  1B7E 2A 9E 0D     	ld hl, (ftpsettingsuservaluepos)
7019  1B81              ; 55     setPosCursor();
7020  1B81 CD 3C F8     	call setposcursor
7021  1B84              ; 56     hl = ftpSettingsUserValue;
7022  1B84 21 A0 0D     	ld hl, ftpsettingsuservalue
7023  1B87              ; 57     printHLStr();
7024  1B87 CD 18 F8     	call printhlstr
7025  1B8A              ; 58
7026  1B8A              ; 59     updateFtpViewStatusText();
7027  1B8A CD A8 1B     	call updateftpviewstatustext
7028  1B8D              ; 60     updateFtpViewValData();
7029  1B8D C3 9C 1B     	jp updateftpviewvaldata
7030  1B90              ; 61 }
7031  1B90              ; 62
7032  1B90              ; 63 void clearFtpViewValData() {
7033  1B90              clearftpviewvaldata:
7034  1B90              ; 64     hl = ftpSettingsStatusValuePos;
7035  1B90 2A 76 0D     	ld hl, (ftpsettingsstatusvaluepos)
7036  1B93              ; 65     setPosCursor();
7037  1B93 CD 3C F8     	call setposcursor
7038  1B96              ; 66     hl = wifiSettingsEmpty18;
7039  1B96 21 15 0D     	ld hl, wifisettingsempty18
7040  1B99              ; 67     printHLStr();
7041  1B99 C3 18 F8     	jp printhlstr
7042  1B9C              ; 68 }
7043  1B9C              ; 69
7044  1B9C              ; 70 void updateFtpViewValData() {
7045  1B9C              updateftpviewvaldata:
7046  1B9C              ; 71     hl = ftpSettingsStatusValuePos;
7047  1B9C 2A 76 0D     	ld hl, (ftpsettingsstatusvaluepos)
7048  1B9F              ; 72     setPosCursor();
7049  1B9F CD 3C F8     	call setposcursor
7050  1BA2              ; 73     hl = ftpSettingsStatusValue;
7051  1BA2 21 78 0D     	ld hl, ftpsettingsstatusvalue
7052  1BA5              ; 74     printHLStr();
7053  1BA5 C3 18 F8     	jp printhlstr
7054  1BA8              ; 75 }
7055  1BA8              ; 76
7056  1BA8              ; 77 void updateFtpViewStatusText() {
7057  1BA8              updateftpviewstatustext:
7058  1BA8              ; 78     push_pop(hl) {
7059  1BA8 E5           	push hl
7060  1BA9              ; 79         push_pop(de) {
7061  1BA9 D5           	push de
7062  1BAA              ; 80             push_pop(bc) {
7063  1BAA C5           	push bc
7064  1BAB              ; 81
7065  1BAB              ; 82                 if ((a = ftpSettingsStateVal) == 0x00) {
7066  1BAB 3A 84 0D     	ld a, (ftpsettingsstateval)
7067  1BAE B7           	or a
7068  1BAF C2 B8 1B     	jp nz, l_496
7069  1BB2              ; 83                     hl = ftpSettingsStatus0;
7070  1BB2 21 86 0D     	ld hl, ftpsettingsstatus0
7071  1BB5 C3 BB 1B     	jp l_497
7072  1BB8              l_496:
7073  1BB8              ; 84                 } else {
7074  1BB8              ; 85                     hl = ftpSettingsStatus1;
7075  1BB8 21 92 0D     	ld hl, ftpsettingsstatus1
7076  1BBB              l_497:
7077  1BBB              ; 86                 }
7078  1BBB              ; 87
7079  1BBB              ; 88                 de = ftpSettingsStatusValue;
7080  1BBB 11 78 0D     	ld de, ftpsettingsstatusvalue
7081  1BBE              ; 89                 //Copy *hl to *de
7082  1BBE              ; 90                 b = 12;
7083  1BBE 06 0C        	ld b, 12
7084  1BC0              ; 91                 do {
7085  1BC0              l_498:
7086  1BC0              ; 92                     a = *hl;
7087  1BC0 7E           	ld a, (hl)
7088  1BC1              ; 93                     *de = a;
7089  1BC1 12           	ld (de), a
7090  1BC2              ; 94                     if ((a = b) == 1) {
7091  1BC2 78           	ld a, b
7092  1BC3 FE 01        	cp 1
7093  1BC5 C2 CB 1B     	jp nz, l_501
7094  1BC8              ; 95                         a = 0;
7095  1BC8 3E 00        	ld a, 0
7096  1BCA              ; 96                         *de = a;
7097  1BCA 12           	ld (de), a
7098  1BCB              l_501:
7099  1BCB              ; 97                     }
7100  1BCB              ; 98                     de++;
7101  1BCB 13           	inc de
7102  1BCC              ; 99                     hl++;
7103  1BCC 23           	inc hl
7104  1BCD              ; 100                     b--;
7105  1BCD 05           	dec b
7106  1BCE              l_499:
7107  1BCE              ; 101                 } while ((a = b) > 0);
7108  1BCE 78           	ld a, b
7109  1BCF B7           	or a
7110  1BD0 C2 C0 1B     	jp nz, l_498
7111  1BD3 C1           	pop bc
7112  1BD4 D1           	pop de
7113  1BD5 E1           	pop hl
7114  1BD6 C9           	ret
7115  1BD7              ; 11 void showFtpFileLoadView() {
7116  1BD7              showftpfileloadview:
7117  1BD7              ; 12     drowRectX = (a = FtpFileLoadViewX);
7118  1BD7 3A E0 1C     	ld a, (ftpfileloadviewx)
7119  1BDA 32 86 03     	ld (drowrectx), a
7120  1BDD              ; 13     drowRectY = (a = FtpFileLoadViewY);
7121  1BDD 3A E1 1C     	ld a, (ftpfileloadviewy)
7122  1BE0 32 87 03     	ld (drowrecty), a
7123  1BE3              ; 14     drowRectEndX = (a = FtpFileLoadViewEX);
7124  1BE3 3A E2 1C     	ld a, (ftpfileloadviewex)
7125  1BE6 32 88 03     	ld (drowrectendx), a
7126  1BE9              ; 15     drowRectEndY = (a = FtpFileLoadViewEY);
7127  1BE9 3A E3 1C     	ld a, (ftpfileloadviewey)
7128  1BEC 32 89 03     	ld (drowrectendy), a
7129  1BEF              ; 16     drowRect();
7130  1BEF CD F2 02     	call drowrect
7131  1BF2              ; 17
7132  1BF2              ; 18     hl = FtpFileLoadViewTitlelPos;
7133  1BF2 2A E4 1C     	ld hl, (ftpfileloadviewtitlelpos)
7134  1BF5              ; 19     setPosCursor();
7135  1BF5 CD 3C F8     	call setposcursor
7136  1BF8              ; 20     hl = FtpFileLoadViewTitlel;
7137  1BF8 21 E6 1C     	ld hl, ftpfileloadviewtitlel
7138  1BFB              ; 21     printHLStr();
7139  1BFB C3 18 F8     	jp printhlstr
7140  1BFE              ; 22 }
7141  1BFE              ; 23
7142  1BFE              ; 24 void updateProgress() {
7143  1BFE              updateprogress:
7144  1BFE              ; 25     push_pop(hl) {
7145  1BFE E5           	push hl
7146  1BFF              ; 26         push_pop(bc) {
7147  1BFF C5           	push bc
7148  1C00              ; 27             a = FtpFileLoadViewY;
7149  1C00 3A E1 1C     	ld a, (ftpfileloadviewy)
7150  1C03              ; 28             a += 1;
7151  1C03 C6 01        	add 1
7152  1C05              ; 29             h = a;
7153  1C05 67           	ld h, a
7154  1C06              ; 30             a = FtpFileLoadViewX;
7155  1C06 3A E0 1C     	ld a, (ftpfileloadviewx)
7156  1C09              ; 31             a += 2;
7157  1C09 C6 02        	add 2
7158  1C0B              ; 32             l = a;
7159  1C0B 6F           	ld l, a
7160  1C0C              ; 33             setPosCursor();
7161  1C0C CD 3C F8     	call setposcursor
7162  1C0F              ; 34             h = 0;
7163  1C0F 26 00        	ld h, 0
7164  1C11              ; 35             a = ftpFileLoadViewProgress;
7165  1C11 3A DF 1C     	ld a, (ftpfileloadviewprogress)
7166  1C14              ; 36             l = a;
7167  1C14 6F           	ld l, a
7168  1C15              ; 37             //
7169  1C15              ; 38             setMyFont();
7170  1C15 CD 6E 03     	call setmyfont
7171  1C18              ; 39             do {
7172  1C18              l_503:
7173  1C18              ; 40                 h++;
7174  1C18 24           	inc h
7175  1C19              ; 41                 if ((a = h) < l) {
7176  1C19 7C           	ld a, h
7177  1C1A BD           	cp l
7178  1C1B D2 23 1C     	jp nc, l_506
7179  1C1E              ; 42                     c = 0x28; //'X';
7180  1C1E 0E 28        	ld c, 40
7181  1C20 C3 25 1C     	jp l_507
7182  1C23              l_506:
7183  1C23              ; 43                 } else {
7184  1C23              ; 44                     c = 0x27; //' ';
7185  1C23 0E 27        	ld c, 39
7186  1C25              l_507:
7187  1C25              ; 45                 }
7188  1C25              ; 46                 push_pop(hl) {
7189  1C25 E5           	push hl
7190  1C26              ; 47                     printChatC();
7191  1C26 CD 09 F8     	call printchatc
7192  1C29 E1           	pop hl
7193  1C2A              l_504:
7194  1C2A              ; 48                 }
7195  1C2A              ; 49             } while ((a = h) < 40);
7196  1C2A 7C           	ld a, h
7197  1C2B FE 28        	cp 40
7198  1C2D DA 18 1C     	jp c, l_503
7199  1C30              ; 50             setSystemFont();
7200  1C30 CD 7D 03     	call setsystemfont
7201  1C33 C1           	pop bc
7202  1C34 E1           	pop hl
7203  1C35 C9           	ret
7204  1C36              ; 51         }
7205  1C36              ; 52     }
7206  1C36              ; 53 }
7207  1C36              ; 54
7208  1C36              ; 55 void ftpFileLoadViewNeedLoad() {
7209  1C36              ftpfileloadviewneedload:
7210  1C36              ; 56     ftpFileDownload();
7211  1C36 CD F9 17     	call ftpfiledownload
7212  1C39              ; 57
7213  1C39              ; 58     // Считываем текущий диск и устанавливаем его
7214  1C39              ; 59     a = diskViewDiskNum;
7215  1C39 3A C0 0D     	ld a, (diskviewdisknum)
7216  1C3C              ; 60     ordos_wnd();
7217  1C3C CD D6 BF     	call ordos_wnd
7218  1C3F              ; 61
7219  1C3F              ; 62     // Получаем адрес куда надо начинать писать данные
7220  1C3F              ; 63     ordos_mxdsk();
7221  1C3F CD B8 BF     	call ordos_mxdsk
7222  1C42              ; 64     diskStartNewFile = hl;
7223  1C42 22 D4 0D     	ld (diskstartnewfile), hl
7224  1C45              ; 65
7225  1C45              ; 66     // Вызываем закачку
7226  1C45              ; 67     ftpFileDownloadNext();
7227  1C45 CD 12 18     	call ftpfiledownloadnext
7228  1C48              ; 68
7229  1C48              ; 69     // Обновляем
7230  1C48              ; 70     updateDiskList();
7231  1C48 C3 8C 03     	jp updatedisklist
7232  1C4B              ; 71     //updateRootUI();
7233  1C4B              ; 72 }
7234  1C4B              ; 73
7235  1C4B              ; 74 void ftpFileLoadViewParce() {
7236  1C4B              ftpfileloadviewparce:
7237  1C4B              ; 75     push_pop(de) {
7238  1C4B D5           	push de
7239  1C4C              ; 76         push_pop(hl) {
7240  1C4C E5           	push hl
7241  1C4D              ; 77             push_pop(bc) {
7242  1C4D C5           	push bc
7243  1C4E              ; 78                 de = ESP_I2S_BUFFER;
7244  1C4E 11 8B 13     	ld de, esp_i2s_buffer
7245  1C51              ; 79                 //addr
7246  1C51              ; 80                 a = *de;
7247  1C51 1A           	ld a, (de)
7248  1C52              ; 81                 l = a;
7249  1C52 6F           	ld l, a
7250  1C53              ; 82                 de++;
7251  1C53 13           	inc de
7252  1C54              ; 83                 a = *de;
7253  1C54 1A           	ld a, (de)
7254  1C55              ; 84                 h = a;
7255  1C55 67           	ld h, a
7256  1C56              ; 85                 ftpFileLoadCurrentPos = hl;
7257  1C56 22 ED 1C     	ld (ftpfileloadcurrentpos), hl
7258  1C59              ; 86                 de++;
7259  1C59 13           	inc de
7260  1C5A              ; 87                 //stopByte
7261  1C5A              ; 88                 a = *de;
7262  1C5A 1A           	ld a, (de)
7263  1C5B              ; 89                 //a &= 0x01;
7264  1C5B              ; 90                 ftpFileLoadViewIsNextData = a;
7265  1C5B 32 DA 1C     	ld (ftpfileloadviewisnextdata), a
7266  1C5E              ; 91                 de++;
7267  1C5E 13           	inc de
7268  1C5F              ; 92                 //sum
7269  1C5F              ; 93                 a = *de;
7270  1C5F 1A           	ld a, (de)
7271  1C60              ; 94                 ftpFileLoadViewCheckSum = a;
7272  1C60 32 DD 1C     	ld (ftpfileloadviewchecksum), a
7273  1C63              ; 95                 de++;
7274  1C63 13           	inc de
7275  1C64              ; 96                 // PROGRESS
7276  1C64              ; 97                 a = *de;
7277  1C64 1A           	ld a, (de)
7278  1C65              ; 98                 ftpFileLoadViewProgress = a;
7279  1C65 32 DF 1C     	ld (ftpfileloadviewprogress), a
7280  1C68              ; 99                 de++;
7281  1C68 13           	inc de
7282  1C69              ; 100                 // PAGE SIZE
7283  1C69              ; 101                 a = *de;
7284  1C69 1A           	ld a, (de)
7285  1C6A              ; 102                 if (a >= 15) {
7286  1C6A FE 0F        	cp 15
7287  1C6C DA 71 1C     	jp c, l_508
7288  1C6F              ; 103                     a = 15;
7289  1C6F 3E 0F        	ld a, 15
7290  1C71              l_508:
7291  1C71              ; 104                 }
7292  1C71              ; 105                 de++;
7293  1C71 13           	inc de
7294  1C72              ; 106                 b = a; // SAVE PAGE SIZE in B
7295  1C72 47           	ld b, a
7296  1C73              ; 107                 // Вычесть из ftpFileLoadCurrentPos SIZE
7297  1C73              ; 108                 push_pop(hl) {
7298  1C73 E5           	push hl
7299  1C74              ; 109                     hl = ftpFileLoadCurrentPos;
7300  1C74 2A ED 1C     	ld hl, (ftpfileloadcurrentpos)
7301  1C77              ; 110                     a = l;
7302  1C77 7D           	ld a, l
7303  1C78              ; 111                     a -= b;
7304  1C78 90           	sub b
7305  1C79              ; 112                     if (flag_c) {
7306  1C79 D2 7D 1C     	jp nc, l_510
7307  1C7C              ; 113                         h--;
7308  1C7C 25           	dec h
7309  1C7D              l_510:
7310  1C7D              ; 114                     }
7311  1C7D              ; 115                     l = a;
7312  1C7D 6F           	ld l, a
7313  1C7E              ; 116                     ftpFileLoadCurrentPos = hl;
7314  1C7E 22 ED 1C     	ld (ftpfileloadcurrentpos), hl
7315  1C81 E1           	pop hl
7316  1C82              ; 117                 }
7317  1C82              ; 118                 //CHECK SUM
7318  1C82              ; 119                 push_pop(de) {
7319  1C82 D5           	push de
7320  1C83              ; 120                     push_pop(bc) {
7321  1C83 C5           	push bc
7322  1C84              ; 121                         h = 0; //SUM!!!
7323  1C84 26 00        	ld h, 0
7324  1C86              ; 122                         do {
7325  1C86              l_512:
7326  1C86              ; 123                             a = *de;
7327  1C86 1A           	ld a, (de)
7328  1C87              ; 124                             a += h;
7329  1C87 84           	add h
7330  1C88              ; 125                             h = a;
7331  1C88 67           	ld h, a
7332  1C89              ; 126                             de++;
7333  1C89 13           	inc de
7334  1C8A              ; 127                             b--;
7335  1C8A 05           	dec b
7336  1C8B              l_513:
7337  1C8B              ; 128                         } while ((a = b) > 0);
7338  1C8B 78           	ld a, b
7339  1C8C B7           	or a
7340  1C8D C2 86 1C     	jp nz, l_512
7341  1C90 C1           	pop bc
7342  1C91 D1           	pop de
7343  1C92              ; 129                     }
7344  1C92              ; 130                 }
7345  1C92              ; 131                 //
7346  1C92              ; 132                 if ((a = ftpFileLoadViewCheckSum) == h) {
7347  1C92 3A DD 1C     	ld a, (ftpfileloadviewchecksum)
7348  1C95 BC           	cp h
7349  1C96 C2 D1 1C     	jp nz, l_515
7350  1C99              ; 133                     // Сумма корректная
7351  1C99              ; 134                     if ((a = ftpFileLoadViewIsNextData) == 0) {
7352  1C99 3A DA 1C     	ld a, (ftpfileloadviewisnextdata)
7353  1C9C B7           	or a
7354  1C9D C2 A6 1C     	jp nz, l_517
7355  1CA0              ; 135                         // Данных больше нет - закрываем файл!
7356  1CA0              ; 136                         ordos_stop();
7357  1CA0 CD E2 BF     	call ordos_stop
7358  1CA3 C3 C6 1C     	jp l_518
7359  1CA6              l_517:
7360  1CA6              ; 137                     } else {
7361  1CA6              ; 138                         // Данные корректны и еще есть - пишем
7362  1CA6              ; 139                         // DATA
7363  1CA6              ; 140                         //hl = diskStartNewFile;
7364  1CA6              ; 141                         push_pop(de) {
7365  1CA6 D5           	push de
7366  1CA7              ; 142                             hl = ftpFileLoadCurrentPos;
7367  1CA7 2A ED 1C     	ld hl, (ftpfileloadcurrentpos)
7368  1CAA              ; 143                             d = h;
7369  1CAA 54           	ld d, h
7370  1CAB              ; 144                             e = l;
7371  1CAB 5D           	ld e, l
7372  1CAC              ; 145                             hl = diskStartNewFile;
7373  1CAC 2A D4 0D     	ld hl, (diskstartnewfile)
7374  1CAF              ; 146                             a = l;
7375  1CAF 7D           	ld a, l
7376  1CB0              ; 147                             a += e;
7377  1CB0 83           	add e
7378  1CB1              ; 148                             if (flag_c) {
7379  1CB1 D2 B5 1C     	jp nc, l_519
7380  1CB4              ; 149                                 h++;
7381  1CB4 24           	inc h
7382  1CB5              l_519:
7383  1CB5              ; 150                             }
7384  1CB5              ; 151                             l = a;
7385  1CB5 6F           	ld l, a
7386  1CB6              ; 152                             a = h;
7387  1CB6 7C           	ld a, h
7388  1CB7              ; 153                             a += d;
7389  1CB7 82           	add d
7390  1CB8              ; 154                             h = a;
7391  1CB8 67           	ld h, a
7392  1CB9 D1           	pop de
7393  1CBA              ; 155                         }
7394  1CBA              ; 156                         do {
7395  1CBA              l_521:
7396  1CBA              ; 157                             a = *de;
7397  1CBA 1A           	ld a, (de)
7398  1CBB              ; 158                             ordos_wdisk();
7399  1CBB CD DF BF     	call ordos_wdisk
7400  1CBE              ; 159                             //SUM
7401  1CBE              ; 160                             hl++;
7402  1CBE 23           	inc hl
7403  1CBF              ; 161                             de++;
7404  1CBF 13           	inc de
7405  1CC0              ; 162                             b--;
7406  1CC0 05           	dec b
7407  1CC1              l_522:
7408  1CC1              ; 163                         } while ((a = b) > 0);
7409  1CC1 78           	ld a, b
7410  1CC2 B7           	or a
7411  1CC3 C2 BA 1C     	jp nz, l_521
7412  1CC6              l_518:
7413  1CC6              ; 164                         //diskStartNewFile = hl;
7414  1CC6              ; 165                     }
7415  1CC6              ; 166                     // Получить следующий пакет
7416  1CC6              ; 167                     a = 0x01;
7417  1CC6 3E 01        	ld a, 1
7418  1CC8              ; 168                     ftpFileLoadViewCheckSumState = a;
7419  1CC8 32 DE 1C     	ld (ftpfileloadviewchecksumstate), a
7420  1CCB              ; 169                     // Если считано без ошибок - то отрисовываем прогресс
7421  1CCB              ; 170                     updateProgress();
7422  1CCB CD FE 1B     	call updateprogress
7423  1CCE C3 D6 1C     	jp l_516
7424  1CD1              l_515:
7425  1CD1              ; 171                 } else {
7426  1CD1              ; 172                     // Получить пакет снова!
7427  1CD1              ; 173                     a = 0x00;
7428  1CD1 3E 00        	ld a, 0
7429  1CD3              ; 174                     ftpFileLoadViewCheckSumState = a;
7430  1CD3 32 DE 1C     	ld (ftpfileloadviewchecksumstate), a
7431  1CD6              l_516:
7432  1CD6 C1           	pop bc
7433  1CD7 E1           	pop hl
7434  1CD8 D1           	pop de
7435  1CD9 C9           	ret
7436  1CDA              ; 175                 }
7437  1CDA              ; 176             }
7438  1CDA              ; 177         }
7439  1CDA              ; 178     }
7440  1CDA              ; 179 }
7441  1CDA              ; 180
7442  1CDA              ; 181 uint8_t ftpFileLoadViewIsNextData = 0;
7443  1CDA              ftpfileloadviewisnextdata:
7444  1CDA 00           	db 0
7445  1CDB              ; 182 uint16_t ftpFileLoadViewFileAddrPos = 0x0000;
7446  1CDB              ftpfileloadviewfileaddrpos:
7447  1CDB 00 00        	dw 0
7448  1CDD              ; 183 uint8_t ftpFileLoadViewCheckSum = 0;
7449  1CDD              ftpfileloadviewchecksum:
7450  1CDD 00           	db 0
7451  1CDE              ; 184 uint8_t ftpFileLoadViewCheckSumState = 0;
7452  1CDE              ftpfileloadviewchecksumstate:
7453  1CDE 00           	db 0
7454  1CDF              ; 185 uint8_t ftpFileLoadViewProgress = 0;
7455  1CDF              ftpfileloadviewprogress:
7456  1CDF 00           	db 0
7457  1CE0              ; 187 uint8_t FtpFileLoadViewX = 10;
7458  1CE0              ftpfileloadviewx:
7459  1CE0 0A           	db 10
7460  1CE1              ; 188 uint8_t FtpFileLoadViewY = 11;
7461  1CE1              ftpfileloadviewy:
7462  1CE1 0B           	db 11
7463  1CE2              ; 189 uint8_t FtpFileLoadViewEX = 54;
7464  1CE2              ftpfileloadviewex:
7465  1CE2 36           	db 54
7466  1CE3              ; 190 uint8_t FtpFileLoadViewEY = 14;
7467  1CE3              ftpfileloadviewey:
7468  1CE3 0E           	db 14
7469  1CE4              ; 192 uint16_t FtpFileLoadViewTitlelPos = 0x0B1D; //031B
7470  1CE4              ftpfileloadviewtitlelpos:
7471  1CE4 1D 0B        	dw 2845
7472  1CE6              ; 193 uint8_t FtpFileLoadViewTitlel[] = " LOAD ";
7473  1CE6              ftpfileloadviewtitlel:
7474  1CE6 20           	db 32
7475  1CE7 4C           	db 76
7476  1CE8 4F           	db 79
7477  1CE9 41           	db 65
7478  1CEA 44           	db 68
7479  1CEB 20           	db 32
7480  1CEC 00           	ds 1
7481  1CED              ; 194 uint16_t ftpFileLoadCurrentPos = 0x0000;
7482  1CED              ftpfileloadcurrentpos:
7483  1CED 00 00        	dw 0
7484  1CEF              ; 14 void parsePageBuffer() {
7485  1CEF              parsepagebuffer:
7486  1CEF              ; 15     checkSumPageBuffer();
7487  1CEF CD 1F 1D     	call checksumpagebuffer
7488  1CF2              ; 16     if ((a = parsePageBufferIsCheck) == 1) {
7489  1CF2 3A 53 1D     	ld a, (parsepagebufferischeck)
7490  1CF5 FE 01        	cp 1
7491  1CF7 C2 19 1D     	jp nz, l_524
7492  1CFA              ; 17         push_pop(de) {
7493  1CFA D5           	push de
7494  1CFB              ; 18             push_pop(bc) {
7495  1CFB C5           	push bc
7496  1CFC              ; 19                 de = ESP_I2S_BUFFER;
7497  1CFC 11 8B 13     	ld de, esp_i2s_buffer
7498  1CFF              ; 20                 // pageNum
7499  1CFF              ; 21                 de++;
7500  1CFF 13           	inc de
7501  1D00              ; 22                 // pageSize
7502  1D00              ; 23                 a = *de;
7503  1D00 1A           	ld a, (de)
7504  1D01              ; 24                 b = a;
7505  1D01 47           	ld b, a
7506  1D02              ; 25                 de++;
7507  1D02 13           	inc de
7508  1D03              ; 26                 // next
7509  1D03              ; 27                 a = *de;
7510  1D03 1A           	ld a, (de)
7511  1D04              ; 28                 parsePageBufferNext = a;
7512  1D04 32 52 1D     	ld (parsepagebuffernext), a
7513  1D07              ; 29                 de++;
7514  1D07 13           	inc de
7515  1D08              ; 30                 // buffer
7516  1D08              ; 31                 push_pop(de) {
7517  1D08 D5           	push de
7518  1D09              ; 32                     do {
7519  1D09              l_526:
7520  1D09              ; 33                         a = *de;
7521  1D09 1A           	ld a, (de)
7522  1D0A              ; 34                         *hl = a;
7523  1D0A 77           	ld (hl), a
7524  1D0B              ; 35                         de++;
7525  1D0B 13           	inc de
7526  1D0C              ; 36                         hl++;
7527  1D0C 23           	inc hl
7528  1D0D              ; 37                         b--;
7529  1D0D 05           	dec b
7530  1D0E              l_527:
7531  1D0E              ; 38                     } while ((a = b) > 0);
7532  1D0E 78           	ld a, b
7533  1D0F B7           	or a
7534  1D10 C2 09 1D     	jp nz, l_526
7535  1D13 D1           	pop de
7536  1D14 C1           	pop bc
7537  1D15 D1           	pop de
7538  1D16 C3 1E 1D     	jp l_525
7539  1D19              l_524:
7540  1D19              ; 39                 }
7541  1D19              ; 40             }
7542  1D19              ; 41         }
7543  1D19              ; 42     } else {
7544  1D19              ; 43         a = 0x5A;
7545  1D19 3E 5A        	ld a, 90
7546  1D1B              ; 44         parsePageBufferNext = a;
7547  1D1B 32 52 1D     	ld (parsepagebuffernext), a
7548  1D1E              l_525:
7549  1D1E C9           	ret
7550  1D1F              ; 45     }
7551  1D1F              ; 46 }
7552  1D1F              ; 47
7553  1D1F              ; 48 void checkSumPageBuffer() {
7554  1D1F              checksumpagebuffer:
7555  1D1F              ; 49     push_pop(de) {
7556  1D1F D5           	push de
7557  1D20              ; 50         push_pop(bc) {
7558  1D20 C5           	push bc
7559  1D21              ; 51             de = ESP_I2S_BUFFER;
7560  1D21 11 8B 13     	ld de, esp_i2s_buffer
7561  1D24              ; 52             c = 0; // c == Check SUM
7562  1D24 0E 00        	ld c, 0
7563  1D26              ; 53             // pageNum
7564  1D26              ; 54             a = *de;
7565  1D26 1A           	ld a, (de)
7566  1D27              ; 55             a += c;
7567  1D27 81           	add c
7568  1D28              ; 56             c = a;
7569  1D28 4F           	ld c, a
7570  1D29              ; 57             de++;
7571  1D29 13           	inc de
7572  1D2A              ; 58             // pageSize
7573  1D2A              ; 59             a = *de;
7574  1D2A 1A           	ld a, (de)
7575  1D2B              ; 60             b = a;
7576  1D2B 47           	ld b, a
7577  1D2C              ; 61             a += c;
7578  1D2C 81           	add c
7579  1D2D              ; 62             c = a;
7580  1D2D 4F           	ld c, a
7581  1D2E              ; 63             de++;
7582  1D2E 13           	inc de
7583  1D2F              ; 64             // next
7584  1D2F              ; 65             a = *de;
7585  1D2F 1A           	ld a, (de)
7586  1D30              ; 66             a += c;
7587  1D30 81           	add c
7588  1D31              ; 67             c = a;
7589  1D31 4F           	ld c, a
7590  1D32              ; 68             de++;
7591  1D32 13           	inc de
7592  1D33              ; 69             // buffer
7593  1D33              ; 70             do {
7594  1D33              l_529:
7595  1D33              ; 71                 a = *de;
7596  1D33 1A           	ld a, (de)
7597  1D34              ; 72                 a += c;
7598  1D34 81           	add c
7599  1D35              ; 73                 c = a;
7600  1D35 4F           	ld c, a
7601  1D36              ; 74                 de++;
7602  1D36 13           	inc de
7603  1D37              ; 75                 b--;
7604  1D37 05           	dec b
7605  1D38              l_530:
7606  1D38              ; 76             } while ((a = b) > 0);
7607  1D38 78           	ld a, b
7608  1D39 B7           	or a
7609  1D3A C2 33 1D     	jp nz, l_529
7610  1D3D              ; 77             // sum
7611  1D3D              ; 78             a = *de;
7612  1D3D 1A           	ld a, (de)
7613  1D3E              ; 79             if (a == c) {
7614  1D3E B9           	cp c
7615  1D3F C2 4A 1D     	jp nz, l_532
7616  1D42              ; 80                 a = 1;
7617  1D42 3E 01        	ld a, 1
7618  1D44              ; 81                 parsePageBufferIsCheck = a;
7619  1D44 32 53 1D     	ld (parsepagebufferischeck), a
7620  1D47 C3 4F 1D     	jp l_533
7621  1D4A              l_532:
7622  1D4A              ; 82             } else {
7623  1D4A              ; 83                 a = 0;
7624  1D4A 3E 00        	ld a, 0
7625  1D4C              ; 84                 parsePageBufferIsCheck = a;
7626  1D4C 32 53 1D     	ld (parsepagebufferischeck), a
7627  1D4F              l_533:
7628  1D4F C1           	pop bc
7629  1D50 D1           	pop de
7630  1D51 C9           	ret
7631  1D52              ; 85             }
7632  1D52              ; 86         }
7633  1D52              ; 87     }
7634  1D52              ; 88 }
7635  1D52              ; 89
7636  1D52              ; 90 uint8_t parsePageBufferNext = 0;
7637  1D52              parsepagebuffernext:
7638  1D52 00           	db 0
7639  1D53              ; 91 uint8_t parsePageBufferIsCheck = 0;
7640  1D53              parsepagebufferischeck:
7641  1D53 00           	db 0
7642  1D54              ; 94 void parseFtpListBuffer() {
7643  1D54              parseftplistbuffer:
7644  1D54              ; 95     checkSumFtpListBuffer();
7645  1D54 CD 29 1E     	call checksumftplistbuffer
7646  1D57              ; 96     if ((a = parseFtpListBufferIsCheck) == 1) {
7647  1D57 3A 47 1F     	ld a, (parseftplistbufferischeck)
7648  1D5A FE 01        	cp 1
7649  1D5C C2 C4 1D     	jp nz, l_534
7650  1D5F              ; 97         push_pop(de) {
7651  1D5F D5           	push de
7652  1D60              ; 98             push_pop(bc) {
7653  1D60 C5           	push bc
7654  1D61              ; 99                 push_pop(hl) {
7655  1D61 E5           	push hl
7656  1D62              ; 100                     de = ESP_I2S_BUFFER;
7657  1D62 11 8B 13     	ld de, esp_i2s_buffer
7658  1D65              ; 101                     hl = ftpDirList;
7659  1D65 21 E3 0D     	ld hl, ftpdirlist
7660  1D68              ; 102                     //-- Pos
7661  1D68              ; 103                     a = *de;
7662  1D68 1A           	ld a, (de)
7663  1D69              ; 104                     a &= 0x3F;
7664  1D69 E6 3F        	and 63
7665  1D6B              ; 105                     ftpDirListCount = a;
7666  1D6B 32 64 0F     	ld (ftpdirlistcount), a
7667  1D6E              ; 106                     b = 0;
7668  1D6E 06 00        	ld b, 0
7669  1D70              ; 107                     carry_rotate_left(a, 4);
7670  1D70 17           	rla
7671  1D71 17           	rla
7672  1D72 17           	rla
7673  1D73 17           	rla
7674  1D74              ; 108                     if (flag_c) { // Если переполняние младшего разряда, инкремент старшего
7675  1D74 D2 78 1D     	jp nc, l_536
7676  1D77              ; 109                         b++;
7677  1D77 04           	inc b
7678  1D78              l_536:
7679  1D78              ; 110                     }
7680  1D78              ; 111                     c = a;
7681  1D78 4F           	ld c, a
7682  1D79              ; 112                     hl += bc; // ftpDirList + смещение
7683  1D79 09           	add hl, bc
7684  1D7A              ; 113                     //-- Next
7685  1D7A              ; 114                     a = *de;
7686  1D7A 1A           	ld a, (de)
7687  1D7B              ; 115                     a &= 0x40;
7688  1D7B E6 40        	and 64
7689  1D7D              ; 116                     if (a == 0x40) {
7690  1D7D FE 40        	cp 64
7691  1D7F C2 8A 1D     	jp nz, l_538
7692  1D82              ; 117                         a = 0x01;
7693  1D82 3E 01        	ld a, 1
7694  1D84              ; 118                         ftpDirListNext = a;
7695  1D84 32 63 0F     	ld (ftpdirlistnext), a
7696  1D87 C3 8F 1D     	jp l_539
7697  1D8A              l_538:
7698  1D8A              ; 119                     } else {
7699  1D8A              ; 120                         a = 0x5A;
7700  1D8A 3E 5A        	ld a, 90
7701  1D8C              ; 121                         ftpDirListNext = a;
7702  1D8C 32 63 0F     	ld (ftpdirlistnext), a
7703  1D8F              l_539:
7704  1D8F              ; 122                     }
7705  1D8F              ; 123                     //-- Dir
7706  1D8F              ; 124                     a = *de;
7707  1D8F 1A           	ld a, (de)
7708  1D90              ; 125                     a &= 0x80;
7709  1D90 E6 80        	and 128
7710  1D92              ; 126                     if (a == 0x80) {
7711  1D92 FE 80        	cp 128
7712  1D94 C2 9F 1D     	jp nz, l_540
7713  1D97              ; 127                         a = 1;
7714  1D97 3E 01        	ld a, 1
7715  1D99              ; 128                         ftpDirListIsDir = a;
7716  1D99 32 65 0F     	ld (ftpdirlistisdir), a
7717  1D9C C3 A4 1D     	jp l_541
7718  1D9F              l_540:
7719  1D9F              ; 129                     } else {
7720  1D9F              ; 130                         a = 0;
7721  1D9F 3E 00        	ld a, 0
7722  1DA1              ; 131                         ftpDirListIsDir = a;
7723  1DA1 32 65 0F     	ld (ftpdirlistisdir), a
7724  1DA4              l_541:
7725  1DA4              ; 132                     }
7726  1DA4              ; 133                     //-- SIZE
7727  1DA4              ; 134                     de++;
7728  1DA4 13           	inc de
7729  1DA5              ; 135                     sizeFtpListBuffer();
7730  1DA5 CD CA 1D     	call sizeftplistbuffer
7731  1DA8              ; 136                     //-- NAME
7732  1DA8              ; 137                     a = ' ';
7733  1DA8 3E 20        	ld a, 32
7734  1DAA              ; 138                     *hl = a;
7735  1DAA 77           	ld (hl), a
7736  1DAB              ; 139                     hl++;
7737  1DAB 23           	inc hl
7738  1DAC              ; 140                     b = 9;
7739  1DAC 06 09        	ld b, 9
7740  1DAE              ; 141                     do {
7741  1DAE              l_542:
7742  1DAE              ; 142                         a = *de;
7743  1DAE 1A           	ld a, (de)
7744  1DAF              ; 143                         if (a == 0x00) {
7745  1DAF B7           	or a
7746  1DB0 C2 B5 1D     	jp nz, l_545
7747  1DB3              ; 144                             a = ' ';
7748  1DB3 3E 20        	ld a, 32
7749  1DB5              l_545:
7750  1DB5              ; 145                         }
7751  1DB5              ; 146                         *hl = a;
7752  1DB5 77           	ld (hl), a
7753  1DB6              ; 147                         hl++;
7754  1DB6 23           	inc hl
7755  1DB7              ; 148                         de++;
7756  1DB7 13           	inc de
7757  1DB8              ; 149                         b--;
7758  1DB8 05           	dec b
7759  1DB9              l_543:
7760  1DB9              ; 150                     } while ((a = b) > 0);
7761  1DB9 78           	ld a, b
7762  1DBA B7           	or a
7763  1DBB C2 AE 1D     	jp nz, l_542
7764  1DBE E1           	pop hl
7765  1DBF C1           	pop bc
7766  1DC0 D1           	pop de
7767  1DC1 C3 C9 1D     	jp l_535
7768  1DC4              l_534:
7769  1DC4              ; 151                 }
7770  1DC4              ; 152             }
7771  1DC4              ; 153         }
7772  1DC4              ; 154     } else {
7773  1DC4              ; 155         a = 0xFF; // ERROR
7774  1DC4 3E FF        	ld a, 255
7775  1DC6              ; 156         ftpDirListNext = a;
7776  1DC6 32 63 0F     	ld (ftpdirlistnext), a
7777  1DC9              l_535:
7778  1DC9 C9           	ret
7779  1DCA              ; 157     }
7780  1DCA              ; 158 }
7781  1DCA              ; 159
7782  1DCA              ; 160 // HL - point File
7783  1DCA              ; 161 // DE - point size
7784  1DCA              ; 162 void sizeFtpListBuffer() {
7785  1DCA              sizeftplistbuffer:
7786  1DCA              ; 163     push_pop(hl) {
7787  1DCA E5           	push hl
7788  1DCB              ; 164         b = 10;
7789  1DCB 06 0A        	ld b, 10
7790  1DCD              ; 165         do {
7791  1DCD              l_547:
7792  1DCD              ; 166             hl++;
7793  1DCD 23           	inc hl
7794  1DCE              ; 167             b--;
7795  1DCE 05           	dec b
7796  1DCF              l_548:
7797  1DCF              ; 168         } while ((a = b) > 0);
7798  1DCF 78           	ld a, b
7799  1DD0 B7           	or a
7800  1DD1 C2 CD 1D     	jp nz, l_547
7801  1DD4              ; 169         // -- Separator
7802  1DD4              ; 170         a = ' ';
7803  1DD4 3E 20        	ld a, 32
7804  1DD6              ; 171         *hl = a;
7805  1DD6 77           	ld (hl), a
7806  1DD7              ; 172         hl++;
7807  1DD7 23           	inc hl
7808  1DD8              ; 173         // --
7809  1DD8              ; 174         if ((a = ftpDirListIsDir) == 1) {
7810  1DD8 3A 65 0F     	ld a, (ftpdirlistisdir)
7811  1DDB FE 01        	cp 1
7812  1DDD C2 F9 1D     	jp nz, l_550
7813  1DE0              ; 175             de++;
7814  1DE0 13           	inc de
7815  1DE1              ; 176             de++;
7816  1DE1 13           	inc de
7817  1DE2              ; 177             a = ' ';
7818  1DE2 3E 20        	ld a, 32
7819  1DE4              ; 178             *hl = a;
7820  1DE4 77           	ld (hl), a
7821  1DE5              ; 179             hl++;
7822  1DE5 23           	inc hl
7823  1DE6              ; 180             a = 'D';
7824  1DE6 3E 44        	ld a, 68
7825  1DE8              ; 181             *hl = a;
7826  1DE8 77           	ld (hl), a
7827  1DE9              ; 182             hl++;
7828  1DE9 23           	inc hl
7829  1DEA              ; 183             a = 'I';
7830  1DEA 3E 49        	ld a, 73
7831  1DEC              ; 184             *hl = a;
7832  1DEC 77           	ld (hl), a
7833  1DED              ; 185             hl++;
7834  1DED 23           	inc hl
7835  1DEE              ; 186             a = 'R';
7836  1DEE 3E 52        	ld a, 82
7837  1DF0              ; 187             *hl = a;
7838  1DF0 77           	ld (hl), a
7839  1DF1              ; 188             hl++;
7840  1DF1 23           	inc hl
7841  1DF2              ; 189             a = 0;
7842  1DF2 3E 00        	ld a, 0
7843  1DF4              ; 190             *hl = a;
7844  1DF4 77           	ld (hl), a
7845  1DF5              ; 191             hl++;
7846  1DF5 23           	inc hl
7847  1DF6 C3 27 1E     	jp l_551
7848  1DF9              l_550:
7849  1DF9              ; 192         } else {
7850  1DF9              ; 193             a = *de;
7851  1DF9 1A           	ld a, (de)
7852  1DFA              ; 194             a &= 0xF0;
7853  1DFA E6 F0        	and 240
7854  1DFC              ; 195             cyclic_rotate_right(a, 4);
7855  1DFC 0F           	rrca
7856  1DFD 0F           	rrca
7857  1DFE 0F           	rrca
7858  1DFF 0F           	rrca
7859  1E00              ; 196             convert4bitToCharA();
7860  1E00 CD 70 17     	call convert4bittochara
7861  1E03              ; 197             *hl = a;
7862  1E03 77           	ld (hl), a
7863  1E04              ; 198             hl++;
7864  1E04 23           	inc hl
7865  1E05              ; 199             a = *de;
7866  1E05 1A           	ld a, (de)
7867  1E06              ; 200             a &= 0x0F;
7868  1E06 E6 0F        	and 15
7869  1E08              ; 201             convert4bitToCharA();
7870  1E08 CD 70 17     	call convert4bittochara
7871  1E0B              ; 202             *hl = a;
7872  1E0B 77           	ld (hl), a
7873  1E0C              ; 203             hl++;
7874  1E0C 23           	inc hl
7875  1E0D              ; 204             de++;
7876  1E0D 13           	inc de
7877  1E0E              ; 205             a = *de;
7878  1E0E 1A           	ld a, (de)
7879  1E0F              ; 206             a &= 0xF0;
7880  1E0F E6 F0        	and 240
7881  1E11              ; 207             cyclic_rotate_right(a, 4);
7882  1E11 0F           	rrca
7883  1E12 0F           	rrca
7884  1E13 0F           	rrca
7885  1E14 0F           	rrca
7886  1E15              ; 208             convert4bitToCharA();
7887  1E15 CD 70 17     	call convert4bittochara
7888  1E18              ; 209             *hl = a;
7889  1E18 77           	ld (hl), a
7890  1E19              ; 210             hl++;
7891  1E19 23           	inc hl
7892  1E1A              ; 211             a = *de;
7893  1E1A 1A           	ld a, (de)
7894  1E1B              ; 212             a &= 0x0F;
7895  1E1B E6 0F        	and 15
7896  1E1D              ; 213             convert4bitToCharA();
7897  1E1D CD 70 17     	call convert4bittochara
7898  1E20              ; 214             *hl = a;
7899  1E20 77           	ld (hl), a
7900  1E21              ; 215             hl++;
7901  1E21 23           	inc hl
7902  1E22              ; 216             de++;
7903  1E22 13           	inc de
7904  1E23              ; 217             a = 0;
7905  1E23 3E 00        	ld a, 0
7906  1E25              ; 218             *hl = a;
7907  1E25 77           	ld (hl), a
7908  1E26              ; 219             hl++;
7909  1E26 23           	inc hl
7910  1E27              l_551:
7911  1E27 E1           	pop hl
7912  1E28 C9           	ret
7913  1E29              ; 220         }
7914  1E29              ; 221     }
7915  1E29              ; 222 }
7916  1E29              ; 223
7917  1E29              ; 224 // ESP_I2S_BUFFER
7918  1E29              ; 225 // diskStartNewFile
7919  1E29              ; 226 void checkSumFtpListBuffer() {
7920  1E29              checksumftplistbuffer:
7921  1E29              ; 227     push_pop(de) {
7922  1E29 D5           	push de
7923  1E2A              ; 228         push_pop(bc) {
7924  1E2A C5           	push bc
7925  1E2B              ; 229             de = ESP_I2S_BUFFER;
7926  1E2B 11 8B 13     	ld de, esp_i2s_buffer
7927  1E2E              ; 230             c = 0;
7928  1E2E 0E 00        	ld c, 0
7929  1E30              ; 231             b = 12;
7930  1E30 06 0C        	ld b, 12
7931  1E32              ; 232             do {
7932  1E32              l_552:
7933  1E32              ; 233                 a = *de;
7934  1E32 1A           	ld a, (de)
7935  1E33              ; 234                 a += c;
7936  1E33 81           	add c
7937  1E34              ; 235                 c = a;
7938  1E34 4F           	ld c, a
7939  1E35              ; 236                 de++;
7940  1E35 13           	inc de
7941  1E36              ; 237                 b--;
7942  1E36 05           	dec b
7943  1E37              l_553:
7944  1E37              ; 238             } while ((a = b) > 0);
7945  1E37 78           	ld a, b
7946  1E38 B7           	or a
7947  1E39 C2 32 1E     	jp nz, l_552
7948  1E3C              ; 239             // SUM
7949  1E3C              ; 240             a = *de;
7950  1E3C 1A           	ld a, (de)
7951  1E3D              ; 241             if (a == c) {
7952  1E3D B9           	cp c
7953  1E3E C2 49 1E     	jp nz, l_555
7954  1E41              ; 242                 a = 1;
7955  1E41 3E 01        	ld a, 1
7956  1E43              ; 243                 parseFtpListBufferIsCheck = a;
7957  1E43 32 47 1F     	ld (parseftplistbufferischeck), a
7958  1E46 C3 4E 1E     	jp l_556
7959  1E49              l_555:
7960  1E49              ; 244             } else {
7961  1E49              ; 245                 a = 0;
7962  1E49 3E 00        	ld a, 0
7963  1E4B              ; 246                 parseFtpListBufferIsCheck = a;
7964  1E4B 32 47 1F     	ld (parseftplistbufferischeck), a
7965  1E4E              l_556:
7966  1E4E C1           	pop bc
7967  1E4F D1           	pop de
7968  1E50 C9           	ret
7969  1E51              ; 247             }
7970  1E51              ; 248         }
7971  1E51              ; 249     }
7972  1E51              ; 250 }
7973  1E51              ; 251
7974  1E51              ; 252 /// Парсинг пакета с данными скачиваемого файла
7975  1E51              ; 253 void ftpFileDownloadParse() {
7976  1E51              ftpfiledownloadparse:
7977  1E51              ; 254     checkSumFtpFileDownload();
7978  1E51 CD CD 1E     	call checksumftpfiledownload
7979  1E54              ; 255     if ((a = ftpFileLoadViewCheckSumState) == 1) {
7980  1E54 3A DE 1C     	ld a, (ftpfileloadviewchecksumstate)
7981  1E57 FE 01        	cp 1
7982  1E59 C2 A7 1E     	jp nz, l_557
7983  1E5C              ; 256         push_pop(de) {
7984  1E5C D5           	push de
7985  1E5D              ; 257             push_pop(hl) {
7986  1E5D E5           	push hl
7987  1E5E              ; 258                 push_pop(bc) {
7988  1E5E C5           	push bc
7989  1E5F              ; 259                     de = ESP_I2S_BUFFER;
7990  1E5F 11 8B 13     	ld de, esp_i2s_buffer
7991  1E62              ; 260                     // -- SIZE
7992  1E62              ; 261                     a = *de;
7993  1E62 1A           	ld a, (de)
7994  1E63              ; 262                     ftpFileDownloadParseSizePackA();
7995  1E63 CD 33 1F     	call ftpfiledownloadparsesizepacka
7996  1E66              ; 263                     de++;
7997  1E66 13           	inc de
7998  1E67              ; 264                     // -- ADDRESS
7999  1E67              ; 265                     a = *de;
8000  1E67 1A           	ld a, (de)
8001  1E68              ; 266                     l = a;
8002  1E68 6F           	ld l, a
8003  1E69              ; 267                     de++;
8004  1E69 13           	inc de
8005  1E6A              ; 268                     a = *de;
8006  1E6A 1A           	ld a, (de)
8007  1E6B              ; 269                     h = a;
8008  1E6B 67           	ld h, a
8009  1E6C              ; 270                     ftpFileLoadCurrentPos = hl;
8010  1E6C 22 ED 1C     	ld (ftpfileloadcurrentpos), hl
8011  1E6F              ; 271                     de++;
8012  1E6F 13           	inc de
8013  1E70              ; 272                     // -- PROGRESS AND NEXT
8014  1E70              ; 273                     a = *de;
8015  1E70 1A           	ld a, (de)
8016  1E71              ; 274                     ftpFileDownloadParseProgressAndNextA();
8017  1E71 CD 00 1F     	call ftpfiledownloadparseprogressandn
8018  1E74              ; 275                     de++;
8019  1E74 13           	inc de
8020  1E75              ; 276                     // -- DATA
8021  1E75              ; 277                     // Если контрольная сумма совпала и есть статус что данные есть - пишем на диск
8022  1E75              ; 278                     if ((a = ftpFileLoadViewIsNextData) == 0x01) {
8023  1E75 3A DA 1C     	ld a, (ftpfileloadviewisnextdata)
8024  1E78 FE 01        	cp 1
8025  1E7A C2 93 1E     	jp nz, l_559
8026  1E7D              ; 279                         ftpFileDownloadCalkDiskPosToHL();
8027  1E7D CD AD 1E     	call ftpfiledownloadcalkdiskpostohl
8028  1E80              ; 280                         a = ftpFileDownloadDataSize;
8029  1E80 3A 46 1F     	ld a, (ftpfiledownloaddatasize)
8030  1E83              ; 281                         b = a;
8031  1E83 47           	ld b, a
8032  1E84              ; 282                         do {
8033  1E84              l_561:
8034  1E84              ; 283                             a = *de;
8035  1E84 1A           	ld a, (de)
8036  1E85              ; 284                             ordos_wdisk();
8037  1E85 CD DF BF     	call ordos_wdisk
8038  1E88              ; 285                             de++;
8039  1E88 13           	inc de
8040  1E89              ; 286                             hl++;
8041  1E89 23           	inc hl
8042  1E8A              ; 287                             b--;
8043  1E8A 05           	dec b
8044  1E8B              l_562:
8045  1E8B              ; 288                         } while ((a = b) > 0);
8046  1E8B 78           	ld a, b
8047  1E8C B7           	or a
8048  1E8D C2 84 1E     	jp nz, l_561
8049  1E90              ; 289                         ftpFileDownloadEnd = hl;
8050  1E90 22 49 1F     	ld (ftpfiledownloadend), hl
8051  1E93              l_559:
8052  1E93              ; 290                     }
8053  1E93              ; 291                     // Если контрольная сумма совпала и статус что данные закончились - закрываем файл
8054  1E93              ; 292                     if ((a = ftpFileLoadViewIsNextData) == 0x5A) {
8055  1E93 3A DA 1C     	ld a, (ftpfileloadviewisnextdata)
8056  1E96 FE 5A        	cp 90
8057  1E98 C2 A1 1E     	jp nz, l_564
8058  1E9B              ; 293                         hl = ftpFileDownloadEnd;
8059  1E9B 2A 49 1F     	ld hl, (ftpfiledownloadend)
8060  1E9E              ; 294                         ordos_stop();
8061  1E9E CD E2 BF     	call ordos_stop
8062  1EA1              l_564:
8063  1EA1 C1           	pop bc
8064  1EA2 E1           	pop hl
8065  1EA3 D1           	pop de
8066  1EA4 C3 AC 1E     	jp l_558
8067  1EA7              l_557:
8068  1EA7              ; 295                     }
8069  1EA7              ; 296                 }
8070  1EA7              ; 297             }
8071  1EA7              ; 298         }
8072  1EA7              ; 299     } else {
8073  1EA7              ; 300         a = 0xFF;
8074  1EA7 3E FF        	ld a, 255
8075  1EA9              ; 301         ftpFileLoadViewIsNextData = a;
8076  1EA9 32 DA 1C     	ld (ftpfileloadviewisnextdata), a
8077  1EAC              l_558:
8078  1EAC C9           	ret
8079  1EAD              ; 302     }
8080  1EAD              ; 303 }
8081  1EAD              ; 304
8082  1EAD              ; 305 /// Считаем адрес куда писать данные на диск
8083  1EAD              ; 306 void ftpFileDownloadCalkDiskPosToHL() {
8084  1EAD              ftpfiledownloadcalkdiskpostohl:
8085  1EAD              ; 307     push_pop(de) {
8086  1EAD D5           	push de
8087  1EAE              ; 308         // получаем адрес пакета
8088  1EAE              ; 309         hl = ftpFileLoadCurrentPos;
8089  1EAE 2A ED 1C     	ld hl, (ftpfileloadcurrentpos)
8090  1EB1              ; 310         // вычитаем длину пакета данных
8091  1EB1              ; 311         a = ftpFileDownloadDataSize;
8092  1EB1 3A 46 1F     	ld a, (ftpfiledownloaddatasize)
8093  1EB4              ; 312         e = a;
8094  1EB4 5F           	ld e, a
8095  1EB5              ; 313         a = l;
8096  1EB5 7D           	ld a, l
8097  1EB6              ; 314         a -= e;
8098  1EB6 93           	sub e
8099  1EB7              ; 315         if (flag_c) {
8100  1EB7 D2 BB 1E     	jp nc, l_566
8101  1EBA              ; 316             h--;
8102  1EBA 25           	dec h
8103  1EBB              l_566:
8104  1EBB              ; 317         }
8105  1EBB              ; 318         l = a;
8106  1EBB 6F           	ld l, a
8107  1EBC              ; 319         // прибавляем к точке начала файла на диске
8108  1EBC              ; 320         d = h;
8109  1EBC 54           	ld d, h
8110  1EBD              ; 321         e = l;
8111  1EBD 5D           	ld e, l
8112  1EBE              ; 322         hl = diskStartNewFile;
8113  1EBE 2A D4 0D     	ld hl, (diskstartnewfile)
8114  1EC1              ; 323         a = l;
8115  1EC1 7D           	ld a, l
8116  1EC2              ; 324         a += e;
8117  1EC2 83           	add e
8118  1EC3              ; 325         if (flag_c) {
8119  1EC3 D2 C7 1E     	jp nc, l_568
8120  1EC6              ; 326             h++;
8121  1EC6 24           	inc h
8122  1EC7              l_568:
8123  1EC7              ; 327         }
8124  1EC7              ; 328         l = a;
8125  1EC7 6F           	ld l, a
8126  1EC8              ; 329         a = h;
8127  1EC8 7C           	ld a, h
8128  1EC9              ; 330         a += d;
8129  1EC9 82           	add d
8130  1ECA              ; 331         h = a;
8131  1ECA 67           	ld h, a
8132  1ECB D1           	pop de
8133  1ECC C9           	ret
8134  1ECD              ; 332         // В HL адрес записи, полученных данных, на диск
8135  1ECD              ; 333     }
8136  1ECD              ; 334 }
8137  1ECD              ; 335
8138  1ECD              ; 336 /// Подсчет контрольной суммы
8139  1ECD              ; 337 void checkSumFtpFileDownload() {
8140  1ECD              checksumftpfiledownload:
8141  1ECD              ; 338     push_pop(de) {
8142  1ECD D5           	push de
8143  1ECE              ; 339         push_pop(bc) {
8144  1ECE C5           	push bc
8145  1ECF              ; 340             de = ESP_I2S_BUFFER;
8146  1ECF 11 8B 13     	ld de, esp_i2s_buffer
8147  1ED2              ; 341             a = *de;
8148  1ED2 1A           	ld a, (de)
8149  1ED3              ; 342             ftpFileDownloadParseSizePackA();
8150  1ED3 CD 33 1F     	call ftpfiledownloadparsesizepacka
8151  1ED6              ; 343             a = ftpFileDownloadPropertySize;
8152  1ED6 3A 45 1F     	ld a, (ftpfiledownloadpropertysize)
8153  1ED9              ; 344             b = a;
8154  1ED9 47           	ld b, a
8155  1EDA              ; 345             a = ftpFileDownloadDataSize;
8156  1EDA 3A 46 1F     	ld a, (ftpfiledownloaddatasize)
8157  1EDD              ; 346             a += b;
8158  1EDD 80           	add b
8159  1EDE              ; 347             b = a;
8160  1EDE 47           	ld b, a
8161  1EDF              ; 348             //
8162  1EDF              ; 349             c = 0;
8163  1EDF 0E 00        	ld c, 0
8164  1EE1              ; 350             do {
8165  1EE1              l_570:
8166  1EE1              ; 351                 a = *de;
8167  1EE1 1A           	ld a, (de)
8168  1EE2              ; 352                 a += c;
8169  1EE2 81           	add c
8170  1EE3              ; 353                 c = a;
8171  1EE3 4F           	ld c, a
8172  1EE4              ; 354                 de++;
8173  1EE4 13           	inc de
8174  1EE5              ; 355                 b--;
8175  1EE5 05           	dec b
8176  1EE6              l_571:
8177  1EE6              ; 356             } while ((a = b) > 0);
8178  1EE6 78           	ld a, b
8179  1EE7 B7           	or a
8180  1EE8 C2 E1 1E     	jp nz, l_570
8181  1EEB              ; 357             //
8182  1EEB              ; 358             a = *de;
8183  1EEB 1A           	ld a, (de)
8184  1EEC              ; 359             if (a == c) {
8185  1EEC B9           	cp c
8186  1EED C2 F8 1E     	jp nz, l_573
8187  1EF0              ; 360                 a = 1;
8188  1EF0 3E 01        	ld a, 1
8189  1EF2              ; 361                 ftpFileLoadViewCheckSumState = a;
8190  1EF2 32 DE 1C     	ld (ftpfileloadviewchecksumstate), a
8191  1EF5 C3 FD 1E     	jp l_574
8192  1EF8              l_573:
8193  1EF8              ; 362             } else {
8194  1EF8              ; 363                 a = 0;
8195  1EF8 3E 00        	ld a, 0
8196  1EFA              ; 364                 ftpFileLoadViewCheckSumState = a;
8197  1EFA 32 DE 1C     	ld (ftpfileloadviewchecksumstate), a
8198  1EFD              l_574:
8199  1EFD C1           	pop bc
8200  1EFE D1           	pop de
8201  1EFF C9           	ret
8202  1F00              ; 365             }
8203  1F00              ; 366         }
8204  1F00              ; 367     }
8205  1F00              ; 368 }
8206  1F00              ; 369
8207  1F00              ; 370 /// Извлекает из A данные о прогрессе и Статус продолжение данных
8208  1F00              ; 371 /// первые 6 бит - прогресс.
8209  1F00              ; 372 /// последние 2 - статус продолжения. (0x80 - если еще есть данные. 0x40 - данные закончились. 0x00 - ошибка данных)
8210  1F00              ; 373 void ftpFileDownloadParseProgressAndNextA() {
8211  1F00              ftpfiledownloadparseprogressandn:
8212  1F00              ; 374     push_pop(bc) {
8213  1F00 C5           	push bc
8214  1F01              ; 375         b = a;
8215  1F01 47           	ld b, a
8216  1F02              ; 376         a &= 0x3F;
8217  1F02 E6 3F        	and 63
8218  1F04              ; 377         ftpFileLoadViewProgress = a;
8219  1F04 32 DF 1C     	ld (ftpfileloadviewprogress), a
8220  1F07              ; 378         //
8221  1F07              ; 379         a = b;
8222  1F07 78           	ld a, b
8223  1F08              ; 380         a &= 0xC0;
8224  1F08 E6 C0        	and 192
8225  1F0A              ; 381         b = a;
8226  1F0A 47           	ld b, a
8227  1F0B              ; 382         // --
8228  1F0B              ; 383         if ((a = b) == 0x80) {
8229  1F0B 78           	ld a, b
8230  1F0C FE 80        	cp 128
8231  1F0E C2 19 1F     	jp nz, l_575
8232  1F11              ; 384             a = 0x01;
8233  1F11 3E 01        	ld a, 1
8234  1F13              ; 385             ftpFileLoadViewIsNextData = a;
8235  1F13 32 DA 1C     	ld (ftpfileloadviewisnextdata), a
8236  1F16 C3 31 1F     	jp l_576
8237  1F19              l_575:
8238  1F19              ; 386         } else if ((a = b) == 0x40) {
8239  1F19 78           	ld a, b
8240  1F1A FE 40        	cp 64
8241  1F1C C2 27 1F     	jp nz, l_577
8242  1F1F              ; 387             a = 0x5A;
8243  1F1F 3E 5A        	ld a, 90
8244  1F21              ; 388             ftpFileLoadViewIsNextData = a;
8245  1F21 32 DA 1C     	ld (ftpfileloadviewisnextdata), a
8246  1F24 C3 31 1F     	jp l_578
8247  1F27              l_577:
8248  1F27              ; 389         } else {
8249  1F27              ; 390             a = 0xFF;
8250  1F27 3E FF        	ld a, 255
8251  1F29              ; 391             ftpFileLoadViewIsNextData = a;
8252  1F29 32 DA 1C     	ld (ftpfileloadviewisnextdata), a
8253  1F2C              ; 392             a = 0;
8254  1F2C 3E 00        	ld a, 0
8255  1F2E              ; 393             ftpFileLoadViewCheckSumState = a;
8256  1F2E 32 DE 1C     	ld (ftpfileloadviewchecksumstate), a
8257  1F31              l_578:
8258  1F31              l_576:
8259  1F31 C1           	pop bc
8260  1F32 C9           	ret
8261  1F33              ; 394         }
8262  1F33              ; 395     }
8263  1F33              ; 396 }
8264  1F33              ; 397
8265  1F33              ; 398 /// Извлекает из A данные по размерам пакета (свойства + буфер)
8266  1F33              ; 399 /// первые 3 бита - свойства, последние 5 - данные
8267  1F33              ; 400 /// (property & 0x07) + ((data & 0x1f)<<3);
8268  1F33              ; 401 void ftpFileDownloadParseSizePackA() {
8269  1F33              ftpfiledownloadparsesizepacka:
8270  1F33              ; 402     push_pop(bc) {
8271  1F33 C5           	push bc
8272  1F34              ; 403         b = a;
8273  1F34 47           	ld b, a
8274  1F35              ; 404         a &= 0x07;
8275  1F35 E6 07        	and 7
8276  1F37              ; 405         ftpFileDownloadPropertySize = a;
8277  1F37 32 45 1F     	ld (ftpfiledownloadpropertysize), a
8278  1F3A              ; 406         a = b;
8279  1F3A 78           	ld a, b
8280  1F3B              ; 407         a &= 0xF8;
8281  1F3B E6 F8        	and 248
8282  1F3D              ; 408         carry_rotate_right(a, 3);
8283  1F3D 1F           	rra
8284  1F3E 1F           	rra
8285  1F3F 1F           	rra
8286  1F40              ; 409         ftpFileDownloadDataSize = a;
8287  1F40 32 46 1F     	ld (ftpfiledownloaddatasize), a
8288  1F43 C1           	pop bc
8289  1F44 C9           	ret
8290  1F45              ; 410     }
8291  1F45              ; 411 }
8292  1F45              ; 412
8293  1F45              ; 413 uint8_t ftpFileDownloadPropertySize = 0;
8294  1F45              ftpfiledownloadpropertysize:
8295  1F45 00           	db 0
8296  1F46              ; 414 uint8_t ftpFileDownloadDataSize = 0;
8297  1F46              ftpfiledownloaddatasize:
8298  1F46 00           	db 0
8299  1F47              ; 415 uint8_t parseFtpListBufferIsCheck = 0;
8300  1F47              parseftplistbufferischeck:
8301  1F47 00           	db 0
8302  1F48              ; 416 uint8_t ftpFileDownloadIsCheck = 0;
8303  1F48              ftpfiledownloadischeck:
8304  1F48 00           	db 0
8305  1F49              ; 417 uint16_t ftpFileDownloadEnd = 0;
8306  1F49              ftpfiledownloadend:
8307  1F49 00 00        	dw 0
8308  1F4B              ; 11 void DEBUGFirstCurA() {
8309  1F4B              debugfirstcura:
8310  1F4B              ; 12     push_pop(hl) {
8311  1F4B E5           	push hl
8312  1F4C              ; 13         l = 1;
8313  1F4C 2E 01        	ld l, 1
8314  1F4E              ; 14         h = a;
8315  1F4E 67           	ld h, a
8316  1F4F              ; 15         setPosCursor();
8317  1F4F CD 3C F8     	call setposcursor
8318  1F52 E1           	pop hl
8319  1F53 C9           	ret
8320  1F54              ; 16     }
8321  1F54              ; 17 }
8322  1F54              ; 18
8323  1F54              ; 19 void DEBUGShowHexA() {
8324  1F54              debugshowhexa:
8325  1F54              ; 20     printHexA();
8326  1F54 CD 15 F8     	call printhexa
8327  1F57              ; 21     a = ' ';
8328  1F57 3E 20        	ld a, 32
8329  1F59              ; 22     printChatA();
8330  1F59 C3 0F F8     	jp printchata
8331  1F5C              ; 32 uint8_t rootTimerTike = 0;
8332  1F5C              roottimertike:
8333  1F5C 00           	db 0
8334  1F5D               savebin "test.ORD", 0x00f0, 0x200f
8335  1F5D
# file closed: main.asm
