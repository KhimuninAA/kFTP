# file opened: main.asm
   1  0000                  device zxspectrum48 ; There is no ZX Spectrum, it is needed for the sjasmplus assembler.
   2  0000              ordos_wnd equ 49110
   3  0000              ordos_sdma equ 49104
   4  0000              ordos_watf equ 49098
   5  0000              ordos_wfile equ 49143
   6  0000              ordos_stop equ 49122
   7  0000              ordos_dirm equ 49128
   8  0000              ordos_start equ 49149
   9  0000              ordos_mxdsk equ 49080
  10  0000              ordos_rmax equ 49089
  11  0000              ordos_wdisk equ 49119
  12  0000              ordos_rdisk equ 49116
  13  0000              fontaddress equ 62417
  14  0000              inverceaddress equ 62419
  15  0000              printhexa equ 63509
  16  0000              printchata equ 63503
  17  0000              printchatc equ 63497
  18  0000              writebyteinothermem equ 63545
  19  0000              setposcursor equ 63548
  20  0000              getposcursor equ 63518
  21  0000              printhlstr equ 63512
  22  0000              getkeyboardchara equ 63491
  23  0000              getkeyboardstatea equ 63506
  24  0000              getkeyboardcodea equ 63515
  25  0000              vv55_setup equ 62979
  26  0000              vv55_port_c equ 62978
  27  0000              ; 12 void ordos_wnd() __address(0xbfd6);
  28  0000              ; 13 ///запись н/адреса буфера имени файла
  29  0000              ; 14 void ordos_sdma() __address(0xbfd0);
  30  0000              ; 15 ///запись адресов (н/к) блока озу
  31  0000              ; 16 void ordos_watf() __address(0xbfca);
  32  0000              ; 17 ///пп.записи файла на диск
  33  0000              ; 18 void ordos_wfile() __address(0xbff7);
  34  0000              ; 19 ///запись стоп-слова в диск
  35  0000              ; 20 void ordos_stop() __address(0xbfe2);
  36  0000              ; 21 /// вывод каталога диска в буфер
  37  0000              ; 22 void ordos_dirm() __address(0xbfe8);
  38  0000              ; 23 /// вход в ос "ordos"
  39  0000              ; 24 void ordos_start() __address(0xbffd);
  40  0000              ; 25 /// конеч.адрес программ.на диске (FF адрес стоп байта) HL
  41  0000              ; 26 void ordos_mxdsk() __address(0xbfb8);
  42  0000              ; 27 /// чтение максимального адреса диска HL
  43  0000              ; 28 void ordos_rmax() __address(0xbfc1);
  44  0000              ; 29 /// запись байта в диск HL-addr A-byte
  45  0000              ; 30 void ordos_wdisk() __address(0xbfdf);
  46  0000              ; 31 /// чтение байта из диска HL-addr A-byte
  47  0000              ; 32 void ordos_rdisk() __address(0xbfdc);
  48  0000              ; 12 extern uint16_t fontAddress __address(0xF3D1);
  49  0000              ; 13 ///ячейка, хранящая признак прямого (00Н) вывода (светлые символы на темном фоне) или инверсного (0FFH) вывода (темные символы на светлом фоне)
  50  0000              ; 14 extern uint16_t inverceAddress __address(0xF3D3);
  51  0000              ; 15
  52  0000              ; 16 ///-----* Функции Монитора *-------
  53  0000              ; 17 ///Вывод на экран HEX из регистра A
  54  0000              ; 18 void printHexA() __address(0xF815);
  55  0000              ; 19 ///Вывод символа на экран из регистра A
  56  0000              ; 20 void printChatA() __address(0xF80F);
  57  0000              ; 21 ///Вывод символа на экран из регистра С
  58  0000              ; 22 void printChatC() __address(0xF809);
  59  0000              ; 23 ///ЗАПИСЬ БАЙТА В ДОП. СТРАНИЦУ HL — АДРЕСА — N СТРАНИЦЫ (0-3) C — ЗАПИСЫВАЕМЫЙ БАЙТ
  60  0000              ; 24 void writeByteInOtherMem() __address(0xF839);
  61  0000              ; 25 ///УСТАНОВКА КУРСОРА ВХ. Н — НОМЕР СТРОКИ — Y L — НОМЕР ПОЗИЦИИ — X
  62  0000              ; 26 void setPosCursor() __address(0xF83C);
  63  0000              ; 27 ///ЗАПРОС ПОЛОЖЕНИЯ КУРСОРА Н - НОМЕР СТРОКИ - Y , L - НОМЕР ПОЗИЦИИ - X
  64  0000              ; 28 void getPosCursor() __address(0xF81E);
  65  0000              ; 29 ///ВЫВОД НА ЭКРАН СООБЩЕНИЯ ВХ.: HL- - АДРЕС НАЧАЛА КОНЕЧНЫЙ БАЙТ - 00Н
  66  0000              ; 30 void printHLStr() __address(0xF818);
  67  0000              ; 31
  68  0000              ; 32 ///ВВОД C СИМВОЛА С КЛАВИАТУРЫ А - ВВЕДЕННЫЙ СИМВОЛ
  69  0000              ; 33 void getKeyboardCharA() __address(0xF803);
  70  0000              ; 34 ///ОПРОС СОСТОЯНИЯ КЛАВИАТУРЫ А = 00Н - НЕ НАЖАТА , А = 0FFH - НАЖАТА
  71  0000              ; 35 void getKeyboardStateA() __address(0xF812);
  72  0000              ; 36 ///ВВОД КОДА НАЖАТОЙ КЛАВИШИ А = 0FFH - НЕ НАЖАТА А = 0FEH - РУС/ЛАТ ИНАЧЕ - КОД КЛАВИШИ
  73  0000              ; 37 void getKeyboardCodeA() __address(0xF81B);
  74  0000              ; 11 extern uint16_t VV55_SETUP __address(0xF603);
  75  0000              ; 12 extern uint16_t VV55_PORT_C __address(0xF602);
  76  0000
  77  0000                  org 0x00F0
  78  00F0
  79  00F0              ; 21 uint8_t appName[] = {'K','F','T','P','$',' ',' ',' '};
  80  00F0              appname:
  81  00F0 4B           	db 75
  82  00F1 46           	db 70
  83  00F2 54           	db 84
  84  00F3 50           	db 80
  85  00F4 24           	db 36
  86  00F5 20           	db 32
  87  00F6 20           	db 32
  88  00F7 20           	db 32
  89  00F8
  90  00F8
  91  00F8 00 01            DB 0x00, 0x01
  92  00FA
  93  00FA 00 1C            DB 0x00, 0x1C
  94  00FC
  95  00FC 00 00 00 00      DB 0x00, 0x00, 0x00, 0x00
  96  0100
  97  0100              ; 32 void main(){
  98  0100              main:
  99  0100              ; 33     updateDiskList();
 100  0100 CD BE 03     	call updatedisklist
 101  0103              ; 34     initI2C();
 102  0103 CD 18 12     	call initi2c
 103  0106              ; 35     ///
 104  0106              ; 36
 105  0106              ; 37     /// WiFI
 106  0106              ; 38     delay5msI2C(); delay5msI2C();
 107  0106 CD DD 12     	call delay5msi2c
 108  0109 CD DD 12     	call delay5msi2c
 109  010C              ; 39     getSSIDValue();
 110  010C CD DE 13     	call getssidvalue
 111  010F              ; 40     delay5msI2C(); delay5msI2C();
 112  010F CD DD 12     	call delay5msi2c
 113  0112 CD DD 12     	call delay5msi2c
 114  0115              ; 41     getSSIDPasswordValue();
 115  0115 CD 0D 14     	call getssidpasswordvalue
 116  0118              ; 42
 117  0118              ; 43     /// FTP
 118  0118              ; 44     delay5msI2C(); delay5msI2C();
 119  0118 CD DD 12     	call delay5msi2c
 120  011B CD DD 12     	call delay5msi2c
 121  011E              ; 45     getFTPUrl();
 122  011E CD 54 15     	call getftpurl
 123  0121              ; 46     delay5msI2C(); delay5msI2C();
 124  0121 CD DD 12     	call delay5msi2c
 125  0124 CD DD 12     	call delay5msi2c
 126  0127              ; 47     getFTPUser();
 127  0127 CD C4 15     	call getftpuser
 128  012A              ; 48     delay5msI2C(); delay5msI2C();
 129  012A CD DD 12     	call delay5msi2c
 130  012D CD DD 12     	call delay5msi2c
 131  0130              ; 49     getFTPPassword();
 132  0130 CD 34 16     	call getftppassword
 133  0133              ; 50     delay5msI2C(); delay5msI2C();
 134  0133 CD DD 12     	call delay5msi2c
 135  0136 CD DD 12     	call delay5msi2c
 136  0139              ; 51     getFTPPort();
 137  0139 CD A4 16     	call getftpport
 138  013C              ; 52
 139  013C              ; 53     ///
 140  013C              ; 54     updateRootUI();
 141  013C CD 17 02     	call updaterootui
 142  013F              ; 55
 143  013F              ; 56     updateRootDataUI();
 144  013F CD 14 02     	call updaterootdataui
 145  0142              ; 57
 146  0142              ; 58     //Бесконечный цикл. Что бы увидеть результат
 147  0142              ; 59     for (;;) {
 148  0142              l_1:
 149  0142              ; 60         getKeyboardStateA();
 150  0142 CD 12 F8     	call getkeyboardstatea
 151  0145              ; 61         if (a == 0xFF) {
 152  0145 FE FF        	cp 255
 153  0147 C2 50 01     	jp nz, l_3
 154  014A              ; 62             // Если клавиша нажата - вызываем обработчик
 155  014A              ; 63             keyboardEvent();
 156  014A CD 74 01     	call keyboardevent
 157  014D C3 71 01     	jp l_4
 158  0150              l_3:
 159  0150              ; 64         } else {
 160  0150              ; 65             a = rootTimerTike;
 161  0150 3A 32 1C     	ld a, (roottimertike)
 162  0153              ; 66             if (a >= 240) {
 163  0153 FE F0        	cp 240
 164  0155 DA 6D 01     	jp c, l_5
 165  0158              ; 67                 a = 0;
 166  0158 3E 00        	ld a, 0
 167  015A              ; 68                 rootTimerTike = a;
 168  015A 32 32 1C     	ld (roottimertike), a
 169  015D              ; 69                 if ((a = rootViewCurrentView) == rootViewCurrentDiskView) {
 170  015D 3A 99 0F     	ld a, (rootviewcurrentview)
 171  0160 B7           	or a
 172  0161 C2 6A 01     	jp nz, l_7
 173  0164              ; 70                     updateWiFiStatus();
 174  0164 CD 05 0B     	call updatewifistatus
 175  0167              ; 71                     updateFtpStatus();
 176  0167 CD 4B 08     	call updateftpstatus
 177  016A              l_7:
 178  016A C3 71 01     	jp l_6
 179  016D              l_5:
 180  016D              ; 72                 }
 181  016D              ; 73             } else {
 182  016D              ; 74                 a++;
 183  016D 3C           	inc a
 184  016E              ; 75                 rootTimerTike = a;
 185  016E 32 32 1C     	ld (roottimertike), a
 186  0171              l_6:
 187  0171              l_4:
 188  0171 C3 42 01     	jp l_1
 189  0174              ; 76             }
 190  0174              ; 77         }
 191  0174              ; 78     }
 192  0174              ; 79 }
 193  0174              ; 80
 194  0174              ; 81 void keyboardEvent() {
 195  0174              keyboardevent:
 196  0174              ; 82     getKeyboardCodeA();
 197  0174 CD 1B F8     	call getkeyboardcodea
 198  0177              ; 83     l = a; //Save key
 199  0177 6F           	ld l, a
 200  0178              ; 84     if ((a = rootViewOldKey) != l) {
 201  0178 3A DA 0F     	ld a, (rootviewoldkey)
 202  017B BD           	cp l
 203  017C CA 13 02     	jp z, l_9
 204  017F              ; 85         a = l; //Load key
 205  017F 7D           	ld a, l
 206  0180              ; 86         rootViewOldKey = a;
 207  0180 32 DA 0F     	ld (rootviewoldkey), a
 208  0183              ; 87         push_pop(hl) {
 209  0183 E5           	push hl
 210  0184              ; 88             a = l; //Load key
 211  0184 7D           	ld a, l
 212  0185              ; 89             if (a != 0xFF) {
 213  0185 FE FF        	cp 255
 214  0187 CA 12 02     	jp z, l_11
 215  018A              ; 90                 /// Hot ley
 216  018A              ; 91                 if (a == 0x03) { //F4 quit ordos
 217  018A FE 03        	cp 3
 218  018C C2 95 01     	jp nz, l_13
 219  018F              ; 92                     ordos_start();
 220  018F CD FD BF     	call ordos_start
 221  0192 C3 BC 01     	jp l_14
 222  0195              l_13:
 223  0195              ; 93                 } else if (a == 0x02) { //F3 Open FTP settings
 224  0195 FE 02        	cp 2
 225  0197 C2 A0 01     	jp nz, l_15
 226  019A              ; 94                     needOpenFTPSettingsEditView();
 227  019A CD 61 05     	call needopenftpsettingseditview
 228  019D C3 BC 01     	jp l_16
 229  01A0              l_15:
 230  01A0              ; 95                 } else if (a == 0x01) { //F2 Open WiFi settings
 231  01A0 FE 01        	cp 1
 232  01A2 C2 AB 01     	jp nz, l_17
 233  01A5              ; 96                     needOpenWiFiSettingsEditView();
 234  01A5 CD 82 08     	call needopenwifisettingseditview
 235  01A8 C3 BC 01     	jp l_18
 236  01AB              l_17:
 237  01AB              ; 97                 } else if (a == 'C') { // Button C
 238  01AB FE 43        	cp 67
 239  01AD C2 BC 01     	jp nz, l_19
 240  01B0              ; 98                     createTestFile();
 241  01B0 CD 3C 10     	call createtestfile
 242  01B3              ; 99                     updateDiskList();
 243  01B3 CD BE 03     	call updatedisklist
 244  01B6              ; 100                     updateRootUI();
 245  01B6 CD 17 02     	call updaterootui
 246  01B9              ; 101                     showDiskList();
 247  01B9 CD CE 03     	call showdisklist
 248  01BC              l_19:
 249  01BC              l_18:
 250  01BC              l_16:
 251  01BC              l_14:
 252  01BC              ; 102                 }
 253  01BC              ; 103
 254  01BC              ; 104                 /// View's
 255  01BC              ; 105                 if ((a = rootViewCurrentView) == rootViewCurrentDiskView) { // Local disk
 256  01BC 3A 99 0F     	ld a, (rootviewcurrentview)
 257  01BF B7           	or a
 258  01C0 C2 CD 01     	jp nz, l_21
 259  01C3              ; 106                     a = l; //Load key
 260  01C3 7D           	ld a, l
 261  01C4              ; 107                     diskViewKeyA();
 262  01C4 CD 78 04     	call diskviewkeya
 263  01C7              ; 108                     showDiskList(); //Refresh
 264  01C7 CD CE 03     	call showdisklist
 265  01CA C3 12 02     	jp l_22
 266  01CD              l_21:
 267  01CD              ; 109                 } else if ((a = rootViewCurrentView) == rootViewCurrentFTPView) { // FTP Dir
 268  01CD 3A 99 0F     	ld a, (rootviewcurrentview)
 269  01D0 FE 01        	cp 1
 270  01D2 C2 DF 01     	jp nz, l_23
 271  01D5              ; 110                     a = l; //Load key
 272  01D5 7D           	ld a, l
 273  01D6              ; 111                     ftpViewKeyA();
 274  01D6 CD EB 18     	call ftpviewkeya
 275  01D9              ; 112                     ftpViewDataUpdate();
 276  01D9 CD 89 18     	call ftpviewdataupdate
 277  01DC C3 12 02     	jp l_24
 278  01DF              l_23:
 279  01DF              ; 113                 } else if ((a = rootViewCurrentView) == rootViewCurrentFTPSettingsEditView) {
 280  01DF 3A 99 0F     	ld a, (rootviewcurrentview)
 281  01E2 FE 02        	cp 2
 282  01E4 C2 F1 01     	jp nz, l_25
 283  01E7              ; 114                     a = l; //Load key
 284  01E7 7D           	ld a, l
 285  01E8              ; 115                     ftpSettingsEditViewKeyA();
 286  01E8 CD DC 07     	call ftpsettingseditviewkeya
 287  01EB              ; 116                     ftpSettingsEditViewDataUpdate();
 288  01EB CD F2 06     	call ftpsettingseditviewdataupdate
 289  01EE C3 12 02     	jp l_26
 290  01F1              l_25:
 291  01F1              ; 117                 } else if ((a = rootViewCurrentView) == rootViewCurrentWiFiSettingsEditView) {
 292  01F1 3A 99 0F     	ld a, (rootviewcurrentview)
 293  01F4 FE 03        	cp 3
 294  01F6 C2 03 02     	jp nz, l_27
 295  01F9              ; 118                     a = l; //Load key
 296  01F9 7D           	ld a, l
 297  01FA              ; 119                     wifiSettingsEditViewKeyA();
 298  01FA CD 5B 09     	call wifisettingseditviewkeya
 299  01FD              ; 120                     wifiSettingsEditViewDataUpdate();
 300  01FD CD F3 08     	call wifisettingseditviewdataupdate
 301  0200 C3 12 02     	jp l_28
 302  0203              l_27:
 303  0203              ; 121                 } else if ((a = rootViewCurrentView) == rootSSIDListView) {
 304  0203 3A 99 0F     	ld a, (rootviewcurrentview)
 305  0206 FE 04        	cp 4
 306  0208 C2 12 02     	jp nz, l_29
 307  020B              ; 122                     a = l; //Load key
 308  020B 7D           	ld a, l
 309  020C              ; 123                     SSIDListViewKeyA();
 310  020C CD 27 0C     	call ssidlistviewkeya
 311  020F              ; 124                     SSIDListViewDataUpdate();
 312  020F CD DB 0B     	call ssidlistviewdataupdate
 313  0212              l_29:
 314  0212              l_28:
 315  0212              l_26:
 316  0212              l_24:
 317  0212              l_22:
 318  0212              l_11:
 319  0212 E1           	pop hl
 320  0213              l_9:
 321  0213 C9           	ret
 322  0214              ; 125                 }
 323  0214              ; 126                 //printHexA();
 324  0214              ; 127             }
 325  0214              ; 128         }
 326  0214              ; 129     }
 327  0214              ; 130 }
 328  0214              ; 131
 329  0214              ; 132 void updateRootDataUI() {
 330  0214              updaterootdataui:
 331  0214              ; 133     showDiskList();
 332  0214 C3 CE 03     	jp showdisklist
 333  0217              ; 134 }
 334  0217              ; 135
 335  0217              ; 136 void updateRootUI() {
 336  0217              updaterootui:
 337  0217              ; 137     a = 0x00;
 338  0217 3E 00        	ld a, 0
 339  0219              ; 138     inverceAddress = a;
 340  0219 32 D3 F3     	ld (inverceaddress), a
 341  021C              ; 139     clearScreen();
 342  021C CD 1A 03     	call clearscreen
 343  021F              ; 140
 344  021F              ; 141     a = 0x00;
 345  021F 3E 00        	ld a, 0
 346  0221              ; 142     inverceAddress = a;
 347  0221 32 D3 F3     	ld (inverceaddress), a
 348  0224              ; 143     showWiFiView();
 349  0224 CD 90 02     	call showwifiview
 350  0227              ; 144     a = 0x00;
 351  0227 3E 00        	ld a, 0
 352  0229              ; 145     inverceAddress = a;
 353  0229 32 D3 F3     	ld (inverceaddress), a
 354  022C              ; 146     showFtpView();
 355  022C CD 75 1A     	call showftpview
 356  022F              ; 147     a = 0x00;
 357  022F 3E 00        	ld a, 0
 358  0231              ; 148     inverceAddress = a;
 359  0231 32 D3 F3     	ld (inverceaddress), a
 360  0234              ; 149     diskView();
 361  0234 CD 69 02     	call diskview
 362  0237              ; 150     a = 0x00;
 363  0237 3E 00        	ld a, 0
 364  0239              ; 151     inverceAddress = a;
 365  0239 32 D3 F3     	ld (inverceaddress), a
 366  023C              ; 152     ftpView();
 367  023C CD 42 02     	call ftpview
 368  023F              ; 153
 369  023F              ; 154     showHelpStr();
 370  023F C3 EF 04     	jp showhelpstr
 371  0242              ; 155 }
 372  0242              ; 156
 373  0242              ; 157 void ftpView() {
 374  0242              ftpview:
 375  0242              ; 158     drowRectX = (a = ftpViewX);
 376  0242 3A 08 0E     	ld a, (ftpviewx)
 377  0245 32 B8 03     	ld (drowrectx), a
 378  0248              ; 159     drowRectY = (a = ftpViewY);
 379  0248 3A 09 0E     	ld a, (ftpviewy)
 380  024B 32 B9 03     	ld (drowrecty), a
 381  024E              ; 160     drowRectEndX = (a = ftpViewEX);
 382  024E 3A 0A 0E     	ld a, (ftpviewex)
 383  0251 32 BA 03     	ld (drowrectendx), a
 384  0254              ; 161     drowRectEndY = (a = ftpViewEY);
 385  0254 3A 0B 0E     	ld a, (ftpviewey)
 386  0257 32 BB 03     	ld (drowrectendy), a
 387  025A              ; 162     drowRect();
 388  025A CD 24 03     	call drowrect
 389  025D              ; 163
 390  025D              ; 164     hl = ftpLabelPos;
 391  025D 2A 0C 0E     	ld hl, (ftplabelpos)
 392  0260              ; 165     setPosCursor();
 393  0260 CD 3C F8     	call setposcursor
 394  0263              ; 166     hl = ftpLabel;
 395  0263 21 0E 0E     	ld hl, ftplabel
 396  0266              ; 167     printHLStr();
 397  0266 C3 18 F8     	jp printhlstr
 398  0269              ; 168 }
 399  0269              ; 169
 400  0269              ; 170 void diskView() {
 401  0269              diskview:
 402  0269              ; 171     drowRectX = (a = diskViewX);
 403  0269 3A E2 0D     	ld a, (diskviewx)
 404  026C 32 B8 03     	ld (drowrectx), a
 405  026F              ; 172     drowRectY = (a = diskViewY);
 406  026F 3A E3 0D     	ld a, (diskviewy)
 407  0272 32 B9 03     	ld (drowrecty), a
 408  0275              ; 173     drowRectEndX = (a = diskViewEX);
 409  0275 3A E4 0D     	ld a, (diskviewex)
 410  0278 32 BA 03     	ld (drowrectendx), a
 411  027B              ; 174     drowRectEndY = (a = diskViewEY);
 412  027B 3A E5 0D     	ld a, (diskviewey)
 413  027E 32 BB 03     	ld (drowrectendy), a
 414  0281              ; 175     drowRect();
 415  0281 CD 24 03     	call drowrect
 416  0284              ; 176
 417  0284              ; 177     hl = diskViewLabelPos;
 418  0284 2A E6 0D     	ld hl, (diskviewlabelpos)
 419  0287              ; 178     setPosCursor();
 420  0287 CD 3C F8     	call setposcursor
 421  028A              ; 179     hl = diskViewLabel;
 422  028A 21 E8 0D     	ld hl, diskviewlabel
 423  028D              ; 180     printHLStr();
 424  028D C3 18 F8     	jp printhlstr
 425  0290              ; 181 }
 426  0290              ; 182
 427  0290              ; 183 void showWiFiView() {
 428  0290              showwifiview:
 429  0290              ; 184     drowRectX = (a = wifiSettingsViewX);
 430  0290 3A E0 0C     	ld a, (wifisettingsviewx)
 431  0293 32 B8 03     	ld (drowrectx), a
 432  0296              ; 185     drowRectY = (a = wifiSettingsViewY);
 433  0296 3A E1 0C     	ld a, (wifisettingsviewy)
 434  0299 32 B9 03     	ld (drowrecty), a
 435  029C              ; 186     drowRectEndX = (a = wifiSettingsViewEX);
 436  029C 3A E2 0C     	ld a, (wifisettingsviewex)
 437  029F 32 BA 03     	ld (drowrectendx), a
 438  02A2              ; 187     drowRectEndY = (a = wifiSettingsViewEY);
 439  02A2 3A E3 0C     	ld a, (wifisettingsviewey)
 440  02A5 32 BB 03     	ld (drowrectendy), a
 441  02A8              ; 188     drowRect();
 442  02A8 CD 24 03     	call drowrect
 443  02AB              ; 189
 444  02AB              ; 190     hl = wifiSettingsPos;
 445  02AB 2A E4 0C     	ld hl, (wifisettingspos)
 446  02AE              ; 191     setPosCursor();
 447  02AE CD 3C F8     	call setposcursor
 448  02B1              ; 192     hl = wifiSettingsLabel;
 449  02B1 21 E6 0C     	ld hl, wifisettingslabel
 450  02B4              ; 193     printHLStr();
 451  02B4 CD 18 F8     	call printhlstr
 452  02B7              ; 194
 453  02B7              ; 195     hl = wifiSettingsSsidLabelPos;
 454  02B7 2A 09 0D     	ld hl, (wifisettingsssidlabelpos)
 455  02BA              ; 196     setPosCursor();
 456  02BA CD 3C F8     	call setposcursor
 457  02BD              ; 197     hl = wifiSettingsSsidLabel;
 458  02BD 21 F7 0C     	ld hl, wifisettingsssidlabel
 459  02C0              ; 198     printHLStr();
 460  02C0 CD 18 F8     	call printhlstr
 461  02C3              ; 199
 462  02C3              ; 200     hl = wifiSettingsIpLabelPos;
 463  02C3 2A 0B 0D     	ld hl, (wifisettingsiplabelpos)
 464  02C6              ; 201     setPosCursor();
 465  02C6 CD 3C F8     	call setposcursor
 466  02C9              ; 202     hl = wifiSettingsIpLabel;
 467  02C9 21 FD 0C     	ld hl, wifisettingsiplabel
 468  02CC              ; 203     printHLStr();
 469  02CC CD 18 F8     	call printhlstr
 470  02CF              ; 204
 471  02CF              ; 205     hl = wifiSettingsMacLabelPos;
 472  02CF 2A 0D 0D     	ld hl, (wifisettingsmaclabelpos)
 473  02D2              ; 206     setPosCursor();
 474  02D2 CD 3C F8     	call setposcursor
 475  02D5              ; 207     hl = wifiSettingsMacLabel;
 476  02D5 21 03 0D     	ld hl, wifisettingsmaclabel
 477  02D8              ; 208     printHLStr();
 478  02D8 CD 18 F8     	call printhlstr
 479  02DB              ; 209
 480  02DB              ; 210     hl = wifiSettingsSsidValPos;
 481  02DB 2A 0F 0D     	ld hl, (wifisettingsssidvalpos)
 482  02DE              ; 211     setPosCursor();
 483  02DE CD 3C F8     	call setposcursor
 484  02E1              ; 212     hl = wifiSettingsSsidVal;
 485  02E1 21 11 0D     	ld hl, wifisettingsssidval
 486  02E4              ; 213     printHLStr();
 487  02E4 CD 18 F8     	call printhlstr
 488  02E7              ; 214
 489  02E7              ; 215     updateWiFiViewValData();
 490  02E7 C3 02 03     	jp updatewifiviewvaldata
 491  02EA              ; 216 }
 492  02EA              ; 217
 493  02EA              ; 218 void clearWiFiViewValData() {
 494  02EA              clearwifiviewvaldata:
 495  02EA              ; 219     hl = wifiSettingsIpValPos;
 496  02EA 2A 21 0D     	ld hl, (wifisettingsipvalpos)
 497  02ED              ; 220     setPosCursor();
 498  02ED CD 3C F8     	call setposcursor
 499  02F0              ; 221     hl = wifiSettingsEmpty18;
 500  02F0 21 47 0D     	ld hl, wifisettingsempty18
 501  02F3              ; 222     printHLStr();
 502  02F3 CD 18 F8     	call printhlstr
 503  02F6              ; 223
 504  02F6              ; 224     hl = wifiSettingsMacValPos;
 505  02F6 2A 33 0D     	ld hl, (wifisettingsmacvalpos)
 506  02F9              ; 225     setPosCursor();
 507  02F9 CD 3C F8     	call setposcursor
 508  02FC              ; 226     hl = wifiSettingsEmpty18;
 509  02FC 21 47 0D     	ld hl, wifisettingsempty18
 510  02FF              ; 227     printHLStr();
 511  02FF C3 18 F8     	jp printhlstr
 512  0302              ; 228 }
 513  0302              ; 229
 514  0302              ; 230 void updateWiFiViewValData() {
 515  0302              updatewifiviewvaldata:
 516  0302              ; 231     hl = wifiSettingsIpValPos;
 517  0302 2A 21 0D     	ld hl, (wifisettingsipvalpos)
 518  0305              ; 232     setPosCursor();
 519  0305 CD 3C F8     	call setposcursor
 520  0308              ; 233     hl = wifiSettingsIpVal;
 521  0308 21 23 0D     	ld hl, wifisettingsipval
 522  030B              ; 234     printHLStr();
 523  030B CD 18 F8     	call printhlstr
 524  030E              ; 235
 525  030E              ; 236     hl = wifiSettingsMacValPos;
 526  030E 2A 33 0D     	ld hl, (wifisettingsmacvalpos)
 527  0311              ; 237     setPosCursor();
 528  0311 CD 3C F8     	call setposcursor
 529  0314              ; 238     hl = wifiSettingsMacVal;
 530  0314 21 35 0D     	ld hl, wifisettingsmacval
 531  0317              ; 239     printHLStr();
 532  0317 C3 18 F8     	jp printhlstr
 533  031A              ; 240 }
 534  031A              ; 241
 535  031A              ; 242 void clearScreen() {
 536  031A              clearscreen:
 537  031A              ; 243     c = 0x1B;
 538  031A 0E 1B        	ld c, 27
 539  031C              ; 244     printChatC();
 540  031C CD 09 F8     	call printchatc
 541  031F              ; 245     c = 0x45;
 542  031F 0E 45        	ld c, 69
 543  0321              ; 246     printChatC();
 544  0321 C3 09 F8     	jp printchatc
 545  0324              ; 247 }
 546  0324              ; 248
 547  0324              ; 249 void drowRect() {
 548  0324              drowrect:
 549  0324              ; 250     setMyFont();
 550  0324 CD A0 03     	call setmyfont
 551  0327              ; 251
 552  0327              ; 252     //h = y
 553  0327              ; 253     a = drowRectY;
 554  0327 3A B9 03     	ld a, (drowrecty)
 555  032A              ; 254     h = a;
 556  032A 67           	ld h, a
 557  032B              ; 255
 558  032B              ; 256     do {
 559  032B              l_31:
 560  032B              ; 257         //l = x
 561  032B              ; 258         a = drowRectX;
 562  032B 3A B8 03     	ld a, (drowrectx)
 563  032E              ; 259         l = a;
 564  032E 6F           	ld l, a
 565  032F              ; 260
 566  032F              ; 261         push_pop(hl) {
 567  032F E5           	push hl
 568  0330              ; 262             setPosCursor();
 569  0330 CD 3C F8     	call setposcursor
 570  0333 E1           	pop hl
 571  0334              ; 263         }
 572  0334              ; 264
 573  0334              ; 265         do {
 574  0334              l_34:
 575  0334              ; 266             if ((a = drowRectY) == h) {
 576  0334 3A B9 03     	ld a, (drowrecty)
 577  0337 BC           	cp h
 578  0338 C2 53 03     	jp nz, l_37
 579  033B              ; 267                 c = 0x26;
 580  033B 0E 26        	ld c, 38
 581  033D              ; 268                 if ((a = drowRectX) == l) {
 582  033D 3A B8 03     	ld a, (drowrectx)
 583  0340 BD           	cp l
 584  0341 C2 46 03     	jp nz, l_39
 585  0344              ; 269                     c = 0x21;
 586  0344 0E 21        	ld c, 33
 587  0346              l_39:
 588  0346              ; 270                 }
 589  0346              ; 271                 if ((a = drowRectEndX)-- == l) {
 590  0346 3A BA 03     	ld a, (drowrectendx)
 591  0349 3D           	dec a
 592  034A BD           	cp l
 593  034B C2 50 03     	jp nz, l_41
 594  034E              ; 272                     c = 0x23;
 595  034E 0E 23        	ld c, 35
 596  0350              l_41:
 597  0350 C3 88 03     	jp l_38
 598  0353              l_37:
 599  0353              ; 273                 }
 600  0353              ; 274             } else if ((a = drowRectEndY)-- == h) {
 601  0353 3A BB 03     	ld a, (drowrectendy)
 602  0356 3D           	dec a
 603  0357 BC           	cp h
 604  0358 C2 73 03     	jp nz, l_43
 605  035B              ; 275                 c = 0x26;
 606  035B 0E 26        	ld c, 38
 607  035D              ; 276                 if ((a = drowRectX) == l) {
 608  035D 3A B8 03     	ld a, (drowrectx)
 609  0360 BD           	cp l
 610  0361 C2 66 03     	jp nz, l_45
 611  0364              ; 277                     c = 0x22;
 612  0364 0E 22        	ld c, 34
 613  0366              l_45:
 614  0366              ; 278                 }
 615  0366              ; 279                 if ((a = drowRectEndX)-- == l) {
 616  0366 3A BA 03     	ld a, (drowrectendx)
 617  0369 3D           	dec a
 618  036A BD           	cp l
 619  036B C2 70 03     	jp nz, l_47
 620  036E              ; 280                     c = 0x24;
 621  036E 0E 24        	ld c, 36
 622  0370              l_47:
 623  0370 C3 88 03     	jp l_44
 624  0373              l_43:
 625  0373              ; 281                 }
 626  0373              ; 282             } else {
 627  0373              ; 283                 c = 0x20;
 628  0373 0E 20        	ld c, 32
 629  0375              ; 284                 if ((a = drowRectX) == l) {
 630  0375 3A B8 03     	ld a, (drowrectx)
 631  0378 BD           	cp l
 632  0379 C2 7E 03     	jp nz, l_49
 633  037C              ; 285                     c = 0x25;
 634  037C 0E 25        	ld c, 37
 635  037E              l_49:
 636  037E              ; 286                 }
 637  037E              ; 287                 if ((a = drowRectEndX)-- == l) {
 638  037E 3A BA 03     	ld a, (drowrectendx)
 639  0381 3D           	dec a
 640  0382 BD           	cp l
 641  0383 C2 88 03     	jp nz, l_51
 642  0386              ; 288                     c = 0x25;
 643  0386 0E 25        	ld c, 37
 644  0388              l_51:
 645  0388              l_44:
 646  0388              l_38:
 647  0388              ; 289                 }
 648  0388              ; 290             }
 649  0388              ; 291
 650  0388              ; 292             push_pop(hl) {
 651  0388 E5           	push hl
 652  0389              ; 293                 printChatC();
 653  0389 CD 09 F8     	call printchatc
 654  038C E1           	pop hl
 655  038D              ; 294             }
 656  038D              ; 295
 657  038D              ; 296             a = drowRectEndX;
 658  038D 3A BA 03     	ld a, (drowrectendx)
 659  0390              ; 297             l++;
 660  0390 2C           	inc l
 661  0391              ; 298             a -= l;
 662  0391 95           	sub l
 663  0392              l_35:
 664  0392 C2 34 03     	jp nz, l_34
 665  0395              ; 299         } while (flag_nz);
 666  0395              ; 300
 667  0395              ; 301         a = drowRectEndY;
 668  0395 3A BB 03     	ld a, (drowrectendy)
 669  0398              ; 302         h++;
 670  0398 24           	inc h
 671  0399              ; 303         a -= h;
 672  0399 94           	sub h
 673  039A              l_32:
 674  039A C2 2B 03     	jp nz, l_31
 675  039D              ; 304     } while (flag_nz);
 676  039D              ; 305
 677  039D              ; 306     setSystemFont();
 678  039D C3 AF 03     	jp setsystemfont
 679  03A0              ; 307 }
 680  03A0              ; 308
 681  03A0              ; 309 void setMyFont() {
 682  03A0              setmyfont:
 683  03A0              ; 310     push_pop(hl) {
 684  03A0 E5           	push hl
 685  03A1              ; 311         hl = fontAddress;
 686  03A1 2A D1 F3     	ld hl, (fontaddress)
 687  03A4              ; 312         systemFontAddress = hl;
 688  03A4 22 BC 03     	ld (systemfontaddress), hl
 689  03A7              ; 313         hl = &myFont;
 690  03A7 21 98 0C     	ld hl, myfont
 691  03AA              ; 314         fontAddress = hl;
 692  03AA 22 D1 F3     	ld (fontaddress), hl
 693  03AD E1           	pop hl
 694  03AE C9           	ret
 695  03AF              ; 315     }
 696  03AF              ; 316 }
 697  03AF              ; 317
 698  03AF              ; 318 void setSystemFont() {
 699  03AF              setsystemfont:
 700  03AF              ; 319     push_pop(hl) {
 701  03AF E5           	push hl
 702  03B0              ; 320         hl = systemFontAddress;
 703  03B0 2A BC 03     	ld hl, (systemfontaddress)
 704  03B3              ; 321         fontAddress = hl;
 705  03B3 22 D1 F3     	ld (fontaddress), hl
 706  03B6 E1           	pop hl
 707  03B7 C9           	ret
 708  03B8              ; 322     }
 709  03B8              ; 323 }
 710  03B8              ; 324
 711  03B8              ; 325 uint8_t drowRectX = 0x00;
 712  03B8              drowrectx:
 713  03B8 00           	db 0
 714  03B9              ; 326 uint8_t drowRectY = 0x00;
 715  03B9              drowrecty:
 716  03B9 00           	db 0
 717  03BA              ; 327 uint8_t drowRectEndX = 0x00;
 718  03BA              drowrectendx:
 719  03BA 00           	db 0
 720  03BB              ; 328 uint8_t drowRectEndY = 0x00;
 721  03BB              drowrectendy:
 722  03BB 00           	db 0
 723  03BC              ; 330 uint16_t systemFontAddress = 0x0000;
 724  03BC              systemfontaddress:
 725  03BC 00 00        	dw 0
 726  03BE              ; 332 void updateDiskList() {
 727  03BE              updatedisklist:
 728  03BE              ; 333     a = diskViewDiskNum;
 729  03BE 3A F2 0D     	ld a, (diskviewdisknum)
 730  03C1              ; 334     ordos_wnd();
 731  03C1 CD D6 BF     	call ordos_wnd
 732  03C4              ; 335     hl = startListBufer;
 733  03C4 21 00 00     	ld hl, 0
 734  03C7              ; 336     ordos_dirm();
 735  03C7 CD E8 BF     	call ordos_dirm
 736  03CA              ; 337     diskViewListCount = a;
 737  03CA 32 F3 0D     	ld (diskviewlistcount), a
 738  03CD C9           	ret
 739  03CE              ; 338 }
 740  03CE              ; 339
 741  03CE              ; 340 void showDiskList() {
 742  03CE              showdisklist:
 743  03CE              ; 341     b = 0;
 744  03CE 06 00        	ld b, 0
 745  03D0              ; 342     showDiskDriveName();
 746  03D0 CD F4 03     	call showdiskdrivename
 747  03D3              ; 343     showDiskDir();
 748  03D3 CD 03 04     	call showdiskdir
 749  03D6              ; 344     hl = diskViewListNamePos;
 750  03D6 2A F5 0D     	ld hl, (diskviewlistnamepos)
 751  03D9              ; 345
 752  03D9              ; 346     if ((a = diskViewListCount) == 0) {
 753  03D9 3A F3 0D     	ld a, (diskviewlistcount)
 754  03DC B7           	or a
 755  03DD C2 E1 03     	jp nz, l_53
 756  03E0              ; 347         return;
 757  03E0 C9           	ret
 758  03E1              l_53:
 759  03E1              ; 348     }
 760  03E1              ; 349
 761  03E1              ; 350     do {
 762  03E1              l_55:
 763  03E1              ; 351         setPosCursor();
 764  03E1 CD 3C F8     	call setposcursor
 765  03E4              ; 352         a = b;
 766  03E4 78           	ld a, b
 767  03E5              ; 353         push_pop(hl) {
 768  03E5 E5           	push hl
 769  03E6              ; 354             showDiskApp();
 770  03E6 CD 31 04     	call showdiskapp
 771  03E9 E1           	pop hl
 772  03EA              ; 355         };
 773  03EA              ; 356
 774  03EA              ; 357         h++;
 775  03EA 24           	inc h
 776  03EB              ; 358         b++;
 777  03EB 04           	inc b
 778  03EC              ; 359         a = diskViewListCount;
 779  03EC 3A F3 0D     	ld a, (diskviewlistcount)
 780  03EF              ; 360         a -= b;
 781  03EF 90           	sub b
 782  03F0              l_56:
 783  03F0 C2 E1 03     	jp nz, l_55
 784  03F3 C9           	ret
 785  03F4              ; 361     } while (flag_nz);
 786  03F4              ; 362 }
 787  03F4              ; 363
 788  03F4              ; 364 void showDiskDriveName() {
 789  03F4              showdiskdrivename:
 790  03F4              ; 365     push_pop(hl) {
 791  03F4 E5           	push hl
 792  03F5              ; 366         hl = diskViewDriveNamePos;
 793  03F5 2A 04 0E     	ld hl, (diskviewdrivenamepos)
 794  03F8              ; 367         setPosCursor();
 795  03F8 CD 3C F8     	call setposcursor
 796  03FB              ; 368         a = diskViewDiskNum;
 797  03FB 3A F2 0D     	ld a, (diskviewdisknum)
 798  03FE              ; 369         printChatA();
 799  03FE CD 0F F8     	call printchata
 800  0401 E1           	pop hl
 801  0402 C9           	ret
 802  0403              ; 370     }
 803  0403              ; 371 }
 804  0403              ; 372
 805  0403              ; 373 void showDiskDir() {
 806  0403              showdiskdir:
 807  0403              ; 374     push_pop(hl) {
 808  0403 E5           	push hl
 809  0404              ; 375         hl = diskViewListDirPos;
 810  0404 2A F7 0D     	ld hl, (diskviewlistdirpos)
 811  0407              ; 376         setPosCursor();
 812  0407 CD 3C F8     	call setposcursor
 813  040A              ; 377         hl = diskViewListDirLabel;
 814  040A 21 F9 0D     	ld hl, diskviewlistdirlabel
 815  040D              ; 378         push_pop(bc) {
 816  040D C5           	push bc
 817  040E              ; 379             a = 0;
 818  040E 3E 00        	ld a, 0
 819  0410              ; 380             inverceAddress = a;
 820  0410 32 D3 F3     	ld (inverceaddress), a
 821  0413              ; 381             if ((a = diskViewCurrPos) == 0) {
 822  0413 3A F4 0D     	ld a, (diskviewcurrpos)
 823  0416 B7           	or a
 824  0417 C2 26 04     	jp nz, l_58
 825  041A              ; 382                 if ((a = rootViewCurrentView) == rootViewCurrentDiskView) {
 826  041A 3A 99 0F     	ld a, (rootviewcurrentview)
 827  041D B7           	or a
 828  041E C2 26 04     	jp nz, l_60
 829  0421              ; 383                     a = 0xFF;
 830  0421 3E FF        	ld a, 255
 831  0423              ; 384                     inverceAddress = a;
 832  0423 32 D3 F3     	ld (inverceaddress), a
 833  0426              l_60:
 834  0426              l_58:
 835  0426              ; 385                 }
 836  0426              ; 386             }
 837  0426              ; 387             printHLStr();
 838  0426 CD 18 F8     	call printhlstr
 839  0429              ; 388             a = 0;
 840  0429 3E 00        	ld a, 0
 841  042B              ; 389             inverceAddress = a;
 842  042B 32 D3 F3     	ld (inverceaddress), a
 843  042E C1           	pop bc
 844  042F E1           	pop hl
 845  0430 C9           	ret
 846  0431              ; 390         }
 847  0431              ; 391     }
 848  0431              ; 392 }
 849  0431              ; 393
 850  0431              ; 394 ///A - count app
 851  0431              ; 395 void showDiskApp() {
 852  0431              showdiskapp:
 853  0431              ; 396     push_pop(bc) {
 854  0431 C5           	push bc
 855  0432              ; 397
 856  0432              ; 398         c = a;
 857  0432 4F           	ld c, a
 858  0433              ; 399         carry_rotate_left(a, 4);
 859  0433 17           	rla
 860  0434 17           	rla
 861  0435 17           	rla
 862  0436 17           	rla
 863  0437              ; 400         hl = startListBufer;
 864  0437 21 00 00     	ld hl, 0
 865  043A              ; 401         a += l;
 866  043A 85           	add l
 867  043B              ; 402         l = a;
 868  043B 6F           	ld l, a
 869  043C              ; 403         if (flag_c) {
 870  043C D2 40 04     	jp nc, l_62
 871  043F              ; 404             h++;
 872  043F 24           	inc h
 873  0440              l_62:
 874  0440              ; 405         }
 875  0440              ; 406
 876  0440              ; 407         a = 0x00;
 877  0440 3E 00        	ld a, 0
 878  0442              ; 408         inverceAddress = a;
 879  0442 32 D3 F3     	ld (inverceaddress), a
 880  0445              ; 409
 881  0445              ; 410         if ((a = diskViewCurrPos)-- == c) {
 882  0445 3A F4 0D     	ld a, (diskviewcurrpos)
 883  0448 3D           	dec a
 884  0449 B9           	cp c
 885  044A C2 59 04     	jp nz, l_64
 886  044D              ; 411             if ((a = rootViewCurrentView) == rootViewCurrentDiskView) {
 887  044D 3A 99 0F     	ld a, (rootviewcurrentview)
 888  0450 B7           	or a
 889  0451 C2 59 04     	jp nz, l_66
 890  0454              ; 412                 a = 0xFF;
 891  0454 3E FF        	ld a, 255
 892  0456              ; 413                 inverceAddress = a;
 893  0456 32 D3 F3     	ld (inverceaddress), a
 894  0459              l_66:
 895  0459              l_64:
 896  0459              ; 414             }
 897  0459              ; 415         }
 898  0459              ; 416
 899  0459              ; 417         a = ' ';
 900  0459 3E 20        	ld a, 32
 901  045B              ; 418         printChatA();
 902  045B CD 0F F8     	call printchata
 903  045E              ; 419         b = 0;
 904  045E 06 00        	ld b, 0
 905  0460              ; 420
 906  0460              ; 421         do {
 907  0460              l_68:
 908  0460              ; 422             a = *hl;
 909  0460 7E           	ld a, (hl)
 910  0461              ; 423             printChatA();
 911  0461 CD 0F F8     	call printchata
 912  0464              ; 424             hl++;
 913  0464 23           	inc hl
 914  0465              ; 425             b++;
 915  0465 04           	inc b
 916  0466              ; 426             a = 8;
 917  0466 3E 08        	ld a, 8
 918  0468              ; 427             a -= b;
 919  0468 90           	sub b
 920  0469              l_69:
 921  0469 C2 60 04     	jp nz, l_68
 922  046C              ; 428         } while (flag_nz);
 923  046C              ; 429         a = ' ';
 924  046C 3E 20        	ld a, 32
 925  046E              ; 430         printChatA();
 926  046E CD 0F F8     	call printchata
 927  0471 C1           	pop bc
 928  0472              ; 431     };
 929  0472              ; 432     a = 0x00;
 930  0472 3E 00        	ld a, 0
 931  0474              ; 433     inverceAddress = a;
 932  0474 32 D3 F3     	ld (inverceaddress), a
 933  0477 C9           	ret
 934  0478              ; 434 }
 935  0478              ; 435
 936  0478              ; 436 void diskViewKeyA() {
 937  0478              diskviewkeya:
 938  0478              ; 437     push_pop(bc) {
 939  0478 C5           	push bc
 940  0479              ; 438         b = a;
 941  0479 47           	ld b, a
 942  047A              ; 439
 943  047A              ; 440         if (a == 0x1A) { //down
 944  047A FE 1A        	cp 26
 945  047C C2 91 04     	jp nz, l_71
 946  047F              ; 441             a = diskViewListCount;
 947  047F 3A F3 0D     	ld a, (diskviewlistcount)
 948  0482              ; 442             c = a;
 949  0482 4F           	ld c, a
 950  0483              ; 443             if ( (a = diskViewCurrPos) < c  ) {
 951  0483 3A F4 0D     	ld a, (diskviewcurrpos)
 952  0486 B9           	cp c
 953  0487 D2 8E 04     	jp nc, l_73
 954  048A              ; 444                 a++;
 955  048A 3C           	inc a
 956  048B              ; 445                 diskViewCurrPos = a;
 957  048B 32 F4 0D     	ld (diskviewcurrpos), a
 958  048E              l_73:
 959  048E C3 ED 04     	jp l_72
 960  0491              l_71:
 961  0491              ; 446             }
 962  0491              ; 447         } else if (a == 0x19) { //up
 963  0491 FE 19        	cp 25
 964  0493 C2 A4 04     	jp nz, l_75
 965  0496              ; 448             if ( (a = diskViewCurrPos) > 0 ) {
 966  0496 3A F4 0D     	ld a, (diskviewcurrpos)
 967  0499 B7           	or a
 968  049A CA A1 04     	jp z, l_77
 969  049D              ; 449                 a--;
 970  049D 3D           	dec a
 971  049E              ; 450                 diskViewCurrPos = a;
 972  049E 32 F4 0D     	ld (diskviewcurrpos), a
 973  04A1              l_77:
 974  04A1 C3 ED 04     	jp l_76
 975  04A4              l_75:
 976  04A4              ; 451             }
 977  04A4              ; 452         } else if (a == 0x0D) { //Enter
 978  04A4 FE 0D        	cp 13
 979  04A6 C2 DD 04     	jp nz, l_79
 980  04A9              ; 453             if ((a = diskViewCurrPos) == 0) { // Change drive
 981  04A9 3A F4 0D     	ld a, (diskviewcurrpos)
 982  04AC B7           	or a
 983  04AD C2 DA 04     	jp nz, l_81
 984  04B0              ; 454                 a = diskViewDiskNum;
 985  04B0 3A F2 0D     	ld a, (diskviewdisknum)
 986  04B3              ; 455                 if (a == 'B') {
 987  04B3 FE 42        	cp 66
 988  04B5 C2 BD 04     	jp nz, l_83
 989  04B8              ; 456                     a = 'C';
 990  04B8 3E 43        	ld a, 67
 991  04BA C3 CE 04     	jp l_84
 992  04BD              l_83:
 993  04BD              ; 457                 } else if (a == 'C') {
 994  04BD FE 43        	cp 67
 995  04BF C2 C7 04     	jp nz, l_85
 996  04C2              ; 458                     a = 'D';
 997  04C2 3E 44        	ld a, 68
 998  04C4 C3 CE 04     	jp l_86
 999  04C7              l_85:
1000  04C7              ; 459                 } else if (a == 'D') {
1001  04C7 FE 44        	cp 68
1002  04C9 C2 CE 04     	jp nz, l_87
1003  04CC              ; 460                     a = 'B';
1004  04CC 3E 42        	ld a, 66
1005  04CE              l_87:
1006  04CE              l_86:
1007  04CE              l_84:
1008  04CE              ; 461                 }
1009  04CE              ; 462                 diskViewDiskNum = a;
1010  04CE 32 F2 0D     	ld (diskviewdisknum), a
1011  04D1              ; 463                 diskView();
1012  04D1 CD 69 02     	call diskview
1013  04D4              ; 464                 updateDiskList();
1014  04D4 CD BE 03     	call updatedisklist
1015  04D7 C3 DA 04     	jp l_82
1016  04DA              l_81:
1017  04DA              ; 465             } else { // Upload file to FTP
1018  04DA              l_82:
1019  04DA C3 ED 04     	jp l_80
1020  04DD              l_79:
1021  04DD              ; 466
1022  04DD              ; 467             }
1023  04DD              ; 468         } else if (a == 0x09) { //TAB
1024  04DD FE 09        	cp 9
1025  04DF C2 ED 04     	jp nz, l_89
1026  04E2              ; 469             a = rootViewCurrentFTPView; // переходим на список файлов FTP
1027  04E2 3E 01        	ld a, 1
1028  04E4              ; 470             rootViewCurrentView = a;
1029  04E4 32 99 0F     	ld (rootviewcurrentview), a
1030  04E7              ; 471             // Сбросить выделение строки на диске
1031  04E7              ; 472             showDiskList();
1032  04E7 CD CE 03     	call showdisklist
1033  04EA              ; 473             // Выделить текущую позицию на FTP
1034  04EA              ; 474             ftpViewDataUpdate();
1035  04EA CD 89 18     	call ftpviewdataupdate
1036  04ED              l_89:
1037  04ED              l_80:
1038  04ED              l_76:
1039  04ED              l_72:
1040  04ED C1           	pop bc
1041  04EE C9           	ret
1042  04EF              ; 475         }
1043  04EF              ; 476     }
1044  04EF              ; 477 }
1045  04EF              ; 478
1046  04EF              ; 479 void showHelpStr() {
1047  04EF              showhelpstr:
1048  04EF              ; 480     push_pop(hl) {
1049  04EF E5           	push hl
1050  04F0              ; 481         hl = rootViewHelpStrPos;
1051  04F0 2A 9A 0F     	ld hl, (rootviewhelpstrpos)
1052  04F3              ; 482         setPosCursor();
1053  04F3 CD 3C F8     	call setposcursor
1054  04F6              ; 483         hl = rootViewHelpStr;
1055  04F6 21 9C 0F     	ld hl, rootviewhelpstr
1056  04F9              ; 484         printHLStr();
1057  04F9 CD 18 F8     	call printhlstr
1058  04FC E1           	pop hl
1059  04FD C9           	ret
1060  04FE              ; 485     }
1061  04FE              ; 486 }
1062  04FE              ; 487
1063  04FE              ; 488 void showFtpSettingsEditView() {
1064  04FE              showftpsettingseditview:
1065  04FE              ; 489     drowRectX = (a = ftpSettingsEditViewX);
1066  04FE 3A DB 0F     	ld a, (ftpsettingseditviewx)
1067  0501 32 B8 03     	ld (drowrectx), a
1068  0504              ; 490     drowRectY = (a = ftpSettingsEditViewY);
1069  0504 3A DC 0F     	ld a, (ftpsettingseditviewy)
1070  0507 32 B9 03     	ld (drowrecty), a
1071  050A              ; 491     drowRectEndX = (a = ftpSettingsEditViewEX);
1072  050A 3A DD 0F     	ld a, (ftpsettingseditviewex)
1073  050D 32 BA 03     	ld (drowrectendx), a
1074  0510              ; 492     drowRectEndY = (a = ftpSettingsEditViewEY);
1075  0510 3A DE 0F     	ld a, (ftpsettingseditviewey)
1076  0513 32 BB 03     	ld (drowrectendy), a
1077  0516              ; 493     drowRect();
1078  0516 CD 24 03     	call drowrect
1079  0519              ; 494
1080  0519              ; 495     hl = ftpSettingsEditViewLabelPos;
1081  0519 2A DF 0F     	ld hl, (ftpsettingseditviewlabelpos)
1082  051C              ; 496     setPosCursor();
1083  051C CD 3C F8     	call setposcursor
1084  051F              ; 497     hl = ftpSettingsEditViewLabel;
1085  051F 21 E1 0F     	ld hl, ftpsettingseditviewlabel
1086  0522              ; 498     printHLStr();
1087  0522 CD 18 F8     	call printhlstr
1088  0525              ; 499
1089  0525              ; 500     hl = ftpSettingsEditViewIpLabelPos;
1090  0525 2A F0 0F     	ld hl, (ftpsettingseditviewiplabelpos)
1091  0528              ; 501     setPosCursor();
1092  0528 CD 3C F8     	call setposcursor
1093  052B              ; 502     hl = ftpSettingsIpLabel;
1094  052B 21 70 0D     	ld hl, ftpsettingsiplabel
1095  052E              ; 503     printHLStr();
1096  052E CD 18 F8     	call printhlstr
1097  0531              ; 504
1098  0531              ; 505     hl = ftpSettingsEditViewPortLabelPos;
1099  0531 2A F2 0F     	ld hl, (ftpsettingseditviewportlabelpos)
1100  0534              ; 506     setPosCursor();
1101  0534 CD 3C F8     	call setposcursor
1102  0537              ; 507     hl = ftpSettingsPortLabel;
1103  0537 21 76 0D     	ld hl, ftpsettingsportlabel
1104  053A              ; 508     printHLStr();
1105  053A CD 18 F8     	call printhlstr
1106  053D              ; 509
1107  053D              ; 510     hl = ftpSettingsEditViewUserLabelPos;
1108  053D 2A F4 0F     	ld hl, (ftpsettingseditviewuserlabelpos)
1109  0540              ; 511     setPosCursor();
1110  0540 CD 3C F8     	call setposcursor
1111  0543              ; 512     hl = ftpSettingsUserLabel;
1112  0543 21 7E 0D     	ld hl, ftpsettingsuserlabel
1113  0546              ; 513     printHLStr();
1114  0546 CD 18 F8     	call printhlstr
1115  0549              ; 514
1116  0549              ; 515     hl = ftpSettingsEditViewPasswordLabelPos;
1117  0549 2A F6 0F     	ld hl, (ftpsettingseditviewpasswordlabel)
1118  054C              ; 516     setPosCursor();
1119  054C CD 3C F8     	call setposcursor
1120  054F              ; 517     hl = ftpSettingsEditViewPasswordLabel;
1121  054F 21 F8 0F     	ld hl, ftpsettingseditviewpasswordlabel_0
1122  0552              ; 518     printHLStr();
1123  0552 CD 18 F8     	call printhlstr
1124  0555              ; 519
1125  0555              ; 520     hl = ftpSettingsEditViewOkLabelPos;
1126  0555 2A FE 0F     	ld hl, (ftpsettingseditviewoklabelpos)
1127  0558              ; 521     setPosCursor();
1128  0558 CD 3C F8     	call setposcursor
1129  055B              ; 522     hl = ftpSettingsEditViewOkLabel;
1130  055B 21 00 10     	ld hl, ftpsettingseditviewoklabel
1131  055E              ; 523     printHLStr();
1132  055E C3 18 F8     	jp printhlstr
1133  0561              ; 524 }
1134  0561              ; 525
1135  0561              ; 526 void needOpenFTPSettingsEditView() {
1136  0561              needopenftpsettingseditview:
1137  0561              ; 527     push_pop(hl) {
1138  0561 E5           	push hl
1139  0562              ; 528         if ((a = rootViewCurrentView) != rootViewCurrentFTPSettingsEditView) { //Если уже открыты настройки - не открываем
1140  0562 3A 99 0F     	ld a, (rootviewcurrentview)
1141  0565 FE 02        	cp 2
1142  0567 CA 85 05     	jp z, l_91
1143  056A              ; 529             if ((a = rootViewCurrentView) != rootViewCurrentWiFiSettingsEditView) { //Если открыта настройка WiFi тоже не открываем
1144  056A 3A 99 0F     	ld a, (rootviewcurrentview)
1145  056D FE 03        	cp 3
1146  056F CA 85 05     	jp z, l_93
1147  0572              ; 530
1148  0572              ; 531                 a = rootViewCurrentFTPSettingsEditView;
1149  0572 3E 02        	ld a, 2
1150  0574              ; 532                 rootViewCurrentView = a;
1151  0574 32 99 0F     	ld (rootviewcurrentview), a
1152  0577              ; 533                 a = 4;
1153  0577 3E 04        	ld a, 4
1154  0579              ; 534                 ftpSettingsEditViewCurrentPos = a;
1155  0579 32 1F 10     	ld (ftpsettingseditviewcurrentpos), a
1156  057C              ; 535
1157  057C              ; 536                 showDiskList(); //Сбросить выделение строки
1158  057C CD CE 03     	call showdisklist
1159  057F              ; 537                 showFtpSettingsEditView();
1160  057F CD FE 04     	call showftpsettingseditview
1161  0582              ; 538                 ftpSettingsEditViewDataUpdate();
1162  0582 CD F2 06     	call ftpsettingseditviewdataupdate
1163  0585              l_93:
1164  0585              l_91:
1165  0585 E1           	pop hl
1166  0586 C9           	ret
1167  0587              ; 539             }
1168  0587              ; 540         }
1169  0587              ; 541     }
1170  0587              ; 542 }
1171  0587              ; 543
1172  0587              ; 544 void ftpSettingsEditViewSelectEditField() {
1173  0587              ftpsettingseditviewselecteditfie:
1174  0587              ; 545     a = ftpSettingsEditViewCurrentPos;
1175  0587 3A 1F 10     	ld a, (ftpsettingseditviewcurrentpos)
1176  058A              ; 546     if (a == 0) {
1177  058A B7           	or a
1178  058B C2 A2 05     	jp nz, l_95
1179  058E              ; 547         hl = ftpSettingsEditViewIpValPos;
1180  058E 2A 07 10     	ld hl, (ftpsettingseditviewipvalpos)
1181  0591              ; 548         ftpSettingsEditViewEditValuePos = hl;
1182  0591 22 20 10     	ld (ftpsettingseditvieweditvaluepos), hl
1183  0594              ; 549         setPosCursor();
1184  0594 CD 3C F8     	call setposcursor
1185  0597              ; 550
1186  0597              ; 551         push_pop(hl) {
1187  0597 E5           	push hl
1188  0598              ; 552             hl = ftpSettingsIpValue;
1189  0598 21 90 0D     	ld hl, ftpsettingsipvalue
1190  059B              ; 553             ftpSettingsEditView_CopyStrFromHL();
1191  059B CD 07 06     	call ftpsettingseditview_copystrfromh
1192  059E E1           	pop hl
1193  059F C3 EA 05     	jp l_96
1194  05A2              l_95:
1195  05A2              ; 554         }
1196  05A2              ; 555     } else if (a == 1) {
1197  05A2 FE 01        	cp 1
1198  05A4 C2 BB 05     	jp nz, l_97
1199  05A7              ; 556         hl = ftpSettingsEditViewPortValPos;
1200  05A7 2A 09 10     	ld hl, (ftpsettingseditviewportvalpos)
1201  05AA              ; 557         ftpSettingsEditViewEditValuePos = hl;
1202  05AA 22 20 10     	ld (ftpsettingseditvieweditvaluepos), hl
1203  05AD              ; 558         setPosCursor();
1204  05AD CD 3C F8     	call setposcursor
1205  05B0              ; 559
1206  05B0              ; 560         push_pop(hl) {
1207  05B0 E5           	push hl
1208  05B1              ; 561             hl = ftpSettingsPortValue;
1209  05B1 21 A2 0D     	ld hl, ftpsettingsportvalue
1210  05B4              ; 562             ftpSettingsEditView_CopyStrFromHL();
1211  05B4 CD 07 06     	call ftpsettingseditview_copystrfromh
1212  05B7 E1           	pop hl
1213  05B8 C3 EA 05     	jp l_98
1214  05BB              l_97:
1215  05BB              ; 563         }
1216  05BB              ; 564     } else if (a == 2) {
1217  05BB FE 02        	cp 2
1218  05BD C2 D4 05     	jp nz, l_99
1219  05C0              ; 565         hl = ftpSettingsEditViewUserValPos;
1220  05C0 2A 0B 10     	ld hl, (ftpsettingseditviewuservalpos)
1221  05C3              ; 566         ftpSettingsEditViewEditValuePos = hl;
1222  05C3 22 20 10     	ld (ftpsettingseditvieweditvaluepos), hl
1223  05C6              ; 567         setPosCursor();
1224  05C6 CD 3C F8     	call setposcursor
1225  05C9              ; 568
1226  05C9              ; 569         push_pop(hl) {
1227  05C9 E5           	push hl
1228  05CA              ; 570             hl = ftpSettingsUserValue;
1229  05CA 21 D2 0D     	ld hl, ftpsettingsuservalue
1230  05CD              ; 571             ftpSettingsEditView_CopyStrFromHL();
1231  05CD CD 07 06     	call ftpsettingseditview_copystrfromh
1232  05D0 E1           	pop hl
1233  05D1 C3 EA 05     	jp l_100
1234  05D4              l_99:
1235  05D4              ; 572         }
1236  05D4              ; 573     } else if (a == 3) {
1237  05D4 FE 03        	cp 3
1238  05D6 C2 EA 05     	jp nz, l_101
1239  05D9              ; 574         hl = ftpSettingsEditViewPasswordValPos;
1240  05D9 2A 0D 10     	ld hl, (ftpsettingseditviewpasswordvalpo)
1241  05DC              ; 575         ftpSettingsEditViewEditValuePos = hl;
1242  05DC 22 20 10     	ld (ftpsettingseditvieweditvaluepos), hl
1243  05DF              ; 576         setPosCursor();
1244  05DF CD 3C F8     	call setposcursor
1245  05E2              ; 577
1246  05E2              ; 578         push_pop(hl) {
1247  05E2 E5           	push hl
1248  05E3              ; 579             hl = ftpSettingsEditViewPasswordVal;
1249  05E3 21 0F 10     	ld hl, ftpsettingseditviewpasswordval
1250  05E6              ; 580             ftpSettingsEditView_CopyStrFromHL();
1251  05E6 CD 07 06     	call ftpsettingseditview_copystrfromh
1252  05E9 E1           	pop hl
1253  05EA              l_101:
1254  05EA              l_100:
1255  05EA              l_98:
1256  05EA              l_96:
1257  05EA              ; 581         }
1258  05EA              ; 582     }
1259  05EA              ; 583     ftpSettingsEditViewEditField();
1260  05EA C3 44 06     	jp ftpsettingseditvieweditfield
1261  05ED              ; 584 }
1262  05ED              ; 585
1263  05ED              ; 586 void ftpSettingsEditViewSaveEditValueToHL() {
1264  05ED              ftpsettingseditviewsaveeditvalue:
1265  05ED              ; 587     push_pop(de) {
1266  05ED D5           	push de
1267  05EE              ; 588         push_pop(bc) {
1268  05EE C5           	push bc
1269  05EF              ; 589             de = ftpSettingsEditViewEditValue;
1270  05EF 11 22 10     	ld de, ftpsettingseditvieweditvalue
1271  05F2              ; 590             a = ftpSettingsEditViewEditPos;
1272  05F2 3A 3A 10     	ld a, (ftpsettingseditvieweditpos)
1273  05F5              ; 591             c = a;
1274  05F5 4F           	ld c, a
1275  05F6              ; 592             b = 0;
1276  05F6 06 00        	ld b, 0
1277  05F8              ; 593             do {
1278  05F8              l_103:
1279  05F8              ; 594                 a = *de;
1280  05F8 1A           	ld a, (de)
1281  05F9              ; 595                 *hl = a;
1282  05F9 77           	ld (hl), a
1283  05FA              ; 596                 hl++;
1284  05FA 23           	inc hl
1285  05FB              ; 597                 de++;
1286  05FB 13           	inc de
1287  05FC              ; 598                 b++;
1288  05FC 04           	inc b
1289  05FD              ; 599                 a = b;
1290  05FD 78           	ld a, b
1291  05FE              ; 600                 a -= c;
1292  05FE 91           	sub c
1293  05FF              l_104:
1294  05FF C2 F8 05     	jp nz, l_103
1295  0602              ; 601             } while (flag_nz);
1296  0602              ; 602             *hl = 0;
1297  0602 36 00        	ld (hl), 0
1298  0604 C1           	pop bc
1299  0605 D1           	pop de
1300  0606 C9           	ret
1301  0607              ; 603         }
1302  0607              ; 604     }
1303  0607              ; 605 }
1304  0607              ; 606
1305  0607              ; 607 void ftpSettingsEditView_CopyStrFromHL() {
1306  0607              ftpsettingseditview_copystrfromh:
1307  0607              ; 608     push_pop(de) {
1308  0607 D5           	push de
1309  0608              ; 609         push_pop(bc) {
1310  0608 C5           	push bc
1311  0609              ; 610             de = ftpSettingsEditViewEditValue;
1312  0609 11 22 10     	ld de, ftpsettingseditvieweditvalue
1313  060C              ; 611             b = 0;
1314  060C 06 00        	ld b, 0
1315  060E              ; 612             c = 0;
1316  060E 0E 00        	ld c, 0
1317  0610              ; 613             do {
1318  0610              l_106:
1319  0610              ; 614                 a = *hl;
1320  0610 7E           	ld a, (hl)
1321  0611              ; 615                 *de = a;
1322  0611 12           	ld (de), a
1323  0612              ; 616                 if ((a = b) == 22) {
1324  0612 78           	ld a, b
1325  0613 FE 16        	cp 22
1326  0615 C2 1E 06     	jp nz, l_109
1327  0618              ; 617                     a = 0;
1328  0618 3E 00        	ld a, 0
1329  061A              ; 618                     *de = a;
1330  061A 12           	ld (de), a
1331  061B C3 38 06     	jp l_110
1332  061E              l_109:
1333  061E              ; 619                 } else if ((a = c) == 1) {
1334  061E 79           	ld a, c
1335  061F FE 01        	cp 1
1336  0621 C2 2A 06     	jp nz, l_111
1337  0624              ; 620                     a = ' ';
1338  0624 3E 20        	ld a, 32
1339  0626              ; 621                     *de = a;
1340  0626 12           	ld (de), a
1341  0627 C3 38 06     	jp l_112
1342  062A              l_111:
1343  062A              ; 622                 } else if ((a = *de) == 0) {
1344  062A 1A           	ld a, (de)
1345  062B B7           	or a
1346  062C C2 38 06     	jp nz, l_113
1347  062F              ; 623                     c = 1;
1348  062F 0E 01        	ld c, 1
1349  0631              ; 624                     a = ' ';
1350  0631 3E 20        	ld a, 32
1351  0633              ; 625                     *de = a;
1352  0633 12           	ld (de), a
1353  0634              ; 626                     a = b;
1354  0634 78           	ld a, b
1355  0635              ; 627                     ftpSettingsEditViewEditPos = a;
1356  0635 32 3A 10     	ld (ftpsettingseditvieweditpos), a
1357  0638              l_113:
1358  0638              l_112:
1359  0638              l_110:
1360  0638              ; 628                 }
1361  0638              ; 629
1362  0638              ; 630                 hl ++;
1363  0638 23           	inc hl
1364  0639              ; 631                 de++;
1365  0639 13           	inc de
1366  063A              ; 632                 b++;
1367  063A 04           	inc b
1368  063B              ; 633                 a = b;
1369  063B 78           	ld a, b
1370  063C              ; 634                 a -= 23;
1371  063C D6 17        	sub 23
1372  063E              l_107:
1373  063E C2 10 06     	jp nz, l_106
1374  0641 C1           	pop bc
1375  0642 D1           	pop de
1376  0643 C9           	ret
1377  0644              ; 635             } while (flag_nz);
1378  0644              ; 636         }
1379  0644              ; 637     }
1380  0644              ; 638 }
1381  0644              ; 639
1382  0644              ; 640 void ftpSettingsEditViewEditField() {
1383  0644              ftpsettingseditvieweditfield:
1384  0644              ; 641     hl = ftpSettingsEditViewEditValuePos;
1385  0644 2A 20 10     	ld hl, (ftpsettingseditvieweditvaluepos)
1386  0647              ; 642     setPosCursor();
1387  0647 CD 3C F8     	call setposcursor
1388  064A              ; 643
1389  064A              ; 644     a = 0xFF;
1390  064A 3E FF        	ld a, 255
1391  064C              ; 645     inverceAddress = a;
1392  064C 32 D3 F3     	ld (inverceaddress), a
1393  064F              ; 646
1394  064F              ; 647     hl = ftpSettingsEditViewEditValue;
1395  064F 21 22 10     	ld hl, ftpsettingseditvieweditvalue
1396  0652              ; 648     printHLStr();
1397  0652 CD 18 F8     	call printhlstr
1398  0655              ; 649
1399  0655              ; 650     ftpSettingsEditViewSetEditCursor();
1400  0655 CD E4 06     	call ftpsettingseditviewseteditcursor
1401  0658              ; 651     push_pop(bc) {
1402  0658 C5           	push bc
1403  0659              ; 652         b = 0;
1404  0659 06 00        	ld b, 0
1405  065B              ; 653         do {
1406  065B              l_115:
1407  065B              ; 654             getKeyboardCharA();
1408  065B CD 03 F8     	call getkeyboardchara
1409  065E              ; 655
1410  065E              ; 656             if (a == 0x1B) { // выход из редактирования без сохранения
1411  065E FE 1B        	cp 27
1412  0660 C2 68 06     	jp nz, l_118
1413  0663              ; 657                 b = 1;
1414  0663 06 01        	ld b, 1
1415  0665 C3 B5 06     	jp l_119
1416  0668              l_118:
1417  0668              ; 658             } else if (a == 0x0D) { // Сохранить и выйти из редактирования
1418  0668 FE 0D        	cp 13
1419  066A C2 75 06     	jp nz, l_120
1420  066D              ; 659                 b = 1;
1421  066D 06 01        	ld b, 1
1422  066F              ; 660                 ftpSettingsEditViewSaveField();
1423  066F CD 82 07     	call ftpsettingseditviewsavefield
1424  0672 C3 B5 06     	jp l_121
1425  0675              l_120:
1426  0675              ; 661             } else if (a >= 0x20) {
1427  0675 FE 20        	cp 32
1428  0677 DA B5 06     	jp c, l_122
1429  067A              ; 662                 if (a < 0x7F) { //Ввод символа
1430  067A FE 7F        	cp 127
1431  067C D2 9D 06     	jp nc, l_124
1432  067F              ; 663                     c = a;
1433  067F 4F           	ld c, a
1434  0680              ; 664                     // Если достигли предела - то перемещаем курсор на 1 назад
1435  0680              ; 665                     a = ftpSettingsEditViewEditPos;
1436  0680 3A 3A 10     	ld a, (ftpsettingseditvieweditpos)
1437  0683              ; 666                     if (a >= 15) {
1438  0683 FE 0F        	cp 15
1439  0685 DA 89 06     	jp c, l_126
1440  0688              ; 667                         a--;
1441  0688 3D           	dec a
1442  0689              l_126:
1443  0689              ; 668                     }
1444  0689              ; 669                     ftpSettingsEditViewEditPos = a;
1445  0689 32 3A 10     	ld (ftpsettingseditvieweditpos), a
1446  068C              ; 670
1447  068C              ; 671                     //Сохраняем символ
1448  068C              ; 672                     a = c;
1449  068C 79           	ld a, c
1450  068D              ; 673                     ftpSettingsEditViewSetValueA();
1451  068D CD C7 06     	call ftpsettingseditviewsetvaluea
1452  0690              ; 674                     a = ftpSettingsEditViewEditPos;
1453  0690 3A 3A 10     	ld a, (ftpsettingseditvieweditpos)
1454  0693              ; 675                     a++;
1455  0693 3C           	inc a
1456  0694              ; 676                     ftpSettingsEditViewEditPos = a;
1457  0694 32 3A 10     	ld (ftpsettingseditvieweditpos), a
1458  0697              ; 677                     ftpSettingsEditViewSetEditCursor();
1459  0697 CD E4 06     	call ftpsettingseditviewseteditcursor
1460  069A C3 B5 06     	jp l_125
1461  069D              l_124:
1462  069D              ; 678                 } else if (a == 0x7F) { //Забой... (удаление символа)
1463  069D FE 7F        	cp 127
1464  069F C2 B5 06     	jp nz, l_128
1465  06A2              ; 679                     if ((a = ftpSettingsEditViewEditPos) > 0) {
1466  06A2 3A 3A 10     	ld a, (ftpsettingseditvieweditpos)
1467  06A5 B7           	or a
1468  06A6 CA B5 06     	jp z, l_130
1469  06A9              ; 680                         a--;
1470  06A9 3D           	dec a
1471  06AA              ; 681                         ftpSettingsEditViewEditPos = a;
1472  06AA 32 3A 10     	ld (ftpsettingseditvieweditpos), a
1473  06AD              ; 682                         ftpSettingsEditViewSetEditCursor();
1474  06AD CD E4 06     	call ftpsettingseditviewseteditcursor
1475  06B0              ; 683                         a = ' ';
1476  06B0 3E 20        	ld a, 32
1477  06B2              ; 684                         ftpSettingsEditViewSetValueA();
1478  06B2 CD C7 06     	call ftpsettingseditviewsetvaluea
1479  06B5              l_130:
1480  06B5              l_128:
1481  06B5              l_125:
1482  06B5              l_122:
1483  06B5              l_121:
1484  06B5              l_119:
1485  06B5              ; 685                     }
1486  06B5              ; 686                 }
1487  06B5              ; 687             }
1488  06B5              ; 688
1489  06B5              ; 689             a = b;
1490  06B5 78           	ld a, b
1491  06B6              ; 690             a -= 1;
1492  06B6 D6 01        	sub 1
1493  06B8              l_116:
1494  06B8 C2 5B 06     	jp nz, l_115
1495  06BB C1           	pop bc
1496  06BC              ; 691         } while (flag_nz);
1497  06BC              ; 692     }
1498  06BC              ; 693
1499  06BC              ; 694     a = 0x00;
1500  06BC 3E 00        	ld a, 0
1501  06BE              ; 695     inverceAddress = a;
1502  06BE 32 D3 F3     	ld (inverceaddress), a
1503  06C1              ; 696
1504  06C1              ; 697     showFtpSettingsEditView();
1505  06C1 CD FE 04     	call showftpsettingseditview
1506  06C4              ; 698     ftpSettingsEditViewDataUpdate();
1507  06C4 C3 F2 06     	jp ftpsettingseditviewdataupdate
1508  06C7              ; 699 }
1509  06C7              ; 700
1510  06C7              ; 701 void ftpSettingsEditViewSetValueA() {
1511  06C7              ftpsettingseditviewsetvaluea:
1512  06C7              ; 702     push_pop(hl) {
1513  06C7 E5           	push hl
1514  06C8              ; 703         push_pop(bc) {
1515  06C8 C5           	push bc
1516  06C9              ; 704             b = a;
1517  06C9 47           	ld b, a
1518  06CA              ; 705             //Сохраним символ в ftpSettingsEditViewEditValue
1519  06CA              ; 706             hl = ftpSettingsEditViewEditValue;
1520  06CA 21 22 10     	ld hl, ftpsettingseditvieweditvalue
1521  06CD              ; 707             a = ftpSettingsEditViewEditPos;
1522  06CD 3A 3A 10     	ld a, (ftpsettingseditvieweditpos)
1523  06D0              ; 708             a += l;
1524  06D0 85           	add l
1525  06D1              ; 709             l = a;
1526  06D1 6F           	ld l, a
1527  06D2              ; 710             if (flag_c) {
1528  06D2 D2 D6 06     	jp nc, l_132
1529  06D5              ; 711                 h++;
1530  06D5 24           	inc h
1531  06D6              l_132:
1532  06D6              ; 712             }
1533  06D6              ; 713             *hl = b;
1534  06D6 70           	ld (hl), b
1535  06D7              ; 714             //Отрисуем символ на экране
1536  06D7              ; 715             ftpSettingsEditViewSetEditCursor();
1537  06D7 CD E4 06     	call ftpsettingseditviewseteditcursor
1538  06DA              ; 716             a = b;
1539  06DA 78           	ld a, b
1540  06DB              ; 717             printChatA();
1541  06DB CD 0F F8     	call printchata
1542  06DE              ; 718             ftpSettingsEditViewSetEditCursor();
1543  06DE CD E4 06     	call ftpsettingseditviewseteditcursor
1544  06E1 C1           	pop bc
1545  06E2 E1           	pop hl
1546  06E3 C9           	ret
1547  06E4              ; 719         }
1548  06E4              ; 720     }
1549  06E4              ; 721 }
1550  06E4              ; 722
1551  06E4              ; 723 void ftpSettingsEditViewSetEditCursor() {
1552  06E4              ftpsettingseditviewseteditcursor:
1553  06E4              ; 724     push_pop(hl) {
1554  06E4 E5           	push hl
1555  06E5              ; 725         hl = ftpSettingsEditViewEditValuePos;
1556  06E5 2A 20 10     	ld hl, (ftpsettingseditvieweditvaluepos)
1557  06E8              ; 726         a = ftpSettingsEditViewEditPos;
1558  06E8 3A 3A 10     	ld a, (ftpsettingseditvieweditpos)
1559  06EB              ; 727         a += l;
1560  06EB 85           	add l
1561  06EC              ; 728         l = a;
1562  06EC 6F           	ld l, a
1563  06ED              ; 729         setPosCursor();
1564  06ED CD 3C F8     	call setposcursor
1565  06F0 E1           	pop hl
1566  06F1 C9           	ret
1567  06F2              ; 730     }
1568  06F2              ; 731 }
1569  06F2              ; 732
1570  06F2              ; 733 void ftpSettingsEditViewDataUpdate() {
1571  06F2              ftpsettingseditviewdataupdate:
1572  06F2              ; 734     if ((a = rootViewCurrentView) != rootViewCurrentFTPSettingsEditView) {
1573  06F2 3A 99 0F     	ld a, (rootviewcurrentview)
1574  06F5 FE 02        	cp 2
1575  06F7 CA FB 06     	jp z, l_134
1576  06FA              ; 735         return;
1577  06FA C9           	ret
1578  06FB              l_134:
1579  06FB              ; 736     }
1580  06FB              ; 737
1581  06FB              ; 738     push_pop(bc) {
1582  06FB C5           	push bc
1583  06FC              ; 739         b = 0;
1584  06FC 06 00        	ld b, 0
1585  06FE              ; 740         do {
1586  06FE              l_136:
1587  06FE              ; 741             a = 0x00;
1588  06FE 3E 00        	ld a, 0
1589  0700              ; 742             inverceAddress = a;
1590  0700 32 D3 F3     	ld (inverceaddress), a
1591  0703              ; 743
1592  0703              ; 744             if ((a = ftpSettingsEditViewCurrentPos) == b) {
1593  0703 3A 1F 10     	ld a, (ftpsettingseditviewcurrentpos)
1594  0706 B8           	cp b
1595  0707 C2 0F 07     	jp nz, l_139
1596  070A              ; 745                 a = 0xFF;
1597  070A 3E FF        	ld a, 255
1598  070C              ; 746                 inverceAddress = a;
1599  070C 32 D3 F3     	ld (inverceaddress), a
1600  070F              l_139:
1601  070F              ; 747             }
1602  070F              ; 748
1603  070F              ; 749             a = b;
1604  070F 78           	ld a, b
1605  0710              ; 750             ftpSettingsEditViewShowValueA();
1606  0710 CD 21 07     	call ftpsettingseditviewshowvaluea
1607  0713              ; 751
1608  0713              ; 752             a = 0x00;
1609  0713 3E 00        	ld a, 0
1610  0715              ; 753             inverceAddress = a;
1611  0715 32 D3 F3     	ld (inverceaddress), a
1612  0718              ; 754
1613  0718              ; 755             b++;
1614  0718 04           	inc b
1615  0719              ; 756             a = b;
1616  0719 78           	ld a, b
1617  071A              ; 757             a -= 5;
1618  071A D6 05        	sub 5
1619  071C              l_137:
1620  071C C2 FE 06     	jp nz, l_136
1621  071F C1           	pop bc
1622  0720 C9           	ret
1623  0721              ; 11 void ftpSettingsEditViewShowValueA() {
1624  0721              ftpsettingseditviewshowvaluea:
1625  0721              ; 12     if (a == 0) {
1626  0721 B7           	or a
1627  0722 C2 34 07     	jp nz, l_141
1628  0725              ; 13         hl = ftpSettingsEditViewIpValPos;
1629  0725 2A 07 10     	ld hl, (ftpsettingseditviewipvalpos)
1630  0728              ; 14         setPosCursor();
1631  0728 CD 3C F8     	call setposcursor
1632  072B              ; 15
1633  072B              ; 16         hl = ftpSettingsIpValue;
1634  072B 21 90 0D     	ld hl, ftpsettingsipvalue
1635  072E              ; 17         printHLStr();
1636  072E CD 18 F8     	call printhlstr
1637  0731 C3 81 07     	jp l_142
1638  0734              l_141:
1639  0734              ; 18     } else if (a == 1) {
1640  0734 FE 01        	cp 1
1641  0736 C2 48 07     	jp nz, l_143
1642  0739              ; 19         hl = ftpSettingsEditViewPortValPos;
1643  0739 2A 09 10     	ld hl, (ftpsettingseditviewportvalpos)
1644  073C              ; 20         setPosCursor();
1645  073C CD 3C F8     	call setposcursor
1646  073F              ; 21
1647  073F              ; 22         hl = ftpSettingsPortValue;
1648  073F 21 A2 0D     	ld hl, ftpsettingsportvalue
1649  0742              ; 23         printHLStr();
1650  0742 CD 18 F8     	call printhlstr
1651  0745 C3 81 07     	jp l_144
1652  0748              l_143:
1653  0748              ; 24     } else if (a == 2) {
1654  0748 FE 02        	cp 2
1655  074A C2 5C 07     	jp nz, l_145
1656  074D              ; 25         hl = ftpSettingsEditViewUserValPos;
1657  074D 2A 0B 10     	ld hl, (ftpsettingseditviewuservalpos)
1658  0750              ; 26         setPosCursor();
1659  0750 CD 3C F8     	call setposcursor
1660  0753              ; 27
1661  0753              ; 28         hl = ftpSettingsUserValue;
1662  0753 21 D2 0D     	ld hl, ftpsettingsuservalue
1663  0756              ; 29         printHLStr();
1664  0756 CD 18 F8     	call printhlstr
1665  0759 C3 81 07     	jp l_146
1666  075C              l_145:
1667  075C              ; 30     } else if (a == 3) {
1668  075C FE 03        	cp 3
1669  075E C2 70 07     	jp nz, l_147
1670  0761              ; 31         hl = ftpSettingsEditViewPasswordValPos;
1671  0761 2A 0D 10     	ld hl, (ftpsettingseditviewpasswordvalpo)
1672  0764              ; 32         setPosCursor();
1673  0764 CD 3C F8     	call setposcursor
1674  0767              ; 33
1675  0767              ; 34         hl = ftpSettingsEditViewPasswordVal;
1676  0767 21 0F 10     	ld hl, ftpsettingseditviewpasswordval
1677  076A              ; 35         printHLStr();
1678  076A CD 18 F8     	call printhlstr
1679  076D C3 81 07     	jp l_148
1680  0770              l_147:
1681  0770              ; 36     } else if (a == 4) {
1682  0770 FE 04        	cp 4
1683  0772 C2 81 07     	jp nz, l_149
1684  0775              ; 37         hl = ftpSettingsEditViewOkLabelPos;
1685  0775 2A FE 0F     	ld hl, (ftpsettingseditviewoklabelpos)
1686  0778              ; 38         setPosCursor();
1687  0778 CD 3C F8     	call setposcursor
1688  077B              ; 39         hl = ftpSettingsEditViewOkLabel;
1689  077B 21 00 10     	ld hl, ftpsettingseditviewoklabel
1690  077E              ; 40         printHLStr();
1691  077E CD 18 F8     	call printhlstr
1692  0781              l_149:
1693  0781              l_148:
1694  0781              l_146:
1695  0781              l_144:
1696  0781              l_142:
1697  0781 C9           	ret
1698  0782              ; 41     }
1699  0782              ; 42 }
1700  0782              ; 43
1701  0782              ; 44 void ftpSettingsEditViewSaveField() {
1702  0782              ftpsettingseditviewsavefield:
1703  0782              ; 45     a = ftpSettingsEditViewCurrentPos;
1704  0782 3A 1F 10     	ld a, (ftpsettingseditviewcurrentpos)
1705  0785              ; 46     if (a == 0) {
1706  0785 B7           	or a
1707  0786 C2 8F 07     	jp nz, l_151
1708  0789              ; 47         hl = ftpSettingsIpValue;
1709  0789 21 90 0D     	ld hl, ftpsettingsipvalue
1710  078C C3 AD 07     	jp l_152
1711  078F              l_151:
1712  078F              ; 48     } else if (a == 1) {
1713  078F FE 01        	cp 1
1714  0791 C2 9A 07     	jp nz, l_153
1715  0794              ; 49         hl = ftpSettingsPortValue;
1716  0794 21 A2 0D     	ld hl, ftpsettingsportvalue
1717  0797 C3 AD 07     	jp l_154
1718  079A              l_153:
1719  079A              ; 50     } else if (a == 2) {
1720  079A FE 02        	cp 2
1721  079C C2 A5 07     	jp nz, l_155
1722  079F              ; 51         hl = ftpSettingsUserValue;
1723  079F 21 D2 0D     	ld hl, ftpsettingsuservalue
1724  07A2 C3 AD 07     	jp l_156
1725  07A5              l_155:
1726  07A5              ; 52     } else if (a == 3) {
1727  07A5 FE 03        	cp 3
1728  07A7 C2 AD 07     	jp nz, l_157
1729  07AA              ; 53         hl = ftpSettingsEditViewPasswordVal;
1730  07AA 21 0F 10     	ld hl, ftpsettingseditviewpasswordval
1731  07AD              l_157:
1732  07AD              l_156:
1733  07AD              l_154:
1734  07AD              l_152:
1735  07AD              ; 54     }
1736  07AD              ; 55     ftpSettingsEditViewSaveEditValueToHL();
1737  07AD CD ED 05     	call ftpsettingseditviewsaveeditvalue
1738  07B0              ; 56     //Save ESP
1739  07B0              ; 57     a = ftpSettingsEditViewCurrentPos;
1740  07B0 3A 1F 10     	ld a, (ftpsettingseditviewcurrentpos)
1741  07B3              ; 58     if (a == 0) {
1742  07B3 B7           	or a
1743  07B4 C2 BD 07     	jp nz, l_159
1744  07B7              ; 59         setFTPUrl();
1745  07B7 CD 8A 15     	call setftpurl
1746  07BA C3 DB 07     	jp l_160
1747  07BD              l_159:
1748  07BD              ; 60     } else if (a == 1) {
1749  07BD FE 01        	cp 1
1750  07BF C2 C8 07     	jp nz, l_161
1751  07C2              ; 61         setFTPPort();
1752  07C2 CD DA 16     	call setftpport
1753  07C5 C3 DB 07     	jp l_162
1754  07C8              l_161:
1755  07C8              ; 62     } else if (a == 2) {
1756  07C8 FE 02        	cp 2
1757  07CA C2 D3 07     	jp nz, l_163
1758  07CD              ; 63         setFTPUser();
1759  07CD CD FA 15     	call setftpuser
1760  07D0 C3 DB 07     	jp l_164
1761  07D3              l_163:
1762  07D3              ; 64     } else if (a == 3) {
1763  07D3 FE 03        	cp 3
1764  07D5 C2 DB 07     	jp nz, l_165
1765  07D8              ; 65         setFTPPassword();
1766  07D8 CD 6A 16     	call setftppassword
1767  07DB              l_165:
1768  07DB              l_164:
1769  07DB              l_162:
1770  07DB              l_160:
1771  07DB C9           	ret
1772  07DC              ; 66     }
1773  07DC              ; 67 }
1774  07DC              ; 68
1775  07DC              ; 69 void ftpSettingsEditViewKeyA() {
1776  07DC              ftpsettingseditviewkeya:
1777  07DC              ; 70     push_pop(hl) {
1778  07DC E5           	push hl
1779  07DD              ; 71         l = a;
1780  07DD 6F           	ld l, a
1781  07DE              ; 72         if ((a = rootViewCurrentView) == rootViewCurrentFTPSettingsEditView) {
1782  07DE 3A 99 0F     	ld a, (rootviewcurrentview)
1783  07E1 FE 02        	cp 2
1784  07E3 C2 49 08     	jp nz, l_167
1785  07E6              ; 73             a = l;
1786  07E6 7D           	ld a, l
1787  07E7              ; 74             if (a == 0x1B) { //ESC выход из настройки
1788  07E7 FE 1B        	cp 27
1789  07E9 C2 FA 07     	jp nz, l_169
1790  07EC              ; 75                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
1791  07EC 3E 00        	ld a, 0
1792  07EE              ; 76                 rootViewCurrentView = a;
1793  07EE 32 99 0F     	ld (rootviewcurrentview), a
1794  07F1              ; 77
1795  07F1              ; 78                 updateRootUI();
1796  07F1 CD 17 02     	call updaterootui
1797  07F4              ; 79                 updateRootDataUI();
1798  07F4 CD 14 02     	call updaterootdataui
1799  07F7 C3 49 08     	jp l_170
1800  07FA              l_169:
1801  07FA              ; 80             } else {
1802  07FA              ; 81                 if (a == 0x1A) { //down
1803  07FA FE 1A        	cp 26
1804  07FC C2 10 08     	jp nz, l_171
1805  07FF              ; 82                     a = ftpSettingsEditViewCurrentPos;
1806  07FF 3A 1F 10     	ld a, (ftpsettingseditviewcurrentpos)
1807  0802              ; 83                     a++;
1808  0802 3C           	inc a
1809  0803              ; 84                     if (a == 5) {
1810  0803 FE 05        	cp 5
1811  0805 C2 0A 08     	jp nz, l_173
1812  0808              ; 85                         a = 0;
1813  0808 3E 00        	ld a, 0
1814  080A              l_173:
1815  080A              ; 86                     }
1816  080A              ; 87                     ftpSettingsEditViewCurrentPos = a;
1817  080A 32 1F 10     	ld (ftpsettingseditviewcurrentpos), a
1818  080D C3 49 08     	jp l_172
1819  0810              l_171:
1820  0810              ; 88                 } else if (a == 0x19) { //up
1821  0810 FE 19        	cp 25
1822  0812 C2 28 08     	jp nz, l_175
1823  0815              ; 89                     a = ftpSettingsEditViewCurrentPos;
1824  0815 3A 1F 10     	ld a, (ftpsettingseditviewcurrentpos)
1825  0818              ; 90                     if (a == 0) {
1826  0818 B7           	or a
1827  0819 C2 21 08     	jp nz, l_177
1828  081C              ; 91                         a = 4;
1829  081C 3E 04        	ld a, 4
1830  081E C3 22 08     	jp l_178
1831  0821              l_177:
1832  0821              ; 92                     } else {
1833  0821              ; 93                         a--;
1834  0821 3D           	dec a
1835  0822              l_178:
1836  0822              ; 94                     }
1837  0822              ; 95                     ftpSettingsEditViewCurrentPos = a;
1838  0822 32 1F 10     	ld (ftpsettingseditviewcurrentpos), a
1839  0825 C3 49 08     	jp l_176
1840  0828              l_175:
1841  0828              ; 96                 } else if (a == 0x0D) { //Enter
1842  0828 FE 0D        	cp 13
1843  082A C2 49 08     	jp nz, l_179
1844  082D              ; 97                     /// и подключиться к FTP
1845  082D              ; 98                     needFtpConnect();
1846  082D CD 14 17     	call needftpconnect
1847  0830              ; 99                     ///
1848  0830              ; 100                     if ((a = ftpSettingsEditViewCurrentPos) == 4) { // Нажатие на кнопку ОК
1849  0830 3A 1F 10     	ld a, (ftpsettingseditviewcurrentpos)
1850  0833 FE 04        	cp 4
1851  0835 C2 46 08     	jp nz, l_181
1852  0838              ; 101                         a = rootViewCurrentDiskView; // переходим на список файлов на диске
1853  0838 3E 00        	ld a, 0
1854  083A              ; 102                         rootViewCurrentView = a;
1855  083A 32 99 0F     	ld (rootviewcurrentview), a
1856  083D              ; 103
1857  083D              ; 104                         updateRootUI();
1858  083D CD 17 02     	call updaterootui
1859  0840              ; 105                         updateRootDataUI();
1860  0840 CD 14 02     	call updaterootdataui
1861  0843 C3 49 08     	jp l_182
1862  0846              l_181:
1863  0846              ; 106                     } else {
1864  0846              ; 107                         ftpSettingsEditViewSelectEditField();
1865  0846 CD 87 05     	call ftpsettingseditviewselecteditfie
1866  0849              l_182:
1867  0849              l_179:
1868  0849              l_176:
1869  0849              l_172:
1870  0849              l_170:
1871  0849              l_167:
1872  0849 E1           	pop hl
1873  084A C9           	ret
1874  084B              ; 108                     }
1875  084B              ; 109                 }
1876  084B              ; 110             }
1877  084B              ; 111         }
1878  084B              ; 112     }
1879  084B              ; 113 }
1880  084B              ; 114
1881  084B              ; 115 void updateFtpStatus() {
1882  084B              updateftpstatus:
1883  084B              ; 116     a = updateFtpStatusTike;
1884  084B 3A 3B 10     	ld a, (updateftpstatustike)
1885  084E              ; 117     if (a < 240) {
1886  084E FE F0        	cp 240
1887  0850 D2 58 08     	jp nc, l_183
1888  0853              ; 118         a++;
1889  0853 3C           	inc a
1890  0854              ; 119         updateFtpStatusTike = a;
1891  0854 32 3B 10     	ld (updateftpstatustike), a
1892  0857              ; 120         return;
1893  0857 C9           	ret
1894  0858              l_183:
1895  0858              ; 121     }
1896  0858              ; 122     a = 0;
1897  0858 3E 00        	ld a, 0
1898  085A              ; 123     updateFtpStatusTike = a;
1899  085A 32 3B 10     	ld (updateftpstatustike), a
1900  085D              ; 124     //
1901  085D              ; 125     getFtpState();
1902  085D CD 24 17     	call getftpstate
1903  0860              ; 126     //
1904  0860              ; 127     updateFtpStatusUI();
1905  0860              ; 128 }
1906  0860              ; 129
1907  0860              ; 130 void updateFtpStatusUI() {
1908  0860              updateftpstatusui:
1909  0860              ; 131     if ((a = ftpSettingsStateChange) == 0x01) {
1910  0860 3A B7 0D     	ld a, (ftpsettingsstatechange)
1911  0863 FE 01        	cp 1
1912  0865 C2 81 08     	jp nz, l_185
1913  0868              ; 132         a = 0x00;
1914  0868 3E 00        	ld a, 0
1915  086A              ; 133         ftpSettingsStateChange = a;
1916  086A 32 B7 0D     	ld (ftpsettingsstatechange), a
1917  086D              ; 134
1918  086D              ; 135         updateFtpViewStatusText();
1919  086D CD 0E 1B     	call updateftpviewstatustext
1920  0870              ; 136         //
1921  0870              ; 137         clearFtpViewValData();
1922  0870 CD F6 1A     	call clearftpviewvaldata
1923  0873              ; 138         updateFtpViewValData();
1924  0873 CD 02 1B     	call updateftpviewvaldata
1925  0876              ; 139
1926  0876              ; 140         // Получаем каталог
1927  0876              ; 141         if ((a = ftpSettingsStateVal) == 0x01) {
1928  0876 3A B6 0D     	ld a, (ftpsettingsstateval)
1929  0879 FE 01        	cp 1
1930  087B C2 81 08     	jp nz, l_187
1931  087E              ; 142             needUpdateFtpList();
1932  087E CD 4F 18     	call needupdateftplist
1933  0881              l_187:
1934  0881              l_185:
1935  0881 C9           	ret
1936  0882              ; 11 void needOpenWiFiSettingsEditView() {
1937  0882              needopenwifisettingseditview:
1938  0882              ; 12     push_pop(hl) {
1939  0882 E5           	push hl
1940  0883              ; 13         if ((a = rootViewCurrentView) != rootViewCurrentWiFiSettingsEditView) { //Если уже открыты настройки - не открываем
1941  0883 3A 99 0F     	ld a, (rootviewcurrentview)
1942  0886 FE 03        	cp 3
1943  0888 CA A6 08     	jp z, l_189
1944  088B              ; 14             if ((a = rootViewCurrentView) != rootViewCurrentFTPSettingsEditView) { //Если открыта настройка WiFi тоже не открываем
1945  088B 3A 99 0F     	ld a, (rootviewcurrentview)
1946  088E FE 02        	cp 2
1947  0890 CA A6 08     	jp z, l_191
1948  0893              ; 15
1949  0893              ; 16                 a = rootViewCurrentWiFiSettingsEditView;
1950  0893 3E 03        	ld a, 3
1951  0895              ; 17                 rootViewCurrentView = a;
1952  0895 32 99 0F     	ld (rootviewcurrentview), a
1953  0898              ; 18
1954  0898              ; 19                 a = 2;
1955  0898 3E 02        	ld a, 2
1956  089A              ; 20                 wifiSettingsEditViewCurrentPos = a;
1957  089A 32 A0 10     	ld (wifisettingseditviewcurrentpos), a
1958  089D              ; 21
1959  089D              ; 22                 showDiskList(); //Сбросить выделение строки
1960  089D CD CE 03     	call showdisklist
1961  08A0              ; 23                 showWiFiSettingsEditView();
1962  08A0 CD A8 08     	call showwifisettingseditview
1963  08A3              ; 24                 wifiSettingsEditViewDataUpdate();
1964  08A3 CD F3 08     	call wifisettingseditviewdataupdate
1965  08A6              l_191:
1966  08A6              l_189:
1967  08A6 E1           	pop hl
1968  08A7 C9           	ret
1969  08A8              ; 25             }
1970  08A8              ; 26         }
1971  08A8              ; 27     }
1972  08A8              ; 28 }
1973  08A8              ; 29
1974  08A8              ; 30 void showWiFiSettingsEditView() {
1975  08A8              showwifisettingseditview:
1976  08A8              ; 31     drowRectX = (a = wifiSettingsEditViewX);
1977  08A8 3A A1 10     	ld a, (wifisettingseditviewx)
1978  08AB 32 B8 03     	ld (drowrectx), a
1979  08AE              ; 32     drowRectY = (a = wifiSettingsEditViewY);
1980  08AE 3A A2 10     	ld a, (wifisettingseditviewy)
1981  08B1 32 B9 03     	ld (drowrecty), a
1982  08B4              ; 33     drowRectEndX = (a = wifiSettingsEditViewEX);
1983  08B4 3A A3 10     	ld a, (wifisettingseditviewex)
1984  08B7 32 BA 03     	ld (drowrectendx), a
1985  08BA              ; 34     drowRectEndY = (a = wifiSettingsEditViewEY);
1986  08BA 3A A4 10     	ld a, (wifisettingseditviewey)
1987  08BD 32 BB 03     	ld (drowrectendy), a
1988  08C0              ; 35     drowRect();
1989  08C0 CD 24 03     	call drowrect
1990  08C3              ; 36
1991  08C3              ; 37     hl = wifiSettingsEditViewLabelPos;
1992  08C3 2A A5 10     	ld hl, (wifisettingseditviewlabelpos)
1993  08C6              ; 38     setPosCursor();
1994  08C6 CD 3C F8     	call setposcursor
1995  08C9              ; 39     hl = wifiSettingsEditViewLabel;
1996  08C9 21 A7 10     	ld hl, wifisettingseditviewlabel
1997  08CC              ; 40     printHLStr();
1998  08CC CD 18 F8     	call printhlstr
1999  08CF              ; 41
2000  08CF              ; 42     hl = wifiSettingsEditViewSSIDLabelPos;
2001  08CF 2A B8 10     	ld hl, (wifisettingseditviewssidlabelpos)
2002  08D2              ; 43     setPosCursor();
2003  08D2 CD 3C F8     	call setposcursor
2004  08D5              ; 44     hl = wifiSettingsEditViewSSIDLabel;
2005  08D5 21 BA 10     	ld hl, wifisettingseditviewssidlabel
2006  08D8              ; 45     printHLStr();
2007  08D8 CD 18 F8     	call printhlstr
2008  08DB              ; 46
2009  08DB              ; 47     hl = wifiSettingsEditViewSSIDPasswordLabelPos;
2010  08DB 2A C0 10     	ld hl, (wifisettingseditviewssidpassword)
2011  08DE              ; 48     setPosCursor();
2012  08DE CD 3C F8     	call setposcursor
2013  08E1              ; 49     hl = wifiSettingsEditViewSSIDPasswordLabel;
2014  08E1 21 C2 10     	ld hl, wifisettingseditviewssidpassword_1
2015  08E4              ; 50     printHLStr();
2016  08E4 CD 18 F8     	call printhlstr
2017  08E7              ; 51
2018  08E7              ; 52     hl = wifiSettingsEditViewOkLabelPos;
2019  08E7 2A C8 10     	ld hl, (wifisettingseditviewoklabelpos)
2020  08EA              ; 53     setPosCursor();
2021  08EA CD 3C F8     	call setposcursor
2022  08ED              ; 54     hl = wifiSettingsEditViewOkLabel;
2023  08ED 21 CA 10     	ld hl, wifisettingseditviewoklabel
2024  08F0              ; 55     printHLStr();
2025  08F0 C3 18 F8     	jp printhlstr
2026  08F3              ; 56 }
2027  08F3              ; 57
2028  08F3              ; 58 void wifiSettingsEditViewDataUpdate() {
2029  08F3              wifisettingseditviewdataupdate:
2030  08F3              ; 59     if ((a = rootViewCurrentView) != rootViewCurrentWiFiSettingsEditView) {
2031  08F3 3A 99 0F     	ld a, (rootviewcurrentview)
2032  08F6 FE 03        	cp 3
2033  08F8 CA FC 08     	jp z, l_193
2034  08FB              ; 60         return;
2035  08FB C9           	ret
2036  08FC              l_193:
2037  08FC              ; 61     }
2038  08FC              ; 62
2039  08FC              ; 63     push_pop(bc) {
2040  08FC C5           	push bc
2041  08FD              ; 64         b = 0;
2042  08FD 06 00        	ld b, 0
2043  08FF              ; 65         do {
2044  08FF              l_195:
2045  08FF              ; 66             a = 0x00;
2046  08FF 3E 00        	ld a, 0
2047  0901              ; 67             inverceAddress = a;
2048  0901 32 D3 F3     	ld (inverceaddress), a
2049  0904              ; 68
2050  0904              ; 69             if ((a = wifiSettingsEditViewCurrentPos) == b) {
2051  0904 3A A0 10     	ld a, (wifisettingseditviewcurrentpos)
2052  0907 B8           	cp b
2053  0908 C2 10 09     	jp nz, l_198
2054  090B              ; 70                 a = 0xFF;
2055  090B 3E FF        	ld a, 255
2056  090D              ; 71                 inverceAddress = a;
2057  090D 32 D3 F3     	ld (inverceaddress), a
2058  0910              l_198:
2059  0910              ; 72             }
2060  0910              ; 73
2061  0910              ; 74             a = b;
2062  0910 78           	ld a, b
2063  0911              ; 75             wifiSettingsEditViewShowValueA();
2064  0911 CD 22 09     	call wifisettingseditviewshowvaluea
2065  0914              ; 76
2066  0914              ; 77             a = 0x00;
2067  0914 3E 00        	ld a, 0
2068  0916              ; 78             inverceAddress = a;
2069  0916 32 D3 F3     	ld (inverceaddress), a
2070  0919              ; 79
2071  0919              ; 80             b++;
2072  0919 04           	inc b
2073  091A              ; 81             a = b;
2074  091A 78           	ld a, b
2075  091B              ; 82             a -= 5;
2076  091B D6 05        	sub 5
2077  091D              l_196:
2078  091D C2 FF 08     	jp nz, l_195
2079  0920 C1           	pop bc
2080  0921 C9           	ret
2081  0922              ; 83         } while (flag_nz);
2082  0922              ; 84     }
2083  0922              ; 85 }
2084  0922              ; 86
2085  0922              ; 87 void wifiSettingsEditViewShowValueA() {
2086  0922              wifisettingseditviewshowvaluea:
2087  0922              ; 88     if (a == 0) {
2088  0922 B7           	or a
2089  0923 C2 35 09     	jp nz, l_200
2090  0926              ; 89         hl = wifiSettingsEditViewSSIDValPos;
2091  0926 2A D1 10     	ld hl, (wifisettingseditviewssidvalpos)
2092  0929              ; 90         setPosCursor();
2093  0929 CD 3C F8     	call setposcursor
2094  092C              ; 91
2095  092C              ; 92         hl = wifiSettingsSsidVal;
2096  092C 21 11 0D     	ld hl, wifisettingsssidval
2097  092F              ; 93         printHLStr();
2098  092F CD 18 F8     	call printhlstr
2099  0932 C3 5A 09     	jp l_201
2100  0935              l_200:
2101  0935              ; 94     } else if (a == 1) {
2102  0935 FE 01        	cp 1
2103  0937 C2 49 09     	jp nz, l_202
2104  093A              ; 95         hl = wifiSettingsEditViewSSIDPasswordValPos;
2105  093A 2A D3 10     	ld hl, (wifisettingseditviewssidpassword_2)
2106  093D              ; 96         setPosCursor();
2107  093D CD 3C F8     	call setposcursor
2108  0940              ; 97
2109  0940              ; 98         hl = wifiSettingsEditViewSSIDPasswordVal;
2110  0940 21 D5 10     	ld hl, wifisettingseditviewssidpassword_3
2111  0943              ; 99         printHLStr();
2112  0943 CD 18 F8     	call printhlstr
2113  0946 C3 5A 09     	jp l_203
2114  0949              l_202:
2115  0949              ; 100     } else if (a == 2) {
2116  0949 FE 02        	cp 2
2117  094B C2 5A 09     	jp nz, l_204
2118  094E              ; 101         hl = wifiSettingsEditViewOkLabelPos;
2119  094E 2A C8 10     	ld hl, (wifisettingseditviewoklabelpos)
2120  0951              ; 102         setPosCursor();
2121  0951 CD 3C F8     	call setposcursor
2122  0954              ; 103         hl = wifiSettingsEditViewOkLabel;
2123  0954 21 CA 10     	ld hl, wifisettingseditviewoklabel
2124  0957              ; 104         printHLStr();
2125  0957 CD 18 F8     	call printhlstr
2126  095A              l_204:
2127  095A              l_203:
2128  095A              l_201:
2129  095A C9           	ret
2130  095B              ; 105     }
2131  095B              ; 106 }
2132  095B              ; 107
2133  095B              ; 108 void wifiSettingsEditViewKeyA() {
2134  095B              wifisettingseditviewkeya:
2135  095B              ; 109     push_pop(hl) {
2136  095B E5           	push hl
2137  095C              ; 110         l = a;
2138  095C 6F           	ld l, a
2139  095D              ; 111         if ((a = rootViewCurrentView) == rootViewCurrentWiFiSettingsEditView) {
2140  095D 3A 99 0F     	ld a, (rootviewcurrentview)
2141  0960 FE 03        	cp 3
2142  0962 C2 C8 09     	jp nz, l_206
2143  0965              ; 112             a = l;
2144  0965 7D           	ld a, l
2145  0966              ; 113             if (a == 0x1B) { //ESC выход из настройки
2146  0966 FE 1B        	cp 27
2147  0968 C2 79 09     	jp nz, l_208
2148  096B              ; 114                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
2149  096B 3E 00        	ld a, 0
2150  096D              ; 115                 rootViewCurrentView = a;
2151  096D 32 99 0F     	ld (rootviewcurrentview), a
2152  0970              ; 116
2153  0970              ; 117                 updateRootUI();
2154  0970 CD 17 02     	call updaterootui
2155  0973              ; 118                 updateRootDataUI();
2156  0973 CD 14 02     	call updaterootdataui
2157  0976 C3 C8 09     	jp l_209
2158  0979              l_208:
2159  0979              ; 119             } else {
2160  0979              ; 120                 if (a == 0x1A) { //down
2161  0979 FE 1A        	cp 26
2162  097B C2 8F 09     	jp nz, l_210
2163  097E              ; 121                     a = wifiSettingsEditViewCurrentPos;
2164  097E 3A A0 10     	ld a, (wifisettingseditviewcurrentpos)
2165  0981              ; 122                     a++;
2166  0981 3C           	inc a
2167  0982              ; 123                     if (a == 3) {
2168  0982 FE 03        	cp 3
2169  0984 C2 89 09     	jp nz, l_212
2170  0987              ; 124                         a = 0;
2171  0987 3E 00        	ld a, 0
2172  0989              l_212:
2173  0989              ; 125                     }
2174  0989              ; 126                     wifiSettingsEditViewCurrentPos = a;
2175  0989 32 A0 10     	ld (wifisettingseditviewcurrentpos), a
2176  098C C3 C8 09     	jp l_211
2177  098F              l_210:
2178  098F              ; 127                 } else if (a == 0x19) { //up
2179  098F FE 19        	cp 25
2180  0991 C2 A7 09     	jp nz, l_214
2181  0994              ; 128                     a = wifiSettingsEditViewCurrentPos;
2182  0994 3A A0 10     	ld a, (wifisettingseditviewcurrentpos)
2183  0997              ; 129                     if (a == 0) {
2184  0997 B7           	or a
2185  0998 C2 A0 09     	jp nz, l_216
2186  099B              ; 130                         a = 2;
2187  099B 3E 02        	ld a, 2
2188  099D C3 A1 09     	jp l_217
2189  09A0              l_216:
2190  09A0              ; 131                     } else {
2191  09A0              ; 132                         a--;
2192  09A0 3D           	dec a
2193  09A1              l_217:
2194  09A1              ; 133                     }
2195  09A1              ; 134                     wifiSettingsEditViewCurrentPos = a;
2196  09A1 32 A0 10     	ld (wifisettingseditviewcurrentpos), a
2197  09A4 C3 C8 09     	jp l_215
2198  09A7              l_214:
2199  09A7              ; 135                 } else if (a == 0x0D) { //Enter
2200  09A7 FE 0D        	cp 13
2201  09A9 C2 C8 09     	jp nz, l_218
2202  09AC              ; 136                     if ((a = wifiSettingsEditViewCurrentPos) == 2) { // Нажатие на кнопку ОК
2203  09AC 3A A0 10     	ld a, (wifisettingseditviewcurrentpos)
2204  09AF FE 02        	cp 2
2205  09B1 C2 C5 09     	jp nz, l_220
2206  09B4              ; 137
2207  09B4              ; 138                         //Пробуем подключиться в WiFi
2208  09B4              ; 139                         needSsidConnect();
2209  09B4 CD 7D 14     	call needssidconnect
2210  09B7              ; 140
2211  09B7              ; 141                         a = rootViewCurrentDiskView; // переходим на список файлов на диске
2212  09B7 3E 00        	ld a, 0
2213  09B9              ; 142                         rootViewCurrentView = a;
2214  09B9 32 99 0F     	ld (rootviewcurrentview), a
2215  09BC              ; 143
2216  09BC              ; 144                         updateRootUI();
2217  09BC CD 17 02     	call updaterootui
2218  09BF              ; 145                         updateRootDataUI();
2219  09BF CD 14 02     	call updaterootdataui
2220  09C2 C3 C8 09     	jp l_221
2221  09C5              l_220:
2222  09C5              ; 146                     } else {
2223  09C5              ; 147                         wifiSettingsEditViewSelectEditField();
2224  09C5 CD CA 09     	call wifisettingseditviewselecteditfi
2225  09C8              l_221:
2226  09C8              l_218:
2227  09C8              l_215:
2228  09C8              l_211:
2229  09C8              l_209:
2230  09C8              l_206:
2231  09C8 E1           	pop hl
2232  09C9 C9           	ret
2233  09CA              ; 148                     }
2234  09CA              ; 149                 }
2235  09CA              ; 150             }
2236  09CA              ; 151         }
2237  09CA              ; 152     }
2238  09CA              ; 153 }
2239  09CA              ; 154
2240  09CA              ; 155 void wifiSettingsEditViewSelectEditField() {
2241  09CA              wifisettingseditviewselecteditfi:
2242  09CA              ; 156     a = wifiSettingsEditViewCurrentPos;
2243  09CA 3A A0 10     	ld a, (wifisettingseditviewcurrentpos)
2244  09CD              ; 157     if (a == 1) {
2245  09CD FE 01        	cp 1
2246  09CF C2 E6 09     	jp nz, l_222
2247  09D2              ; 158         hl = wifiSettingsEditViewSSIDPasswordValPos;
2248  09D2 2A D3 10     	ld hl, (wifisettingseditviewssidpassword_2)
2249  09D5              ; 159         wifiSettingsEditViewEditValuePos = hl;
2250  09D5 22 E5 10     	ld (wifisettingseditvieweditvaluepos), hl
2251  09D8              ; 160         setPosCursor();
2252  09D8 CD 3C F8     	call setposcursor
2253  09DB              ; 161
2254  09DB              ; 162         push_pop(hl) {
2255  09DB E5           	push hl
2256  09DC              ; 163             hl = wifiSettingsEditViewSSIDPasswordVal;
2257  09DC 21 D5 10     	ld hl, wifisettingseditviewssidpassword_3
2258  09DF              ; 164             wifiSettingsEditView_CopyStrFromHL();
2259  09DF CD ED 09     	call wifisettingseditview_copystrfrom
2260  09E2 E1           	pop hl
2261  09E3 C3 EA 09     	jp l_223
2262  09E6              l_222:
2263  09E6              ; 165         }
2264  09E6              ; 166     } else {
2265  09E6              ; 167         // открыть список доступных сетей
2266  09E6              ; 168         needOpenSSIDListView();
2267  09E6 CD 34 0B     	call needopenssidlistview
2268  09E9              ; 169         return;
2269  09E9 C9           	ret
2270  09EA              l_223:
2271  09EA              ; 170     }
2272  09EA              ; 171     wifiSettingsEditViewEditField();
2273  09EA C3 2A 0A     	jp wifisettingseditvieweditfield
2274  09ED              ; 172 }
2275  09ED              ; 173
2276  09ED              ; 174 void wifiSettingsEditView_CopyStrFromHL() {
2277  09ED              wifisettingseditview_copystrfrom:
2278  09ED              ; 175     push_pop(de) {
2279  09ED D5           	push de
2280  09EE              ; 176         push_pop(bc) {
2281  09EE C5           	push bc
2282  09EF              ; 177             de = wifiSettingsEditViewEditValue;
2283  09EF 11 E7 10     	ld de, wifisettingseditvieweditvalue
2284  09F2              ; 178             b = 0;
2285  09F2 06 00        	ld b, 0
2286  09F4              ; 179             c = 0;
2287  09F4 0E 00        	ld c, 0
2288  09F6              ; 180             do {
2289  09F6              l_224:
2290  09F6              ; 181                 a = *hl;
2291  09F6 7E           	ld a, (hl)
2292  09F7              ; 182                 *de = a;
2293  09F7 12           	ld (de), a
2294  09F8              ; 183                 if ((a = b) == 22) {
2295  09F8 78           	ld a, b
2296  09F9 FE 16        	cp 22
2297  09FB C2 04 0A     	jp nz, l_227
2298  09FE              ; 184                     a = 0;
2299  09FE 3E 00        	ld a, 0
2300  0A00              ; 185                     *de = a;
2301  0A00 12           	ld (de), a
2302  0A01 C3 1E 0A     	jp l_228
2303  0A04              l_227:
2304  0A04              ; 186                 } else if ((a = c) == 1) {
2305  0A04 79           	ld a, c
2306  0A05 FE 01        	cp 1
2307  0A07 C2 10 0A     	jp nz, l_229
2308  0A0A              ; 187                     a = ' ';
2309  0A0A 3E 20        	ld a, 32
2310  0A0C              ; 188                     *de = a;
2311  0A0C 12           	ld (de), a
2312  0A0D C3 1E 0A     	jp l_230
2313  0A10              l_229:
2314  0A10              ; 189                 } else if ((a = *de) == 0) {
2315  0A10 1A           	ld a, (de)
2316  0A11 B7           	or a
2317  0A12 C2 1E 0A     	jp nz, l_231
2318  0A15              ; 190                     c = 1;
2319  0A15 0E 01        	ld c, 1
2320  0A17              ; 191                     a = ' ';
2321  0A17 3E 20        	ld a, 32
2322  0A19              ; 192                     *de = a;
2323  0A19 12           	ld (de), a
2324  0A1A              ; 193                     a = b;
2325  0A1A 78           	ld a, b
2326  0A1B              ; 194                     wifiSettingsEditViewEditPos = a;
2327  0A1B 32 FF 10     	ld (wifisettingseditvieweditpos), a
2328  0A1E              l_231:
2329  0A1E              l_230:
2330  0A1E              l_228:
2331  0A1E              ; 195                 }
2332  0A1E              ; 196
2333  0A1E              ; 197                 hl ++;
2334  0A1E 23           	inc hl
2335  0A1F              ; 198                 de++;
2336  0A1F 13           	inc de
2337  0A20              ; 199                 b++;
2338  0A20 04           	inc b
2339  0A21              ; 200                 a = b;
2340  0A21 78           	ld a, b
2341  0A22              ; 201                 a -= 23;
2342  0A22 D6 17        	sub 23
2343  0A24              l_225:
2344  0A24 C2 F6 09     	jp nz, l_224
2345  0A27 C1           	pop bc
2346  0A28 D1           	pop de
2347  0A29 C9           	ret
2348  0A2A              ; 202             } while (flag_nz);
2349  0A2A              ; 203         }
2350  0A2A              ; 204     }
2351  0A2A              ; 205 }
2352  0A2A              ; 206
2353  0A2A              ; 207 void wifiSettingsEditViewEditField() {
2354  0A2A              wifisettingseditvieweditfield:
2355  0A2A              ; 208     hl = wifiSettingsEditViewEditValuePos;
2356  0A2A 2A E5 10     	ld hl, (wifisettingseditvieweditvaluepos)
2357  0A2D              ; 209     setPosCursor();
2358  0A2D CD 3C F8     	call setposcursor
2359  0A30              ; 210
2360  0A30              ; 211     a = 0xFF;
2361  0A30 3E FF        	ld a, 255
2362  0A32              ; 212     inverceAddress = a;
2363  0A32 32 D3 F3     	ld (inverceaddress), a
2364  0A35              ; 213
2365  0A35              ; 214     hl = wifiSettingsEditViewEditValue;
2366  0A35 21 E7 10     	ld hl, wifisettingseditvieweditvalue
2367  0A38              ; 215     printHLStr();
2368  0A38 CD 18 F8     	call printhlstr
2369  0A3B              ; 216
2370  0A3B              ; 217     wifiSettingsEditViewSetEditCursor();
2371  0A3B CD AD 0A     	call wifisettingseditviewseteditcurso
2372  0A3E              ; 218     push_pop(bc) {
2373  0A3E C5           	push bc
2374  0A3F              ; 219         b = 0;
2375  0A3F 06 00        	ld b, 0
2376  0A41              ; 220         do {
2377  0A41              l_233:
2378  0A41              ; 221             getKeyboardCharA();
2379  0A41 CD 03 F8     	call getkeyboardchara
2380  0A44              ; 222
2381  0A44              ; 223             if (a == 0x1B) { // выход из редактирования без сохранения
2382  0A44 FE 1B        	cp 27
2383  0A46 C2 4E 0A     	jp nz, l_236
2384  0A49              ; 224                 b = 1;
2385  0A49 06 01        	ld b, 1
2386  0A4B C3 9B 0A     	jp l_237
2387  0A4E              l_236:
2388  0A4E              ; 225             } else if (a == 0x0D) { // Сохранить и выйти из редактирования
2389  0A4E FE 0D        	cp 13
2390  0A50 C2 5B 0A     	jp nz, l_238
2391  0A53              ; 226                 b = 1;
2392  0A53 06 01        	ld b, 1
2393  0A55              ; 227                 wifiSettingsEditViewSaveField();
2394  0A55 CD BB 0A     	call wifisettingseditviewsavefield
2395  0A58 C3 9B 0A     	jp l_239
2396  0A5B              l_238:
2397  0A5B              ; 228             } else if (a >= 0x20) {
2398  0A5B FE 20        	cp 32
2399  0A5D DA 9B 0A     	jp c, l_240
2400  0A60              ; 229                 if (a < 0x7F) { //Ввод символа
2401  0A60 FE 7F        	cp 127
2402  0A62 D2 83 0A     	jp nc, l_242
2403  0A65              ; 230                     c = a;
2404  0A65 4F           	ld c, a
2405  0A66              ; 231                     // Если достигли предела - то перемещаем курсор на 1 назад
2406  0A66              ; 232                     a = wifiSettingsEditViewEditPos;
2407  0A66 3A FF 10     	ld a, (wifisettingseditvieweditpos)
2408  0A69              ; 233                     if (a >= 15) {
2409  0A69 FE 0F        	cp 15
2410  0A6B DA 6F 0A     	jp c, l_244
2411  0A6E              ; 234                         a--;
2412  0A6E 3D           	dec a
2413  0A6F              l_244:
2414  0A6F              ; 235                     }
2415  0A6F              ; 236                     wifiSettingsEditViewEditPos = a;
2416  0A6F 32 FF 10     	ld (wifisettingseditvieweditpos), a
2417  0A72              ; 237
2418  0A72              ; 238                     //Сохраняем символ
2419  0A72              ; 239                     a = c;
2420  0A72 79           	ld a, c
2421  0A73              ; 240                     wifiSettingsEditViewSetValueA();
2422  0A73 CD C9 0A     	call wifisettingseditviewsetvaluea
2423  0A76              ; 241                     a = wifiSettingsEditViewEditPos;
2424  0A76 3A FF 10     	ld a, (wifisettingseditvieweditpos)
2425  0A79              ; 242                     a++;
2426  0A79 3C           	inc a
2427  0A7A              ; 243                     wifiSettingsEditViewEditPos = a;
2428  0A7A 32 FF 10     	ld (wifisettingseditvieweditpos), a
2429  0A7D              ; 244                     wifiSettingsEditViewSetEditCursor();
2430  0A7D CD AD 0A     	call wifisettingseditviewseteditcurso
2431  0A80 C3 9B 0A     	jp l_243
2432  0A83              l_242:
2433  0A83              ; 245                 } else if (a == 0x7F) { //Забой... (удаление символа)
2434  0A83 FE 7F        	cp 127
2435  0A85 C2 9B 0A     	jp nz, l_246
2436  0A88              ; 246                     if ((a = wifiSettingsEditViewEditPos) > 0) {
2437  0A88 3A FF 10     	ld a, (wifisettingseditvieweditpos)
2438  0A8B B7           	or a
2439  0A8C CA 9B 0A     	jp z, l_248
2440  0A8F              ; 247                         a--;
2441  0A8F 3D           	dec a
2442  0A90              ; 248                         wifiSettingsEditViewEditPos = a;
2443  0A90 32 FF 10     	ld (wifisettingseditvieweditpos), a
2444  0A93              ; 249                         wifiSettingsEditViewSetEditCursor();
2445  0A93 CD AD 0A     	call wifisettingseditviewseteditcurso
2446  0A96              ; 250                         a = ' ';
2447  0A96 3E 20        	ld a, 32
2448  0A98              ; 251                         wifiSettingsEditViewSetValueA();
2449  0A98 CD C9 0A     	call wifisettingseditviewsetvaluea
2450  0A9B              l_248:
2451  0A9B              l_246:
2452  0A9B              l_243:
2453  0A9B              l_240:
2454  0A9B              l_239:
2455  0A9B              l_237:
2456  0A9B              ; 252                     }
2457  0A9B              ; 253                 }
2458  0A9B              ; 254             }
2459  0A9B              ; 255
2460  0A9B              ; 256             a = b;
2461  0A9B 78           	ld a, b
2462  0A9C              ; 257             a -= 1;
2463  0A9C D6 01        	sub 1
2464  0A9E              l_234:
2465  0A9E C2 41 0A     	jp nz, l_233
2466  0AA1 C1           	pop bc
2467  0AA2              ; 258         } while (flag_nz);
2468  0AA2              ; 259     }
2469  0AA2              ; 260
2470  0AA2              ; 261     a = 0x00;
2471  0AA2 3E 00        	ld a, 0
2472  0AA4              ; 262     inverceAddress = a;
2473  0AA4 32 D3 F3     	ld (inverceaddress), a
2474  0AA7              ; 263
2475  0AA7              ; 264     showWiFiSettingsEditView();
2476  0AA7 CD A8 08     	call showwifisettingseditview
2477  0AAA              ; 265     wifiSettingsEditViewDataUpdate();
2478  0AAA C3 F3 08     	jp wifisettingseditviewdataupdate
2479  0AAD              ; 266 }
2480  0AAD              ; 267
2481  0AAD              ; 268 void wifiSettingsEditViewSetEditCursor() {
2482  0AAD              wifisettingseditviewseteditcurso:
2483  0AAD              ; 269     push_pop(hl) {
2484  0AAD E5           	push hl
2485  0AAE              ; 270         hl = wifiSettingsEditViewEditValuePos;
2486  0AAE 2A E5 10     	ld hl, (wifisettingseditvieweditvaluepos)
2487  0AB1              ; 271         a = wifiSettingsEditViewEditPos;
2488  0AB1 3A FF 10     	ld a, (wifisettingseditvieweditpos)
2489  0AB4              ; 272         a += l;
2490  0AB4 85           	add l
2491  0AB5              ; 273         l = a;
2492  0AB5 6F           	ld l, a
2493  0AB6              ; 274         setPosCursor();
2494  0AB6 CD 3C F8     	call setposcursor
2495  0AB9 E1           	pop hl
2496  0ABA C9           	ret
2497  0ABB              ; 275     }
2498  0ABB              ; 276 }
2499  0ABB              ; 277
2500  0ABB              ; 278 void wifiSettingsEditViewSaveField() {
2501  0ABB              wifisettingseditviewsavefield:
2502  0ABB              ; 279     a = wifiSettingsEditViewCurrentPos;
2503  0ABB 3A A0 10     	ld a, (wifisettingseditviewcurrentpos)
2504  0ABE              ; 280     if (a == 1) {
2505  0ABE FE 01        	cp 1
2506  0AC0 C2 C6 0A     	jp nz, l_250
2507  0AC3              ; 281         hl = wifiSettingsEditViewSSIDPasswordVal;
2508  0AC3 21 D5 10     	ld hl, wifisettingseditviewssidpassword_3
2509  0AC6              l_250:
2510  0AC6              ; 282     }
2511  0AC6              ; 283     wifiSettingsEditViewSaveEditValueToHL();
2512  0AC6 C3 E6 0A     	jp wifisettingseditviewsaveeditvalu
2513  0AC9              ; 284 }
2514  0AC9              ; 285
2515  0AC9              ; 286 void wifiSettingsEditViewSetValueA() {
2516  0AC9              wifisettingseditviewsetvaluea:
2517  0AC9              ; 287     push_pop(hl) {
2518  0AC9 E5           	push hl
2519  0ACA              ; 288         push_pop(bc) {
2520  0ACA C5           	push bc
2521  0ACB              ; 289             b = a;
2522  0ACB 47           	ld b, a
2523  0ACC              ; 290             //Сохраним символ в wifiSettingsEditViewEditValue
2524  0ACC              ; 291             hl = wifiSettingsEditViewEditValue;
2525  0ACC 21 E7 10     	ld hl, wifisettingseditvieweditvalue
2526  0ACF              ; 292             a = wifiSettingsEditViewEditPos;
2527  0ACF 3A FF 10     	ld a, (wifisettingseditvieweditpos)
2528  0AD2              ; 293             a += l;
2529  0AD2 85           	add l
2530  0AD3              ; 294             l = a;
2531  0AD3 6F           	ld l, a
2532  0AD4              ; 295             if (flag_c) {
2533  0AD4 D2 D8 0A     	jp nc, l_252
2534  0AD7              ; 296                 h++;
2535  0AD7 24           	inc h
2536  0AD8              l_252:
2537  0AD8              ; 297             }
2538  0AD8              ; 298             *hl = b;
2539  0AD8 70           	ld (hl), b
2540  0AD9              ; 299             //Отрисуем символ на экране
2541  0AD9              ; 300             wifiSettingsEditViewSetEditCursor();
2542  0AD9 CD AD 0A     	call wifisettingseditviewseteditcurso
2543  0ADC              ; 301             a = b;
2544  0ADC 78           	ld a, b
2545  0ADD              ; 302             printChatA();
2546  0ADD CD 0F F8     	call printchata
2547  0AE0              ; 303             wifiSettingsEditViewSetEditCursor();
2548  0AE0 CD AD 0A     	call wifisettingseditviewseteditcurso
2549  0AE3 C1           	pop bc
2550  0AE4 E1           	pop hl
2551  0AE5 C9           	ret
2552  0AE6              ; 304         }
2553  0AE6              ; 305     }
2554  0AE6              ; 306 }
2555  0AE6              ; 307
2556  0AE6              ; 308 void wifiSettingsEditViewSaveEditValueToHL() {
2557  0AE6              wifisettingseditviewsaveeditvalu:
2558  0AE6              ; 309     push_pop(de) {
2559  0AE6 D5           	push de
2560  0AE7              ; 310         push_pop(bc) {
2561  0AE7 C5           	push bc
2562  0AE8              ; 311             de = wifiSettingsEditViewEditValue;
2563  0AE8 11 E7 10     	ld de, wifisettingseditvieweditvalue
2564  0AEB              ; 312             a = wifiSettingsEditViewEditPos;
2565  0AEB 3A FF 10     	ld a, (wifisettingseditvieweditpos)
2566  0AEE              ; 313             c = a;
2567  0AEE 4F           	ld c, a
2568  0AEF              ; 314             b = 0;
2569  0AEF 06 00        	ld b, 0
2570  0AF1              ; 315             do {
2571  0AF1              l_254:
2572  0AF1              ; 316                 a = *de;
2573  0AF1 1A           	ld a, (de)
2574  0AF2              ; 317                 *hl = a;
2575  0AF2 77           	ld (hl), a
2576  0AF3              ; 318                 hl++;
2577  0AF3 23           	inc hl
2578  0AF4              ; 319                 de++;
2579  0AF4 13           	inc de
2580  0AF5              ; 320                 b++;
2581  0AF5 04           	inc b
2582  0AF6              ; 321                 a = b;
2583  0AF6 78           	ld a, b
2584  0AF7              ; 322                 a -= c;
2585  0AF7 91           	sub c
2586  0AF8              l_255:
2587  0AF8 C2 F1 0A     	jp nz, l_254
2588  0AFB              ; 323             } while (flag_nz);
2589  0AFB              ; 324             *hl = 0;
2590  0AFB 36 00        	ld (hl), 0
2591  0AFD C1           	pop bc
2592  0AFE D1           	pop de
2593  0AFF              ; 325         }
2594  0AFF              ; 326     }
2595  0AFF              ; 327     setSSIDPasswordValue();
2596  0AFF CD 43 14     	call setssidpasswordvalue
2597  0B02              ; 328     setSSIDPasswordValue();
2598  0B02 C3 43 14     	jp setssidpasswordvalue
2599  0B05              ; 329     //getSSIDPasswordValue();
2600  0B05              ; 330 }
2601  0B05              ; 331
2602  0B05              ; 332 ///  Обновить данные WiFi
2603  0B05              ; 333 void updateWiFiStatus() {
2604  0B05              updatewifistatus:
2605  0B05              ; 334     a = updateWiFiStatusTike;
2606  0B05 3A 00 11     	ld a, (updatewifistatustike)
2607  0B08              ; 335     if (a < 240) {
2608  0B08 FE F0        	cp 240
2609  0B0A D2 12 0B     	jp nc, l_257
2610  0B0D              ; 336         a++;
2611  0B0D 3C           	inc a
2612  0B0E              ; 337         updateWiFiStatusTike = a;
2613  0B0E 32 00 11     	ld (updatewifistatustike), a
2614  0B11              ; 338         return;
2615  0B11 C9           	ret
2616  0B12              l_257:
2617  0B12              ; 339     }
2618  0B12              ; 340     a = 0;
2619  0B12 3E 00        	ld a, 0
2620  0B14              ; 341     updateWiFiStatusTike = a;
2621  0B14 32 00 11     	ld (updatewifistatustike), a
2622  0B17              ; 342     //
2623  0B17              ; 343     getSSIDState();
2624  0B17 CD 1F 15     	call getssidstate
2625  0B1A              ; 344     if ((a = WiFiStateUpdate) == 0x01) {
2626  0B1A 3A 02 11     	ld a, (wifistateupdate)
2627  0B1D FE 01        	cp 1
2628  0B1F C2 33 0B     	jp nz, l_259
2629  0B22              ; 345         a = 0x00;
2630  0B22 3E 00        	ld a, 0
2631  0B24              ; 346         WiFiStateUpdate = a;
2632  0B24 32 02 11     	ld (wifistateupdate), a
2633  0B27              ; 347         getSSIDIPAddress();
2634  0B27 CD B3 14     	call getssidipaddress
2635  0B2A              ; 348         getSSIDMacAddress();
2636  0B2A CD E9 14     	call getssidmacaddress
2637  0B2D              ; 349         //
2638  0B2D              ; 350         clearWiFiViewValData();
2639  0B2D CD EA 02     	call clearwifiviewvaldata
2640  0B30              ; 351         updateWiFiViewValData();
2641  0B30 CD 02 03     	call updatewifiviewvaldata
2642  0B33              l_259:
2643  0B33 C9           	ret
2644  0B34              ; 13 void needOpenSSIDListView() {
2645  0B34              needopenssidlistview:
2646  0B34              ; 14     push_pop(hl) {
2647  0B34 E5           	push hl
2648  0B35              ; 15         if ((a = rootViewCurrentView) != rootSSIDListView) { //Если уже открыто окно - не открываем
2649  0B35 3A 99 0F     	ld a, (rootviewcurrentview)
2650  0B38 FE 04        	cp 4
2651  0B3A CA 4D 0B     	jp z, l_261
2652  0B3D              ; 16             a = rootSSIDListView;
2653  0B3D 3E 04        	ld a, 4
2654  0B3F              ; 17             rootViewCurrentView = a;
2655  0B3F 32 99 0F     	ld (rootviewcurrentview), a
2656  0B42              ; 18
2657  0B42              ; 19             a = 0;
2658  0B42 3E 00        	ld a, 0
2659  0B44              ; 20             SSIDListViewCurrentPos = a;
2660  0B44 32 16 11     	ld (ssidlistviewcurrentpos), a
2661  0B47              ; 21
2662  0B47              ; 22             showSSIDListView();
2663  0B47 CD 87 0B     	call showssidlistview
2664  0B4A              ; 23             SSIDListViewDataUpdate();
2665  0B4A CD DB 0B     	call ssidlistviewdataupdate
2666  0B4D              l_261:
2667  0B4D E1           	pop hl
2668  0B4E C9           	ret
2669  0B4F              ; 24         }
2670  0B4F              ; 25     }
2671  0B4F              ; 26 }
2672  0B4F              ; 27
2673  0B4F              ; 28 void SSIDListGetCount() {
2674  0B4F              ssidlistgetcount:
2675  0B4F              ; 29     push_pop(hl) {
2676  0B4F E5           	push hl
2677  0B50              ; 30         push_pop(bc) {
2678  0B50 C5           	push bc
2679  0B51              ; 31             push_pop(de) {
2680  0B51 D5           	push de
2681  0B52              ; 32                 a = 0;
2682  0B52 3E 00        	ld a, 0
2683  0B54              ; 33                 SSIDListCount = a;
2684  0B54 32 15 11     	ld (ssidlistcount), a
2685  0B57              ; 34                 de = 16;
2686  0B57 11 10 00     	ld de, 16
2687  0B5A              ; 35
2688  0B5A              ; 36                 b = 16;
2689  0B5A 06 10        	ld b, 16
2690  0B5C              ; 37                 hl = SSIDList;
2691  0B5C 21 18 11     	ld hl, ssidlist
2692  0B5F              ; 38                 do {
2693  0B5F              l_263:
2694  0B5F              ; 39                     a = *hl;
2695  0B5F 7E           	ld a, (hl)
2696  0B60              ; 40                     if (a > 0) {
2697  0B60 B7           	or a
2698  0B61 CA 6B 0B     	jp z, l_266
2699  0B64              ; 41                         a = SSIDListCount;
2700  0B64 3A 15 11     	ld a, (ssidlistcount)
2701  0B67              ; 42                         a++;
2702  0B67 3C           	inc a
2703  0B68              ; 43                         SSIDListCount = a;
2704  0B68 32 15 11     	ld (ssidlistcount), a
2705  0B6B              l_266:
2706  0B6B              ; 44                     }
2707  0B6B              ; 45                     hl += de;
2708  0B6B 19           	add hl, de
2709  0B6C              ; 46                     b--;
2710  0B6C 05           	dec b
2711  0B6D              l_264:
2712  0B6D C2 5F 0B     	jp nz, l_263
2713  0B70 D1           	pop de
2714  0B71 C1           	pop bc
2715  0B72 E1           	pop hl
2716  0B73 C9           	ret
2717  0B74              ; 47                 } while (flag_nz);
2718  0B74              ; 48             }
2719  0B74              ; 49         }
2720  0B74              ; 50     }
2721  0B74              ; 51 }
2722  0B74              ; 52
2723  0B74              ; 53 void setSSIDPosCursorC() {
2724  0B74              setssidposcursorc:
2725  0B74              ; 54     push_pop(hl) {
2726  0B74 E5           	push hl
2727  0B75              ; 55         a = SSIDListViewY;
2728  0B75 3A 04 11     	ld a, (ssidlistviewy)
2729  0B78              ; 56         a += 2;
2730  0B78 C6 02        	add 2
2731  0B7A              ; 57         a += c;
2732  0B7A 81           	add c
2733  0B7B              ; 58         h = a;
2734  0B7B 67           	ld h, a
2735  0B7C              ; 59         a = SSIDListViewX;
2736  0B7C 3A 03 11     	ld a, (ssidlistviewx)
2737  0B7F              ; 60         a += 3;
2738  0B7F C6 03        	add 3
2739  0B81              ; 61         l = a;
2740  0B81 6F           	ld l, a
2741  0B82              ; 62         setPosCursor();
2742  0B82 CD 3C F8     	call setposcursor
2743  0B85 E1           	pop hl
2744  0B86 C9           	ret
2745  0B87              ; 63     }
2746  0B87              ; 64 }
2747  0B87              ; 65
2748  0B87              ; 66 void showSSIDListView() {
2749  0B87              showssidlistview:
2750  0B87              ; 67     drowRectX = (a = SSIDListViewX);
2751  0B87 3A 03 11     	ld a, (ssidlistviewx)
2752  0B8A 32 B8 03     	ld (drowrectx), a
2753  0B8D              ; 68     drowRectY = (a = SSIDListViewY);
2754  0B8D 3A 04 11     	ld a, (ssidlistviewy)
2755  0B90 32 B9 03     	ld (drowrecty), a
2756  0B93              ; 69     drowRectEndX = (a = SSIDListViewEX);
2757  0B93 3A 05 11     	ld a, (ssidlistviewex)
2758  0B96 32 BA 03     	ld (drowrectendx), a
2759  0B99              ; 70     drowRectEndY = (a = SSIDListViewEY);
2760  0B99 3A 06 11     	ld a, (ssidlistviewey)
2761  0B9C 32 BB 03     	ld (drowrectendy), a
2762  0B9F              ; 71     drowRect();
2763  0B9F CD 24 03     	call drowrect
2764  0BA2              ; 72
2765  0BA2              ; 73     hl = SSIDListViewTitlePos;
2766  0BA2 2A 07 11     	ld hl, (ssidlistviewtitlepos)
2767  0BA5              ; 74     setPosCursor();
2768  0BA5 CD 3C F8     	call setposcursor
2769  0BA8              ; 75     hl = SSIDListViewTitle;
2770  0BA8 21 09 11     	ld hl, ssidlistviewtitle
2771  0BAB              ; 76     printHLStr();
2772  0BAB CD 18 F8     	call printhlstr
2773  0BAE              ; 77
2774  0BAE              ; 78     i2cWaitingForAccess();
2775  0BAE CD CA 12     	call i2cwaitingforaccess
2776  0BB1              ; 79     needUpdateSSIDList();
2777  0BB1 CD 8D 14     	call needupdatessidlist
2778  0BB4              ; 80     i2cWaitingForAccess();
2779  0BB4 CD CA 12     	call i2cwaitingforaccess
2780  0BB7              ; 81     getSSIDList();
2781  0BB7 CD 97 13     	call getssidlist
2782  0BBA              ; 82
2783  0BBA              ; 83     SSIDFixBuffer();
2784  0BBA CD C0 0B     	call ssidfixbuffer
2785  0BBD              ; 84
2786  0BBD              ; 85     // Получить кол-во сетей
2787  0BBD              ; 86     SSIDListGetCount();
2788  0BBD C3 4F 0B     	jp ssidlistgetcount
2789  0BC0              ; 87 }
2790  0BC0              ; 88
2791  0BC0              ; 89 void SSIDFixBuffer() {
2792  0BC0              ssidfixbuffer:
2793  0BC0              ; 90     push_pop(bc) {
2794  0BC0 C5           	push bc
2795  0BC1              ; 91         push_pop(de) {
2796  0BC1 D5           	push de
2797  0BC2              ; 92             push_pop(hl) {
2798  0BC2 E5           	push hl
2799  0BC3              ; 93                 hl = SSIDList;
2800  0BC3 21 18 11     	ld hl, ssidlist
2801  0BC6              ; 94                 de = 15;
2802  0BC6 11 0F 00     	ld de, 15
2803  0BC9              ; 95                 hl += de;
2804  0BC9 19           	add hl, de
2805  0BCA              ; 96                 de = 16;
2806  0BCA 11 10 00     	ld de, 16
2807  0BCD              ; 97                 b = 16;
2808  0BCD 06 10        	ld b, 16
2809  0BCF              ; 98                 do {
2810  0BCF              l_268:
2811  0BCF              ; 99                     a = 0;
2812  0BCF 3E 00        	ld a, 0
2813  0BD1              ; 100                     *hl = a;
2814  0BD1 77           	ld (hl), a
2815  0BD2              ; 101                     hl += de;
2816  0BD2 19           	add hl, de
2817  0BD3              ; 102                     b--;
2818  0BD3 05           	dec b
2819  0BD4              l_269:
2820  0BD4 C2 CF 0B     	jp nz, l_268
2821  0BD7 E1           	pop hl
2822  0BD8 D1           	pop de
2823  0BD9 C1           	pop bc
2824  0BDA C9           	ret
2825  0BDB              ; 103                 } while (flag_nz);
2826  0BDB              ; 104             }
2827  0BDB              ; 105         }
2828  0BDB              ; 106     }
2829  0BDB              ; 107 }
2830  0BDB              ; 108
2831  0BDB              ; 109 void SSIDListViewDataUpdate() {
2832  0BDB              ssidlistviewdataupdate:
2833  0BDB              ; 110     if ((a = rootViewCurrentView) != rootSSIDListView) {
2834  0BDB 3A 99 0F     	ld a, (rootviewcurrentview)
2835  0BDE FE 04        	cp 4
2836  0BE0 CA E4 0B     	jp z, l_271
2837  0BE3              ; 111         return;
2838  0BE3 C9           	ret
2839  0BE4              l_271:
2840  0BE4              ; 112     }
2841  0BE4              ; 113
2842  0BE4              ; 114     push_pop(bc) {
2843  0BE4 C5           	push bc
2844  0BE5              ; 115         b = 0;
2845  0BE5 06 00        	ld b, 0
2846  0BE7              ; 116         do {
2847  0BE7              l_273:
2848  0BE7              ; 117             a = 0x00;
2849  0BE7 3E 00        	ld a, 0
2850  0BE9              ; 118             inverceAddress = a;
2851  0BE9 32 D3 F3     	ld (inverceaddress), a
2852  0BEC              ; 119
2853  0BEC              ; 120             if ((a = SSIDListViewCurrentPos) == b) {
2854  0BEC 3A 16 11     	ld a, (ssidlistviewcurrentpos)
2855  0BEF B8           	cp b
2856  0BF0 C2 F8 0B     	jp nz, l_276
2857  0BF3              ; 121                 a = 0xFF;
2858  0BF3 3E FF        	ld a, 255
2859  0BF5              ; 122                 inverceAddress = a;
2860  0BF5 32 D3 F3     	ld (inverceaddress), a
2861  0BF8              l_276:
2862  0BF8              ; 123             }
2863  0BF8              ; 124
2864  0BF8              ; 125             a = b;
2865  0BF8 78           	ld a, b
2866  0BF9              ; 126             SSIDListViewShowValueA();
2867  0BF9 CD 0B 0C     	call ssidlistviewshowvaluea
2868  0BFC              ; 127
2869  0BFC              ; 128             a = 0x00;
2870  0BFC 3E 00        	ld a, 0
2871  0BFE              ; 129             inverceAddress = a;
2872  0BFE 32 D3 F3     	ld (inverceaddress), a
2873  0C01              ; 130
2874  0C01              ; 131             b++;
2875  0C01 04           	inc b
2876  0C02              ; 132             a = SSIDListCount;
2877  0C02 3A 15 11     	ld a, (ssidlistcount)
2878  0C05              ; 133             a -= b;
2879  0C05 90           	sub b
2880  0C06              l_274:
2881  0C06 C2 E7 0B     	jp nz, l_273
2882  0C09 C1           	pop bc
2883  0C0A C9           	ret
2884  0C0B              ; 134             //a = b;
2885  0C0B              ; 135             //a -= SSIDListCount;
2886  0C0B              ; 136         } while (flag_nz);
2887  0C0B              ; 137     }
2888  0C0B              ; 138 }
2889  0C0B              ; 139
2890  0C0B              ; 140 void SSIDListViewShowValueA() {
2891  0C0B              ssidlistviewshowvaluea:
2892  0C0B              ; 141     push_pop(hl) {
2893  0C0B E5           	push hl
2894  0C0C              ; 142         push_pop(de) {
2895  0C0C D5           	push de
2896  0C0D              ; 143             de = 16;
2897  0C0D 11 10 00     	ld de, 16
2898  0C10              ; 144             c = a;
2899  0C10 4F           	ld c, a
2900  0C11              ; 145             setSSIDPosCursorC();
2901  0C11 CD 74 0B     	call setssidposcursorc
2902  0C14              ; 146             hl = SSIDList;
2903  0C14 21 18 11     	ld hl, ssidlist
2904  0C17              ; 147             if ((a = c) > 0) {
2905  0C17 79           	ld a, c
2906  0C18 B7           	or a
2907  0C19 CA 21 0C     	jp z, l_278
2908  0C1C              ; 148                 do {
2909  0C1C              l_280:
2910  0C1C              ; 149                     hl += de;
2911  0C1C 19           	add hl, de
2912  0C1D              ; 150                     c--;
2913  0C1D 0D           	dec c
2914  0C1E              l_281:
2915  0C1E C2 1C 0C     	jp nz, l_280
2916  0C21              l_278:
2917  0C21              ; 151                 } while (flag_nz);
2918  0C21              ; 152             }
2919  0C21              ; 153             printHLStr();
2920  0C21 CD 18 F8     	call printhlstr
2921  0C24 D1           	pop de
2922  0C25 E1           	pop hl
2923  0C26 C9           	ret
2924  0C27              ; 154         }
2925  0C27              ; 155     }
2926  0C27              ; 156 }
2927  0C27              ; 157
2928  0C27              ; 158 void SSIDListViewKeyA() {
2929  0C27              ssidlistviewkeya:
2930  0C27              ; 159     push_pop(hl) {
2931  0C27 E5           	push hl
2932  0C28              ; 160         l = a;
2933  0C28 6F           	ld l, a
2934  0C29              ; 161         if ((a = rootViewCurrentView) == rootSSIDListView) {
2935  0C29 3A 99 0F     	ld a, (rootviewcurrentview)
2936  0C2C FE 04        	cp 4
2937  0C2E C2 96 0C     	jp nz, l_283
2938  0C31              ; 162             a = l;
2939  0C31 7D           	ld a, l
2940  0C32              ; 163             if (a == 0x1B) { //ESC выход из настройки
2941  0C32 FE 1B        	cp 27
2942  0C34 C2 48 0C     	jp nz, l_285
2943  0C37              ; 164                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
2944  0C37 3E 00        	ld a, 0
2945  0C39              ; 165                 rootViewCurrentView = a;
2946  0C39 32 99 0F     	ld (rootviewcurrentview), a
2947  0C3C              ; 166
2948  0C3C              ; 167                 updateRootUI();
2949  0C3C CD 17 02     	call updaterootui
2950  0C3F              ; 168                 updateRootDataUI();
2951  0C3F CD 14 02     	call updaterootdataui
2952  0C42              ; 169                 needOpenWiFiSettingsEditView();
2953  0C42 CD 82 08     	call needopenwifisettingseditview
2954  0C45 C3 96 0C     	jp l_286
2955  0C48              l_285:
2956  0C48              ; 170             } else {
2957  0C48              ; 171                 a = SSIDListCount;
2958  0C48 3A 15 11     	ld a, (ssidlistcount)
2959  0C4B              ; 172                 h = a;
2960  0C4B 67           	ld h, a
2961  0C4C              ; 173                 a = l;
2962  0C4C 7D           	ld a, l
2963  0C4D              ; 174                 if (a == 0x1A) { //down
2964  0C4D FE 1A        	cp 26
2965  0C4F C2 62 0C     	jp nz, l_287
2966  0C52              ; 175                     a = SSIDListViewCurrentPos;
2967  0C52 3A 16 11     	ld a, (ssidlistviewcurrentpos)
2968  0C55              ; 176                     a++;
2969  0C55 3C           	inc a
2970  0C56              ; 177                     if (a == h) {
2971  0C56 BC           	cp h
2972  0C57 C2 5C 0C     	jp nz, l_289
2973  0C5A              ; 178                         a = 0;
2974  0C5A 3E 00        	ld a, 0
2975  0C5C              l_289:
2976  0C5C              ; 179                     }
2977  0C5C              ; 180                     SSIDListViewCurrentPos = a;
2978  0C5C 32 16 11     	ld (ssidlistviewcurrentpos), a
2979  0C5F C3 96 0C     	jp l_288
2980  0C62              l_287:
2981  0C62              ; 181                 } else if (a == 0x19) { //up
2982  0C62 FE 19        	cp 25
2983  0C64 C2 7A 0C     	jp nz, l_291
2984  0C67              ; 182                     a = SSIDListViewCurrentPos;
2985  0C67 3A 16 11     	ld a, (ssidlistviewcurrentpos)
2986  0C6A              ; 183                     if (a == 0) {
2987  0C6A B7           	or a
2988  0C6B C2 73 0C     	jp nz, l_293
2989  0C6E              ; 184                         a = h;
2990  0C6E 7C           	ld a, h
2991  0C6F              ; 185                         a--;
2992  0C6F 3D           	dec a
2993  0C70 C3 74 0C     	jp l_294
2994  0C73              l_293:
2995  0C73              ; 186                     } else {
2996  0C73              ; 187                         a--;
2997  0C73 3D           	dec a
2998  0C74              l_294:
2999  0C74              ; 188                     }
3000  0C74              ; 189                     SSIDListViewCurrentPos = a;
3001  0C74 32 16 11     	ld (ssidlistviewcurrentpos), a
3002  0C77 C3 96 0C     	jp l_292
3003  0C7A              l_291:
3004  0C7A              ; 190                 } else if (a == 0x0D) { //Enter
3005  0C7A FE 0D        	cp 13
3006  0C7C C2 96 0C     	jp nz, l_295
3007  0C7F              ; 191                     // Надо отправить на ESP
3008  0C7F              ; 192                     a = SSIDListViewCurrentPos;
3009  0C7F 3A 16 11     	ld a, (ssidlistviewcurrentpos)
3010  0C82              ; 193
3011  0C82              ; 194                     // Отправляем index на ESP
3012  0C82              ; 195                     setSSIDNumberA();
3013  0C82 CD 9D 14     	call setssidnumbera
3014  0C85              ; 196                     // Подождем
3015  0C85              ; 197
3016  0C85              ; 198                     getSSIDValue();
3017  0C85 CD DE 13     	call getssidvalue
3018  0C88              ; 199
3019  0C88              ; 200                     // закрываем
3020  0C88              ; 201                     a = rootViewCurrentDiskView; // переходим на список файлов на диске
3021  0C88 3E 00        	ld a, 0
3022  0C8A              ; 202                     rootViewCurrentView = a;
3023  0C8A 32 99 0F     	ld (rootviewcurrentview), a
3024  0C8D              ; 203
3025  0C8D              ; 204                     updateRootUI();
3026  0C8D CD 17 02     	call updaterootui
3027  0C90              ; 205                     updateRootDataUI();
3028  0C90 CD 14 02     	call updaterootdataui
3029  0C93              ; 206                     needOpenWiFiSettingsEditView();
3030  0C93 CD 82 08     	call needopenwifisettingseditview
3031  0C96              l_295:
3032  0C96              l_292:
3033  0C96              l_288:
3034  0C96              l_286:
3035  0C96              l_283:
3036  0C96 E1           	pop hl
3037  0C97 C9           	ret
3038  0C98              ; 12 uint8_t myFont[] =
3039  0C98              myfont:
3040  0C98 00           	db 0
3041  0C99 00           	db 0
3042  0C9A 00           	db 0
3043  0C9B 00           	db 0
3044  0C9C 00           	db 0
3045  0C9D 00           	db 0
3046  0C9E 00           	db 0
3047  0C9F 00           	db 0
3048  0CA0 00           	db 0
3049  0CA1 00           	db 0
3050  0CA2 1F           	db 31
3051  0CA3 10           	db 16
3052  0CA4 10           	db 16
3053  0CA5 13           	db 19
3054  0CA6 12           	db 18
3055  0CA7 12           	db 18
3056  0CA8 12           	db 18
3057  0CA9 12           	db 18
3058  0CAA 13           	db 19
3059  0CAB 10           	db 16
3060  0CAC 10           	db 16
3061  0CAD 1F           	db 31
3062  0CAE 00           	db 0
3063  0CAF 00           	db 0
3064  0CB0 00           	db 0
3065  0CB1 00           	db 0
3066  0CB2 3E           	db 62
3067  0CB3 02           	db 2
3068  0CB4 02           	db 2
3069  0CB5 32           	db 50
3070  0CB6 12           	db 18
3071  0CB7 12           	db 18
3072  0CB8 12           	db 18
3073  0CB9 12           	db 18
3074  0CBA 32           	db 50
3075  0CBB 02           	db 2
3076  0CBC 02           	db 2
3077  0CBD 3E           	db 62
3078  0CBE 00           	db 0
3079  0CBF 00           	db 0
3080  0CC0 12           	db 18
3081  0CC1 12           	db 18
3082  0CC2 12           	db 18
3083  0CC3 12           	db 18
3084  0CC4 12           	db 18
3085  0CC5 12           	db 18
3086  0CC6 12           	db 18
3087  0CC7 12           	db 18
3088  0CC8 00           	db 0
3089  0CC9 00           	db 0
3090  0CCA 3F           	db 63
3091  0CCB 00           	db 0
3092  0CCC 00           	db 0
3093  0CCD 3F           	db 63
3094  0CCE 00           	db 0
3095  0CCF 00           	db 0
3096  0CD0 2A           	db 42
3097  0CD1 15           	db 21
3098  0CD2 2A           	db 42
3099  0CD3 15           	db 21
3100  0CD4 2A           	db 42
3101  0CD5 15           	db 21
3102  0CD6 2A           	db 42
3103  0CD7 15           	db 21
3104  0CD8 3F           	db 63
3105  0CD9 3F           	db 63
3106  0CDA 3F           	db 63
3107  0CDB 3F           	db 63
3108  0CDC 3F           	db 63
3109  0CDD 3F           	db 63
3110  0CDE 3F           	db 63
3111  0CDF 3F           	db 63
3112  0CE0              ; 11 uint8_t wifiSettingsViewX = 0x00;
3113  0CE0              wifisettingsviewx:
3114  0CE0 00           	db 0
3115  0CE1              ; 12 uint8_t wifiSettingsViewY = 0x01;
3116  0CE1              wifisettingsviewy:
3117  0CE1 01           	db 1
3118  0CE2              ; 13 uint8_t wifiSettingsViewEX = 29;
3119  0CE2              wifisettingsviewex:
3120  0CE2 1D           	db 29
3121  0CE3              ; 14 uint8_t wifiSettingsViewEY = 6;
3122  0CE3              wifisettingsviewey:
3123  0CE3 06           	db 6
3124  0CE4              ; 15 uint16_t wifiSettingsPos = 0x0108;
3125  0CE4              wifisettingspos:
3126  0CE4 08 01        	dw 264
3127  0CE6              ; 16 uint8_t wifiSettingsLabel[] = " WI-FI SETTINGS ";
3128  0CE6              wifisettingslabel:
3129  0CE6 20           	db 32
3130  0CE7 57           	db 87
3131  0CE8 49           	db 73
3132  0CE9 2D           	db 45
3133  0CEA 46           	db 70
3134  0CEB 49           	db 73
3135  0CEC 20           	db 32
3136  0CED 53           	db 83
3137  0CEE 45           	db 69
3138  0CEF 54           	db 84
3139  0CF0 54           	db 84
3140  0CF1 49           	db 73
3141  0CF2 4E           	db 78
3142  0CF3 47           	db 71
3143  0CF4 53           	db 83
3144  0CF5 20           	db 32
3145  0CF6 00           	ds 1
3146  0CF7              ; 17 uint8_t wifiSettingsSsidLabel[] = "SSID:";
3147  0CF7              wifisettingsssidlabel:
3148  0CF7 53           	db 83
3149  0CF8 53           	db 83
3150  0CF9 49           	db 73
3151  0CFA 44           	db 68
3152  0CFB 3A           	db 58
3153  0CFC 00           	ds 1
3154  0CFD              ; 18 uint8_t wifiSettingsIpLabel[] = "IP  :";
3155  0CFD              wifisettingsiplabel:
3156  0CFD 49           	db 73
3157  0CFE 50           	db 80
3158  0CFF 20           	db 32
3159  0D00 20           	db 32
3160  0D01 3A           	db 58
3161  0D02 00           	ds 1
3162  0D03              ; 19 uint8_t wifiSettingsMacLabel[] = "MAC :";
3163  0D03              wifisettingsmaclabel:
3164  0D03 4D           	db 77
3165  0D04 41           	db 65
3166  0D05 43           	db 67
3167  0D06 20           	db 32
3168  0D07 3A           	db 58
3169  0D08 00           	ds 1
3170  0D09              ; 21 uint16_t wifiSettingsSsidLabelPos = 0x0202;
3171  0D09              wifisettingsssidlabelpos:
3172  0D09 02 02        	dw 514
3173  0D0B              ; 22 uint16_t wifiSettingsIpLabelPos = 0x0302;
3174  0D0B              wifisettingsiplabelpos:
3175  0D0B 02 03        	dw 770
3176  0D0D              ; 23 uint16_t wifiSettingsMacLabelPos = 0x0402;
3177  0D0D              wifisettingsmaclabelpos:
3178  0D0D 02 04        	dw 1026
3179  0D0F              ; 25 uint16_t wifiSettingsSsidValPos = 0x0208;
3180  0D0F              wifisettingsssidvalpos:
3181  0D0F 08 02        	dw 520
3182  0D11              ; 26 uint8_t wifiSettingsSsidVal[16] = "K159";
3183  0D11              wifisettingsssidval:
3184  0D11 4B           	db 75
3185  0D12 31           	db 49
3186  0D13 35           	db 53
3187  0D14 39           	db 57
3188  0D15 00 00 00...  	ds 12
3189  0D21              ; 27 uint16_t wifiSettingsIpValPos = 0x0308;
3190  0D21              wifisettingsipvalpos:
3191  0D21 08 03        	dw 776
3192  0D23              ; 28 uint8_t wifiSettingsIpVal[16] = "-";
3193  0D23              wifisettingsipval:
3194  0D23 2D           	db 45
3195  0D24 00 00 00...  	ds 15
3196  0D33              ; 29 uint16_t wifiSettingsMacValPos = 0x0408;
3197  0D33              wifisettingsmacvalpos:
3198  0D33 08 04        	dw 1032
3199  0D35              ; 30 uint8_t wifiSettingsMacVal[18] = "-";
3200  0D35              wifisettingsmacval:
3201  0D35 2D           	db 45
3202  0D36 00 00 00...  	ds 17
3203  0D47              ; 32 uint8_t wifiSettingsEmpty18[18] = "                 ";
3204  0D47              wifisettingsempty18:
3205  0D47 20           	db 32
3206  0D48 20           	db 32
3207  0D49 20           	db 32
3208  0D4A 20           	db 32
3209  0D4B 20           	db 32
3210  0D4C 20           	db 32
3211  0D4D 20           	db 32
3212  0D4E 20           	db 32
3213  0D4F 20           	db 32
3214  0D50 20           	db 32
3215  0D51 20           	db 32
3216  0D52 20           	db 32
3217  0D53 20           	db 32
3218  0D54 20           	db 32
3219  0D55 20           	db 32
3220  0D56 20           	db 32
3221  0D57 20           	db 32
3222  0D58 00           	ds 1
3223  0D59              ; 11 uint8_t ftpSettingsViewX = 30;
3224  0D59              ftpsettingsviewx:
3225  0D59 1E           	db 30
3226  0D5A              ; 12 uint8_t ftpSettingsViewY = 1;
3227  0D5A              ftpsettingsviewy:
3228  0D5A 01           	db 1
3229  0D5B              ; 13 uint8_t ftpSettingsViewEX = 63; //54;
3230  0D5B              ftpsettingsviewex:
3231  0D5B 3F           	db 63
3232  0D5C              ; 14 uint8_t ftpSettingsViewEY = 6;
3233  0D5C              ftpsettingsviewey:
3234  0D5C 06           	db 6
3235  0D5D              ; 16 uint16_t ftpSettingsLabelPos = 0x0127;
3236  0D5D              ftpsettingslabelpos:
3237  0D5D 27 01        	dw 295
3238  0D5F              ; 17 uint8_t ftpSettingsLabel[] = " FTP SETTINGS ";
3239  0D5F              ftpsettingslabel:
3240  0D5F 20           	db 32
3241  0D60 46           	db 70
3242  0D61 54           	db 84
3243  0D62 50           	db 80
3244  0D63 20           	db 32
3245  0D64 53           	db 83
3246  0D65 45           	db 69
3247  0D66 54           	db 84
3248  0D67 54           	db 84
3249  0D68 49           	db 73
3250  0D69 4E           	db 78
3251  0D6A 47           	db 71
3252  0D6B 53           	db 83
3253  0D6C 20           	db 32
3254  0D6D 00           	ds 1
3255  0D6E              ; 20 uint16_t ftpSettingsIpLabelPos = 0x0220;
3256  0D6E              ftpsettingsiplabelpos:
3257  0D6E 20 02        	dw 544
3258  0D70              ; 21 uint8_t ftpSettingsIpLabel[] = "IP:";
3259  0D70              ftpsettingsiplabel:
3260  0D70 49           	db 73
3261  0D71 50           	db 80
3262  0D72 3A           	db 58
3263  0D73 00           	ds 1
3264  0D74              ; 23 uint16_t ftpSettingsPortLabelPos = 0x0234;
3265  0D74              ftpsettingsportlabelpos:
3266  0D74 34 02        	dw 564
3267  0D76              ; 24 uint8_t ftpSettingsPortLabel[] = "PORT:";
3268  0D76              ftpsettingsportlabel:
3269  0D76 50           	db 80
3270  0D77 4F           	db 79
3271  0D78 52           	db 82
3272  0D79 54           	db 84
3273  0D7A 3A           	db 58
3274  0D7B 00           	ds 1
3275  0D7C              ; 26 uint16_t ftpSettingsUserLabelPos = 0x0320;
3276  0D7C              ftpsettingsuserlabelpos:
3277  0D7C 20 03        	dw 800
3278  0D7E              ; 27 uint8_t ftpSettingsUserLabel[] = "USER:";
3279  0D7E              ftpsettingsuserlabel:
3280  0D7E 55           	db 85
3281  0D7F 53           	db 83
3282  0D80 45           	db 69
3283  0D81 52           	db 82
3284  0D82 3A           	db 58
3285  0D83 00           	ds 1
3286  0D84              ; 29 uint16_t ftpSettingsStatusLabelPos = 0x0420;
3287  0D84              ftpsettingsstatuslabelpos:
3288  0D84 20 04        	dw 1056
3289  0D86              ; 30 uint8_t ftpSettingsStatusLabel[] = "STATUS:";
3290  0D86              ftpsettingsstatuslabel:
3291  0D86 53           	db 83
3292  0D87 54           	db 84
3293  0D88 41           	db 65
3294  0D89 54           	db 84
3295  0D8A 55           	db 85
3296  0D8B 53           	db 83
3297  0D8C 3A           	db 58
3298  0D8D 00           	ds 1
3299  0D8E              ; 32 uint16_t ftpSettingsIpValuePos = 0x0224;
3300  0D8E              ftpsettingsipvaluepos:
3301  0D8E 24 02        	dw 548
3302  0D90              ; 33 uint8_t ftpSettingsIpValue[16] = "100.100.100.100";
3303  0D90              ftpsettingsipvalue:
3304  0D90 31           	db 49
3305  0D91 30           	db 48
3306  0D92 30           	db 48
3307  0D93 2E           	db 46
3308  0D94 31           	db 49
3309  0D95 30           	db 48
3310  0D96 30           	db 48
3311  0D97 2E           	db 46
3312  0D98 31           	db 49
3313  0D99 30           	db 48
3314  0D9A 30           	db 48
3315  0D9B 2E           	db 46
3316  0D9C 31           	db 49
3317  0D9D 30           	db 48
3318  0D9E 30           	db 48
3319  0D9F 00           	ds 1
3320  0DA0              ; 35 uint16_t ftpSettingsPortValuePos = 0x023A;
3321  0DA0              ftpsettingsportvaluepos:
3322  0DA0 3A 02        	dw 570
3323  0DA2              ; 36 uint8_t ftpSettingsPortValue[6] = "21";
3324  0DA2              ftpsettingsportvalue:
3325  0DA2 32           	db 50
3326  0DA3 31           	db 49
3327  0DA4 00 00 00 00  	ds 4
3328  0DA8              ; 38 uint16_t ftpSettingsStatusValuePos = 0x0428;
3329  0DA8              ftpsettingsstatusvaluepos:
3330  0DA8 28 04        	dw 1064
3331  0DAA              ; 39 uint8_t ftpSettingsStatusValue[12] = "-";
3332  0DAA              ftpsettingsstatusvalue:
3333  0DAA 2D           	db 45
3334  0DAB 00 00 00...  	ds 11
3335  0DB6              ; 40 uint8_t ftpSettingsStateVal = 0;
3336  0DB6              ftpsettingsstateval:
3337  0DB6 00           	db 0
3338  0DB7              ; 41 uint8_t ftpSettingsStateChange = 1;
3339  0DB7              ftpsettingsstatechange:
3340  0DB7 01           	db 1
3341  0DB8              ; 42 uint8_t ftpSettingsStatus0[12] = "DISCONNECT ";
3342  0DB8              ftpsettingsstatus0:
3343  0DB8 44           	db 68
3344  0DB9 49           	db 73
3345  0DBA 53           	db 83
3346  0DBB 43           	db 67
3347  0DBC 4F           	db 79
3348  0DBD 4E           	db 78
3349  0DBE 4E           	db 78
3350  0DBF 45           	db 69
3351  0DC0 43           	db 67
3352  0DC1 54           	db 84
3353  0DC2 20           	db 32
3354  0DC3 00           	ds 1
3355  0DC4              ; 43 uint8_t ftpSettingsStatus1[12] = "CONNECT    ";
3356  0DC4              ftpsettingsstatus1:
3357  0DC4 43           	db 67
3358  0DC5 4F           	db 79
3359  0DC6 4E           	db 78
3360  0DC7 4E           	db 78
3361  0DC8 45           	db 69
3362  0DC9 43           	db 67
3363  0DCA 54           	db 84
3364  0DCB 20           	db 32
3365  0DCC 20           	db 32
3366  0DCD 20           	db 32
3367  0DCE 20           	db 32
3368  0DCF 00           	ds 1
3369  0DD0              ; 45 uint16_t ftpSettingsUserValuePos = 0x0326;
3370  0DD0              ftpsettingsuservaluepos:
3371  0DD0 26 03        	dw 806
3372  0DD2              ; 46 uint8_t ftpSettingsUserValue[16] = "ESP8266";
3373  0DD2              ftpsettingsuservalue:
3374  0DD2 45           	db 69
3375  0DD3 53           	db 83
3376  0DD4 50           	db 80
3377  0DD5 38           	db 56
3378  0DD6 32           	db 50
3379  0DD7 36           	db 54
3380  0DD8 36           	db 54
3381  0DD9 00 00 00...  	ds 9
3382  0DE2              ; 11 uint8_t diskViewX = 0;
3383  0DE2              diskviewx:
3384  0DE2 00           	db 0
3385  0DE3              ; 12 uint8_t diskViewY = 7;
3386  0DE3              diskviewy:
3387  0DE3 07           	db 7
3388  0DE4              ; 13 uint8_t diskViewEX = 29; //54;
3389  0DE4              diskviewex:
3390  0DE4 1D           	db 29
3391  0DE5              ; 14 uint8_t diskViewEY = 25;
3392  0DE5              diskviewey:
3393  0DE5 19           	db 25
3394  0DE6              ; 16 uint16_t diskViewLabelPos = 0x0709;
3395  0DE6              diskviewlabelpos:
3396  0DE6 09 07        	dw 1801
3397  0DE8              ; 17 uint8_t diskViewLabel[] = " DISK:   ";
3398  0DE8              diskviewlabel:
3399  0DE8 20           	db 32
3400  0DE9 44           	db 68
3401  0DEA 49           	db 73
3402  0DEB 53           	db 83
3403  0DEC 4B           	db 75
3404  0DED 3A           	db 58
3405  0DEE 20           	db 32
3406  0DEF 20           	db 32
3407  0DF0 20           	db 32
3408  0DF1 00           	ds 1
3409  0DF2              ; 19 uint8_t diskViewDiskNum = 'B';
3410  0DF2              diskviewdisknum:
3411  0DF2 42           	db 66
3412  0DF3              ; 20 uint8_t diskViewListCount = 0;
3413  0DF3              diskviewlistcount:
3414  0DF3 00           	db 0
3415  0DF4              ; 21 uint8_t diskViewCurrPos = 1;
3416  0DF4              diskviewcurrpos:
3417  0DF4 01           	db 1
3418  0DF5              ; 22 uint16_t diskViewListNamePos = 0x0902;
3419  0DF5              diskviewlistnamepos:
3420  0DF5 02 09        	dw 2306
3421  0DF7              ; 24 uint16_t diskViewListDirPos = 0x0802;
3422  0DF7              diskviewlistdirpos:
3423  0DF7 02 08        	dw 2050
3424  0DF9              ; 25 uint8_t diskViewListDirLabel[] = " ..       ";
3425  0DF9              diskviewlistdirlabel:
3426  0DF9 20           	db 32
3427  0DFA 2E           	db 46
3428  0DFB 2E           	db 46
3429  0DFC 20           	db 32
3430  0DFD 20           	db 32
3431  0DFE 20           	db 32
3432  0DFF 20           	db 32
3433  0E00 20           	db 32
3434  0E01 20           	db 32
3435  0E02 20           	db 32
3436  0E03 00           	ds 1
3437  0E04              ; 27 uint16_t diskViewDriveNamePos = 0x0710;
3438  0E04              diskviewdrivenamepos:
3439  0E04 10 07        	dw 1808
3440  0E06              ; 29 uint16_t diskStartNewFile = 0x0000;
3441  0E06              diskstartnewfile:
3442  0E06 00 00        	dw 0
3443  0E08              ; 11 uint8_t ftpViewX = 30;
3444  0E08              ftpviewx:
3445  0E08 1E           	db 30
3446  0E09              ; 12 uint8_t ftpViewY = 7;
3447  0E09              ftpviewy:
3448  0E09 07           	db 7
3449  0E0A              ; 13 uint8_t ftpViewEX = 63;
3450  0E0A              ftpviewex:
3451  0E0A 3F           	db 63
3452  0E0B              ; 14 uint8_t ftpViewEY = 25;
3453  0E0B              ftpviewey:
3454  0E0B 19           	db 25
3455  0E0C              ; 16 uint16_t ftpLabelPos = 0x0728;
3456  0E0C              ftplabelpos:
3457  0E0C 28 07        	dw 1832
3458  0E0E              ; 17 uint8_t ftpLabel[] = " FTP: ";
3459  0E0E              ftplabel:
3460  0E0E 20           	db 32
3461  0E0F 46           	db 70
3462  0E10 54           	db 84
3463  0E11 50           	db 80
3464  0E12 3A           	db 58
3465  0E13 20           	db 32
3466  0E14 00           	ds 1
3467  0E15              ; 19 uint8_t ftpDirList[16 * 24];
3468  0E15              ftpdirlist:
3469  0E15 00 00 00...  	ds 384
3470  0F95              ; 20 uint8_t ftpDirListNext = 0;
3471  0F95              ftpdirlistnext:
3472  0F95 00           	db 0
3473  0F96              ; 21 uint8_t ftpDirListCount = 0;
3474  0F96              ftpdirlistcount:
3475  0F96 00           	db 0
3476  0F97              ; 22 uint8_t ftpDirListIsDir = 0;
3477  0F97              ftpdirlistisdir:
3478  0F97 00           	db 0
3479  0F98              ; 24 uint8_t ftpViewCurrentPos = 0;
3480  0F98              ftpviewcurrentpos:
3481  0F98 00           	db 0
3482  0F99              ; 16 uint8_t rootViewCurrentView = 0;
3483  0F99              rootviewcurrentview:
3484  0F99 00           	db 0
3485  0F9A              ; 18 uint16_t rootViewHelpStrPos = 0x0600;
3486  0F9A              rootviewhelpstrpos:
3487  0F9A 00 06        	dw 1536
3488  0F9C              ; 19 uint8_t rootViewHelpStr[] = " F1: ..          F2: WI-FI          F3: FTP          F4: QUIT";
3489  0F9C              rootviewhelpstr:
3490  0F9C 20           	db 32
3491  0F9D 46           	db 70
3492  0F9E 31           	db 49
3493  0F9F 3A           	db 58
3494  0FA0 20           	db 32
3495  0FA1 2E           	db 46
3496  0FA2 2E           	db 46
3497  0FA3 20           	db 32
3498  0FA4 20           	db 32
3499  0FA5 20           	db 32
3500  0FA6 20           	db 32
3501  0FA7 20           	db 32
3502  0FA8 20           	db 32
3503  0FA9 20           	db 32
3504  0FAA 20           	db 32
3505  0FAB 20           	db 32
3506  0FAC 20           	db 32
3507  0FAD 46           	db 70
3508  0FAE 32           	db 50
3509  0FAF 3A           	db 58
3510  0FB0 20           	db 32
3511  0FB1 57           	db 87
3512  0FB2 49           	db 73
3513  0FB3 2D           	db 45
3514  0FB4 46           	db 70
3515  0FB5 49           	db 73
3516  0FB6 20           	db 32
3517  0FB7 20           	db 32
3518  0FB8 20           	db 32
3519  0FB9 20           	db 32
3520  0FBA 20           	db 32
3521  0FBB 20           	db 32
3522  0FBC 20           	db 32
3523  0FBD 20           	db 32
3524  0FBE 20           	db 32
3525  0FBF 20           	db 32
3526  0FC0 46           	db 70
3527  0FC1 33           	db 51
3528  0FC2 3A           	db 58
3529  0FC3 20           	db 32
3530  0FC4 46           	db 70
3531  0FC5 54           	db 84
3532  0FC6 50           	db 80
3533  0FC7 20           	db 32
3534  0FC8 20           	db 32
3535  0FC9 20           	db 32
3536  0FCA 20           	db 32
3537  0FCB 20           	db 32
3538  0FCC 20           	db 32
3539  0FCD 20           	db 32
3540  0FCE 20           	db 32
3541  0FCF 20           	db 32
3542  0FD0 20           	db 32
3543  0FD1 46           	db 70
3544  0FD2 34           	db 52
3545  0FD3 3A           	db 58
3546  0FD4 20           	db 32
3547  0FD5 51           	db 81
3548  0FD6 55           	db 85
3549  0FD7 49           	db 73
3550  0FD8 54           	db 84
3551  0FD9 00           	ds 1
3552  0FDA              ; 21 uint8_t rootViewOldKey = 0xFF;
3553  0FDA              rootviewoldkey:
3554  0FDA FF           	db 255
3555  0FDB              ; 11 uint8_t ftpSettingsEditViewX = 14;
3556  0FDB              ftpsettingseditviewx:
3557  0FDB 0E           	db 14
3558  0FDC              ; 12 uint8_t ftpSettingsEditViewY = 4;
3559  0FDC              ftpsettingseditviewy:
3560  0FDC 04           	db 4
3561  0FDD              ; 13 uint8_t ftpSettingsEditViewEX = 50;
3562  0FDD              ftpsettingseditviewex:
3563  0FDD 32           	db 50
3564  0FDE              ; 14 uint8_t ftpSettingsEditViewEY = 20;
3565  0FDE              ftpsettingseditviewey:
3566  0FDE 14           	db 20
3567  0FDF              ; 16 uint16_t ftpSettingsEditViewLabelPos = 0x0418;
3568  0FDF              ftpsettingseditviewlabelpos:
3569  0FDF 18 04        	dw 1048
3570  0FE1              ; 17 uint8_t ftpSettingsEditViewLabel[] = " FTP SETTINGS ";
3571  0FE1              ftpsettingseditviewlabel:
3572  0FE1 20           	db 32
3573  0FE2 46           	db 70
3574  0FE3 54           	db 84
3575  0FE4 50           	db 80
3576  0FE5 20           	db 32
3577  0FE6 53           	db 83
3578  0FE7 45           	db 69
3579  0FE8 54           	db 84
3580  0FE9 54           	db 84
3581  0FEA 49           	db 73
3582  0FEB 4E           	db 78
3583  0FEC 47           	db 71
3584  0FED 53           	db 83
3585  0FEE 20           	db 32
3586  0FEF 00           	ds 1
3587  0FF0              ; 19 uint16_t ftpSettingsEditViewIpLabelPos = 0x0713;
3588  0FF0              ftpsettingseditviewiplabelpos:
3589  0FF0 13 07        	dw 1811
3590  0FF2              ; 20 uint16_t ftpSettingsEditViewPortLabelPos = 0x0911;
3591  0FF2              ftpsettingseditviewportlabelpos:
3592  0FF2 11 09        	dw 2321
3593  0FF4              ; 21 uint16_t ftpSettingsEditViewUserLabelPos = 0x0B11;
3594  0FF4              ftpsettingseditviewuserlabelpos:
3595  0FF4 11 0B        	dw 2833
3596  0FF6              ; 23 uint16_t ftpSettingsEditViewPasswordLabelPos = 0x0D11;
3597  0FF6              ftpsettingseditviewpasswordlabel:
3598  0FF6 11 0D        	dw 3345
3599  0FF8              ; 24 uint8_t ftpSettingsEditViewPasswordLabel[] = "PASS:";
3600  0FF8              ftpsettingseditviewpasswordlabel_0:
3601  0FF8 50           	db 80
3602  0FF9 41           	db 65
3603  0FFA 53           	db 83
3604  0FFB 53           	db 83
3605  0FFC 3A           	db 58
3606  0FFD 00           	ds 1
3607  0FFE              ; 26 uint16_t ftpSettingsEditViewOkLabelPos = 0x101D;
3608  0FFE              ftpsettingseditviewoklabelpos:
3609  0FFE 1D 10        	dw 4125
3610  1000              ; 27 uint8_t ftpSettingsEditViewOkLabel[] = "  OK  ";
3611  1000              ftpsettingseditviewoklabel:
3612  1000 20           	db 32
3613  1001 20           	db 32
3614  1002 4F           	db 79
3615  1003 4B           	db 75
3616  1004 20           	db 32
3617  1005 20           	db 32
3618  1006 00           	ds 1
3619  1007              ; 29 uint16_t ftpSettingsEditViewIpValPos = 0x0719;
3620  1007              ftpsettingseditviewipvalpos:
3621  1007 19 07        	dw 1817
3622  1009              ; 30 uint16_t ftpSettingsEditViewPortValPos = 0x0919;
3623  1009              ftpsettingseditviewportvalpos:
3624  1009 19 09        	dw 2329
3625  100B              ; 31 uint16_t ftpSettingsEditViewUserValPos = 0x0B19;
3626  100B              ftpsettingseditviewuservalpos:
3627  100B 19 0B        	dw 2841
3628  100D              ; 32 uint16_t ftpSettingsEditViewPasswordValPos = 0x0D19;
3629  100D              ftpsettingseditviewpasswordvalpo:
3630  100D 19 0D        	dw 3353
3631  100F              ; 33 uint8_t ftpSettingsEditViewPasswordVal[16] = "ESP8266";
3632  100F              ftpsettingseditviewpasswordval:
3633  100F 45           	db 69
3634  1010 53           	db 83
3635  1011 50           	db 80
3636  1012 38           	db 56
3637  1013 32           	db 50
3638  1014 36           	db 54
3639  1015 36           	db 54
3640  1016 00 00 00...  	ds 9
3641  101F              ; 35 uint8_t ftpSettingsEditViewCurrentPos = 0;
3642  101F              ftpsettingseditviewcurrentpos:
3643  101F 00           	db 0
3644  1020              ; 37 uint16_t ftpSettingsEditViewEditValuePos = 0x0000;
3645  1020              ftpsettingseditvieweditvaluepos:
3646  1020 00 00        	dw 0
3647  1022              ; 38 uint8_t ftpSettingsEditViewEditValue[24] = "";
3648  1022              ftpsettingseditvieweditvalue:
3649  1022 00 00 00...  	ds 24
3650  103A              ; 39 uint8_t ftpSettingsEditViewEditPos = 0;
3651  103A              ftpsettingseditvieweditpos:
3652  103A 00           	db 0
3653  103B              ; 41 uint8_t updateFtpStatusTike = 0;
3654  103B              updateftpstatustike:
3655  103B 00           	db 0
3656  103C              ; 11 void createTestFile() {
3657  103C              createtestfile:
3658  103C              ; 12     push_pop(hl) {
3659  103C E5           	push hl
3660  103D              ; 13         a = diskViewDiskNum;
3661  103D 3A F2 0D     	ld a, (diskviewdisknum)
3662  1040              ; 14         ordos_wnd();
3663  1040 CD D6 BF     	call ordos_wnd
3664  1043              ; 15
3665  1043              ; 16         ordos_mxdsk();
3666  1043 CD B8 BF     	call ordos_mxdsk
3667  1046              ; 17         diskStartNewFile = hl;
3668  1046 22 06 0E     	ld (diskstartnewfile), hl
3669  1049              ; 18         de = fileTable;
3670  1049 11 60 10     	ld de, filetable
3671  104C              ; 19         b = 0;
3672  104C 06 00        	ld b, 0
3673  104E              ; 20         do {
3674  104E              l_297:
3675  104E              ; 21             a = *de;
3676  104E 1A           	ld a, (de)
3677  104F              ; 22             ordos_wdisk();
3678  104F CD DF BF     	call ordos_wdisk
3679  1052              ; 23             hl++;
3680  1052 23           	inc hl
3681  1053              ; 24             de++;
3682  1053 13           	inc de
3683  1054              ; 25             b++;
3684  1054 04           	inc b
3685  1055              ; 26             a = b;
3686  1055 78           	ld a, b
3687  1056              ; 27             a -= 64;
3688  1056 D6 40        	sub 64
3689  1058              l_298:
3690  1058 C2 4E 10     	jp nz, l_297
3691  105B              ; 28         } while (flag_nz);
3692  105B              ; 29         ordos_stop();
3693  105B CD E2 BF     	call ordos_stop
3694  105E E1           	pop hl
3695  105F C9           	ret
3696  1060              ; 30     }
3697  1060              ; 31 }
3698  1060              ; 32
3699  1060              ; 33 uint8_t fileTable[] = {
3700  1060              filetable:
3701  1060 42           	db 66
3702  1061 4F           	db 79
3703  1062 4F           	db 79
3704  1063 54           	db 84
3705  1064 24           	db 36
3706  1065 20           	db 32
3707  1066 20           	db 32
3708  1067 20           	db 32
3709  1068 00           	db 0
3710  1069 B4           	db 180
3711  106A 30           	db 48
3712  106B 00           	db 0
3713  106C 00           	db 0
3714  106D FF           	db 255
3715  106E FF           	db 255
3716  106F FF           	db 255
3717  1070 21           	db 33
3718  1071 D0           	db 208
3719  1072 B4           	db 180
3720  1073 CD           	db 205
3721  1074 18           	db 24
3722  1075 F8           	db 248
3723  1076 11           	db 17
3724  1077 00           	db 0
3725  1078 F7           	db 247
3726  1079 3E           	db 62
3727  107A 10           	db 16
3728  107B 32           	db 50
3729  107C 20           	db 32
3730  107D F7           	db 247
3731  107E AF           	db 175
3732  107F 32           	db 50
3733  1080 01           	db 1
3734  1081 F7           	db 247
3735  1082 3E           	db 62
3736  1083 D0           	db 208
3737  1084 CD           	db 205
3738  1085 BF           	db 191
3739  1086 B4           	db 180
3740  1087 06           	db 6
3741  1088 05           	db 5
3742  1089 3E           	db 62
3743  108A 4B           	db 75
3744  108B CD           	db 205
3745  108C BF           	db 191
3746  108D B4           	db 180
3747  108E 05           	db 5
3748  108F C2           	db 194
3749  1090 19           	db 25
3750  1091 B4           	db 180
3751  1092 3E           	db 62
3752  1093 0B           	db 11
3753  1094 CD           	db 205
3754  1095 BF           	db 191
3755  1096 B4           	db 180
3756  1097 1A           	db 26
3757  1098 07           	db 7
3758  1099 DA           	db 218
3759  109A 27           	db 39
3760  109B B4           	db 180
3761  109C CD           	db 205
3762  109D 8D           	db 141
3763  109E B4           	db 180
3764  109F CA           	db 202
3765  10A0              ; 11 uint8_t wifiSettingsEditViewCurrentPos = 0;
3766  10A0              wifisettingseditviewcurrentpos:
3767  10A0 00           	db 0
3768  10A1              ; 13 uint8_t wifiSettingsEditViewX = 14;
3769  10A1              wifisettingseditviewx:
3770  10A1 0E           	db 14
3771  10A2              ; 14 uint8_t wifiSettingsEditViewY = 4;
3772  10A2              wifisettingseditviewy:
3773  10A2 04           	db 4
3774  10A3              ; 15 uint8_t wifiSettingsEditViewEX = 50;
3775  10A3              wifisettingseditviewex:
3776  10A3 32           	db 50
3777  10A4              ; 16 uint8_t wifiSettingsEditViewEY = 15;
3778  10A4              wifisettingseditviewey:
3779  10A4 0F           	db 15
3780  10A5              ; 18 uint16_t wifiSettingsEditViewLabelPos = 0x0418;
3781  10A5              wifisettingseditviewlabelpos:
3782  10A5 18 04        	dw 1048
3783  10A7              ; 19 uint8_t wifiSettingsEditViewLabel[] = " WI-FI SETTINGS ";
3784  10A7              wifisettingseditviewlabel:
3785  10A7 20           	db 32
3786  10A8 57           	db 87
3787  10A9 49           	db 73
3788  10AA 2D           	db 45
3789  10AB 46           	db 70
3790  10AC 49           	db 73
3791  10AD 20           	db 32
3792  10AE 53           	db 83
3793  10AF 45           	db 69
3794  10B0 54           	db 84
3795  10B1 54           	db 84
3796  10B2 49           	db 73
3797  10B3 4E           	db 78
3798  10B4 47           	db 71
3799  10B5 53           	db 83
3800  10B6 20           	db 32
3801  10B7 00           	ds 1
3802  10B8              ; 21 uint16_t wifiSettingsEditViewSSIDLabelPos = 0x0711;
3803  10B8              wifisettingseditviewssidlabelpos:
3804  10B8 11 07        	dw 1809
3805  10BA              ; 22 uint8_t wifiSettingsEditViewSSIDLabel[] = "SSID:";
3806  10BA              wifisettingseditviewssidlabel:
3807  10BA 53           	db 83
3808  10BB 53           	db 83
3809  10BC 49           	db 73
3810  10BD 44           	db 68
3811  10BE 3A           	db 58
3812  10BF 00           	ds 1
3813  10C0              ; 24 uint16_t wifiSettingsEditViewSSIDPasswordLabelPos = 0x0911;
3814  10C0              wifisettingseditviewssidpassword:
3815  10C0 11 09        	dw 2321
3816  10C2              ; 25 uint8_t wifiSettingsEditViewSSIDPasswordLabel[] = "PASS:";
3817  10C2              wifisettingseditviewssidpassword_1:
3818  10C2 50           	db 80
3819  10C3 41           	db 65
3820  10C4 53           	db 83
3821  10C5 53           	db 83
3822  10C6 3A           	db 58
3823  10C7 00           	ds 1
3824  10C8              ; 27 uint16_t wifiSettingsEditViewOkLabelPos = 0x0B1D;
3825  10C8              wifisettingseditviewoklabelpos:
3826  10C8 1D 0B        	dw 2845
3827  10CA              ; 28 uint8_t wifiSettingsEditViewOkLabel[] = "  OK  ";
3828  10CA              wifisettingseditviewoklabel:
3829  10CA 20           	db 32
3830  10CB 20           	db 32
3831  10CC 4F           	db 79
3832  10CD 4B           	db 75
3833  10CE 20           	db 32
3834  10CF 20           	db 32
3835  10D0 00           	ds 1
3836  10D1              ; 30 uint16_t wifiSettingsEditViewSSIDValPos = 0x0719;
3837  10D1              wifisettingseditviewssidvalpos:
3838  10D1 19 07        	dw 1817
3839  10D3              ; 31 uint16_t wifiSettingsEditViewSSIDPasswordValPos = 0x0919;
3840  10D3              wifisettingseditviewssidpassword_2:
3841  10D3 19 09        	dw 2329
3842  10D5              ; 33 uint8_t wifiSettingsEditViewSSIDPasswordVal[16] = "---";
3843  10D5              wifisettingseditviewssidpassword_3:
3844  10D5 2D           	db 45
3845  10D6 2D           	db 45
3846  10D7 2D           	db 45
3847  10D8 00 00 00...  	ds 13
3848  10E5              ; 35 uint16_t wifiSettingsEditViewEditValuePos = 0x0000;
3849  10E5              wifisettingseditvieweditvaluepos:
3850  10E5 00 00        	dw 0
3851  10E7              ; 36 uint8_t wifiSettingsEditViewEditValue[24] = "";
3852  10E7              wifisettingseditvieweditvalue:
3853  10E7 00 00 00...  	ds 24
3854  10FF              ; 37 uint8_t wifiSettingsEditViewEditPos = 0;
3855  10FF              wifisettingseditvieweditpos:
3856  10FF 00           	db 0
3857  1100              ; 39 uint8_t updateWiFiStatusTike = 0;
3858  1100              updatewifistatustike:
3859  1100 00           	db 0
3860  1101              ; 40 uint8_t WiFiState = 0;
3861  1101              wifistate:
3862  1101 00           	db 0
3863  1102              ; 41 uint8_t WiFiStateUpdate = 1;
3864  1102              wifistateupdate:
3865  1102 01           	db 1
3866  1103              ; 11 uint8_t SSIDListViewX = 22;
3867  1103              ssidlistviewx:
3868  1103 16           	db 22
3869  1104              ; 12 uint8_t SSIDListViewY = 3;
3870  1104              ssidlistviewy:
3871  1104 03           	db 3
3872  1105              ; 13 uint8_t SSIDListViewEX = 44;
3873  1105              ssidlistviewex:
3874  1105 2C           	db 44
3875  1106              ; 14 uint8_t SSIDListViewEY = 23;
3876  1106              ssidlistviewey:
3877  1106 17           	db 23
3878  1107              ; 16 uint16_t SSIDListViewTitlePos = 0x031B;
3879  1107              ssidlistviewtitlepos:
3880  1107 1B 03        	dw 795
3881  1109              ; 17 uint8_t SSIDListViewTitle[] = " SSID LIST ";
3882  1109              ssidlistviewtitle:
3883  1109 20           	db 32
3884  110A 53           	db 83
3885  110B 53           	db 83
3886  110C 49           	db 73
3887  110D 44           	db 68
3888  110E 20           	db 32
3889  110F 4C           	db 76
3890  1110 49           	db 73
3891  1111 53           	db 83
3892  1112 54           	db 84
3893  1113 20           	db 32
3894  1114 00           	ds 1
3895  1115              ; 19 uint8_t SSIDListCount = 0;
3896  1115              ssidlistcount:
3897  1115 00           	db 0
3898  1116              ; 20 uint8_t SSIDListViewCurrentPos = 0;
3899  1116              ssidlistviewcurrentpos:
3900  1116 00           	db 0
3901  1117              ; 21 uint8_t SSIDListNext = 0;
3902  1117              ssidlistnext:
3903  1117 00           	db 0
3904  1118              ; 23 uint8_t SSIDList[] = {
3905  1118              ssidlist:
3906  1118 44           	db 68
3907  1119 49           	db 73
3908  111A 52           	db 82
3909  111B 45           	db 69
3910  111C 43           	db 67
3911  111D 54           	db 84
3912  111E 2D           	db 45
3913  111F 4C           	db 76
3914  1120 30           	db 48
3915  1121 5B           	db 91
3916  1122 42           	db 66
3917  1123 44           	db 68
3918  1124 5D           	db 93
3919  1125 53           	db 83
3920  1126 4C           	db 76
3921  1127 00           	db 0
3922  1128 4B           	db 75
3923  1129 56           	db 86
3924  112A 31           	db 49
3925  112B 35           	db 53
3926  112C 31           	db 49
3927  112D 00           	db 0
3928  112E 00           	db 0
3929  112F 00           	db 0
3930  1130 00           	db 0
3931  1131 00           	db 0
3932  1132 00           	db 0
3933  1133 00           	db 0
3934  1134 00           	db 0
3935  1135 00           	db 0
3936  1136 00           	db 0
3937  1137 00           	db 0
3938  1138 4D           	db 77
3939  1139 47           	db 71
3940  113A 54           	db 84
3941  113B 53           	db 83
3942  113C 5F           	db 95
3943  113D 47           	db 71
3944  113E 50           	db 80
3945  113F 4F           	db 79
3946  1140 4E           	db 78
3947  1141 5F           	db 95
3948  1142 44           	db 68
3949  1143 44           	db 68
3950  1144 31           	db 49
3951  1145 35           	db 53
3952  1146 00           	db 0
3953  1147 00           	db 0
3954  1148 4D           	db 77
3955  1149 47           	db 71
3956  114A 54           	db 84
3957  114B 53           	db 83
3958  114C 5F           	db 95
3959  114D 47           	db 71
3960  114E 50           	db 80
3961  114F 4F           	db 79
3962  1150 4E           	db 78
3963  1151 5F           	db 95
3964  1152 39           	db 57
3965  1153 30           	db 48
3966  1154 36           	db 54
3967  1155 39           	db 57
3968  1156 00           	db 0
3969  1157 00           	db 0
3970  1158 41           	db 65
3971  1159 45           	db 69
3972  115A 52           	db 82
3973  115B 4F           	db 79
3974  115C 4C           	db 76
3975  115D 49           	db 73
3976  115E 4E           	db 78
3977  115F 4B           	db 75
3978  1160 44           	db 68
3979  1161 00           	db 0
3980  1162 00           	db 0
3981  1163 00           	db 0
3982  1164 00           	db 0
3983  1165 00           	db 0
3984  1166 00           	db 0
3985  1167 00           	db 0
3986  1168 4D           	db 77
3987  1169 47           	db 71
3988  116A 54           	db 84
3989  116B 53           	db 83
3990  116C 5F           	db 95
3991  116D 47           	db 71
3992  116E 50           	db 80
3993  116F 4F           	db 79
3994  1170 4E           	db 78
3995  1171 5F           	db 95
3996  1172 36           	db 54
3997  1173 34           	db 52
3998  1174 36           	db 54
3999  1175 30           	db 48
4000  1176 00           	db 0
4001  1177 00           	db 0
4002  1178 4D           	db 77
4003  1179 54           	db 84
4004  117A 53           	db 83
4005  117B 5F           	db 95
4006  117C 47           	db 71
4007  117D 50           	db 80
4008  117E 4F           	db 79
4009  117F 4E           	db 78
4010  1180 5F           	db 95
4011  1181 39           	db 57
4012  1182 33           	db 51
4013  1183 32           	db 50
4014  1184 41           	db 65
4015  1185 46           	db 70
4016  1186 38           	db 56
4017  1187 00           	db 0
4018  1188 4D           	db 77
4019  1189 47           	db 71
4020  118A 54           	db 84
4021  118B 53           	db 83
4022  118C 5F           	db 95
4023  118D 47           	db 71
4024  118E 50           	db 80
4025  118F 4F           	db 79
4026  1190 4E           	db 78
4027  1191 5F           	db 95
4028  1192 39           	db 57
4029  1193 41           	db 65
4030  1194 36           	db 54
4031  1195 32           	db 50
4032  1196 00           	db 0
4033  1197 00           	db 0
4034  1198 42           	db 66
4035  1199 45           	db 69
4036  119A 45           	db 69
4037  119B 4C           	db 76
4038  119C 49           	db 73
4039  119D 4E           	db 78
4040  119E 45           	db 69
4041  119F 2D           	db 45
4042  11A0 52           	db 82
4043  11A1 4F           	db 79
4044  11A2 55           	db 85
4045  11A3 54           	db 84
4046  11A4 45           	db 69
4047  11A5 52           	db 82
4048  11A6 45           	db 69
4049  11A7 00           	db 0
4050  11A8 54           	db 84
4051  11A9 4F           	db 79
4052  11AA 54           	db 84
4053  11AB 4F           	db 79
4054  11AC 52           	db 82
4055  11AD 4F           	db 79
4056  11AE 00           	db 0
4057  11AF 00           	db 0
4058  11B0 00           	db 0
4059  11B1 00           	db 0
4060  11B2 00           	db 0
4061  11B3 00           	db 0
4062  11B4 00           	db 0
4063  11B5 00           	db 0
4064  11B6 00           	db 0
4065  11B7 00           	db 0
4066  11B8 50           	db 80
4067  11B9 4F           	db 79
4068  11BA 4B           	db 75
4069  11BB 45           	db 69
4070  11BC 4D           	db 77
4071  11BD 4F           	db 79
4072  11BE 4E           	db 78
4073  11BF 00           	db 0
4074  11C0 00           	db 0
4075  11C1 00           	db 0
4076  11C2 00           	db 0
4077  11C3 00           	db 0
4078  11C4 00           	db 0
4079  11C5 00           	db 0
4080  11C6 00           	db 0
4081  11C7 00           	db 0
4082  11C8 4B           	db 75
4083  11C9 45           	db 69
4084  11CA 45           	db 69
4085  11CB 4E           	db 78
4086  11CC 45           	db 69
4087  11CD 54           	db 84
4088  11CE 49           	db 73
4089  11CF 43           	db 67
4090  11D0 2D           	db 45
4091  11D1 35           	db 53
4092  11D2 35           	db 53
4093  11D3 35           	db 53
4094  11D4 32           	db 50
4095  11D5 00           	db 0
4096  11D6 00           	db 0
4097  11D7 00           	db 0
4098  11D8 4B           	db 75
4099  11D9 31           	db 49
4100  11DA 35           	db 53
4101  11DB 39           	db 57
4102  11DC 00           	db 0
4103  11DD 00           	db 0
4104  11DE 00           	db 0
4105  11DF 00           	db 0
4106  11E0 00           	db 0
4107  11E1 00           	db 0
4108  11E2 00           	db 0
4109  11E3 00           	db 0
4110  11E4 00           	db 0
4111  11E5 00           	db 0
4112  11E6 00           	db 0
4113  11E7 00           	db 0
4114  11E8 4B           	db 75
4115  11E9 54           	db 84
4116  11EA 31           	db 49
4117  11EB 35           	db 53
4118  11EC 39           	db 57
4119  11ED 00           	db 0
4120  11EE 00           	db 0
4121  11EF 00           	db 0
4122  11F0 00           	db 0
4123  11F1 00           	db 0
4124  11F2 00           	db 0
4125  11F3 00           	db 0
4126  11F4 00           	db 0
4127  11F5 00           	db 0
4128  11F6 00           	db 0
4129  11F7 00           	db 0
4130  11F8 00           	db 0
4131  11F9 00           	db 0
4132  11FA 00           	db 0
4133  11FB 00           	db 0
4134  11FC 00           	db 0
4135  11FD 00           	db 0
4136  11FE 00           	db 0
4137  11FF 00           	db 0
4138  1200 00           	db 0
4139  1201 00           	db 0
4140  1202 00           	db 0
4141  1203 00           	db 0
4142  1204 00           	db 0
4143  1205 00           	db 0
4144  1206 00           	db 0
4145  1207 00           	db 0
4146  1208 00           	db 0
4147  1209 00           	db 0
4148  120A 00           	db 0
4149  120B 00           	db 0
4150  120C 00           	db 0
4151  120D 00           	db 0
4152  120E 00           	db 0
4153  120F 00           	db 0
4154  1210 00           	db 0
4155  1211 00           	db 0
4156  1212 00           	db 0
4157  1213 00           	db 0
4158  1214 00           	db 0
4159  1215 00           	db 0
4160  1216 00           	db 0
4161  1217 00           	db 0
4162  1218              ; 16 void initI2C() {
4163  1218              initi2c:
4164  1218              ; 17     a = 0x81;
4165  1218 3E 81        	ld a, 129
4166  121A              ; 18     VV55_SETUP = a;
4167  121A 32 03 F6     	ld (vv55_setup), a
4168  121D              ; 19     #ifdef _SLOW_SETTINGS
4169  121D              ; 20     NOPS
4170  121D 00           	nop
4171  121E 00           	nop
4172  121F 00           	nop
4173  1220 00           	nop
4174  1221              ; 21     #endif
4175  1221              ; 22     a = 0xC0;
4176  1221 3E C0        	ld a, 192
4177  1223              ; 23     VV55_PORT_C = a;
4178  1223 32 02 F6     	ld (vv55_port_c), a
4179  1226 C9           	ret
4180  1227              ; 24 }
4181  1227              ; 25
4182  1227              ; 26 void startI2C() {
4183  1227              starti2c:
4184  1227              ; 27     #ifdef _SLOW_SETTINGS
4185  1227              ; 28     NOPS
4186  1227 00           	nop
4187  1228 00           	nop
4188  1229 00           	nop
4189  122A 00           	nop
4190  122B              ; 29     #endif
4191  122B              ; 30     a = 0x40;
4192  122B 3E 40        	ld a, 64
4193  122D              ; 31     VV55_PORT_C = a;
4194  122D 32 02 F6     	ld (vv55_port_c), a
4195  1230              ; 32     #ifdef _SLOW_SETTINGS
4196  1230              ; 33     NOPS
4197  1230 00           	nop
4198  1231 00           	nop
4199  1232 00           	nop
4200  1233 00           	nop
4201  1234              ; 34     #endif
4202  1234              ; 35     nop();
4203  1234 00           	nop
4204  1235              ; 36     a = 0x00;
4205  1235 3E 00        	ld a, 0
4206  1237              ; 37     VV55_PORT_C = a;
4207  1237 32 02 F6     	ld (vv55_port_c), a
4208  123A C9           	ret
4209  123B              ; 38 }
4210  123B              ; 39
4211  123B              ; 40 void stopI2C() {
4212  123B              stopi2c:
4213  123B              ; 41     #ifdef _SLOW_SETTINGS
4214  123B              ; 42     NOPS
4215  123B 00           	nop
4216  123C 00           	nop
4217  123D 00           	nop
4218  123E 00           	nop
4219  123F              ; 43     #endif
4220  123F              ; 44     a = 0x40;
4221  123F 3E 40        	ld a, 64
4222  1241              ; 45     VV55_PORT_C = a;
4223  1241 32 02 F6     	ld (vv55_port_c), a
4224  1244              ; 46     #ifdef _SLOW_SETTINGS
4225  1244              ; 47     NOPS
4226  1244 00           	nop
4227  1245 00           	nop
4228  1246 00           	nop
4229  1247 00           	nop
4230  1248              ; 48     #endif
4231  1248              ; 49     nop();
4232  1248 00           	nop
4233  1249              ; 50     a = 0xC0;
4234  1249 3E C0        	ld a, 192
4235  124B              ; 51     VV55_PORT_C = a;
4236  124B 32 02 F6     	ld (vv55_port_c), a
4237  124E C9           	ret
4238  124F              ; 52 }
4239  124F              ; 53
4240  124F              ; 54 /// вх. [A] - устанавливаемое значение (8 бит)
4241  124F              ; 55 void setSDAI2C(){
4242  124F              setsdai2c:
4243  124F              ; 56 //    #ifdef _SLOW_SETTINGS
4244  124F              ; 57 //    NOPS
4245  124F              ; 58 //    #endif
4246  124F              ; 59     a &= 0x80;
4247  124F E6 80        	and 128
4248  1251              ; 60     I2C_CURRETN_VALUE = a;
4249  1251 32 0F 13     	ld (i2c_curretn_value), a
4250  1254              ; 61     VV55_PORT_C = a;
4251  1254 32 02 F6     	ld (vv55_port_c), a
4252  1257 C9           	ret
4253  1258              ; 62 }
4254  1258              ; 63
4255  1258              ; 64 void pulseNewI2C() {
4256  1258              pulsenewi2c:
4257  1258              ; 65     #ifdef _SLOW_SETTINGS
4258  1258              ; 66     NOPS
4259  1258 00           	nop
4260  1259 00           	nop
4261  125A 00           	nop
4262  125B 00           	nop
4263  125C              ; 67     #endif
4264  125C              ; 68     a = I2C_CURRETN_VALUE;
4265  125C 3A 0F 13     	ld a, (i2c_curretn_value)
4266  125F              ; 69     a += 0x40;
4267  125F C6 40        	add 64
4268  1261              ; 70     VV55_PORT_C = a;
4269  1261 32 02 F6     	ld (vv55_port_c), a
4270  1264              ; 71 //    /// - Проверим что SLAVE не тормозит передачу -
4271  1264              ; 72 //    /// - После установки 1 - проверяем - есть ли 1 на SCL. Если там 0 - то ждем SLAVE
4272  1264              ; 73 //    do {
4273  1264              ; 74 //        a = VV55_PORT_C;
4274  1264              ; 75 //        a &= 0x40;
4275  1264              ; 76 //    } while (a != 0x40);
4276  1264              ; 77 //    /// -------------------------------------
4277  1264              ; 78     #ifdef _SLOW_SETTINGS
4278  1264              ; 79     NOPS
4279  1264 00           	nop
4280  1265 00           	nop
4281  1266 00           	nop
4282  1267 00           	nop
4283  1268              ; 80     #endif
4284  1268              ; 81     nop();
4285  1268 00           	nop
4286  1269              ; 82     a = I2C_CURRETN_VALUE;
4287  1269 3A 0F 13     	ld a, (i2c_curretn_value)
4288  126C              ; 83     a += 0x00;
4289  126C              ; 84     VV55_PORT_C = a;
4290  126C 32 02 F6     	ld (vv55_port_c), a
4291  126F C9           	ret
4292  1270              ; 85 }
4293  1270              ; 86
4294  1270              ; 87 /// вх. [C] передаваемый байт
4295  1270              ; 88 /// вых.[A]=0 - OK
4296  1270              ; 89 void transmitNewI2C() {
4297  1270              transmitnewi2c:
4298  1270              ; 90     push_pop(bc) {
4299  1270 C5           	push bc
4300  1271              ; 91         b = 8;
4301  1271 06 08        	ld b, 8
4302  1273              ; 92         do {
4303  1273              l_300:
4304  1273              ; 93             setSDAI2C(a = c);
4305  1273 79           	ld a, c
4306  1274 CD 4F 12     	call setsdai2c
4307  1277              ; 94             pulseNewI2C();
4308  1277 CD 58 12     	call pulsenewi2c
4309  127A              ; 95             a = c;
4310  127A 79           	ld a, c
4311  127B              ; 96             carry_rotate_left(a, 1);
4312  127B 17           	rla
4313  127C              ; 97             c = a;
4314  127C 4F           	ld c, a
4315  127D              ; 98             b--;
4316  127D 05           	dec b
4317  127E              l_301:
4318  127E C2 73 12     	jp nz, l_300
4319  1281              ; 99         } while (flag_nz);
4320  1281              ; 100
4321  1281              ; 101         setSDAI2C(a = 0x80);
4322  1281 3E 80        	ld a, 128
4323  1283 CD 4F 12     	call setsdai2c
4324  1286              ; 102         a = VV55_PORT_C;
4325  1286 3A 02 F6     	ld a, (vv55_port_c)
4326  1289              ; 103         a &= 1;
4327  1289 E6 01        	and 1
4328  128B              ; 104         b = a;
4329  128B 47           	ld b, a
4330  128C              ; 105         setSDAI2C(a = 0x00);
4331  128C 3E 00        	ld a, 0
4332  128E CD 4F 12     	call setsdai2c
4333  1291              ; 106         pulseNewI2C();
4334  1291 CD 58 12     	call pulsenewi2c
4335  1294              ; 107         a = b;
4336  1294 78           	ld a, b
4337  1295 C1           	pop bc
4338  1296 C9           	ret
4339  1297              ; 108     }
4340  1297              ; 109 }
4341  1297              ; 110
4342  1297              ; 111 /// вых.[C] принятый байт
4343  1297              ; 112 /// вых.[B] ACK/NAK
4344  1297              ; 113 void recieveNewI2C() {
4345  1297              recievenewi2c:
4346  1297              ; 114     push_pop(de) {
4347  1297 D5           	push de
4348  1298              ; 115         setSDAI2C(a = 0x80);
4349  1298 3E 80        	ld a, 128
4350  129A CD 4F 12     	call setsdai2c
4351  129D              ; 116         c = 0;
4352  129D 0E 00        	ld c, 0
4353  129F              ; 117         d = 0x08;
4354  129F 16 08        	ld d, 8
4355  12A1              ; 118         do {
4356  12A1              l_303:
4357  12A1              ; 119             a = c;
4358  12A1 79           	ld a, c
4359  12A2              ; 120             carry_rotate_left(a, 1);
4360  12A2 17           	rla
4361  12A3              ; 121             c = a;
4362  12A3 4F           	ld c, a
4363  12A4              ; 122             a = VV55_PORT_C; // READ BIT
4364  12A4 3A 02 F6     	ld a, (vv55_port_c)
4365  12A7              ; 123             a &= 1;
4366  12A7 E6 01        	and 1
4367  12A9              ; 124             a += c;
4368  12A9 81           	add c
4369  12AA              ; 125             c = a;
4370  12AA 4F           	ld c, a
4371  12AB              ; 126             pulseNewI2C();
4372  12AB CD 58 12     	call pulsenewi2c
4373  12AE              ; 127             d--;
4374  12AE 15           	dec d
4375  12AF              ; 128             a = d;
4376  12AF 7A           	ld a, d
4377  12B0              l_304:
4378  12B0 C2 A1 12     	jp nz, l_303
4379  12B3              ; 129         } while (flag_nz);
4380  12B3              ; 130 //        setSDAI2C(a = 0x80);
4381  12B3              ; 131 //        a &= 1;
4382  12B3              ; 132 //        b = a;
4383  12B3              ; 133 //        setSDAI2C(a = 0x00);
4384  12B3              ; 134 //        if ((a = b) == 0x01) {
4385  12B3              ; 135 //            setSDAI2C(a = 0x80);
4386  12B3              ; 136 //        } else {
4387  12B3              ; 137 //            setSDAI2C(a = 0x00);
4388  12B3              ; 138 //        }
4389  12B3              ; 139
4390  12B3              ; 140         setSDAI2C(a = 0x00);
4391  12B3 3E 00        	ld a, 0
4392  12B5 CD 4F 12     	call setsdai2c
4393  12B8              ; 141
4394  12B8              ; 142         pulseNewI2C();
4395  12B8 CD 58 12     	call pulsenewi2c
4396  12BB              ; 143
4397  12BB              ; 144         a = VV55_PORT_C;
4398  12BB 3A 02 F6     	ld a, (vv55_port_c)
4399  12BE              ; 145         a &= 1;
4400  12BE E6 01        	and 1
4401  12C0              ; 146         b = a;
4402  12C0 47           	ld b, a
4403  12C1 D1           	pop de
4404  12C2 C9           	ret
4405  12C3              ; 147     }
4406  12C3              ; 148 }
4407  12C3              ; 149
4408  12C3              ; 150 /// вых.[B] - 1 устройство занято
4409  12C3              ; 151 void i2cBusy() {
4410  12C3              i2cbusy:
4411  12C3              ; 152     a = VV55_PORT_C;
4412  12C3 3A 02 F6     	ld a, (vv55_port_c)
4413  12C6              ; 153     a &= 2;
4414  12C6 E6 02        	and 2
4415  12C8              ; 154     carry_rotate_right(a, 1);
4416  12C8 1F           	rra
4417  12C9 C9           	ret
4418  12CA              ; 155 }
4419  12CA              ; 156
4420  12CA              ; 157 /// Ожидание готовности I2C
4421  12CA              ; 158 void i2cWaitingForAccess() {
4422  12CA              i2cwaitingforaccess:
4423  12CA              ; 159     do {
4424  12CA              l_306:
4425  12CA              ; 160         i2cBusy();
4426  12CA CD C3 12     	call i2cbusy
4427  12CD              ; 161         if (a == 1) {
4428  12CD FE 01        	cp 1
4429  12CF C2 D7 12     	jp nz, l_309
4430  12D2              ; 162             nop();
4431  12D2 00           	nop
4432  12D3              ; 163             nop();
4433  12D3 00           	nop
4434  12D4              ; 164             nop();
4435  12D4 00           	nop
4436  12D5              ; 165             nop();
4437  12D5 00           	nop
4438  12D6              ; 166             nop();
4439  12D6 00           	nop
4440  12D7              l_309:
4441  12D7              l_307:
4442  12D7              ; 167         }
4443  12D7              ; 168     } while (a == 1);
4444  12D7 FE 01        	cp 1
4445  12D9 CA CA 12     	jp z, l_306
4446  12DC C9           	ret
4447  12DD              ; 169 }
4448  12DD              ; 170
4449  12DD              ; 171 void delay5msI2C() {
4450  12DD              delay5msi2c:
4451  12DD              ; 172     push_pop(bc) {
4452  12DD C5           	push bc
4453  12DE              ; 173         bc = 0x500;
4454  12DE 01 00 05     	ld bc, 1280
4455  12E1              ; 174         do {
4456  12E1              l_311:
4457  12E1              ; 175             bc--;
4458  12E1 0B           	dec bc
4459  12E2              ; 176             a = b;
4460  12E2 78           	ld a, b
4461  12E3              ; 177             a |= c;
4462  12E3 B1           	or c
4463  12E4              l_312:
4464  12E4 C2 E1 12     	jp nz, l_311
4465  12E7 C1           	pop bc
4466  12E8 C9           	ret
4467  12E9              ; 178         } while (flag_nz);
4468  12E9              ; 179     }
4469  12E9              ; 180 }
4470  12E9              ; 181
4471  12E9              ; 182 void busRecoveryI2C() {
4472  12E9              busrecoveryi2c:
4473  12E9              ; 183     startI2C();
4474  12E9 CD 27 12     	call starti2c
4475  12EC              ; 184     a = 0;
4476  12EC 3E 00        	ld a, 0
4477  12EE              ; 185     setSDAI2C();
4478  12EE CD 4F 12     	call setsdai2c
4479  12F1              ; 186     pulseNewI2C();
4480  12F1 CD 58 12     	call pulsenewi2c
4481  12F4              ; 187     pulseNewI2C();
4482  12F4 CD 58 12     	call pulsenewi2c
4483  12F7              ; 188     pulseNewI2C();
4484  12F7 CD 58 12     	call pulsenewi2c
4485  12FA              ; 189     pulseNewI2C();
4486  12FA CD 58 12     	call pulsenewi2c
4487  12FD              ; 190     pulseNewI2C();
4488  12FD CD 58 12     	call pulsenewi2c
4489  1300              ; 191     pulseNewI2C();
4490  1300 CD 58 12     	call pulsenewi2c
4491  1303              ; 192     pulseNewI2C();
4492  1303 CD 58 12     	call pulsenewi2c
4493  1306              ; 193     pulseNewI2C();
4494  1306 CD 58 12     	call pulsenewi2c
4495  1309              ; 194     pulseNewI2C();
4496  1309 CD 58 12     	call pulsenewi2c
4497  130C              ; 195     stopI2C();
4498  130C C3 3B 12     	jp stopi2c
4499  130F              ; 11 uint8_t I2C_CURRETN_VALUE = 0x00;
4500  130F              i2c_curretn_value:
4501  130F 00           	db 0
4502  1310              ; 12 uint8_t CHIP_ADDRESS = 0x12;
4503  1310              chip_address:
4504  1310 12           	db 18
4505  1311              ; 14 void sendCommand() {
4506  1311              sendcommand:
4507  1311              ; 15     push_pop(de) {
4508  1311 D5           	push de
4509  1312              ; 16         d = h;
4510  1312 54           	ld d, h
4511  1313              ; 17         // form the slave address with the R/W bit (R=1, W=0) at LSB
4512  1313              ; 18         a ^= a; // XRA     A Carry = 0
4513  1313 AF           	xor a
4514  1314              ; 19         a = CHIP_ADDRESS;
4515  1314 3A 10 13     	ld a, (chip_address)
4516  1317              ; 20         carry_rotate_left(a, 1); // shift address left, set R/W bit to 0 (write)
4517  1317 17           	rla
4518  1318              ; 21         h = a;
4519  1318 67           	ld h, a
4520  1319              ; 22
4521  1319              ; 23         startI2C();
4522  1319 CD 27 12     	call starti2c
4523  131C              ; 24         c = h;
4524  131C 4C           	ld c, h
4525  131D              ; 25         transmitNewI2C(); // Адрес и направление
4526  131D CD 70 12     	call transmitnewi2c
4527  1320              ; 26
4528  1320              ; 27         c = l;
4529  1320 4D           	ld c, l
4530  1321              ; 28         transmitNewI2C(); // Комманда
4531  1321 CD 70 12     	call transmitnewi2c
4532  1324              ; 29
4533  1324              ; 30         // Отправляемые данные
4534  1324              ; 31         if ((a = d) > 0) {
4535  1324 7A           	ld a, d
4536  1325 B7           	or a
4537  1326 CA 37 13     	jp z, l_314
4538  1329              ; 32             h = d;
4539  1329 62           	ld h, d
4540  132A              ; 33             de = ESP_I2S_BUFFER;
4541  132A 11 77 13     	ld de, esp_i2s_buffer
4542  132D              ; 34             do {
4543  132D              l_316:
4544  132D              ; 35                 a = *de;
4545  132D 1A           	ld a, (de)
4546  132E              ; 36                 de++;
4547  132E 13           	inc de
4548  132F              ; 37                 c = a;
4549  132F 4F           	ld c, a
4550  1330              ; 38                 transmitNewI2C();
4551  1330 CD 70 12     	call transmitnewi2c
4552  1333              ; 39                 h--;
4553  1333 25           	dec h
4554  1334              l_317:
4555  1334 C2 2D 13     	jp nz, l_316
4556  1337              l_314:
4557  1337              ; 40             } while(flag_nz);
4558  1337              ; 41         }
4559  1337              ; 42
4560  1337              ; 43         // Конец отправки
4561  1337              ; 44         stopI2C();
4562  1337 CD 3B 12     	call stopi2c
4563  133A D1           	pop de
4564  133B C9           	ret
4565  133C              ; 45     }
4566  133C              ; 46 }
4567  133C              ; 47
4568  133C              ; 48 /// вх. [L] - Кол-во считываемых байт
4569  133C              ; 49 void readNewInBuffer() {
4570  133C              readnewinbuffer:
4571  133C              ; 50     push_pop(hl) {
4572  133C E5           	push hl
4573  133D              ; 51         push_pop(de) {
4574  133D D5           	push de
4575  133E              ; 52             a ^= a; // XRA
4576  133E AF           	xor a
4577  133F              ; 53             a = CHIP_ADDRESS;
4578  133F 3A 10 13     	ld a, (chip_address)
4579  1342              ; 54             carry_rotate_left(a, 1);
4580  1342 17           	rla
4581  1343              ; 55             a += 1;
4582  1343 C6 01        	add 1
4583  1345              ; 56             h = a;
4584  1345 67           	ld h, a
4585  1346              ; 57             //
4586  1346              ; 58             startI2C();
4587  1346 CD 27 12     	call starti2c
4588  1349              ; 59             c = h;
4589  1349 4C           	ld c, h
4590  134A              ; 60             transmitNewI2C();
4591  134A CD 70 12     	call transmitnewi2c
4592  134D              ; 61
4593  134D              ; 62             i2cWaitingForAccess();
4594  134D CD CA 12     	call i2cwaitingforaccess
4595  1350              ; 63
4596  1350              ; 64             //l = 20;
4597  1350              ; 65             de = ESP_I2S_BUFFER;
4598  1350 11 77 13     	ld de, esp_i2s_buffer
4599  1353              ; 66             do {
4600  1353              l_319:
4601  1353              ; 67                 push_pop(bc) {
4602  1353 C5           	push bc
4603  1354              ; 68                     // Если последний ожидаемый байт - то передаем NACK
4604  1354              ; 69                     if ((a = l) == 1) {
4605  1354 7D           	ld a, l
4606  1355 FE 01        	cp 1
4607  1357 C2 5F 13     	jp nz, l_322
4608  135A              ; 70                         b = 0x01;
4609  135A 06 01        	ld b, 1
4610  135C C3 61 13     	jp l_323
4611  135F              l_322:
4612  135F              ; 71                     } else {
4613  135F              ; 72                         b = 0x00;
4614  135F 06 00        	ld b, 0
4615  1361              l_323:
4616  1361              ; 73                     }
4617  1361              ; 74                     recieveNewI2C();
4618  1361 CD 97 12     	call recievenewi2c
4619  1364              ; 75 //                    if ((a = b) == 0x01) {
4620  1364              ; 76 //                        l = 1;
4621  1364              ; 77 //                    }
4622  1364              ; 78                     a = c;
4623  1364 79           	ld a, c
4624  1365 C1           	pop bc
4625  1366              ; 79                 }
4626  1366              ; 80                 *de = a;
4627  1366 12           	ld (de), a
4628  1367              ; 81                 de++;
4629  1367 13           	inc de
4630  1368              ; 82                 l--;
4631  1368 2D           	dec l
4632  1369              l_320:
4633  1369              ; 83             } while ((a = l) > 0);
4634  1369 7D           	ld a, l
4635  136A B7           	or a
4636  136B C2 53 13     	jp nz, l_319
4637  136E              ; 84             a = 0; // stop byte
4638  136E 3E 00        	ld a, 0
4639  1370              ; 85             *de = a;
4640  1370 12           	ld (de), a
4641  1371              ; 86             //
4642  1371              ; 87             stopI2C();
4643  1371 CD 3B 12     	call stopi2c
4644  1374 D1           	pop de
4645  1375 E1           	pop hl
4646  1376 C9           	ret
4647  1377              ; 88         }
4648  1377              ; 89     }
4649  1377              ; 90 }
4650  1377              ; 91
4651  1377              ; 92 uint8_t ESP_I2S_BUFFER[32];
4652  1377              esp_i2s_buffer:
4653  1377 00 00 00...  	ds 32
4654  1397              ; 12 void getSSIDList() {
4655  1397              getssidlist:
4656  1397              ; 13     // Получить ответ
4657  1397              ; 14     // Ответ ESP_I2S_BUFFER
4658  1397              ; 15     // SSIDList буфер заполнения
4659  1397              ; 16     push_pop(bc) {
4660  1397 C5           	push bc
4661  1398              ; 17         do {
4662  1398              l_324:
4663  1398              ; 18             //
4664  1398              ; 19             delay5msI2C();
4665  1398 CD DD 12     	call delay5msi2c
4666  139B              ; 20             i2cWaitingForAccess();
4667  139B CD CA 12     	call i2cwaitingforaccess
4668  139E              ; 21             l = 5;
4669  139E 2E 05        	ld l, 5
4670  13A0              ; 22             h = 0;
4671  13A0 26 00        	ld h, 0
4672  13A2              ; 23             sendCommand();
4673  13A2 CD 11 13     	call sendcommand
4674  13A5              ; 24             //
4675  13A5              ; 25             delay5msI2C();
4676  13A5 CD DD 12     	call delay5msi2c
4677  13A8              ; 26             i2cWaitingForAccess();
4678  13A8 CD CA 12     	call i2cwaitingforaccess
4679  13AB              ; 27             l = 22;
4680  13AB 2E 16        	ld l, 22
4681  13AD              ; 28             readNewInBuffer();
4682  13AD CD 3C 13     	call readnewinbuffer
4683  13B0              ; 29             push_pop(a) {
4684  13B0 F5           	push af
4685  13B1              ; 30                 push_pop(de) {
4686  13B1 D5           	push de
4687  13B2              ; 31                     push_pop(hl) {
4688  13B2 E5           	push hl
4689  13B3              ; 32                         de = ESP_I2S_BUFFER;
4690  13B3 11 77 13     	ld de, esp_i2s_buffer
4691  13B6              ; 33                         a = *de; // позиция
4692  13B6 1A           	ld a, (de)
4693  13B7              ; 34                         carry_rotate_left(a, 4);
4694  13B7 17           	rla
4695  13B8 17           	rla
4696  13B9 17           	rla
4697  13BA 17           	rla
4698  13BB              ; 35                         c = a;
4699  13BB 4F           	ld c, a
4700  13BC              ; 36                         // смещаем адрес буфера на 16 * на позицию
4701  13BC              ; 37                         b = 0;
4702  13BC 06 00        	ld b, 0
4703  13BE              ; 38                         hl = SSIDList;
4704  13BE 21 18 11     	ld hl, ssidlist
4705  13C1              ; 39                         hl += bc;
4706  13C1 09           	add hl, bc
4707  13C2              ; 40                         //
4708  13C2              ; 41                         de++;
4709  13C2 13           	inc de
4710  13C3              ; 42                         a = *de; // flag
4711  13C3 1A           	ld a, (de)
4712  13C4              ; 43                         SSIDListNext = a;
4713  13C4 32 17 11     	ld (ssidlistnext), a
4714  13C7              ; 44                         de++;
4715  13C7 13           	inc de
4716  13C8              ; 45                         // copy 16 byte
4717  13C8              ; 46                         b = 16;
4718  13C8 06 10        	ld b, 16
4719  13CA              ; 47                         do {
4720  13CA              l_327:
4721  13CA              ; 48                             a = *de;
4722  13CA 1A           	ld a, (de)
4723  13CB              ; 49                             *hl = a;
4724  13CB 77           	ld (hl), a
4725  13CC              ; 50                             de++;
4726  13CC 13           	inc de
4727  13CD              ; 51                             hl++;
4728  13CD 23           	inc hl
4729  13CE              ; 52                             b--;
4730  13CE 05           	dec b
4731  13CF              l_328:
4732  13CF C2 CA 13     	jp nz, l_327
4733  13D2 E1           	pop hl
4734  13D3 D1           	pop de
4735  13D4 F1           	pop af
4736  13D5              ; 53                         } while (flag_nz);
4737  13D5              ; 54                     }
4738  13D5              ; 55                 }
4739  13D5              ; 56             }
4740  13D5              ; 57             a = SSIDListNext;
4741  13D5 3A 17 11     	ld a, (ssidlistnext)
4742  13D8              l_325:
4743  13D8              ; 58         } while (a != 0);
4744  13D8 B7           	or a
4745  13D9 C2 98 13     	jp nz, l_324
4746  13DC C1           	pop bc
4747  13DD C9           	ret
4748  13DE              ; 59     }
4749  13DE              ; 60 }
4750  13DE              ; 61
4751  13DE              ; 62 /// Получить текущее имя сети
4752  13DE              ; 63 void getSSIDValue() {
4753  13DE              getssidvalue:
4754  13DE              ; 64     push_pop(hl) {
4755  13DE E5           	push hl
4756  13DF              ; 65         push_pop(de) {
4757  13DF D5           	push de
4758  13E0              ; 66             push_pop(bc) {
4759  13E0 C5           	push bc
4760  13E1              ; 67                 delay5msI2C();
4761  13E1 CD DD 12     	call delay5msi2c
4762  13E4              ; 68                 i2cWaitingForAccess();
4763  13E4 CD CA 12     	call i2cwaitingforaccess
4764  13E7              ; 69                 l = 6;
4765  13E7 2E 06        	ld l, 6
4766  13E9              ; 70                 h = 0;
4767  13E9 26 00        	ld h, 0
4768  13EB              ; 71                 sendCommand();
4769  13EB CD 11 13     	call sendcommand
4770  13EE              ; 72
4771  13EE              ; 73                 delay5msI2C();
4772  13EE CD DD 12     	call delay5msi2c
4773  13F1              ; 74
4774  13F1              ; 75                 i2cWaitingForAccess();
4775  13F1 CD CA 12     	call i2cwaitingforaccess
4776  13F4              ; 76                 l = 26;
4777  13F4 2E 1A        	ld l, 26
4778  13F6              ; 77                 readNewInBuffer();
4779  13F6 CD 3C 13     	call readnewinbuffer
4780  13F9              ; 78
4781  13F9              ; 79                 de = ESP_I2S_BUFFER;
4782  13F9 11 77 13     	ld de, esp_i2s_buffer
4783  13FC              ; 80                 hl = wifiSettingsSsidVal;
4784  13FC 21 11 0D     	ld hl, wifisettingsssidval
4785  13FF              ; 81                 b = 16;
4786  13FF 06 10        	ld b, 16
4787  1401              ; 82                 do {
4788  1401              l_330:
4789  1401              ; 83                     a = *de;
4790  1401 1A           	ld a, (de)
4791  1402              ; 84                     *hl = a;
4792  1402 77           	ld (hl), a
4793  1403              ; 85                     de++;
4794  1403 13           	inc de
4795  1404              ; 86                     hl++;
4796  1404 23           	inc hl
4797  1405              ; 87                     b--;
4798  1405 05           	dec b
4799  1406              l_331:
4800  1406 C2 01 14     	jp nz, l_330
4801  1409 C1           	pop bc
4802  140A D1           	pop de
4803  140B E1           	pop hl
4804  140C C9           	ret
4805  140D              ; 88                 } while (flag_nz);
4806  140D              ; 89             }
4807  140D              ; 90         }
4808  140D              ; 91     }
4809  140D              ; 92 }
4810  140D              ; 93
4811  140D              ; 94 /// Получить пароль wifi
4812  140D              ; 95 void getSSIDPasswordValue() {
4813  140D              getssidpasswordvalue:
4814  140D              ; 96     push_pop(hl) {
4815  140D E5           	push hl
4816  140E              ; 97         push_pop(de) {
4817  140E D5           	push de
4818  140F              ; 98             push_pop(bc) {
4819  140F C5           	push bc
4820  1410              ; 99                 delay5msI2C();
4821  1410 CD DD 12     	call delay5msi2c
4822  1413              ; 100                 i2cWaitingForAccess();
4823  1413 CD CA 12     	call i2cwaitingforaccess
4824  1416              ; 101                 l = 8;
4825  1416 2E 08        	ld l, 8
4826  1418              ; 102                 h = 0;
4827  1418 26 00        	ld h, 0
4828  141A              ; 103                 sendCommand();
4829  141A CD 11 13     	call sendcommand
4830  141D              ; 104
4831  141D              ; 105                 delay5msI2C();
4832  141D CD DD 12     	call delay5msi2c
4833  1420              ; 106
4834  1420              ; 107                 i2cWaitingForAccess();
4835  1420 CD CA 12     	call i2cwaitingforaccess
4836  1423              ; 108                 l = 26;
4837  1423 2E 1A        	ld l, 26
4838  1425              ; 109                 readNewInBuffer();
4839  1425 CD 3C 13     	call readnewinbuffer
4840  1428              ; 110
4841  1428              ; 111                 de = ESP_I2S_BUFFER;
4842  1428 11 77 13     	ld de, esp_i2s_buffer
4843  142B              ; 112                 hl = wifiSettingsEditViewSSIDPasswordVal;
4844  142B 21 D5 10     	ld hl, wifisettingseditviewssidpassword_3
4845  142E              ; 113                 b = 16;
4846  142E 06 10        	ld b, 16
4847  1430              ; 114                 do {
4848  1430              l_333:
4849  1430              ; 115                     a = *de;
4850  1430 1A           	ld a, (de)
4851  1431              ; 116                     if(a==0xFF){
4852  1431 FE FF        	cp 255
4853  1433 C2 38 14     	jp nz, l_336
4854  1436              ; 117                         a = 0x00;
4855  1436 3E 00        	ld a, 0
4856  1438              l_336:
4857  1438              ; 118                     }
4858  1438              ; 119                     *hl = a;
4859  1438 77           	ld (hl), a
4860  1439              ; 120                     de++;
4861  1439 13           	inc de
4862  143A              ; 121                     hl++;
4863  143A 23           	inc hl
4864  143B              ; 122                     b--;
4865  143B 05           	dec b
4866  143C              l_334:
4867  143C C2 30 14     	jp nz, l_333
4868  143F C1           	pop bc
4869  1440 D1           	pop de
4870  1441 E1           	pop hl
4871  1442 C9           	ret
4872  1443              ; 123                 } while (flag_nz);
4873  1443              ; 124             }
4874  1443              ; 125         }
4875  1443              ; 126     }
4876  1443              ; 127 }
4877  1443              ; 128
4878  1443              ; 129 /// Отправить пароль wifi
4879  1443              ; 130 void setSSIDPasswordValue() {
4880  1443              setssidpasswordvalue:
4881  1443              ; 131     push_pop(hl) {
4882  1443 E5           	push hl
4883  1444              ; 132         push_pop(de) {
4884  1444 D5           	push de
4885  1445              ; 133             push_pop(bc) {
4886  1445 C5           	push bc
4887  1446              ; 134                 de = wifiSettingsEditViewSSIDPasswordVal;
4888  1446 11 D5 10     	ld de, wifisettingseditviewssidpassword_3
4889  1449              ; 135                 hl = ESP_I2S_BUFFER;
4890  1449 21 77 13     	ld hl, esp_i2s_buffer
4891  144C              ; 136                 b = 16;
4892  144C 06 10        	ld b, 16
4893  144E              ; 137                 c = 0;
4894  144E 0E 00        	ld c, 0
4895  1450              ; 138                 do {
4896  1450              l_338:
4897  1450              ; 139                     a = *de;
4898  1450 1A           	ld a, (de)
4899  1451              ; 140                     if ((a = c) == 1) {
4900  1451 79           	ld a, c
4901  1452 FE 01        	cp 1
4902  1454 C2 5C 14     	jp nz, l_341
4903  1457              ; 141                         a = 0xFF;
4904  1457 3E FF        	ld a, 255
4905  1459 C3 65 14     	jp l_342
4906  145C              l_341:
4907  145C              ; 142                     } else if((a = *de) == 0) {
4908  145C 1A           	ld a, (de)
4909  145D B7           	or a
4910  145E C2 65 14     	jp nz, l_343
4911  1461              ; 143                         c = 1;
4912  1461 0E 01        	ld c, 1
4913  1463              ; 144                         a = 0x00;
4914  1463 3E 00        	ld a, 0
4915  1465              l_343:
4916  1465              l_342:
4917  1465              ; 145                     }
4918  1465              ; 146                     *hl = a;
4919  1465 77           	ld (hl), a
4920  1466              ; 147                     de++;
4921  1466 13           	inc de
4922  1467              ; 148                     hl++;
4923  1467 23           	inc hl
4924  1468              ; 149                     b--;
4925  1468 05           	dec b
4926  1469              l_339:
4927  1469 C2 50 14     	jp nz, l_338
4928  146C              ; 150                 } while (flag_nz);
4929  146C              ; 151
4930  146C              ; 152                 delay5msI2C();
4931  146C CD DD 12     	call delay5msi2c
4932  146F              ; 153                 i2cWaitingForAccess();
4933  146F CD CA 12     	call i2cwaitingforaccess
4934  1472              ; 154                 l = 9;
4935  1472 2E 09        	ld l, 9
4936  1474              ; 155                 h = 16;
4937  1474 26 10        	ld h, 16
4938  1476              ; 156                 sendCommand();
4939  1476 CD 11 13     	call sendcommand
4940  1479 C1           	pop bc
4941  147A D1           	pop de
4942  147B E1           	pop hl
4943  147C C9           	ret
4944  147D              ; 157             }
4945  147D              ; 158         }
4946  147D              ; 159     }
4947  147D              ; 160 }
4948  147D              ; 161
4949  147D              ; 162 /// Подключиться в WiFi
4950  147D              ; 163 void needSsidConnect() {
4951  147D              needssidconnect:
4952  147D              ; 164     push_pop(hl) {
4953  147D E5           	push hl
4954  147E              ; 165         delay5msI2C();
4955  147E CD DD 12     	call delay5msi2c
4956  1481              ; 166         i2cWaitingForAccess();
4957  1481 CD CA 12     	call i2cwaitingforaccess
4958  1484              ; 167         l = 10;
4959  1484 2E 0A        	ld l, 10
4960  1486              ; 168         h = 0;
4961  1486 26 00        	ld h, 0
4962  1488              ; 169         sendCommand();
4963  1488 CD 11 13     	call sendcommand
4964  148B E1           	pop hl
4965  148C C9           	ret
4966  148D              ; 170     }
4967  148D              ; 171 }
4968  148D              ; 172
4969  148D              ; 173 /// Запросить обновление списка сетей
4970  148D              ; 174 void needUpdateSSIDList() {
4971  148D              needupdatessidlist:
4972  148D              ; 175     push_pop(hl) {
4973  148D E5           	push hl
4974  148E              ; 176         delay5msI2C();
4975  148E CD DD 12     	call delay5msi2c
4976  1491              ; 177         i2cWaitingForAccess();
4977  1491 CD CA 12     	call i2cwaitingforaccess
4978  1494              ; 178         l = 4;
4979  1494 2E 04        	ld l, 4
4980  1496              ; 179         h = 0;
4981  1496 26 00        	ld h, 0
4982  1498              ; 180         sendCommand();
4983  1498 CD 11 13     	call sendcommand
4984  149B E1           	pop hl
4985  149C C9           	ret
4986  149D              ; 181     }
4987  149D              ; 182 }
4988  149D              ; 183
4989  149D              ; 184 /// Установить имя сети по номеру в списке
4990  149D              ; 185 /// вх. [A] - номер сети
4991  149D              ; 186 void setSSIDNumberA() {
4992  149D              setssidnumbera:
4993  149D              ; 187     push_pop(de) {
4994  149D D5           	push de
4995  149E              ; 188         push_pop(hl) {
4996  149E E5           	push hl
4997  149F              ; 189             de = ESP_I2S_BUFFER;
4998  149F 11 77 13     	ld de, esp_i2s_buffer
4999  14A2              ; 190             *de = a;
5000  14A2 12           	ld (de), a
5001  14A3              ; 191             //
5002  14A3              ; 192             delay5msI2C();
5003  14A3 CD DD 12     	call delay5msi2c
5004  14A6              ; 193             i2cWaitingForAccess();
5005  14A6 CD CA 12     	call i2cwaitingforaccess
5006  14A9              ; 194             //
5007  14A9              ; 195             l = 7; // SET_SSID
5008  14A9 2E 07        	ld l, 7
5009  14AB              ; 196             h = 1; // 1 байт
5010  14AB 26 01        	ld h, 1
5011  14AD              ; 197             sendCommand();
5012  14AD CD 11 13     	call sendcommand
5013  14B0 E1           	pop hl
5014  14B1 D1           	pop de
5015  14B2 C9           	ret
5016  14B3              ; 198         }
5017  14B3              ; 199     }
5018  14B3              ; 200 }
5019  14B3              ; 201
5020  14B3              ; 202 /// Получить IP_Address
5021  14B3              ; 203 void getSSIDIPAddress() {
5022  14B3              getssidipaddress:
5023  14B3              ; 204     push_pop(hl) {
5024  14B3 E5           	push hl
5025  14B4              ; 205         push_pop(de) {
5026  14B4 D5           	push de
5027  14B5              ; 206             push_pop(bc) {
5028  14B5 C5           	push bc
5029  14B6              ; 207                 delay5msI2C();
5030  14B6 CD DD 12     	call delay5msi2c
5031  14B9              ; 208                 i2cWaitingForAccess();
5032  14B9 CD CA 12     	call i2cwaitingforaccess
5033  14BC              ; 209                 l = 12;
5034  14BC 2E 0C        	ld l, 12
5035  14BE              ; 210                 h = 0;
5036  14BE 26 00        	ld h, 0
5037  14C0              ; 211                 sendCommand();
5038  14C0 CD 11 13     	call sendcommand
5039  14C3              ; 212                 //
5040  14C3              ; 213                 delay5msI2C();
5041  14C3 CD DD 12     	call delay5msi2c
5042  14C6              ; 214                 i2cWaitingForAccess();
5043  14C6 CD CA 12     	call i2cwaitingforaccess
5044  14C9              ; 215                 l = 26;
5045  14C9 2E 1A        	ld l, 26
5046  14CB              ; 216                 readNewInBuffer();
5047  14CB CD 3C 13     	call readnewinbuffer
5048  14CE              ; 217                 //
5049  14CE              ; 218                 de = ESP_I2S_BUFFER;
5050  14CE 11 77 13     	ld de, esp_i2s_buffer
5051  14D1              ; 219                 hl = wifiSettingsIpVal;
5052  14D1 21 23 0D     	ld hl, wifisettingsipval
5053  14D4              ; 220                 b = 16;
5054  14D4 06 10        	ld b, 16
5055  14D6              ; 221                 do {
5056  14D6              l_345:
5057  14D6              ; 222                     a = *de;
5058  14D6 1A           	ld a, (de)
5059  14D7              ; 223                     if(a==0xFF){
5060  14D7 FE FF        	cp 255
5061  14D9 C2 DE 14     	jp nz, l_348
5062  14DC              ; 224                         a = 0x00;
5063  14DC 3E 00        	ld a, 0
5064  14DE              l_348:
5065  14DE              ; 225                     }
5066  14DE              ; 226                     *hl = a;
5067  14DE 77           	ld (hl), a
5068  14DF              ; 227                     de++;
5069  14DF 13           	inc de
5070  14E0              ; 228                     hl++;
5071  14E0 23           	inc hl
5072  14E1              ; 229                     b--;
5073  14E1 05           	dec b
5074  14E2              l_346:
5075  14E2 C2 D6 14     	jp nz, l_345
5076  14E5 C1           	pop bc
5077  14E6 D1           	pop de
5078  14E7 E1           	pop hl
5079  14E8 C9           	ret
5080  14E9              ; 230                 } while (flag_nz);
5081  14E9              ; 231             }
5082  14E9              ; 232         }
5083  14E9              ; 233     }
5084  14E9              ; 234 }
5085  14E9              ; 235
5086  14E9              ; 236 /// Получить MAC_Address
5087  14E9              ; 237 void getSSIDMacAddress() {
5088  14E9              getssidmacaddress:
5089  14E9              ; 238     push_pop(hl) {
5090  14E9 E5           	push hl
5091  14EA              ; 239         push_pop(de) {
5092  14EA D5           	push de
5093  14EB              ; 240             push_pop(bc) {
5094  14EB C5           	push bc
5095  14EC              ; 241                 delay5msI2C();
5096  14EC CD DD 12     	call delay5msi2c
5097  14EF              ; 242                 i2cWaitingForAccess();
5098  14EF CD CA 12     	call i2cwaitingforaccess
5099  14F2              ; 243                 l = 13;
5100  14F2 2E 0D        	ld l, 13
5101  14F4              ; 244                 h = 0;
5102  14F4 26 00        	ld h, 0
5103  14F6              ; 245                 sendCommand();
5104  14F6 CD 11 13     	call sendcommand
5105  14F9              ; 246                 //
5106  14F9              ; 247                 delay5msI2C();
5107  14F9 CD DD 12     	call delay5msi2c
5108  14FC              ; 248                 i2cWaitingForAccess();
5109  14FC CD CA 12     	call i2cwaitingforaccess
5110  14FF              ; 249                 l = 26;
5111  14FF 2E 1A        	ld l, 26
5112  1501              ; 250                 readNewInBuffer();
5113  1501 CD 3C 13     	call readnewinbuffer
5114  1504              ; 251                 //
5115  1504              ; 252                 de = ESP_I2S_BUFFER;
5116  1504 11 77 13     	ld de, esp_i2s_buffer
5117  1507              ; 253                 hl = wifiSettingsMacVal;
5118  1507 21 35 0D     	ld hl, wifisettingsmacval
5119  150A              ; 254                 b = 18;
5120  150A 06 12        	ld b, 18
5121  150C              ; 255                 do {
5122  150C              l_350:
5123  150C              ; 256                     a = *de;
5124  150C 1A           	ld a, (de)
5125  150D              ; 257                     if(a==0xFF){
5126  150D FE FF        	cp 255
5127  150F C2 14 15     	jp nz, l_353
5128  1512              ; 258                         a = 0x00;
5129  1512 3E 00        	ld a, 0
5130  1514              l_353:
5131  1514              ; 259                     }
5132  1514              ; 260                     *hl = a;
5133  1514 77           	ld (hl), a
5134  1515              ; 261                     de++;
5135  1515 13           	inc de
5136  1516              ; 262                     hl++;
5137  1516 23           	inc hl
5138  1517              ; 263                     b--;
5139  1517 05           	dec b
5140  1518              l_351:
5141  1518 C2 0C 15     	jp nz, l_350
5142  151B C1           	pop bc
5143  151C D1           	pop de
5144  151D E1           	pop hl
5145  151E C9           	ret
5146  151F              ; 264                 } while (flag_nz);
5147  151F              ; 265             }
5148  151F              ; 266         }
5149  151F              ; 267     }
5150  151F              ; 268 }
5151  151F              ; 269
5152  151F              ; 270 /// Получить STATE_SSID
5153  151F              ; 271 void getSSIDState() {
5154  151F              getssidstate:
5155  151F              ; 272     push_pop(hl) {
5156  151F E5           	push hl
5157  1520              ; 273         push_pop(de) {
5158  1520 D5           	push de
5159  1521              ; 274             push_pop(bc) {
5160  1521 C5           	push bc
5161  1522              ; 275                 delay5msI2C();
5162  1522 CD DD 12     	call delay5msi2c
5163  1525              ; 276                 i2cWaitingForAccess();
5164  1525 CD CA 12     	call i2cwaitingforaccess
5165  1528              ; 277                 l = 11;
5166  1528 2E 0B        	ld l, 11
5167  152A              ; 278                 h = 0;
5168  152A 26 00        	ld h, 0
5169  152C              ; 279                 sendCommand();
5170  152C CD 11 13     	call sendcommand
5171  152F              ; 280                 //
5172  152F              ; 281                 delay5msI2C();
5173  152F CD DD 12     	call delay5msi2c
5174  1532              ; 282                 i2cWaitingForAccess();
5175  1532 CD CA 12     	call i2cwaitingforaccess
5176  1535              ; 283                 l = 4;
5177  1535 2E 04        	ld l, 4
5178  1537              ; 284                 readNewInBuffer();
5179  1537 CD 3C 13     	call readnewinbuffer
5180  153A              ; 285                 //
5181  153A              ; 286                 a = WiFiState;
5182  153A 3A 01 11     	ld a, (wifistate)
5183  153D              ; 287                 h = a;
5184  153D 67           	ld h, a
5185  153E              ; 288                 de = ESP_I2S_BUFFER;
5186  153E 11 77 13     	ld de, esp_i2s_buffer
5187  1541              ; 289                 a = *de;
5188  1541 1A           	ld a, (de)
5189  1542              ; 290                 a &= 0x01;
5190  1542 E6 01        	and 1
5191  1544              ; 291                 WiFiState = a;
5192  1544 32 01 11     	ld (wifistate), a
5193  1547              ; 292                 if(a != h){
5194  1547 BC           	cp h
5195  1548 CA 50 15     	jp z, l_355
5196  154B              ; 293                     a = 0x01;
5197  154B 3E 01        	ld a, 1
5198  154D              ; 294                     WiFiStateUpdate = a;
5199  154D 32 02 11     	ld (wifistateupdate), a
5200  1550              l_355:
5201  1550 C1           	pop bc
5202  1551 D1           	pop de
5203  1552 E1           	pop hl
5204  1553 C9           	ret
5205  1554              ; 295                 }
5206  1554              ; 296             }
5207  1554              ; 297         }
5208  1554              ; 298     }
5209  1554              ; 299 }
5210  1554              ; 300
5211  1554              ; 301 /// FTP
5212  1554              ; 302
5213  1554              ; 303 /// Получить FTP URL
5214  1554              ; 304 void getFTPUrl() {
5215  1554              getftpurl:
5216  1554              ; 305     push_pop(hl) {
5217  1554 E5           	push hl
5218  1555              ; 306         push_pop(de) {
5219  1555 D5           	push de
5220  1556              ; 307             push_pop(bc) {
5221  1556 C5           	push bc
5222  1557              ; 308                 delay5msI2C();
5223  1557 CD DD 12     	call delay5msi2c
5224  155A              ; 309                 i2cWaitingForAccess();
5225  155A CD CA 12     	call i2cwaitingforaccess
5226  155D              ; 310                 l = 2;
5227  155D 2E 02        	ld l, 2
5228  155F              ; 311                 h = 0;
5229  155F 26 00        	ld h, 0
5230  1561              ; 312                 sendCommand();
5231  1561 CD 11 13     	call sendcommand
5232  1564              ; 313                 //
5233  1564              ; 314                 delay5msI2C();
5234  1564 CD DD 12     	call delay5msi2c
5235  1567              ; 315                 i2cWaitingForAccess();
5236  1567 CD CA 12     	call i2cwaitingforaccess
5237  156A              ; 316                 l = 26;
5238  156A 2E 1A        	ld l, 26
5239  156C              ; 317                 readNewInBuffer();
5240  156C CD 3C 13     	call readnewinbuffer
5241  156F              ; 318                 //
5242  156F              ; 319                 de = ESP_I2S_BUFFER;
5243  156F 11 77 13     	ld de, esp_i2s_buffer
5244  1572              ; 320                 hl = ftpSettingsIpValue;
5245  1572 21 90 0D     	ld hl, ftpsettingsipvalue
5246  1575              ; 321                 b = 16;
5247  1575 06 10        	ld b, 16
5248  1577              ; 322                 do {
5249  1577              l_357:
5250  1577              ; 323                     a = *de;
5251  1577 1A           	ld a, (de)
5252  1578              ; 324                     if(a==0xFF){
5253  1578 FE FF        	cp 255
5254  157A C2 7F 15     	jp nz, l_360
5255  157D              ; 325                         a = 0x00;
5256  157D 3E 00        	ld a, 0
5257  157F              l_360:
5258  157F              ; 326                     }
5259  157F              ; 327                     *hl = a;
5260  157F 77           	ld (hl), a
5261  1580              ; 328                     de++;
5262  1580 13           	inc de
5263  1581              ; 329                     hl++;
5264  1581 23           	inc hl
5265  1582              ; 330                     b--;
5266  1582 05           	dec b
5267  1583              l_358:
5268  1583 C2 77 15     	jp nz, l_357
5269  1586 C1           	pop bc
5270  1587 D1           	pop de
5271  1588 E1           	pop hl
5272  1589 C9           	ret
5273  158A              ; 331                 } while (flag_nz);
5274  158A              ; 332             }
5275  158A              ; 333         }
5276  158A              ; 334     }
5277  158A              ; 335 }
5278  158A              ; 336
5279  158A              ; 337 /// Отправить FTP URL
5280  158A              ; 338 void setFTPUrl() {
5281  158A              setftpurl:
5282  158A              ; 339     push_pop(hl) {
5283  158A E5           	push hl
5284  158B              ; 340         push_pop(de) {
5285  158B D5           	push de
5286  158C              ; 341             push_pop(bc) {
5287  158C C5           	push bc
5288  158D              ; 342                 de = ftpSettingsIpValue;
5289  158D 11 90 0D     	ld de, ftpsettingsipvalue
5290  1590              ; 343                 hl = ESP_I2S_BUFFER;
5291  1590 21 77 13     	ld hl, esp_i2s_buffer
5292  1593              ; 344                 b = 16;
5293  1593 06 10        	ld b, 16
5294  1595              ; 345                 c = 0;
5295  1595 0E 00        	ld c, 0
5296  1597              ; 346                 do {
5297  1597              l_362:
5298  1597              ; 347                     a = *de;
5299  1597 1A           	ld a, (de)
5300  1598              ; 348                     if ((a = c) == 1) {
5301  1598 79           	ld a, c
5302  1599 FE 01        	cp 1
5303  159B C2 A3 15     	jp nz, l_365
5304  159E              ; 349                         a = 0xFF;
5305  159E 3E FF        	ld a, 255
5306  15A0 C3 AC 15     	jp l_366
5307  15A3              l_365:
5308  15A3              ; 350                     } else if((a = *de) == 0) {
5309  15A3 1A           	ld a, (de)
5310  15A4 B7           	or a
5311  15A5 C2 AC 15     	jp nz, l_367
5312  15A8              ; 351                         c = 1;
5313  15A8 0E 01        	ld c, 1
5314  15AA              ; 352                         a = 0x00;
5315  15AA 3E 00        	ld a, 0
5316  15AC              l_367:
5317  15AC              l_366:
5318  15AC              ; 353                     }
5319  15AC              ; 354                     *hl = a;
5320  15AC 77           	ld (hl), a
5321  15AD              ; 355                     de++;
5322  15AD 13           	inc de
5323  15AE              ; 356                     hl++;
5324  15AE 23           	inc hl
5325  15AF              ; 357                     b--;
5326  15AF 05           	dec b
5327  15B0              l_363:
5328  15B0 C2 97 15     	jp nz, l_362
5329  15B3              ; 358                 } while (flag_nz);
5330  15B3              ; 359
5331  15B3              ; 360                 delay5msI2C();
5332  15B3 CD DD 12     	call delay5msi2c
5333  15B6              ; 361                 i2cWaitingForAccess();
5334  15B6 CD CA 12     	call i2cwaitingforaccess
5335  15B9              ; 362                 l = 3;
5336  15B9 2E 03        	ld l, 3
5337  15BB              ; 363                 h = 16;
5338  15BB 26 10        	ld h, 16
5339  15BD              ; 364                 sendCommand();
5340  15BD CD 11 13     	call sendcommand
5341  15C0 C1           	pop bc
5342  15C1 D1           	pop de
5343  15C2 E1           	pop hl
5344  15C3 C9           	ret
5345  15C4              ; 365             }
5346  15C4              ; 366         }
5347  15C4              ; 367     }
5348  15C4              ; 368 }
5349  15C4              ; 369
5350  15C4              ; 370 /// Получить FTP User
5351  15C4              ; 371 void getFTPUser() {
5352  15C4              getftpuser:
5353  15C4              ; 372     push_pop(hl) {
5354  15C4 E5           	push hl
5355  15C5              ; 373         push_pop(de) {
5356  15C5 D5           	push de
5357  15C6              ; 374             push_pop(bc) {
5358  15C6 C5           	push bc
5359  15C7              ; 375                 delay5msI2C();
5360  15C7 CD DD 12     	call delay5msi2c
5361  15CA              ; 376                 i2cWaitingForAccess();
5362  15CA CD CA 12     	call i2cwaitingforaccess
5363  15CD              ; 377                 l = 18;
5364  15CD 2E 12        	ld l, 18
5365  15CF              ; 378                 h = 0;
5366  15CF 26 00        	ld h, 0
5367  15D1              ; 379                 sendCommand();
5368  15D1 CD 11 13     	call sendcommand
5369  15D4              ; 380                 //
5370  15D4              ; 381                 delay5msI2C();
5371  15D4 CD DD 12     	call delay5msi2c
5372  15D7              ; 382                 i2cWaitingForAccess();
5373  15D7 CD CA 12     	call i2cwaitingforaccess
5374  15DA              ; 383                 l = 26;
5375  15DA 2E 1A        	ld l, 26
5376  15DC              ; 384                 readNewInBuffer();
5377  15DC CD 3C 13     	call readnewinbuffer
5378  15DF              ; 385                 //
5379  15DF              ; 386                 de = ESP_I2S_BUFFER;
5380  15DF 11 77 13     	ld de, esp_i2s_buffer
5381  15E2              ; 387                 hl = ftpSettingsUserValue;
5382  15E2 21 D2 0D     	ld hl, ftpsettingsuservalue
5383  15E5              ; 388                 b = 16;
5384  15E5 06 10        	ld b, 16
5385  15E7              ; 389                 do {
5386  15E7              l_369:
5387  15E7              ; 390                     a = *de;
5388  15E7 1A           	ld a, (de)
5389  15E8              ; 391                     if(a==0xFF){
5390  15E8 FE FF        	cp 255
5391  15EA C2 EF 15     	jp nz, l_372
5392  15ED              ; 392                         a = 0x00;
5393  15ED 3E 00        	ld a, 0
5394  15EF              l_372:
5395  15EF              ; 393                     }
5396  15EF              ; 394                     *hl = a;
5397  15EF 77           	ld (hl), a
5398  15F0              ; 395                     de++;
5399  15F0 13           	inc de
5400  15F1              ; 396                     hl++;
5401  15F1 23           	inc hl
5402  15F2              ; 397                     b--;
5403  15F2 05           	dec b
5404  15F3              l_370:
5405  15F3 C2 E7 15     	jp nz, l_369
5406  15F6 C1           	pop bc
5407  15F7 D1           	pop de
5408  15F8 E1           	pop hl
5409  15F9 C9           	ret
5410  15FA              ; 398                 } while (flag_nz);
5411  15FA              ; 399             }
5412  15FA              ; 400         }
5413  15FA              ; 401     }
5414  15FA              ; 402 }
5415  15FA              ; 403
5416  15FA              ; 404 /// Отправить FTP User
5417  15FA              ; 405 void setFTPUser() {
5418  15FA              setftpuser:
5419  15FA              ; 406     push_pop(hl) {
5420  15FA E5           	push hl
5421  15FB              ; 407         push_pop(de) {
5422  15FB D5           	push de
5423  15FC              ; 408             push_pop(bc) {
5424  15FC C5           	push bc
5425  15FD              ; 409                 de = ftpSettingsUserValue;
5426  15FD 11 D2 0D     	ld de, ftpsettingsuservalue
5427  1600              ; 410                 hl = ESP_I2S_BUFFER;
5428  1600 21 77 13     	ld hl, esp_i2s_buffer
5429  1603              ; 411                 b = 16;
5430  1603 06 10        	ld b, 16
5431  1605              ; 412                 c = 0;
5432  1605 0E 00        	ld c, 0
5433  1607              ; 413                 do {
5434  1607              l_374:
5435  1607              ; 414                     a = *de;
5436  1607 1A           	ld a, (de)
5437  1608              ; 415                     if ((a = c) == 1) {
5438  1608 79           	ld a, c
5439  1609 FE 01        	cp 1
5440  160B C2 13 16     	jp nz, l_377
5441  160E              ; 416                         a = 0xFF;
5442  160E 3E FF        	ld a, 255
5443  1610 C3 1C 16     	jp l_378
5444  1613              l_377:
5445  1613              ; 417                     } else if((a = *de) == 0) {
5446  1613 1A           	ld a, (de)
5447  1614 B7           	or a
5448  1615 C2 1C 16     	jp nz, l_379
5449  1618              ; 418                         c = 1;
5450  1618 0E 01        	ld c, 1
5451  161A              ; 419                         a = 0x00;
5452  161A 3E 00        	ld a, 0
5453  161C              l_379:
5454  161C              l_378:
5455  161C              ; 420                     }
5456  161C              ; 421                     *hl = a;
5457  161C 77           	ld (hl), a
5458  161D              ; 422                     de++;
5459  161D 13           	inc de
5460  161E              ; 423                     hl++;
5461  161E 23           	inc hl
5462  161F              ; 424                     b--;
5463  161F 05           	dec b
5464  1620              l_375:
5465  1620 C2 07 16     	jp nz, l_374
5466  1623              ; 425                 } while (flag_nz);
5467  1623              ; 426
5468  1623              ; 427                 delay5msI2C();
5469  1623 CD DD 12     	call delay5msi2c
5470  1626              ; 428                 i2cWaitingForAccess();
5471  1626 CD CA 12     	call i2cwaitingforaccess
5472  1629              ; 429                 l = 19;
5473  1629 2E 13        	ld l, 19
5474  162B              ; 430                 h = 16;
5475  162B 26 10        	ld h, 16
5476  162D              ; 431                 sendCommand();
5477  162D CD 11 13     	call sendcommand
5478  1630 C1           	pop bc
5479  1631 D1           	pop de
5480  1632 E1           	pop hl
5481  1633 C9           	ret
5482  1634              ; 432             }
5483  1634              ; 433         }
5484  1634              ; 434     }
5485  1634              ; 435 }
5486  1634              ; 436
5487  1634              ; 437 /// Получить FTP Password
5488  1634              ; 438 void getFTPPassword() {
5489  1634              getftppassword:
5490  1634              ; 439     push_pop(hl) {
5491  1634 E5           	push hl
5492  1635              ; 440         push_pop(de) {
5493  1635 D5           	push de
5494  1636              ; 441             push_pop(bc) {
5495  1636 C5           	push bc
5496  1637              ; 442                 delay5msI2C();
5497  1637 CD DD 12     	call delay5msi2c
5498  163A              ; 443                 i2cWaitingForAccess();
5499  163A CD CA 12     	call i2cwaitingforaccess
5500  163D              ; 444                 l = 20;
5501  163D 2E 14        	ld l, 20
5502  163F              ; 445                 h = 0;
5503  163F 26 00        	ld h, 0
5504  1641              ; 446                 sendCommand();
5505  1641 CD 11 13     	call sendcommand
5506  1644              ; 447                 //
5507  1644              ; 448                 delay5msI2C();
5508  1644 CD DD 12     	call delay5msi2c
5509  1647              ; 449                 i2cWaitingForAccess();
5510  1647 CD CA 12     	call i2cwaitingforaccess
5511  164A              ; 450                 l = 26;
5512  164A 2E 1A        	ld l, 26
5513  164C              ; 451                 readNewInBuffer();
5514  164C CD 3C 13     	call readnewinbuffer
5515  164F              ; 452                 //
5516  164F              ; 453                 de = ESP_I2S_BUFFER;
5517  164F 11 77 13     	ld de, esp_i2s_buffer
5518  1652              ; 454                 hl = ftpSettingsEditViewPasswordVal;
5519  1652 21 0F 10     	ld hl, ftpsettingseditviewpasswordval
5520  1655              ; 455                 b = 16;
5521  1655 06 10        	ld b, 16
5522  1657              ; 456                 do {
5523  1657              l_381:
5524  1657              ; 457                     a = *de;
5525  1657 1A           	ld a, (de)
5526  1658              ; 458                     if(a==0xFF){
5527  1658 FE FF        	cp 255
5528  165A C2 5F 16     	jp nz, l_384
5529  165D              ; 459                         a = 0x00;
5530  165D 3E 00        	ld a, 0
5531  165F              l_384:
5532  165F              ; 460                     }
5533  165F              ; 461                     *hl = a;
5534  165F 77           	ld (hl), a
5535  1660              ; 462                     de++;
5536  1660 13           	inc de
5537  1661              ; 463                     hl++;
5538  1661 23           	inc hl
5539  1662              ; 464                     b--;
5540  1662 05           	dec b
5541  1663              l_382:
5542  1663 C2 57 16     	jp nz, l_381
5543  1666 C1           	pop bc
5544  1667 D1           	pop de
5545  1668 E1           	pop hl
5546  1669 C9           	ret
5547  166A              ; 465                 } while (flag_nz);
5548  166A              ; 466             }
5549  166A              ; 467         }
5550  166A              ; 468     }
5551  166A              ; 469 }
5552  166A              ; 470
5553  166A              ; 471 /// Отправить FTP Password
5554  166A              ; 472 void setFTPPassword() {
5555  166A              setftppassword:
5556  166A              ; 473     push_pop(hl) {
5557  166A E5           	push hl
5558  166B              ; 474         push_pop(de) {
5559  166B D5           	push de
5560  166C              ; 475             push_pop(bc) {
5561  166C C5           	push bc
5562  166D              ; 476                 de = ftpSettingsEditViewPasswordVal;
5563  166D 11 0F 10     	ld de, ftpsettingseditviewpasswordval
5564  1670              ; 477                 hl = ESP_I2S_BUFFER;
5565  1670 21 77 13     	ld hl, esp_i2s_buffer
5566  1673              ; 478                 b = 16;
5567  1673 06 10        	ld b, 16
5568  1675              ; 479                 c = 0;
5569  1675 0E 00        	ld c, 0
5570  1677              ; 480                 do {
5571  1677              l_386:
5572  1677              ; 481                     a = *de;
5573  1677 1A           	ld a, (de)
5574  1678              ; 482                     if ((a = c) == 1) {
5575  1678 79           	ld a, c
5576  1679 FE 01        	cp 1
5577  167B C2 83 16     	jp nz, l_389
5578  167E              ; 483                         a = 0xFF;
5579  167E 3E FF        	ld a, 255
5580  1680 C3 8C 16     	jp l_390
5581  1683              l_389:
5582  1683              ; 484                     } else if((a = *de) == 0) {
5583  1683 1A           	ld a, (de)
5584  1684 B7           	or a
5585  1685 C2 8C 16     	jp nz, l_391
5586  1688              ; 485                         c = 1;
5587  1688 0E 01        	ld c, 1
5588  168A              ; 486                         a = 0x00;
5589  168A 3E 00        	ld a, 0
5590  168C              l_391:
5591  168C              l_390:
5592  168C              ; 487                     }
5593  168C              ; 488                     *hl = a;
5594  168C 77           	ld (hl), a
5595  168D              ; 489                     de++;
5596  168D 13           	inc de
5597  168E              ; 490                     hl++;
5598  168E 23           	inc hl
5599  168F              ; 491                     b--;
5600  168F 05           	dec b
5601  1690              l_387:
5602  1690 C2 77 16     	jp nz, l_386
5603  1693              ; 492                 } while (flag_nz);
5604  1693              ; 493
5605  1693              ; 494                 delay5msI2C();
5606  1693 CD DD 12     	call delay5msi2c
5607  1696              ; 495                 i2cWaitingForAccess();
5608  1696 CD CA 12     	call i2cwaitingforaccess
5609  1699              ; 496                 l = 21;
5610  1699 2E 15        	ld l, 21
5611  169B              ; 497                 h = 16;
5612  169B 26 10        	ld h, 16
5613  169D              ; 498                 sendCommand();
5614  169D CD 11 13     	call sendcommand
5615  16A0 C1           	pop bc
5616  16A1 D1           	pop de
5617  16A2 E1           	pop hl
5618  16A3 C9           	ret
5619  16A4              ; 499             }
5620  16A4              ; 500         }
5621  16A4              ; 501     }
5622  16A4              ; 502 }
5623  16A4              ; 503
5624  16A4              ; 504 /// Получить FTP Port
5625  16A4              ; 505 void getFTPPort() {
5626  16A4              getftpport:
5627  16A4              ; 506     push_pop(hl) {
5628  16A4 E5           	push hl
5629  16A5              ; 507         push_pop(de) {
5630  16A5 D5           	push de
5631  16A6              ; 508             push_pop(bc) {
5632  16A6 C5           	push bc
5633  16A7              ; 509                 delay5msI2C();
5634  16A7 CD DD 12     	call delay5msi2c
5635  16AA              ; 510                 i2cWaitingForAccess();
5636  16AA CD CA 12     	call i2cwaitingforaccess
5637  16AD              ; 511                 l = 16;
5638  16AD 2E 10        	ld l, 16
5639  16AF              ; 512                 h = 0;
5640  16AF 26 00        	ld h, 0
5641  16B1              ; 513                 sendCommand();
5642  16B1 CD 11 13     	call sendcommand
5643  16B4              ; 514                 //
5644  16B4              ; 515                 delay5msI2C();
5645  16B4 CD DD 12     	call delay5msi2c
5646  16B7              ; 516                 i2cWaitingForAccess();
5647  16B7 CD CA 12     	call i2cwaitingforaccess
5648  16BA              ; 517                 l = 10;
5649  16BA 2E 0A        	ld l, 10
5650  16BC              ; 518                 readNewInBuffer();
5651  16BC CD 3C 13     	call readnewinbuffer
5652  16BF              ; 519                 //
5653  16BF              ; 520                 de = ESP_I2S_BUFFER;
5654  16BF 11 77 13     	ld de, esp_i2s_buffer
5655  16C2              ; 521                 hl = ftpSettingsPortValue;
5656  16C2 21 A2 0D     	ld hl, ftpsettingsportvalue
5657  16C5              ; 522                 b = 6;
5658  16C5 06 06        	ld b, 6
5659  16C7              ; 523                 do {
5660  16C7              l_393:
5661  16C7              ; 524                     a = *de;
5662  16C7 1A           	ld a, (de)
5663  16C8              ; 525                     if(a==0xFF){
5664  16C8 FE FF        	cp 255
5665  16CA C2 CF 16     	jp nz, l_396
5666  16CD              ; 526                         a = 0x00;
5667  16CD 3E 00        	ld a, 0
5668  16CF              l_396:
5669  16CF              ; 527                     }
5670  16CF              ; 528                     *hl = a;
5671  16CF 77           	ld (hl), a
5672  16D0              ; 529                     de++;
5673  16D0 13           	inc de
5674  16D1              ; 530                     hl++;
5675  16D1 23           	inc hl
5676  16D2              ; 531                     b--;
5677  16D2 05           	dec b
5678  16D3              l_394:
5679  16D3 C2 C7 16     	jp nz, l_393
5680  16D6 C1           	pop bc
5681  16D7 D1           	pop de
5682  16D8 E1           	pop hl
5683  16D9 C9           	ret
5684  16DA              ; 532                 } while (flag_nz);
5685  16DA              ; 533             }
5686  16DA              ; 534         }
5687  16DA              ; 535     }
5688  16DA              ; 536 }
5689  16DA              ; 537
5690  16DA              ; 538 /// Отправить FTP Port
5691  16DA              ; 539 void setFTPPort() {
5692  16DA              setftpport:
5693  16DA              ; 540     push_pop(hl) {
5694  16DA E5           	push hl
5695  16DB              ; 541         push_pop(de) {
5696  16DB D5           	push de
5697  16DC              ; 542             push_pop(bc) {
5698  16DC C5           	push bc
5699  16DD              ; 543                 de = ftpSettingsPortValue;
5700  16DD 11 A2 0D     	ld de, ftpsettingsportvalue
5701  16E0              ; 544                 hl = ESP_I2S_BUFFER;
5702  16E0 21 77 13     	ld hl, esp_i2s_buffer
5703  16E3              ; 545                 b = 6;
5704  16E3 06 06        	ld b, 6
5705  16E5              ; 546                 c = 0;
5706  16E5 0E 00        	ld c, 0
5707  16E7              ; 547                 do {
5708  16E7              l_398:
5709  16E7              ; 548                     a = *de;
5710  16E7 1A           	ld a, (de)
5711  16E8              ; 549                     if ((a = c) == 1) {
5712  16E8 79           	ld a, c
5713  16E9 FE 01        	cp 1
5714  16EB C2 F3 16     	jp nz, l_401
5715  16EE              ; 550                         a = 0xFF;
5716  16EE 3E FF        	ld a, 255
5717  16F0 C3 FC 16     	jp l_402
5718  16F3              l_401:
5719  16F3              ; 551                     } else if((a = *de) == 0) {
5720  16F3 1A           	ld a, (de)
5721  16F4 B7           	or a
5722  16F5 C2 FC 16     	jp nz, l_403
5723  16F8              ; 552                         c = 1;
5724  16F8 0E 01        	ld c, 1
5725  16FA              ; 553                         a = 0x00;
5726  16FA 3E 00        	ld a, 0
5727  16FC              l_403:
5728  16FC              l_402:
5729  16FC              ; 554                     }
5730  16FC              ; 555                     *hl = a;
5731  16FC 77           	ld (hl), a
5732  16FD              ; 556                     de++;
5733  16FD 13           	inc de
5734  16FE              ; 557                     hl++;
5735  16FE 23           	inc hl
5736  16FF              ; 558                     b--;
5737  16FF 05           	dec b
5738  1700              l_399:
5739  1700 C2 E7 16     	jp nz, l_398
5740  1703              ; 559                 } while (flag_nz);
5741  1703              ; 560
5742  1703              ; 561                 delay5msI2C();
5743  1703 CD DD 12     	call delay5msi2c
5744  1706              ; 562                 i2cWaitingForAccess();
5745  1706 CD CA 12     	call i2cwaitingforaccess
5746  1709              ; 563                 l = 17;
5747  1709 2E 11        	ld l, 17
5748  170B              ; 564                 h = 6;
5749  170B 26 06        	ld h, 6
5750  170D              ; 565                 sendCommand();
5751  170D CD 11 13     	call sendcommand
5752  1710 C1           	pop bc
5753  1711 D1           	pop de
5754  1712 E1           	pop hl
5755  1713 C9           	ret
5756  1714              ; 566             }
5757  1714              ; 567         }
5758  1714              ; 568     }
5759  1714              ; 569 }
5760  1714              ; 570
5761  1714              ; 571 /// Подключиться в FTP
5762  1714              ; 572 void needFtpConnect() {
5763  1714              needftpconnect:
5764  1714              ; 573     push_pop(hl) {
5765  1714 E5           	push hl
5766  1715              ; 574         delay5msI2C();
5767  1715 CD DD 12     	call delay5msi2c
5768  1718              ; 575         i2cWaitingForAccess();
5769  1718 CD CA 12     	call i2cwaitingforaccess
5770  171B              ; 576         l = 23;
5771  171B 2E 17        	ld l, 23
5772  171D              ; 577         h = 0;
5773  171D 26 00        	ld h, 0
5774  171F              ; 578         sendCommand();
5775  171F CD 11 13     	call sendcommand
5776  1722 E1           	pop hl
5777  1723 C9           	ret
5778  1724              ; 579     }
5779  1724              ; 580 }
5780  1724              ; 581
5781  1724              ; 582 /// Получить статус FTP
5782  1724              ; 583 void getFtpState() {
5783  1724              getftpstate:
5784  1724              ; 584     push_pop(hl) {
5785  1724 E5           	push hl
5786  1725              ; 585         push_pop(de) {
5787  1725 D5           	push de
5788  1726              ; 586             push_pop(bc) {
5789  1726 C5           	push bc
5790  1727              ; 587                 delay5msI2C();
5791  1727 CD DD 12     	call delay5msi2c
5792  172A              ; 588                 i2cWaitingForAccess();
5793  172A CD CA 12     	call i2cwaitingforaccess
5794  172D              ; 589                 l = 24;
5795  172D 2E 18        	ld l, 24
5796  172F              ; 590                 h = 0;
5797  172F 26 00        	ld h, 0
5798  1731              ; 591                 sendCommand();
5799  1731 CD 11 13     	call sendcommand
5800  1734              ; 592                 //
5801  1734              ; 593                 delay5msI2C();
5802  1734 CD DD 12     	call delay5msi2c
5803  1737              ; 594                 i2cWaitingForAccess();
5804  1737 CD CA 12     	call i2cwaitingforaccess
5805  173A              ; 595                 l = 4;
5806  173A 2E 04        	ld l, 4
5807  173C              ; 596                 readNewInBuffer();
5808  173C CD 3C 13     	call readnewinbuffer
5809  173F              ; 597                 //
5810  173F              ; 598                 a = ftpSettingsStateVal;
5811  173F 3A B6 0D     	ld a, (ftpsettingsstateval)
5812  1742              ; 599                 h = a;
5813  1742 67           	ld h, a
5814  1743              ; 600                 de = ESP_I2S_BUFFER;
5815  1743 11 77 13     	ld de, esp_i2s_buffer
5816  1746              ; 601                 a = *de;
5817  1746 1A           	ld a, (de)
5818  1747              ; 602                 a &= 0x01;
5819  1747 E6 01        	and 1
5820  1749              ; 603                 ftpSettingsStateVal = a;
5821  1749 32 B6 0D     	ld (ftpsettingsstateval), a
5822  174C              ; 604                 if(a != h){
5823  174C BC           	cp h
5824  174D CA 55 17     	jp z, l_405
5825  1750              ; 605                     a = 0x01;
5826  1750 3E 01        	ld a, 1
5827  1752              ; 606                     ftpSettingsStateChange = a;
5828  1752 32 B7 0D     	ld (ftpsettingsstatechange), a
5829  1755              l_405:
5830  1755 C1           	pop bc
5831  1756 D1           	pop de
5832  1757 E1           	pop hl
5833  1758 C9           	ret
5834  1759              ; 607                 }
5835  1759              ; 608             }
5836  1759              ; 609         }
5837  1759              ; 610     }
5838  1759              ; 611 }
5839  1759              ; 612
5840  1759              ; 613 /// обновить сисок FTP файлов
5841  1759              ; 614 void updateFtpList() {
5842  1759              updateftplist:
5843  1759              ; 615     push_pop(hl) {
5844  1759 E5           	push hl
5845  175A              ; 616         a = 0;
5846  175A 3E 00        	ld a, 0
5847  175C              ; 617         ftpDirListCount = a;
5848  175C 32 96 0F     	ld (ftpdirlistcount), a
5849  175F              ; 618         delay5msI2C();
5850  175F CD DD 12     	call delay5msi2c
5851  1762              ; 619         i2cWaitingForAccess();
5852  1762 CD CA 12     	call i2cwaitingforaccess
5853  1765              ; 620         l = 25;
5854  1765 2E 19        	ld l, 25
5855  1767              ; 621         h = 0;
5856  1767 26 00        	ld h, 0
5857  1769              ; 622         sendCommand();
5858  1769 CD 11 13     	call sendcommand
5859  176C              ; 623
5860  176C              ; 624         delay5msI2C();
5861  176C CD DD 12     	call delay5msi2c
5862  176F              ; 625         i2cWaitingForAccess();
5863  176F CD CA 12     	call i2cwaitingforaccess
5864  1772              ; 626         busRecoveryI2C();
5865  1772 CD E9 12     	call busrecoveryi2c
5866  1775 E1           	pop hl
5867  1776 C9           	ret
5868  1777              ; 627     }
5869  1777              ; 628 }
5870  1777              ; 629
5871  1777              ; 630 void convert4bitToCharA() {
5872  1777              convert4bittochara:
5873  1777              ; 631     if (a < 10) {
5874  1777 FE 0A        	cp 10
5875  1779 D2 81 17     	jp nc, l_407
5876  177C              ; 632         a += 0x30;
5877  177C C6 30        	add 48
5878  177E C3 83 17     	jp l_408
5879  1781              l_407:
5880  1781              ; 633     } else {
5881  1781              ; 634         a += 0x37;
5882  1781 C6 37        	add 55
5883  1783              l_408:
5884  1783 C9           	ret
5885  1784              ; 635     }
5886  1784              ; 636 }
5887  1784              ; 637
5888  1784              ; 638 /// Получаем список файлов и директорий в текущей папке
5889  1784              ; 639 void getFtpList() {
5890  1784              getftplist:
5891  1784              ; 640     // Получить ответ
5892  1784              ; 641     // Ответ ESP_I2S_BUFFER
5893  1784              ; 642     // ftpDirList буфер заполнения
5894  1784              ; 643     push_pop(bc) {
5895  1784 C5           	push bc
5896  1785              ; 644         do {
5897  1785              l_409:
5898  1785              ; 645             //
5899  1785              ; 646             delay5msI2C();
5900  1785 CD DD 12     	call delay5msi2c
5901  1788              ; 647             i2cWaitingForAccess();
5902  1788 CD CA 12     	call i2cwaitingforaccess
5903  178B              ; 648             l = 26;
5904  178B 2E 1A        	ld l, 26
5905  178D              ; 649             h = 0;
5906  178D 26 00        	ld h, 0
5907  178F              ; 650             sendCommand();
5908  178F CD 11 13     	call sendcommand
5909  1792              ; 651             //
5910  1792              ; 652             delay5msI2C();
5911  1792 CD DD 12     	call delay5msi2c
5912  1795              ; 653             i2cWaitingForAccess();
5913  1795 CD CA 12     	call i2cwaitingforaccess
5914  1798              ; 654             l = 26;
5915  1798 2E 1A        	ld l, 26
5916  179A              ; 655             readNewInBuffer();
5917  179A CD 3C 13     	call readnewinbuffer
5918  179D              ; 656             push_pop(a) {
5919  179D F5           	push af
5920  179E              ; 657                 push_pop(de) {
5921  179E D5           	push de
5922  179F              ; 658                     push_pop(hl) {
5923  179F E5           	push hl
5924  17A0              ; 659                         parceBufferToFile();
5925  17A0 CD 9B 19     	call parcebuffertofile
5926  17A3 E1           	pop hl
5927  17A4 D1           	pop de
5928  17A5 F1           	pop af
5929  17A6              l_410:
5930  17A6              ; 660                     }
5931  17A6              ; 661                 }
5932  17A6              ; 662             }
5933  17A6              ; 663             //a = ftpDirListNext;
5934  17A6              ; 664         } while ((a = ftpDirListNext) != 0x5A); // == 1
5935  17A6 3A 95 0F     	ld a, (ftpdirlistnext)
5936  17A9 FE 5A        	cp 90
5937  17AB C2 85 17     	jp nz, l_409
5938  17AE              ; 665
5939  17AE              ; 666         delay5msI2C();
5940  17AE CD DD 12     	call delay5msi2c
5941  17B1              ; 667         i2cWaitingForAccess();
5942  17B1 CD CA 12     	call i2cwaitingforaccess
5943  17B4              ; 668         busRecoveryI2C();
5944  17B4 CD E9 12     	call busrecoveryi2c
5945  17B7 C1           	pop bc
5946  17B8 C9           	ret
5947  17B9              ; 669     }
5948  17B9              ; 670 }
5949  17B9              ; 671
5950  17B9              ; 672 /// Указать какой файл скачивать
5951  17B9              ; 673 void ftpFileDownload() {
5952  17B9              ftpfiledownload:
5953  17B9              ; 674     push_pop(de) {
5954  17B9 D5           	push de
5955  17BA              ; 675         push_pop(hl) {
5956  17BA E5           	push hl
5957  17BB              ; 676             de = ESP_I2S_BUFFER;
5958  17BB 11 77 13     	ld de, esp_i2s_buffer
5959  17BE              ; 677             a = ftpViewCurrentPos;
5960  17BE 3A 98 0F     	ld a, (ftpviewcurrentpos)
5961  17C1              ; 678             *de = a;
5962  17C1 12           	ld (de), a
5963  17C2              ; 679             //
5964  17C2              ; 680             delay5msI2C();
5965  17C2 CD DD 12     	call delay5msi2c
5966  17C5              ; 681             i2cWaitingForAccess();
5967  17C5 CD CA 12     	call i2cwaitingforaccess
5968  17C8              ; 682             //
5969  17C8              ; 683             l = 28; // FILE_DOWNLOAD
5970  17C8 2E 1C        	ld l, 28
5971  17CA              ; 684             h = 1; // 1 байт
5972  17CA 26 01        	ld h, 1
5973  17CC              ; 685             sendCommand();
5974  17CC CD 11 13     	call sendcommand
5975  17CF E1           	pop hl
5976  17D0 D1           	pop de
5977  17D1 C9           	ret
5978  17D2              ; 686         }
5979  17D2              ; 687     }
5980  17D2              ; 688 }
5981  17D2              ; 689
5982  17D2              ; 690 /// Скачать указанный файл
5983  17D2              ; 691 void ftpFileDownloadNext() {
5984  17D2              ftpfiledownloadnext:
5985  17D2              ; 692     push_pop(hl) {
5986  17D2 E5           	push hl
5987  17D3              ; 693         a = 0x01;
5988  17D3 3E 01        	ld a, 1
5989  17D5              ; 694         ftpFileLoadViewCheckSumState = a;
5990  17D5 32 23 1C     	ld (ftpfileloadviewchecksumstate), a
5991  17D8              ; 695         do {
5992  17D8              l_412:
5993  17D8              ; 696             // Если контрольная сумма верна просим следующий буфер
5994  17D8              ; 697             if ((a = ftpFileLoadViewCheckSumState) == 0x01) {
5995  17D8 3A 23 1C     	ld a, (ftpfileloadviewchecksumstate)
5996  17DB FE 01        	cp 1
5997  17DD C2 ED 17     	jp nz, l_415
5998  17E0              ; 698                 delay5msI2C();
5999  17E0 CD DD 12     	call delay5msi2c
6000  17E3              ; 699                 i2cWaitingForAccess();
6001  17E3 CD CA 12     	call i2cwaitingforaccess
6002  17E6              ; 700                 l = 29;
6003  17E6 2E 1D        	ld l, 29
6004  17E8              ; 701                 h = 0;
6005  17E8 26 00        	ld h, 0
6006  17EA              ; 702                 sendCommand();
6007  17EA CD 11 13     	call sendcommand
6008  17ED              l_415:
6009  17ED              ; 703             }
6010  17ED              ; 704
6011  17ED              ; 705             // Получить буфер
6012  17ED              ; 706             delay5msI2C();
6013  17ED CD DD 12     	call delay5msi2c
6014  17F0              ; 707             i2cWaitingForAccess();
6015  17F0 CD CA 12     	call i2cwaitingforaccess
6016  17F3              ; 708             l = 30;
6017  17F3 2E 1E        	ld l, 30
6018  17F5              ; 709             h = 0;
6019  17F5 26 00        	ld h, 0
6020  17F7              ; 710             sendCommand();
6021  17F7 CD 11 13     	call sendcommand
6022  17FA              ; 711             //
6023  17FA              ; 712             delay5msI2C();
6024  17FA CD DD 12     	call delay5msi2c
6025  17FD              ; 713             i2cWaitingForAccess();
6026  17FD CD CA 12     	call i2cwaitingforaccess
6027  1800              ; 714             l = 15; //(12) //26; (20)
6028  1800 2E 0F        	ld l, 15
6029  1802              ; 715             readNewInBuffer();
6030  1802 CD 3C 13     	call readnewinbuffer
6031  1805              ; 716
6032  1805              ; 717             // Распарсить буфер и пррверить контрольную сумму
6033  1805              ; 718             ftpFileLoadViewParce();
6034  1805 CD B4 1B     	call ftpfileloadviewparce
6035  1808              l_413:
6036  1808              ; 719
6037  1808              ; 720         } while ((a = ftpFileLoadViewIsNextData) != 0x5A); // == 1
6038  1808 3A 1F 1C     	ld a, (ftpfileloadviewisnextdata)
6039  180B FE 5A        	cp 90
6040  180D C2 D8 17     	jp nz, l_412
6041  1810 E1           	pop hl
6042  1811 C9           	ret
6043  1812              ; 721     }
6044  1812              ; 722 }
6045  1812              ; 723
6046  1812              ; 724 /// Сменить директорию
6047  1812              ; 725 void ftpChangeDirPos() {
6048  1812              ftpchangedirpos:
6049  1812              ; 726     push_pop(de) {
6050  1812 D5           	push de
6051  1813              ; 727         push_pop(hl) {
6052  1813 E5           	push hl
6053  1814              ; 728             de = ESP_I2S_BUFFER;
6054  1814 11 77 13     	ld de, esp_i2s_buffer
6055  1817              ; 729             a = ftpViewCurrentPos;
6056  1817 3A 98 0F     	ld a, (ftpviewcurrentpos)
6057  181A              ; 730             *de = a;
6058  181A 12           	ld (de), a
6059  181B              ; 731             //
6060  181B              ; 732             delay5msI2C();
6061  181B CD DD 12     	call delay5msi2c
6062  181E              ; 733             i2cWaitingForAccess();
6063  181E CD CA 12     	call i2cwaitingforaccess
6064  1821              ; 734             //
6065  1821              ; 735             l = 32; // FTP_DIR_INDEX
6066  1821 2E 20        	ld l, 32
6067  1823              ; 736             h = 1; // 1 байт
6068  1823 26 01        	ld h, 1
6069  1825              ; 737             sendCommand();
6070  1825 CD 11 13     	call sendcommand
6071  1828              ; 738
6072  1828              ; 739             delay5msI2C();
6073  1828 CD DD 12     	call delay5msi2c
6074  182B              ; 740             i2cWaitingForAccess();
6075  182B CD CA 12     	call i2cwaitingforaccess
6076  182E              ; 741             busRecoveryI2C();
6077  182E CD E9 12     	call busrecoveryi2c
6078  1831 E1           	pop hl
6079  1832 D1           	pop de
6080  1833 C9           	ret
6081  1834              ; 742         }
6082  1834              ; 743     }
6083  1834              ; 744 }
6084  1834              ; 745
6085  1834              ; 746 /// Сменить директорию вверх
6086  1834              ; 747 void ftpChangeDirUp() {
6087  1834              ftpchangedirup:
6088  1834              ; 748     push_pop(de) {
6089  1834 D5           	push de
6090  1835              ; 749         push_pop(hl) {
6091  1835 E5           	push hl
6092  1836              ; 750             delay5msI2C();
6093  1836 CD DD 12     	call delay5msi2c
6094  1839              ; 751             i2cWaitingForAccess();
6095  1839 CD CA 12     	call i2cwaitingforaccess
6096  183C              ; 752             //
6097  183C              ; 753             l = 31; // FTP_DIR_UP
6098  183C 2E 1F        	ld l, 31
6099  183E              ; 754             h = 0;
6100  183E 26 00        	ld h, 0
6101  1840              ; 755             sendCommand();
6102  1840 CD 11 13     	call sendcommand
6103  1843              ; 756
6104  1843              ; 757             delay5msI2C();
6105  1843 CD DD 12     	call delay5msi2c
6106  1846              ; 758             i2cWaitingForAccess();
6107  1846 CD CA 12     	call i2cwaitingforaccess
6108  1849              ; 759             busRecoveryI2C();
6109  1849 CD E9 12     	call busrecoveryi2c
6110  184C E1           	pop hl
6111  184D D1           	pop de
6112  184E C9           	ret
6113  184F              ; 11 void needUpdateFtpList() {
6114  184F              needupdateftplist:
6115  184F              ; 12     i2cWaitingForAccess();
6116  184F CD CA 12     	call i2cwaitingforaccess
6117  1852              ; 13     updateFtpList();
6118  1852 CD 59 17     	call updateftplist
6119  1855              ; 14     i2cWaitingForAccess();
6120  1855 CD CA 12     	call i2cwaitingforaccess
6121  1858              ; 15     getFtpList();
6122  1858 CD 84 17     	call getftplist
6123  185B              ; 16
6124  185B              ; 17     a = ftpDirListCount;
6125  185B 3A 96 0F     	ld a, (ftpdirlistcount)
6126  185E              ; 18     if (a >= 16) {
6127  185E FE 10        	cp 16
6128  1860 DA 68 18     	jp c, l_417
6129  1863              ; 19         a = 16;
6130  1863 3E 10        	ld a, 16
6131  1865              ; 20         ftpDirListCount = a;
6132  1865 32 96 0F     	ld (ftpdirlistcount), a
6133  1868              l_417:
6134  1868              ; 21     }
6135  1868              ; 22
6136  1868              ; 23     a = 0;
6137  1868 3E 00        	ld a, 0
6138  186A              ; 24     ftpViewCurrentPos = a;
6139  186A 32 98 0F     	ld (ftpviewcurrentpos), a
6140  186D              ; 25
6141  186D              ; 26     // clearView();
6142  186D              ; 27     ftpViewDataUpdate();
6143  186D C3 89 18     	jp ftpviewdataupdate
6144  1870              ; 28 }
6145  1870              ; 29
6146  1870              ; 30 void clearView() {
6147  1870              clearview:
6148  1870              ; 31     push_pop(hl) {
6149  1870 E5           	push hl
6150  1871              ; 32         push_pop(bc) {
6151  1871 C5           	push bc
6152  1872              ; 33             b = 14;
6153  1872 06 0E        	ld b, 14
6154  1874              ; 34             c = 0;
6155  1874 0E 00        	ld c, 0
6156  1876              ; 35             do {
6157  1876              l_419:
6158  1876              ; 36                 ftpViewPosCursorC();
6159  1876 CD D8 18     	call ftpviewposcursorc
6160  1879              ; 37                 hl = wifiSettingsEmpty18;
6161  1879 21 47 0D     	ld hl, wifisettingsempty18
6162  187C              ; 38                 printHLStr();
6163  187C CD 18 F8     	call printhlstr
6164  187F              ; 39                 b--;
6165  187F 05           	dec b
6166  1880              ; 40                 c++;
6167  1880 0C           	inc c
6168  1881              l_420:
6169  1881              ; 41             } while ((a = b) > 0);
6170  1881 78           	ld a, b
6171  1882 B7           	or a
6172  1883 C2 76 18     	jp nz, l_419
6173  1886 C1           	pop bc
6174  1887 E1           	pop hl
6175  1888 C9           	ret
6176  1889              ; 42         }
6177  1889              ; 43     }
6178  1889              ; 44 }
6179  1889              ; 45
6180  1889              ; 46 void ftpViewDataUpdate() {
6181  1889              ftpviewdataupdate:
6182  1889              ; 47     push_pop(bc) {
6183  1889 C5           	push bc
6184  188A              ; 48         b = 0;
6185  188A 06 00        	ld b, 0
6186  188C              ; 49         do {
6187  188C              l_422:
6188  188C              ; 50             a = 0x00;
6189  188C 3E 00        	ld a, 0
6190  188E              ; 51             inverceAddress = a;
6191  188E 32 D3 F3     	ld (inverceaddress), a
6192  1891              ; 52
6193  1891              ; 53             if ((a = rootViewCurrentView) == rootViewCurrentFTPView) {
6194  1891 3A 99 0F     	ld a, (rootviewcurrentview)
6195  1894 FE 01        	cp 1
6196  1896 C2 A5 18     	jp nz, l_425
6197  1899              ; 54                 if ((a = ftpViewCurrentPos) == b) {
6198  1899 3A 98 0F     	ld a, (ftpviewcurrentpos)
6199  189C B8           	cp b
6200  189D C2 A5 18     	jp nz, l_427
6201  18A0              ; 55                     a = 0xFF;
6202  18A0 3E FF        	ld a, 255
6203  18A2              ; 56                     inverceAddress = a;
6204  18A2 32 D3 F3     	ld (inverceaddress), a
6205  18A5              l_427:
6206  18A5              l_425:
6207  18A5              ; 57                 }
6208  18A5              ; 58             }
6209  18A5              ; 59
6210  18A5              ; 60             a = b;
6211  18A5 78           	ld a, b
6212  18A6              ; 61             ftpViewShowValueA();
6213  18A6 CD BA 18     	call ftpviewshowvaluea
6214  18A9              ; 62
6215  18A9              ; 63             a = 0x00;
6216  18A9 3E 00        	ld a, 0
6217  18AB              ; 64             inverceAddress = a;
6218  18AB 32 D3 F3     	ld (inverceaddress), a
6219  18AE              ; 65
6220  18AE              ; 66             b++;
6221  18AE 04           	inc b
6222  18AF              ; 67             a = ftpDirListCount;
6223  18AF 3A 96 0F     	ld a, (ftpdirlistcount)
6224  18B2              ; 68             c = a;
6225  18B2 4F           	ld c, a
6226  18B3              l_423:
6227  18B3              ; 69         } while ((a = b) < c);
6228  18B3 78           	ld a, b
6229  18B4 B9           	cp c
6230  18B5 DA 8C 18     	jp c, l_422
6231  18B8 C1           	pop bc
6232  18B9 C9           	ret
6233  18BA              ; 70     }
6234  18BA              ; 71 }
6235  18BA              ; 72
6236  18BA              ; 73 void ftpViewShowValueA() {
6237  18BA              ftpviewshowvaluea:
6238  18BA              ; 74     push_pop(hl) {
6239  18BA E5           	push hl
6240  18BB              ; 75         push_pop(de) {
6241  18BB D5           	push de
6242  18BC              ; 76             push_pop(bc) {
6243  18BC C5           	push bc
6244  18BD              ; 77                 de = 16;
6245  18BD 11 10 00     	ld de, 16
6246  18C0              ; 78                 c = a;
6247  18C0 4F           	ld c, a
6248  18C1              ; 79                 ftpViewPosCursorC();
6249  18C1 CD D8 18     	call ftpviewposcursorc
6250  18C4              ; 80                 hl = ftpDirList;
6251  18C4 21 15 0E     	ld hl, ftpdirlist
6252  18C7              ; 81                 if ((a = c) > 0) {
6253  18C7 79           	ld a, c
6254  18C8 B7           	or a
6255  18C9 CA D1 18     	jp z, l_429
6256  18CC              ; 82                     do {
6257  18CC              l_431:
6258  18CC              ; 83                         hl += de;
6259  18CC 19           	add hl, de
6260  18CD              ; 84                         c--;
6261  18CD 0D           	dec c
6262  18CE              l_432:
6263  18CE C2 CC 18     	jp nz, l_431
6264  18D1              l_429:
6265  18D1              ; 85                     } while (flag_nz);
6266  18D1              ; 86                 }
6267  18D1              ; 87                 //hl = ftpLabel;
6268  18D1              ; 88                 printHLStr();
6269  18D1 CD 18 F8     	call printhlstr
6270  18D4 C1           	pop bc
6271  18D5 D1           	pop de
6272  18D6 E1           	pop hl
6273  18D7 C9           	ret
6274  18D8              ; 89             }
6275  18D8              ; 90         }
6276  18D8              ; 91     }
6277  18D8              ; 92 }
6278  18D8              ; 93
6279  18D8              ; 94 void ftpViewPosCursorC() {
6280  18D8              ftpviewposcursorc:
6281  18D8              ; 95     push_pop(hl) {
6282  18D8 E5           	push hl
6283  18D9              ; 96         a = ftpViewY;
6284  18D9 3A 09 0E     	ld a, (ftpviewy)
6285  18DC              ; 97         a += 1;
6286  18DC C6 01        	add 1
6287  18DE              ; 98         a += c;
6288  18DE 81           	add c
6289  18DF              ; 99         h = a;
6290  18DF 67           	ld h, a
6291  18E0              ; 100         a = ftpViewX;
6292  18E0 3A 08 0E     	ld a, (ftpviewx)
6293  18E3              ; 101         a += 3;
6294  18E3 C6 03        	add 3
6295  18E5              ; 102         l = a;
6296  18E5 6F           	ld l, a
6297  18E6              ; 103         setPosCursor();
6298  18E6 CD 3C F8     	call setposcursor
6299  18E9 E1           	pop hl
6300  18EA C9           	ret
6301  18EB              ; 104     }
6302  18EB              ; 105 }
6303  18EB              ; 106
6304  18EB              ; 107 void ftpViewKeyA() {
6305  18EB              ftpviewkeya:
6306  18EB              ; 108     push_pop(hl) {
6307  18EB E5           	push hl
6308  18EC              ; 109         l = a;
6309  18EC 6F           	ld l, a
6310  18ED              ; 110         if ((a = rootViewCurrentView) == rootViewCurrentFTPView) {
6311  18ED 3A 99 0F     	ld a, (rootviewcurrentview)
6312  18F0 FE 01        	cp 1
6313  18F2 C2 8A 19     	jp nz, l_434
6314  18F5              ; 111             a = l;
6315  18F5 7D           	ld a, l
6316  18F6              ; 112             if (a == 0x09) { // TAB - Change to local disk
6317  18F6 FE 09        	cp 9
6318  18F8 C2 09 19     	jp nz, l_436
6319  18FB              ; 113                 a = rootViewCurrentDiskView; // переходим на список файлов на диске
6320  18FB 3E 00        	ld a, 0
6321  18FD              ; 114                 rootViewCurrentView = a;
6322  18FD 32 99 0F     	ld (rootviewcurrentview), a
6323  1900              ; 115                 ftpViewDataUpdate();
6324  1900 CD 89 18     	call ftpviewdataupdate
6325  1903              ; 116                 showDiskList();
6326  1903 CD CE 03     	call showdisklist
6327  1906 C3 8A 19     	jp l_437
6328  1909              l_436:
6329  1909              ; 117             } else {
6330  1909              ; 118                 a = ftpDirListCount;
6331  1909 3A 96 0F     	ld a, (ftpdirlistcount)
6332  190C              ; 119                 h = a;
6333  190C 67           	ld h, a
6334  190D              ; 120                 a = l;
6335  190D 7D           	ld a, l
6336  190E              ; 121                 if (a == 0x1A) { //down
6337  190E FE 1A        	cp 26
6338  1910 C2 23 19     	jp nz, l_438
6339  1913              ; 122                     a = ftpViewCurrentPos;
6340  1913 3A 98 0F     	ld a, (ftpviewcurrentpos)
6341  1916              ; 123                     a++;
6342  1916 3C           	inc a
6343  1917              ; 124                     if (a == h) {
6344  1917 BC           	cp h
6345  1918 C2 1D 19     	jp nz, l_440
6346  191B              ; 125                         a = 0;
6347  191B 3E 00        	ld a, 0
6348  191D              l_440:
6349  191D              ; 126                     }
6350  191D              ; 127                     ftpViewCurrentPos = a;
6351  191D 32 98 0F     	ld (ftpviewcurrentpos), a
6352  1920 C3 8A 19     	jp l_439
6353  1923              l_438:
6354  1923              ; 128                 } else if (a == 0x19) { //up
6355  1923 FE 19        	cp 25
6356  1925 C2 3B 19     	jp nz, l_442
6357  1928              ; 129                     a = ftpViewCurrentPos;
6358  1928 3A 98 0F     	ld a, (ftpviewcurrentpos)
6359  192B              ; 130                     if (a == 0) {
6360  192B B7           	or a
6361  192C C2 34 19     	jp nz, l_444
6362  192F              ; 131                         a = h;
6363  192F 7C           	ld a, h
6364  1930              ; 132                         a--;
6365  1930 3D           	dec a
6366  1931 C3 35 19     	jp l_445
6367  1934              l_444:
6368  1934              ; 133                     } else {
6369  1934              ; 134                         a--;
6370  1934 3D           	dec a
6371  1935              l_445:
6372  1935              ; 135                     }
6373  1935              ; 136                     ftpViewCurrentPos = a;
6374  1935 32 98 0F     	ld (ftpviewcurrentpos), a
6375  1938 C3 8A 19     	jp l_443
6376  193B              l_442:
6377  193B              ; 137                 } else if (a == 0x0D) { //Enter
6378  193B FE 0D        	cp 13
6379  193D C2 6A 19     	jp nz, l_446
6380  1940              ; 138                     ftpViewCurrentPosIsDir();
6381  1940 CD 4A 1A     	call ftpviewcurrentposisdir
6382  1943              ; 139                     if ((a = ftpDirListIsDir) == 1) {
6383  1943 3A 97 0F     	ld a, (ftpdirlistisdir)
6384  1946 FE 01        	cp 1
6385  1948 C2 64 19     	jp nz, l_448
6386  194B              ; 140                         if ((a = ftpViewCurrentPos) == 0) {
6387  194B 3A 98 0F     	ld a, (ftpviewcurrentpos)
6388  194E B7           	or a
6389  194F C2 58 19     	jp nz, l_450
6390  1952              ; 141                             ftpChangeDirUp();
6391  1952 CD 34 18     	call ftpchangedirup
6392  1955 C3 5B 19     	jp l_451
6393  1958              l_450:
6394  1958              ; 142                         } else {
6395  1958              ; 143                             ftpChangeDirPos();
6396  1958 CD 12 18     	call ftpchangedirpos
6397  195B              l_451:
6398  195B              ; 144                         }
6399  195B              ; 145                         clearView();
6400  195B CD 70 18     	call clearview
6401  195E              ; 146                         needUpdateFtpList();
6402  195E CD 4F 18     	call needupdateftplist
6403  1961 C3 67 19     	jp l_449
6404  1964              l_448:
6405  1964              ; 147                     } else {
6406  1964              ; 148                         loadSelectFile();
6407  1964 CD 8C 19     	call loadselectfile
6408  1967              l_449:
6409  1967 C3 8A 19     	jp l_447
6410  196A              l_446:
6411  196A              ; 149                     }
6412  196A              ; 150                 } else if (a == 0x34) { // C (COPY)
6413  196A FE 34        	cp 52
6414  196C C2 7F 19     	jp nz, l_452
6415  196F              ; 151                     ftpViewCurrentPosIsDir();
6416  196F CD 4A 1A     	call ftpviewcurrentposisdir
6417  1972              ; 152                     if ((a = ftpDirListIsDir) == 0) {
6418  1972 3A 97 0F     	ld a, (ftpdirlistisdir)
6419  1975 B7           	or a
6420  1976 C2 7C 19     	jp nz, l_454
6421  1979              ; 153                         loadSelectFile();
6422  1979 CD 8C 19     	call loadselectfile
6423  197C              l_454:
6424  197C C3 8A 19     	jp l_453
6425  197F              l_452:
6426  197F              ; 154                     }
6427  197F              ; 155                 } else if (a == 'R') { // R (Refresh)
6428  197F FE 52        	cp 82
6429  1981 C2 8A 19     	jp nz, l_456
6430  1984              ; 156                     clearView();
6431  1984 CD 70 18     	call clearview
6432  1987              ; 157                     needUpdateFtpList();
6433  1987 CD 4F 18     	call needupdateftplist
6434  198A              l_456:
6435  198A              l_453:
6436  198A              l_447:
6437  198A              l_443:
6438  198A              l_439:
6439  198A              l_437:
6440  198A              l_434:
6441  198A E1           	pop hl
6442  198B C9           	ret
6443  198C              ; 158                 }
6444  198C              ; 159             }
6445  198C              ; 160         }
6446  198C              ; 161     }
6447  198C              ; 162 }
6448  198C              ; 163
6449  198C              ; 164 void loadSelectFile() {
6450  198C              loadselectfile:
6451  198C              ; 165     showFtpFileLoadView();
6452  198C CD 3D 1B     	call showftpfileloadview
6453  198F              ; 166     ftpFileLoadViewNeedLoad();
6454  198F CD 9C 1B     	call ftpfileloadviewneedload
6455  1992              ; 167     updateDiskList();
6456  1992 CD BE 03     	call updatedisklist
6457  1995              ; 168     updateRootUI();
6458  1995 CD 17 02     	call updaterootui
6459  1998              ; 169     showDiskList();
6460  1998 C3 CE 03     	jp showdisklist
6461  199B              ; 170 }
6462  199B              ; 171
6463  199B              ; 172 /// from ESP_I2S_BUFFER
6464  199B              ; 173 /// to ftpDirList
6465  199B              ; 174 /// count ftpDirListCount
6466  199B              ; 175 /// next ftpDirListNext
6467  199B              ; 176 void parceBufferToFile() {
6468  199B              parcebuffertofile:
6469  199B              ; 177     de = ESP_I2S_BUFFER;
6470  199B 11 77 13     	ld de, esp_i2s_buffer
6471  199E              ; 178     // (0) - порядковый номер Должен быть == ftpDirListCount + 1
6472  199E              ; 179     a = ftpDirListCount;
6473  199E 3A 96 0F     	ld a, (ftpdirlistcount)
6474  19A1              ; 180 //    b = a;
6475  19A1              ; 181 //    a = *de;
6476  19A1              ; 182 //    if (a != b) {
6477  19A1              ; 183 //        a = 0x5A;
6478  19A1              ; 184 //        ftpDirListNext = a;
6479  19A1              ; 185 //        return;
6480  19A1              ; 186 //    }
6481  19A1              ; 187     hl = ftpDirList;
6482  19A1 21 15 0E     	ld hl, ftpdirlist
6483  19A4              ; 188     b = 0;
6484  19A4 06 00        	ld b, 0
6485  19A6              ; 189     carry_rotate_left(a, 4);
6486  19A6 17           	rla
6487  19A7 17           	rla
6488  19A8 17           	rla
6489  19A9 17           	rla
6490  19AA              ; 190     if (flag_c) { // Если переполняние младшего разряда, инкремент старшего
6491  19AA D2 AE 19     	jp nc, l_458
6492  19AD              ; 191         b++;
6493  19AD 04           	inc b
6494  19AE              l_458:
6495  19AE              ; 192     }
6496  19AE              ; 193     c = a;
6497  19AE 4F           	ld c, a
6498  19AF              ; 194     hl += bc; // ftpDirList + смещение
6499  19AF 09           	add hl, bc
6500  19B0              ; 195 //    a = ftpDirListCount;
6501  19B0              ; 196 //    a ++;
6502  19B0              ; 197 //    ftpDirListCount = a;
6503  19B0              ; 198     // (1) - Флаг окончания пакета. Если 1 - то продолжаем. Любой другой - СТОП!
6504  19B0              ; 199     de++;
6505  19B0 13           	inc de
6506  19B1              ; 200     a = *de;
6507  19B1 1A           	ld a, (de)
6508  19B2              ; 201     ftpDirListNext = a;
6509  19B2 32 95 0F     	ld (ftpdirlistnext), a
6510  19B5              ; 202     if (a != 0x5A) {
6511  19B5 FE 5A        	cp 90
6512  19B7 CA C1 19     	jp z, l_460
6513  19BA              ; 203         a = ftpDirListCount;
6514  19BA 3A 96 0F     	ld a, (ftpdirlistcount)
6515  19BD              ; 204         a ++;
6516  19BD 3C           	inc a
6517  19BE              ; 205         ftpDirListCount = a;
6518  19BE 32 96 0F     	ld (ftpdirlistcount), a
6519  19C1              l_460:
6520  19C1              ; 206     }
6521  19C1              ; 207 //    if (a == 0x01) {
6522  19C1              ; 208 //        a = 1;
6523  19C1              ; 209 //        ftpDirListNext = a;
6524  19C1              ; 210 //    } else {
6525  19C1              ; 211 //        a = 0;
6526  19C1              ; 212 //        ftpDirListNext = a;
6527  19C1              ; 213 //        return;
6528  19C1              ; 214 //    }
6529  19C1              ; 215     // (2) - Флаг директоии
6530  19C1              ; 216     de++;
6531  19C1 13           	inc de
6532  19C2              ; 217     a = *de;
6533  19C2 1A           	ld a, (de)
6534  19C3              ; 218     a &= 0x01;
6535  19C3 E6 01        	and 1
6536  19C5              ; 219     ftpDirListIsDir = a;
6537  19C5 32 97 0F     	ld (ftpdirlistisdir), a
6538  19C8              ; 220     if (a == 0) {
6539  19C8 B7           	or a
6540  19C9 C2 D2 19     	jp nz, l_462
6541  19CC              ; 221         a = ' ';
6542  19CC 3E 20        	ld a, 32
6543  19CE              ; 222         *hl = a;
6544  19CE 77           	ld (hl), a
6545  19CF C3 D5 19     	jp l_463
6546  19D2              l_462:
6547  19D2              ; 223     } else {
6548  19D2              ; 224         a = ' '; //'>';
6549  19D2 3E 20        	ld a, 32
6550  19D4              ; 225         *hl = a;
6551  19D4 77           	ld (hl), a
6552  19D5              l_463:
6553  19D5              ; 226     }
6554  19D5              ; 227     hl++;
6555  19D5 23           	inc hl
6556  19D6              ; 228     // (3-4) - размер файла
6557  19D6              ; 229     de++;
6558  19D6 13           	inc de
6559  19D7              ; 230     parceSizeFileInBuffer();
6560  19D7 CD F4 19     	call parcesizefileinbuffer
6561  19DA              ; 231     // (5-) Имя файла/директории
6562  19DA              ; 232     b = 9;
6563  19DA 06 09        	ld b, 9
6564  19DC              ; 233     do {
6565  19DC              l_464:
6566  19DC              ; 234         a = *de;
6567  19DC 1A           	ld a, (de)
6568  19DD              ; 235         if (a == 0x00) {
6569  19DD B7           	or a
6570  19DE C2 E3 19     	jp nz, l_467
6571  19E1              ; 236             a = ' ';
6572  19E1 3E 20        	ld a, 32
6573  19E3              l_467:
6574  19E3              ; 237         }
6575  19E3              ; 238         *hl = a;
6576  19E3 77           	ld (hl), a
6577  19E4              ; 239         if ((a = b) == 1) {
6578  19E4 78           	ld a, b
6579  19E5 FE 01        	cp 1
6580  19E7 C2 ED 19     	jp nz, l_469
6581  19EA              ; 240             a = ' ';
6582  19EA 3E 20        	ld a, 32
6583  19EC              ; 241             *hl = a;
6584  19EC 77           	ld (hl), a
6585  19ED              l_469:
6586  19ED              ; 242         }
6587  19ED              ; 243         de++;
6588  19ED 13           	inc de
6589  19EE              ; 244         hl++;
6590  19EE 23           	inc hl
6591  19EF              ; 245         b--;
6592  19EF 05           	dec b
6593  19F0              l_465:
6594  19F0 C2 DC 19     	jp nz, l_464
6595  19F3 C9           	ret
6596  19F4              ; 246     } while (flag_nz);
6597  19F4              ; 247 }
6598  19F4              ; 248
6599  19F4              ; 249 /// HL - result string
6600  19F4              ; 250 /// DE - 2 byte size
6601  19F4              ; 251 void parceSizeFileInBuffer() {
6602  19F4              parcesizefileinbuffer:
6603  19F4              ; 252     push_pop(hl) {
6604  19F4 E5           	push hl
6605  19F5              ; 253         push_pop(bc) {
6606  19F5 C5           	push bc
6607  19F6              ; 254             bc = 9;
6608  19F6 01 09 00     	ld bc, 9
6609  19F9              ; 255             hl += bc; // смещаем указатель на позицию с размеров файла
6610  19F9 09           	add hl, bc
6611  19FA              ; 256             a = ' ';
6612  19FA 3E 20        	ld a, 32
6613  19FC              ; 257             *hl = a;
6614  19FC 77           	ld (hl), a
6615  19FD              ; 258             hl++;
6616  19FD 23           	inc hl
6617  19FE              ; 259             // Размер
6618  19FE              ; 260             if ((a = ftpDirListIsDir) == 0) {
6619  19FE 3A 97 0F     	ld a, (ftpdirlistisdir)
6620  1A01 B7           	or a
6621  1A02 C2 32 1A     	jp nz, l_471
6622  1A05              ; 261                 a = *de;
6623  1A05 1A           	ld a, (de)
6624  1A06              ; 262                 a &= 0xF0;
6625  1A06 E6 F0        	and 240
6626  1A08              ; 263                 cyclic_rotate_right(a, 4);
6627  1A08 0F           	rrca
6628  1A09 0F           	rrca
6629  1A0A 0F           	rrca
6630  1A0B 0F           	rrca
6631  1A0C              ; 264                 convert4bitToCharA();
6632  1A0C CD 77 17     	call convert4bittochara
6633  1A0F              ; 265                 *hl = a;
6634  1A0F 77           	ld (hl), a
6635  1A10              ; 266                 hl++;
6636  1A10 23           	inc hl
6637  1A11              ; 267                 a = *de;
6638  1A11 1A           	ld a, (de)
6639  1A12              ; 268                 a &= 0x0F;
6640  1A12 E6 0F        	and 15
6641  1A14              ; 269                 convert4bitToCharA();
6642  1A14 CD 77 17     	call convert4bittochara
6643  1A17              ; 270                 *hl = a;
6644  1A17 77           	ld (hl), a
6645  1A18              ; 271                 hl++;
6646  1A18 23           	inc hl
6647  1A19              ; 272                 de++;
6648  1A19 13           	inc de
6649  1A1A              ; 273
6650  1A1A              ; 274                 a = *de;
6651  1A1A 1A           	ld a, (de)
6652  1A1B              ; 275                 a &= 0xF0;
6653  1A1B E6 F0        	and 240
6654  1A1D              ; 276                 cyclic_rotate_right(a, 4);
6655  1A1D 0F           	rrca
6656  1A1E 0F           	rrca
6657  1A1F 0F           	rrca
6658  1A20 0F           	rrca
6659  1A21              ; 277                 convert4bitToCharA();
6660  1A21 CD 77 17     	call convert4bittochara
6661  1A24              ; 278                 *hl = a;
6662  1A24 77           	ld (hl), a
6663  1A25              ; 279                 hl++;
6664  1A25 23           	inc hl
6665  1A26              ; 280                 a = *de;
6666  1A26 1A           	ld a, (de)
6667  1A27              ; 281                 a &= 0x0F;
6668  1A27 E6 0F        	and 15
6669  1A29              ; 282                 convert4bitToCharA();
6670  1A29 CD 77 17     	call convert4bittochara
6671  1A2C              ; 283                 *hl = a;
6672  1A2C 77           	ld (hl), a
6673  1A2D              ; 284                 hl++;
6674  1A2D 23           	inc hl
6675  1A2E              ; 285                 de++;
6676  1A2E 13           	inc de
6677  1A2F C3 44 1A     	jp l_472
6678  1A32              l_471:
6679  1A32              ; 286             } else {
6680  1A32              ; 287                 a = ' ';
6681  1A32 3E 20        	ld a, 32
6682  1A34              ; 288                 *hl = a;
6683  1A34 77           	ld (hl), a
6684  1A35              ; 289                 hl++;
6685  1A35 23           	inc hl
6686  1A36              ; 290                 a = 'D';
6687  1A36 3E 44        	ld a, 68
6688  1A38              ; 291                 *hl = a;
6689  1A38 77           	ld (hl), a
6690  1A39              ; 292                 hl++;
6691  1A39 23           	inc hl
6692  1A3A              ; 293                 a = 'I';
6693  1A3A 3E 49        	ld a, 73
6694  1A3C              ; 294                 *hl = a;
6695  1A3C 77           	ld (hl), a
6696  1A3D              ; 295                 hl++;
6697  1A3D 23           	inc hl
6698  1A3E              ; 296                 a = 'R';
6699  1A3E 3E 52        	ld a, 82
6700  1A40              ; 297                 *hl = a;
6701  1A40 77           	ld (hl), a
6702  1A41              ; 298                 hl++;
6703  1A41 23           	inc hl
6704  1A42              ; 299                 de++;
6705  1A42 13           	inc de
6706  1A43              ; 300                 de++;
6707  1A43 13           	inc de
6708  1A44              l_472:
6709  1A44              ; 301             }
6710  1A44              ; 302             //
6711  1A44              ; 303             a = 0;
6712  1A44 3E 00        	ld a, 0
6713  1A46              ; 304             *hl = a; // End char string
6714  1A46 77           	ld (hl), a
6715  1A47 C1           	pop bc
6716  1A48 E1           	pop hl
6717  1A49 C9           	ret
6718  1A4A              ; 305         }
6719  1A4A              ; 306     }
6720  1A4A              ; 307 }
6721  1A4A              ; 308
6722  1A4A              ; 309 void ftpViewCurrentPosIsDir() {
6723  1A4A              ftpviewcurrentposisdir:
6724  1A4A              ; 310     push_pop(hl) {
6725  1A4A E5           	push hl
6726  1A4B              ; 311         push_pop(bc) {
6727  1A4B C5           	push bc
6728  1A4C              ; 312             hl = ftpDirList;
6729  1A4C 21 15 0E     	ld hl, ftpdirlist
6730  1A4F              ; 313             a = ftpViewCurrentPos;
6731  1A4F 3A 98 0F     	ld a, (ftpviewcurrentpos)
6732  1A52              ; 314             b = 0;
6733  1A52 06 00        	ld b, 0
6734  1A54              ; 315             carry_rotate_left(a, 4);
6735  1A54 17           	rla
6736  1A55 17           	rla
6737  1A56 17           	rla
6738  1A57 17           	rla
6739  1A58              ; 316             if (flag_c) { // Если переполняние младшего разряда, инкремент старшего
6740  1A58 D2 5C 1A     	jp nc, l_473
6741  1A5B              ; 317                 b++;
6742  1A5B 04           	inc b
6743  1A5C              l_473:
6744  1A5C              ; 318             }
6745  1A5C              ; 319             c = a;
6746  1A5C 4F           	ld c, a
6747  1A5D              ; 320             hl += bc;
6748  1A5D 09           	add hl, bc
6749  1A5E              ; 321             // + 12 (DIR)
6750  1A5E              ; 322             bc = 12;
6751  1A5E 01 0C 00     	ld bc, 12
6752  1A61              ; 323             hl += bc;
6753  1A61 09           	add hl, bc
6754  1A62              ; 324             a = *hl;
6755  1A62 7E           	ld a, (hl)
6756  1A63              ; 325             if (a == 'D') {
6757  1A63 FE 44        	cp 68
6758  1A65 C2 6D 1A     	jp nz, l_475
6759  1A68              ; 326                 a = 1;
6760  1A68 3E 01        	ld a, 1
6761  1A6A C3 6F 1A     	jp l_476
6762  1A6D              l_475:
6763  1A6D              ; 327             } else {
6764  1A6D              ; 328                 a = 0;
6765  1A6D 3E 00        	ld a, 0
6766  1A6F              l_476:
6767  1A6F              ; 329             }
6768  1A6F              ; 330             ftpDirListIsDir = a;
6769  1A6F 32 97 0F     	ld (ftpdirlistisdir), a
6770  1A72 C1           	pop bc
6771  1A73 E1           	pop hl
6772  1A74 C9           	ret
6773  1A75              ; 11 void showFtpView() {
6774  1A75              showftpview:
6775  1A75              ; 12     drowRectX = (a = ftpSettingsViewX);
6776  1A75 3A 59 0D     	ld a, (ftpsettingsviewx)
6777  1A78 32 B8 03     	ld (drowrectx), a
6778  1A7B              ; 13     drowRectY = (a = ftpSettingsViewY);
6779  1A7B 3A 5A 0D     	ld a, (ftpsettingsviewy)
6780  1A7E 32 B9 03     	ld (drowrecty), a
6781  1A81              ; 14     drowRectEndX = (a = ftpSettingsViewEX);
6782  1A81 3A 5B 0D     	ld a, (ftpsettingsviewex)
6783  1A84 32 BA 03     	ld (drowrectendx), a
6784  1A87              ; 15     drowRectEndY = (a = ftpSettingsViewEY);
6785  1A87 3A 5C 0D     	ld a, (ftpsettingsviewey)
6786  1A8A 32 BB 03     	ld (drowrectendy), a
6787  1A8D              ; 16     drowRect();
6788  1A8D CD 24 03     	call drowrect
6789  1A90              ; 17
6790  1A90              ; 18     hl = ftpSettingsLabelPos;
6791  1A90 2A 5D 0D     	ld hl, (ftpsettingslabelpos)
6792  1A93              ; 19     setPosCursor();
6793  1A93 CD 3C F8     	call setposcursor
6794  1A96              ; 20     hl = ftpSettingsLabel;
6795  1A96 21 5F 0D     	ld hl, ftpsettingslabel
6796  1A99              ; 21     printHLStr();
6797  1A99 CD 18 F8     	call printhlstr
6798  1A9C              ; 22
6799  1A9C              ; 23     hl = ftpSettingsStatusLabelPos;
6800  1A9C 2A 84 0D     	ld hl, (ftpsettingsstatuslabelpos)
6801  1A9F              ; 24     setPosCursor();
6802  1A9F CD 3C F8     	call setposcursor
6803  1AA2              ; 25     hl = ftpSettingsStatusLabel;
6804  1AA2 21 86 0D     	ld hl, ftpsettingsstatuslabel
6805  1AA5              ; 26     printHLStr();
6806  1AA5 CD 18 F8     	call printhlstr
6807  1AA8              ; 27
6808  1AA8              ; 28     hl = ftpSettingsIpLabelPos;
6809  1AA8 2A 6E 0D     	ld hl, (ftpsettingsiplabelpos)
6810  1AAB              ; 29     setPosCursor();
6811  1AAB CD 3C F8     	call setposcursor
6812  1AAE              ; 30     hl = ftpSettingsIpLabel;
6813  1AAE 21 70 0D     	ld hl, ftpsettingsiplabel
6814  1AB1              ; 31     printHLStr();
6815  1AB1 CD 18 F8     	call printhlstr
6816  1AB4              ; 32
6817  1AB4              ; 33     hl = ftpSettingsPortLabelPos;
6818  1AB4 2A 74 0D     	ld hl, (ftpsettingsportlabelpos)
6819  1AB7              ; 34     setPosCursor();
6820  1AB7 CD 3C F8     	call setposcursor
6821  1ABA              ; 35     hl = ftpSettingsPortLabel;
6822  1ABA 21 76 0D     	ld hl, ftpsettingsportlabel
6823  1ABD              ; 36     printHLStr();
6824  1ABD CD 18 F8     	call printhlstr
6825  1AC0              ; 37
6826  1AC0              ; 38     hl = ftpSettingsUserLabelPos;
6827  1AC0 2A 7C 0D     	ld hl, (ftpsettingsuserlabelpos)
6828  1AC3              ; 39     setPosCursor();
6829  1AC3 CD 3C F8     	call setposcursor
6830  1AC6              ; 40     hl = ftpSettingsUserLabel;
6831  1AC6 21 7E 0D     	ld hl, ftpsettingsuserlabel
6832  1AC9              ; 41     printHLStr();
6833  1AC9 CD 18 F8     	call printhlstr
6834  1ACC              ; 42
6835  1ACC              ; 43     //Value
6836  1ACC              ; 44     hl = ftpSettingsIpValuePos;
6837  1ACC 2A 8E 0D     	ld hl, (ftpsettingsipvaluepos)
6838  1ACF              ; 45     setPosCursor();
6839  1ACF CD 3C F8     	call setposcursor
6840  1AD2              ; 46     hl = ftpSettingsIpValue;
6841  1AD2 21 90 0D     	ld hl, ftpsettingsipvalue
6842  1AD5              ; 47     printHLStr();
6843  1AD5 CD 18 F8     	call printhlstr
6844  1AD8              ; 48
6845  1AD8              ; 49     hl = ftpSettingsPortValuePos;
6846  1AD8 2A A0 0D     	ld hl, (ftpsettingsportvaluepos)
6847  1ADB              ; 50     setPosCursor();
6848  1ADB CD 3C F8     	call setposcursor
6849  1ADE              ; 51     hl = ftpSettingsPortValue;
6850  1ADE 21 A2 0D     	ld hl, ftpsettingsportvalue
6851  1AE1              ; 52     printHLStr();
6852  1AE1 CD 18 F8     	call printhlstr
6853  1AE4              ; 53
6854  1AE4              ; 54     hl = ftpSettingsUserValuePos;
6855  1AE4 2A D0 0D     	ld hl, (ftpsettingsuservaluepos)
6856  1AE7              ; 55     setPosCursor();
6857  1AE7 CD 3C F8     	call setposcursor
6858  1AEA              ; 56     hl = ftpSettingsUserValue;
6859  1AEA 21 D2 0D     	ld hl, ftpsettingsuservalue
6860  1AED              ; 57     printHLStr();
6861  1AED CD 18 F8     	call printhlstr
6862  1AF0              ; 58
6863  1AF0              ; 59     updateFtpViewStatusText();
6864  1AF0 CD 0E 1B     	call updateftpviewstatustext
6865  1AF3              ; 60     updateFtpViewValData();
6866  1AF3 C3 02 1B     	jp updateftpviewvaldata
6867  1AF6              ; 61 }
6868  1AF6              ; 62
6869  1AF6              ; 63 void clearFtpViewValData() {
6870  1AF6              clearftpviewvaldata:
6871  1AF6              ; 64     hl = ftpSettingsStatusValuePos;
6872  1AF6 2A A8 0D     	ld hl, (ftpsettingsstatusvaluepos)
6873  1AF9              ; 65     setPosCursor();
6874  1AF9 CD 3C F8     	call setposcursor
6875  1AFC              ; 66     hl = wifiSettingsEmpty18;
6876  1AFC 21 47 0D     	ld hl, wifisettingsempty18
6877  1AFF              ; 67     printHLStr();
6878  1AFF C3 18 F8     	jp printhlstr
6879  1B02              ; 68 }
6880  1B02              ; 69
6881  1B02              ; 70 void updateFtpViewValData() {
6882  1B02              updateftpviewvaldata:
6883  1B02              ; 71     hl = ftpSettingsStatusValuePos;
6884  1B02 2A A8 0D     	ld hl, (ftpsettingsstatusvaluepos)
6885  1B05              ; 72     setPosCursor();
6886  1B05 CD 3C F8     	call setposcursor
6887  1B08              ; 73     hl = ftpSettingsStatusValue;
6888  1B08 21 AA 0D     	ld hl, ftpsettingsstatusvalue
6889  1B0B              ; 74     printHLStr();
6890  1B0B C3 18 F8     	jp printhlstr
6891  1B0E              ; 75 }
6892  1B0E              ; 76
6893  1B0E              ; 77 void updateFtpViewStatusText() {
6894  1B0E              updateftpviewstatustext:
6895  1B0E              ; 78     push_pop(hl) {
6896  1B0E E5           	push hl
6897  1B0F              ; 79         push_pop(de) {
6898  1B0F D5           	push de
6899  1B10              ; 80             push_pop(bc) {
6900  1B10 C5           	push bc
6901  1B11              ; 81
6902  1B11              ; 82                 if ((a = ftpSettingsStateVal) == 0x00) {
6903  1B11 3A B6 0D     	ld a, (ftpsettingsstateval)
6904  1B14 B7           	or a
6905  1B15 C2 1E 1B     	jp nz, l_477
6906  1B18              ; 83                     hl = ftpSettingsStatus0;
6907  1B18 21 B8 0D     	ld hl, ftpsettingsstatus0
6908  1B1B C3 21 1B     	jp l_478
6909  1B1E              l_477:
6910  1B1E              ; 84                 } else {
6911  1B1E              ; 85                     hl = ftpSettingsStatus1;
6912  1B1E 21 C4 0D     	ld hl, ftpsettingsstatus1
6913  1B21              l_478:
6914  1B21              ; 86                 }
6915  1B21              ; 87
6916  1B21              ; 88                 de = ftpSettingsStatusValue;
6917  1B21 11 AA 0D     	ld de, ftpsettingsstatusvalue
6918  1B24              ; 89                 //Copy *hl to *de
6919  1B24              ; 90                 b = 12;
6920  1B24 06 0C        	ld b, 12
6921  1B26              ; 91                 do {
6922  1B26              l_479:
6923  1B26              ; 92                     a = *hl;
6924  1B26 7E           	ld a, (hl)
6925  1B27              ; 93                     *de = a;
6926  1B27 12           	ld (de), a
6927  1B28              ; 94                     if ((a = b) == 1) {
6928  1B28 78           	ld a, b
6929  1B29 FE 01        	cp 1
6930  1B2B C2 31 1B     	jp nz, l_482
6931  1B2E              ; 95                         a = 0;
6932  1B2E 3E 00        	ld a, 0
6933  1B30              ; 96                         *de = a;
6934  1B30 12           	ld (de), a
6935  1B31              l_482:
6936  1B31              ; 97                     }
6937  1B31              ; 98                     de++;
6938  1B31 13           	inc de
6939  1B32              ; 99                     hl++;
6940  1B32 23           	inc hl
6941  1B33              ; 100                     b--;
6942  1B33 05           	dec b
6943  1B34              l_480:
6944  1B34              ; 101                 } while ((a = b) > 0);
6945  1B34 78           	ld a, b
6946  1B35 B7           	or a
6947  1B36 C2 26 1B     	jp nz, l_479
6948  1B39 C1           	pop bc
6949  1B3A D1           	pop de
6950  1B3B E1           	pop hl
6951  1B3C C9           	ret
6952  1B3D              ; 11 void showFtpFileLoadView() {
6953  1B3D              showftpfileloadview:
6954  1B3D              ; 12     drowRectX = (a = FtpFileLoadViewX);
6955  1B3D 3A 25 1C     	ld a, (ftpfileloadviewx)
6956  1B40 32 B8 03     	ld (drowrectx), a
6957  1B43              ; 13     drowRectY = (a = FtpFileLoadViewY);
6958  1B43 3A 26 1C     	ld a, (ftpfileloadviewy)
6959  1B46 32 B9 03     	ld (drowrecty), a
6960  1B49              ; 14     drowRectEndX = (a = FtpFileLoadViewEX);
6961  1B49 3A 27 1C     	ld a, (ftpfileloadviewex)
6962  1B4C 32 BA 03     	ld (drowrectendx), a
6963  1B4F              ; 15     drowRectEndY = (a = FtpFileLoadViewEY);
6964  1B4F 3A 28 1C     	ld a, (ftpfileloadviewey)
6965  1B52 32 BB 03     	ld (drowrectendy), a
6966  1B55              ; 16     drowRect();
6967  1B55 CD 24 03     	call drowrect
6968  1B58              ; 17
6969  1B58              ; 18     hl = FtpFileLoadViewTitlelPos;
6970  1B58 2A 29 1C     	ld hl, (ftpfileloadviewtitlelpos)
6971  1B5B              ; 19     setPosCursor();
6972  1B5B CD 3C F8     	call setposcursor
6973  1B5E              ; 20     hl = FtpFileLoadViewTitlel;
6974  1B5E 21 2B 1C     	ld hl, ftpfileloadviewtitlel
6975  1B61              ; 21     printHLStr();
6976  1B61 C3 18 F8     	jp printhlstr
6977  1B64              ; 22 }
6978  1B64              ; 23
6979  1B64              ; 24 void updateProgress() {
6980  1B64              updateprogress:
6981  1B64              ; 25     push_pop(hl) {
6982  1B64 E5           	push hl
6983  1B65              ; 26         push_pop(bc) {
6984  1B65 C5           	push bc
6985  1B66              ; 27             a = FtpFileLoadViewY;
6986  1B66 3A 26 1C     	ld a, (ftpfileloadviewy)
6987  1B69              ; 28             a += 1;
6988  1B69 C6 01        	add 1
6989  1B6B              ; 29             h = a;
6990  1B6B 67           	ld h, a
6991  1B6C              ; 30             a = FtpFileLoadViewX;
6992  1B6C 3A 25 1C     	ld a, (ftpfileloadviewx)
6993  1B6F              ; 31             a += 2;
6994  1B6F C6 02        	add 2
6995  1B71              ; 32             l = a;
6996  1B71 6F           	ld l, a
6997  1B72              ; 33             setPosCursor();
6998  1B72 CD 3C F8     	call setposcursor
6999  1B75              ; 34             h = 0;
7000  1B75 26 00        	ld h, 0
7001  1B77              ; 35             a = ftpFileLoadViewProgress;
7002  1B77 3A 24 1C     	ld a, (ftpfileloadviewprogress)
7003  1B7A              ; 36             l = a;
7004  1B7A 6F           	ld l, a
7005  1B7B              ; 37             //
7006  1B7B              ; 38             setMyFont();
7007  1B7B CD A0 03     	call setmyfont
7008  1B7E              ; 39             do {
7009  1B7E              l_484:
7010  1B7E              ; 40                 h++;
7011  1B7E 24           	inc h
7012  1B7F              ; 41                 if ((a = h) < l) {
7013  1B7F 7C           	ld a, h
7014  1B80 BD           	cp l
7015  1B81 D2 89 1B     	jp nc, l_487
7016  1B84              ; 42                     c = 0x28; //'X';
7017  1B84 0E 28        	ld c, 40
7018  1B86 C3 8B 1B     	jp l_488
7019  1B89              l_487:
7020  1B89              ; 43                 } else {
7021  1B89              ; 44                     c = 0x27; //' ';
7022  1B89 0E 27        	ld c, 39
7023  1B8B              l_488:
7024  1B8B              ; 45                 }
7025  1B8B              ; 46                 push_pop(hl) {
7026  1B8B E5           	push hl
7027  1B8C              ; 47                     printChatC();
7028  1B8C CD 09 F8     	call printchatc
7029  1B8F E1           	pop hl
7030  1B90              l_485:
7031  1B90              ; 48                 }
7032  1B90              ; 49             } while ((a = h) < 40);
7033  1B90 7C           	ld a, h
7034  1B91 FE 28        	cp 40
7035  1B93 DA 7E 1B     	jp c, l_484
7036  1B96              ; 50             setSystemFont();
7037  1B96 CD AF 03     	call setsystemfont
7038  1B99 C1           	pop bc
7039  1B9A E1           	pop hl
7040  1B9B C9           	ret
7041  1B9C              ; 51         }
7042  1B9C              ; 52     }
7043  1B9C              ; 53 }
7044  1B9C              ; 54
7045  1B9C              ; 55 void ftpFileLoadViewNeedLoad() {
7046  1B9C              ftpfileloadviewneedload:
7047  1B9C              ; 56     ftpFileDownload();
7048  1B9C CD B9 17     	call ftpfiledownload
7049  1B9F              ; 57
7050  1B9F              ; 58     // Считываем текущий диск и устанавливаем его
7051  1B9F              ; 59     a = diskViewDiskNum;
7052  1B9F 3A F2 0D     	ld a, (diskviewdisknum)
7053  1BA2              ; 60     ordos_wnd();
7054  1BA2 CD D6 BF     	call ordos_wnd
7055  1BA5              ; 61
7056  1BA5              ; 62     // Получаем адрес куда надо начинать писать данные
7057  1BA5              ; 63     ordos_mxdsk();
7058  1BA5 CD B8 BF     	call ordos_mxdsk
7059  1BA8              ; 64     diskStartNewFile = hl;
7060  1BA8 22 06 0E     	ld (diskstartnewfile), hl
7061  1BAB              ; 65
7062  1BAB              ; 66     // Вызываем закачку
7063  1BAB              ; 67     ftpFileDownloadNext();
7064  1BAB CD D2 17     	call ftpfiledownloadnext
7065  1BAE              ; 68
7066  1BAE              ; 69     // Обновляем
7067  1BAE              ; 70     updateDiskList();
7068  1BAE CD BE 03     	call updatedisklist
7069  1BB1              ; 71     updateRootUI();
7070  1BB1 C3 17 02     	jp updaterootui
7071  1BB4              ; 72 }
7072  1BB4              ; 73
7073  1BB4              ; 74 void ftpFileLoadViewParce() {
7074  1BB4              ftpfileloadviewparce:
7075  1BB4              ; 75     push_pop(de) {
7076  1BB4 D5           	push de
7077  1BB5              ; 76         push_pop(hl) {
7078  1BB5 E5           	push hl
7079  1BB6              ; 77             push_pop(bc) {
7080  1BB6 C5           	push bc
7081  1BB7              ; 78                 de = ESP_I2S_BUFFER;
7082  1BB7 11 77 13     	ld de, esp_i2s_buffer
7083  1BBA              ; 79                 //addr
7084  1BBA              ; 80                 de++;
7085  1BBA 13           	inc de
7086  1BBB              ; 81                 de++;
7087  1BBB 13           	inc de
7088  1BBC              ; 82                 //stopByte
7089  1BBC              ; 83                 a = *de;
7090  1BBC 1A           	ld a, (de)
7091  1BBD              ; 84                 //a &= 0x01;
7092  1BBD              ; 85                 ftpFileLoadViewIsNextData = a;
7093  1BBD 32 1F 1C     	ld (ftpfileloadviewisnextdata), a
7094  1BC0              ; 86                 de++;
7095  1BC0 13           	inc de
7096  1BC1              ; 87                 //sum
7097  1BC1              ; 88                 a = *de;
7098  1BC1 1A           	ld a, (de)
7099  1BC2              ; 89                 ftpFileLoadViewCheckSum = a;
7100  1BC2 32 22 1C     	ld (ftpfileloadviewchecksum), a
7101  1BC5              ; 90                 de++;
7102  1BC5 13           	inc de
7103  1BC6              ; 91                 // PROGRESS
7104  1BC6              ; 92                 a = *de;
7105  1BC6 1A           	ld a, (de)
7106  1BC7              ; 93                 ftpFileLoadViewProgress = a;
7107  1BC7 32 24 1C     	ld (ftpfileloadviewprogress), a
7108  1BCA              ; 94                 de++;
7109  1BCA 13           	inc de
7110  1BCB              ; 95                 // PAGE SIZE
7111  1BCB              ; 96                 a = *de;
7112  1BCB 1A           	ld a, (de)
7113  1BCC              ; 97                 if (a >= 15) {
7114  1BCC FE 0F        	cp 15
7115  1BCE DA D3 1B     	jp c, l_489
7116  1BD1              ; 98                     a = 15;
7117  1BD1 3E 0F        	ld a, 15
7118  1BD3              l_489:
7119  1BD3              ; 99                 }
7120  1BD3              ; 100                 de++;
7121  1BD3 13           	inc de
7122  1BD4              ; 101                 //CHECK SUM
7123  1BD4              ; 102                 b = a; // SAVE PAGE SIZE in B
7124  1BD4 47           	ld b, a
7125  1BD5              ; 103                 push_pop(de) {
7126  1BD5 D5           	push de
7127  1BD6              ; 104                     push_pop(bc) {
7128  1BD6 C5           	push bc
7129  1BD7              ; 105                         h = 0; //SUM!!!
7130  1BD7 26 00        	ld h, 0
7131  1BD9              ; 106                         do {
7132  1BD9              l_491:
7133  1BD9              ; 107                             a = *de;
7134  1BD9 1A           	ld a, (de)
7135  1BDA              ; 108                             a += h;
7136  1BDA 84           	add h
7137  1BDB              ; 109                             h = a;
7138  1BDB 67           	ld h, a
7139  1BDC              ; 110                             de++;
7140  1BDC 13           	inc de
7141  1BDD              ; 111                             b--;
7142  1BDD 05           	dec b
7143  1BDE              l_492:
7144  1BDE              ; 112                         } while ((a = b) > 0);
7145  1BDE 78           	ld a, b
7146  1BDF B7           	or a
7147  1BE0 C2 D9 1B     	jp nz, l_491
7148  1BE3 C1           	pop bc
7149  1BE4 D1           	pop de
7150  1BE5              ; 113                     }
7151  1BE5              ; 114                 }
7152  1BE5              ; 115                 //
7153  1BE5              ; 116                 if ((a = ftpFileLoadViewCheckSum) == h) {
7154  1BE5 3A 22 1C     	ld a, (ftpfileloadviewchecksum)
7155  1BE8 BC           	cp h
7156  1BE9 C2 16 1C     	jp nz, l_494
7157  1BEC              ; 117                     // Сумма корректная
7158  1BEC              ; 118                     if ((a = ftpFileLoadViewIsNextData) == 0) {
7159  1BEC 3A 1F 1C     	ld a, (ftpfileloadviewisnextdata)
7160  1BEF B7           	or a
7161  1BF0 C2 F9 1B     	jp nz, l_496
7162  1BF3              ; 119                         // Данных больше нет - закрываем файл!
7163  1BF3              ; 120                         ordos_stop();
7164  1BF3 CD E2 BF     	call ordos_stop
7165  1BF6 C3 0B 1C     	jp l_497
7166  1BF9              l_496:
7167  1BF9              ; 121                     } else {
7168  1BF9              ; 122                         // Данные корректны и еще есть - пишем
7169  1BF9              ; 123                         // DATA
7170  1BF9              ; 124                         hl = diskStartNewFile;
7171  1BF9 2A 06 0E     	ld hl, (diskstartnewfile)
7172  1BFC              ; 125                         do {
7173  1BFC              l_498:
7174  1BFC              ; 126                             a = *de;
7175  1BFC 1A           	ld a, (de)
7176  1BFD              ; 127                             ordos_wdisk();
7177  1BFD CD DF BF     	call ordos_wdisk
7178  1C00              ; 128                             //SUM
7179  1C00              ; 129                             hl++;
7180  1C00 23           	inc hl
7181  1C01              ; 130                             de++;
7182  1C01 13           	inc de
7183  1C02              ; 131                             b--;
7184  1C02 05           	dec b
7185  1C03              l_499:
7186  1C03              ; 132                         } while ((a = b) > 0);
7187  1C03 78           	ld a, b
7188  1C04 B7           	or a
7189  1C05 C2 FC 1B     	jp nz, l_498
7190  1C08              ; 133                         diskStartNewFile = hl;
7191  1C08 22 06 0E     	ld (diskstartnewfile), hl
7192  1C0B              l_497:
7193  1C0B              ; 134                     }
7194  1C0B              ; 135                     // Получить следующий пакет
7195  1C0B              ; 136                     a = 0x01;
7196  1C0B 3E 01        	ld a, 1
7197  1C0D              ; 137                     ftpFileLoadViewCheckSumState = a;
7198  1C0D 32 23 1C     	ld (ftpfileloadviewchecksumstate), a
7199  1C10              ; 138                     // Если считано без ошибок - то отрисовываем прогресс
7200  1C10              ; 139                     updateProgress();
7201  1C10 CD 64 1B     	call updateprogress
7202  1C13 C3 1B 1C     	jp l_495
7203  1C16              l_494:
7204  1C16              ; 140                 } else {
7205  1C16              ; 141                     // Получить пакет снова!
7206  1C16              ; 142                     a = 0x00;
7207  1C16 3E 00        	ld a, 0
7208  1C18              ; 143                     ftpFileLoadViewCheckSumState = a;
7209  1C18 32 23 1C     	ld (ftpfileloadviewchecksumstate), a
7210  1C1B              l_495:
7211  1C1B C1           	pop bc
7212  1C1C E1           	pop hl
7213  1C1D D1           	pop de
7214  1C1E C9           	ret
7215  1C1F              ; 144                 }
7216  1C1F              ; 145             }
7217  1C1F              ; 146         }
7218  1C1F              ; 147     }
7219  1C1F              ; 148 }
7220  1C1F              ; 149
7221  1C1F              ; 150 uint8_t ftpFileLoadViewIsNextData = 0;
7222  1C1F              ftpfileloadviewisnextdata:
7223  1C1F 00           	db 0
7224  1C20              ; 151 uint16_t ftpFileLoadViewFileAddrPos = 0x0000;
7225  1C20              ftpfileloadviewfileaddrpos:
7226  1C20 00 00        	dw 0
7227  1C22              ; 152 uint8_t ftpFileLoadViewCheckSum = 0;
7228  1C22              ftpfileloadviewchecksum:
7229  1C22 00           	db 0
7230  1C23              ; 153 uint8_t ftpFileLoadViewCheckSumState = 0;
7231  1C23              ftpfileloadviewchecksumstate:
7232  1C23 00           	db 0
7233  1C24              ; 154 uint8_t ftpFileLoadViewProgress = 0;
7234  1C24              ftpfileloadviewprogress:
7235  1C24 00           	db 0
7236  1C25              ; 156 uint8_t FtpFileLoadViewX = 10;
7237  1C25              ftpfileloadviewx:
7238  1C25 0A           	db 10
7239  1C26              ; 157 uint8_t FtpFileLoadViewY = 11;
7240  1C26              ftpfileloadviewy:
7241  1C26 0B           	db 11
7242  1C27              ; 158 uint8_t FtpFileLoadViewEX = 54;
7243  1C27              ftpfileloadviewex:
7244  1C27 36           	db 54
7245  1C28              ; 159 uint8_t FtpFileLoadViewEY = 14;
7246  1C28              ftpfileloadviewey:
7247  1C28 0E           	db 14
7248  1C29              ; 161 uint16_t FtpFileLoadViewTitlelPos = 0x0B1D; //031B
7249  1C29              ftpfileloadviewtitlelpos:
7250  1C29 1D 0B        	dw 2845
7251  1C2B              ; 162 uint8_t FtpFileLoadViewTitlel[] = " LOAD ";
7252  1C2B              ftpfileloadviewtitlel:
7253  1C2B 20           	db 32
7254  1C2C 4C           	db 76
7255  1C2D 4F           	db 79
7256  1C2E 41           	db 65
7257  1C2F 44           	db 68
7258  1C30 20           	db 32
7259  1C31 00           	ds 1
7260  1C32              ; 30 uint8_t rootTimerTike = 0;
7261  1C32              roottimertike:
7262  1C32 00           	db 0
7263  1C33               savebin "test.ORD", 0x00f0, 0x1C0f
7264  1C33
# file closed: main.asm
